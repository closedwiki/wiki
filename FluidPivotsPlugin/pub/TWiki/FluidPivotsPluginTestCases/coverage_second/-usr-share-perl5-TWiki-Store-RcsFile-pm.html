<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Store/RcsFile.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Store/RcsFile.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">20.5%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Module of TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2002 John Talintyre, john.talintyre@btinternet.com</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2002-2007 Peter Thoeny, peter@thoeny.org</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and TWiki Contributors. All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">20</td><td colspan="6"></td></tr><tr><td class="h">21 - 34</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TWiki::Store::RcsFile

This class is PACKAGE PRIVATE to Store, and should never be
used from anywhere else. Base class of implementations of stores
that manipulate RCS format files.

The general contract of the methods on this class and its subclasses
calls for errors to be signalled by Error::Simple exceptions.

Refer to Store.pm for models of usage.

=cut</pre></td></tr>
<tr><td class="h">35</td><td colspan="6"></td></tr><tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Store::RcsFile;</td></tr>
<tr><td class="h">37</td><td colspan="6"></td></tr><tr><td class="h">38</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L38">1</a></div></td><td><div>5</div><div>3</div><div>5</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">39</td><td colspan="6"></td></tr><tr><td class="h">40</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L40">1</a></div></td><td><div>6</div><div>3</div><div>5</div></td><td class="s">use File::Copy;</td></tr>
<tr><td class="h">41</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L41">1</a></div></td><td><div>7</div><div>5</div><div>7</div></td><td class="s">use File::Spec;</td></tr>
<tr><td class="h">42</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L42">1</a></div></td><td><div>6</div><div>3</div><div>9</div></td><td class="s">use File::Path;</td></tr>
<tr><td class="h">43</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L43">1</a></div></td><td><div>7</div><div>3</div><div>8</div></td><td class="s">use File::Basename;</td></tr>
<tr><td class="h">44</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L44">1</a></div></td><td><div>7</div><div>2</div><div>8</div></td><td class="s">use Assert;</td></tr>
<tr><td class="h">45</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L45">1</a></div></td><td><div>7</div><div>2</div><div>7</div></td><td class="s">use TWiki::Time;</td></tr>
<tr><td class="h">46</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L46">1</a></div></td><td><div>6</div><div>2</div><div>8</div></td><td class="s">use TWiki::Sandbox;</td></tr>
<tr><td class="h">47</td><td colspan="6"></td></tr><tr><td class="h">48 - 56</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ClassMethod new($session, $web, $topic, $attachment)

Constructor. There is one object per stored file.

Note that $web, $topic and $attachment must be untainted!

=cut</pre></td></tr>
<tr><td class="h">57</td><td colspan="6"></td></tr><tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">59</td><td><div class="c3">148</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L59">148</a></div></td><td><div>599</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $class, $session, $web, $topic, $attachment ) = @_;</td></tr>
<tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#ASSERT($session-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">61</td><td><div class="c3">148</div></td><td></td><td></td><td></td><td><div>845</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = bless( {}, $class );</td></tr>
<tr><td class="h">62</td><td><div class="c3">148</div></td><td></td><td></td><td></td><td><div>639</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session} = $session;</td></tr>
<tr><td class="h">63</td><td colspan="6"></td></tr><tr><td class="h">64</td><td><div class="c3">148</div></td><td></td><td></td><td></td><td><div>551</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{web} = $web;</td></tr>
<tr><td class="h">65</td><td colspan="6"></td></tr><tr><td class="h">66</td><td><div class="c3">148</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L66">100</a></div></td><td></td><td></td><td><div>675</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $topic ) {</td></tr>
<tr><td class="h">67</td><td><div class="c3">141</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L67">50</a></div></td><td></td><td></td><td><div>846</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rcsSubDir = ( $TWiki::cfg{RCS}{useSubDir} ? &#39;/RCS&#39; : &#39;&#39; );</td></tr>
<tr><td class="h">68</td><td colspan="6"></td></tr><tr><td class="h">69</td><td><div class="c3">141</div></td><td></td><td></td><td></td><td><div>519</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topic} = $topic;</td></tr>
<tr><td class="h">70</td><td colspan="6"></td></tr><tr><td class="h">71</td><td><div class="c3">141</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L71">100</a></div></td><td></td><td></td><td><div>529</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $attachment ) {</td></tr>
<tr><td class="h">72</td><td colspan="6"></td></tr><tr><td class="h">73</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{attachment} = $attachment;</td></tr>
<tr><td class="h">74</td><td colspan="6"></td></tr><tr><td class="h">75</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{file} = $TWiki::cfg{PubDir}.&#39;/&#39;.$web.&#39;/&#39;.</td></tr>
<tr><td class="h">76</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topic}.&#39;/&#39;.$attachment;</td></tr>
<tr><td class="h">77</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{rcsFile} = $TWiki::cfg{PubDir}.&#39;/&#39;.</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web.&#39;/&#39;.$topic.$rcsSubDir.&#39;/&#39;.$attachment.&#39;,v&#39;;</td></tr>
<tr><td class="h">79</td><td colspan="6"></td></tr><tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">81</td><td><div class="c3">140</div></td><td></td><td></td><td></td><td><div>958</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{file} = $TWiki::cfg{DataDir}.&#39;/&#39;.$web.&#39;/&#39;.</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic.&#39;.txt&#39;;</td></tr>
<tr><td class="h">83</td><td><div class="c3">140</div></td><td></td><td></td><td></td><td><div>857</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{rcsFile} = $TWiki::cfg{DataDir}.&#39;/&#39;.</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web.$rcsSubDir.&#39;/&#39;.$topic.&#39;.txt,v&#39;;</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">86</td><td colspan="6"></td></tr><tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# remove utf8 encodings from filenames</td></tr>
<tr><td class="h">88</td><td><div class="c3">141</div></td><td></td><td></td><td></td><td><div>719</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downgrade($this-&gt;{attachment});</td></tr>
<tr><td class="h">89</td><td><div class="c3">141</div></td><td></td><td></td><td></td><td><div>624</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downgrade($this-&gt;{file});</td></tr>
<tr><td class="h">90</td><td><div class="c3">141</div></td><td></td><td></td><td></td><td><div>536</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downgrade($this-&gt;{rcsFile});</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">92</td><td colspan="6"></td></tr><tr><td class="h">93</td><td><div class="c3">148</div></td><td></td><td></td><td></td><td><div>934</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this;</td></tr>
<tr><td class="h">94</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">95</td><td colspan="6"></td></tr><tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td class="s"># downgrade utf8 encoding of files</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub downgrade {</td></tr>
<tr><td class="h">98</td><td><div class="c3">423</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L98">100</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L98">423</a></div></td><td><div>1920</div></td><td class="s">&nbsp;&nbsp;return unless $_[0];</td></tr>
<tr><td class="h">99</td><td><div class="c3">283</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L99">50</a></div></td><td></td><td></td><td><div>1495</div></td><td class="s">&nbsp;&nbsp;return unless $] &gt;= 5.008;</td></tr>
<tr><td class="h">100</td><td><div class="c3">283</div></td><td></td><td></td><td></td><td><div>1197</div></td><td class="s">&nbsp;&nbsp;utf8::downgrade($_[0]);</td></tr>
<tr><td class="h">101</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">102</td><td colspan="6"></td></tr><tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Used in subclasses for late initialisation during object creation</td></tr>
<tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td class="s"># (after the object is blessed into the subclass)</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub init {</td></tr>
<tr><td class="h">106</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L106">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">107</td><td colspan="6"></td></tr><tr><td class="h">108</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L108">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $this-&gt;{topic};</td></tr>
<tr><td class="h">109</td><td colspan="6"></td></tr><tr><td class="h">110</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L110">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( -e $this-&gt;{file} ) {</td></tr>
<tr><td class="h">111</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L111">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L111">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{attachment} &amp;&amp; !$this-&gt;isAsciiDefault() ) {</td></tr>
<tr><td class="h">112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;initBinary();</td></tr>
<tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;initText();</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">116</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">118</td><td colspan="6"></td></tr><tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Make any missing paths on the way to this file</td></tr>
<tr><td class="h">120</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: duplicates CPAN File::Tree::mkpath</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _mkPathTo {</td></tr>
<tr><td class="h">122</td><td colspan="6"></td></tr><tr><td class="h">123</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L123">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = shift;</td></tr>
<tr><td class="h">124</td><td colspan="6"></td></tr><tr><td class="h">125</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$file = TWiki::Sandbox::untaintUnchecked( $file ); </td></tr>
<tr><td class="h">126</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $path = File::Basename::dirname($file);</td></tr>
<tr><td class="h">127</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;eval {</td></tr>
<tr><td class="h">128</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File::Path::mkpath($path, 0, $TWiki::cfg{RCS}{dirPermission});</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">130</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L130">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($@) {</td></tr>
<tr><td class="h">131</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple(&quot;RCS: failed to create ${path}: $!&quot;);</td></tr>
<tr><td class="h">132</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">134</td><td colspan="6"></td></tr><tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: this should use TWiki::Time</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _epochToRcsDateTime {</td></tr>
<tr><td class="h">137</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L137">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $dateTime ) = @_;</td></tr>
<tr><td class="h">138</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TODO: should this be gmtime or local time?</td></tr>
<tr><td class="h">139</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $sec,$min,$hour,$mday,$mon,$year,$wday,$yday ) = gmtime( $dateTime );</td></tr>
<tr><td class="h">140</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L140">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$year += 1900 if( $year &gt; 99 );</td></tr>
<tr><td class="h">141</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rcsDateTime = sprintf &#39;%d.%02d.%02d.%02d.%02d.%02d&#39;,</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $year, $mon + 1, $mday, $hour, $min, $sec );</td></tr>
<tr><td class="h">143</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $rcsDateTime;</td></tr>
<tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">145</td><td colspan="6"></td></tr><tr><td class="h">146</td><td></td><td></td><td></td><td></td><td></td><td class="s"># filenames for lock and lease files</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _controlFileName {</td></tr>
<tr><td class="h">148</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L148">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $type ) = @_;</td></tr>
<tr><td class="h">149</td><td colspan="6"></td></tr><tr><td class="h">150</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L150">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $fn = $this-&gt;{file} || &#39;&#39;;</td></tr>
<tr><td class="h">151</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$fn =~ s/txt$/$type/;</td></tr>
<tr><td class="h">152</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fn;</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">154</td><td colspan="6"></td></tr><tr><td class="h">155 - 166</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getRevisionInfo($version) -&gt; ($rev, $date, $user, $comment)

   * =$version= if 0 or undef, or out of range (version number &gt; number of revs) will return info about the latest revision.

Returns (rev, date, user, comment) where rev is the number of the rev for which the info was recovered, date is the date of that rev (epoch s), user is the login name of the user who saved that rev, and comment is the comment associated with the rev.

Designed to be overridden by subclasses, which can call up to this method
if file-based rev info is required.

=cut</pre></td></tr>
<tr><td class="h">167</td><td colspan="6"></td></tr><tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getRevisionInfo {</td></tr>
<tr><td class="h">169</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L169">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">170</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $fileDate = $this-&gt;getTimestamp();</td></tr>
<tr><td class="h">171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( 1, $fileDate, $TWiki::cfg{DefaultUserLogin},</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Default revision information&#39; );</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">174</td><td colspan="6"></td></tr><tr><td class="h">175 - 181</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getLatestRevision() -&gt; $text

Get the text of the most recent revision

=cut</pre></td></tr>
<tr><td class="h">182</td><td colspan="6"></td></tr><tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getLatestRevision {</td></tr>
<tr><td class="h">184</td><td><div class="c3">45</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L184">45</a></div></td><td><div>147</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">185</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>233</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_readFile( $this-&gt;{file} );</td></tr>
<tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">187</td><td colspan="6"></td></tr><tr><td class="h">188 - 194</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getLatestRevisionTime() -&gt; $text

Get the time of the most recent revision

=cut</pre></td></tr>
<tr><td class="h">195</td><td colspan="6"></td></tr><tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getLatestRevisionTime {</td></tr>
<tr><td class="h">197</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L197">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @e = stat( shift-&gt;{file} );</td></tr>
<tr><td class="h">198</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L198">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $e[9] || 0;</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">200</td><td colspan="6"></td></tr><tr><td class="h">201 - 207</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod readMetaData($name) -&gt; $text

Get a meta-data block for this web

=cut</pre></td></tr>
<tr><td class="h">208</td><td colspan="6"></td></tr><tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub readMetaData {</td></tr>
<tr><td class="h">210</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L210">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $name ) = @_;</td></tr>
<tr><td class="h">211</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web}.&#39;/.&#39;.$name;</td></tr>
<tr><td class="h">212</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L212">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $file ) {</td></tr>
<tr><td class="h">213</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_readFile( $file );</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">215</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">217</td><td colspan="6"></td></tr><tr><td class="h">218 - 228</td><td colspan="5"></td><td class="s"><pre>=pod

---+++ ObjectMethod getWorkArea( $key ) -&gt; $directorypath

Gets a private directory uniquely identified by $key. The directory is
intended as a work area for plugins.

The standard is a directory named the same as &quot;key&quot; under
$TWiki::cfg{RCS}{WorkAreaDir}

=cut</pre></td></tr>
<tr><td class="h">229</td><td colspan="6"></td></tr><tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getWorkArea {</td></tr>
<tr><td class="h">231</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L231">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $key ) = @_;</td></tr>
<tr><td class="h">232</td><td colspan="6"></td></tr><tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# untaint and detect nasties</td></tr>
<tr><td class="h">234</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$key = TWiki::Sandbox::normalizeFileName( $key );</td></tr>
<tr><td class="h">235</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L235">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &quot;Bad work area name $key&quot; ) unless ( $key );</td></tr>
<tr><td class="h">236</td><td colspan="6"></td></tr><tr><td class="h">237</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dir =  &quot;$TWiki::cfg{RCS}{WorkAreaDir}/$key&quot;;</td></tr>
<tr><td class="h">238</td><td colspan="6"></td></tr><tr><td class="h">239</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L239">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( -d $dir ) {</td></tr>
<tr><td class="h">240</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L240">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdir( $dir ) || throw Error::Simple(</td></tr>
<tr><td class="h">241</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;RCS: failed to create &#39;.$key.&#39; work area. Check that {RCS}{WorkAreaDir} points to a valid directory that I can read and write to&#39;);</td></tr>
<tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">243</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $dir;</td></tr>
<tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">245</td><td colspan="6"></td></tr><tr><td class="h">246 - 253</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod saveMetaData( $web, $name ) -&gt; $text

Write a named meta-data string. If web is given the meta-data
is stored alongside a web.

=cut</pre></td></tr>
<tr><td class="h">254</td><td colspan="6"></td></tr><tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub saveMetaData {</td></tr>
<tr><td class="h">256</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L256">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $name, $text ) = @_;</td></tr>
<tr><td class="h">257</td><td colspan="6"></td></tr><tr><td class="h">258</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web}.&#39;/.&#39;.$name;</td></tr>
<tr><td class="h">259</td><td colspan="6"></td></tr><tr><td class="h">260</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_saveFile( $file, $text );</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">262</td><td colspan="6"></td></tr><tr><td class="h">263 - 271</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getTopicNames() -&gt; @topics

Get list of all topics in a web
   * =$web= - Web name, required, e.g. =&#39;Sandbox&#39;=
Return a topic list, e.g. =( &#39;WebChanges&#39;,  &#39;WebHome&#39;, &#39;WebIndex&#39;, &#39;WebNotify&#39; )=

=cut</pre></td></tr>
<tr><td class="h">272</td><td colspan="6"></td></tr><tr><td class="h">273</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getTopicNames {</td></tr>
<tr><td class="h">274</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L274">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">275</td><td colspan="6"></td></tr><tr><td class="h">276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;opendir DIR, $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web};</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the name filter is used to ensure we don&#39;t return filenames</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# that contain illegal characters as topic names.</td></tr>
<tr><td class="h">279</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @topicList =</td></tr>
<tr><td class="h">280</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort</td></tr>
<tr><td class="h">281</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L281">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { TWiki::Sandbox::untaintUnchecked( $_ ) }</td></tr>
<tr><td class="h">282</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grep { !/$TWiki::cfg{NameFilter}/ &amp;&amp; s/\.txt$// }</td></tr>
<tr><td class="h">283</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readdir( DIR );</td></tr>
<tr><td class="h">284</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;closedir( DIR );</td></tr>
<tr><td class="h">285</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @topicList;</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">287</td><td colspan="6"></td></tr><tr><td class="h">288 - 294</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getWebNames() -&gt; @webs

Gets a list of names of subwebs in the current web

=cut</pre></td></tr>
<tr><td class="h">295</td><td colspan="6"></td></tr><tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getWebNames {</td></tr>
<tr><td class="h">297</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L297">7</a></div></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">298</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dir = $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web};</td></tr>
<tr><td class="h">299</td><td><div class="c3">7</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L299">50</a></div></td><td></td><td></td><td><div>114</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( opendir( DIR, $dir ) ) {</td></tr>
<tr><td class="h">300</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @tmpList =</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort</td></tr>
<tr><td class="h">302</td><td><div class="c3">1067</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L302">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L302">67</a></div></td><td></td><td><div>6818</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { TWiki::Sandbox::untaintUnchecked( $_ ) }</td></tr>
<tr><td class="h">303</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>780</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grep { !/\./ &amp;&amp;</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!/$TWiki::cfg{NameFilter}/ &amp;&amp;</td></tr>
<tr><td class="h">305</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-d $dir.&#39;/&#39;.$_</td></tr>
<tr><td class="h">306</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readdir( DIR );</td></tr>
<tr><td class="h">308</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>122</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closedir( DIR );</td></tr>
<tr><td class="h">309</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return @tmpList;</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">311</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">312</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">313</td><td colspan="6"></td></tr><tr><td class="h">314 - 337</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod searchInWebContent($searchString, $web, \@topics, \%options ) -&gt; \%map

Search for a string in the content of a web. The search must be over all
content and all formatted meta-data, though the latter search type is
deprecated (use searchMetaData instead).

   * =$searchString= - the search string, in egrep format if regex
   * =$web= - The web to search in
   * =\@topics= - reference to a list of topics to search
   * =\%options= - reference to an options hash
The =\%options= hash may contain the following options:
   * =type= - if =regex= will perform a egrep-syntax RE search (default &#39;&#39;)
   * =casesensitive= - false to ignore case (defaulkt true)
   * =files_without_match= - true to return files only (default false)

The return value is a reference to a hash which maps each matching topic
name to a list of the lines in that topic that matched the search,
as would be returned by &#39;grep&#39;. If =files_without_match= is specified, it will
return on the first match in each topic (i.e. it will return only one
match per topic, and will not return matching lines).

=cut</pre></td></tr>
<tr><td class="h">338</td><td colspan="6"></td></tr><tr><td class="h">339</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub searchInWebContent {</td></tr>
<tr><td class="h">340</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L340">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $searchString, $topics, $options ) = @_;</td></tr>
<tr><td class="h">341</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $options) if DEBUG;</td></tr>
<tr><td class="h">342</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sDir = $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web}.&#39;/&#39;;</td></tr>
<tr><td class="h">343</td><td colspan="6"></td></tr><tr><td class="h">344</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L344">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($this-&gt;{searchFn}) {</td></tr>
<tr><td class="h">345</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval &quot;require $TWiki::cfg{RCS}{SearchAlgorithm}&quot;;</td></tr>
<tr><td class="h">346</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L346">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Bad {RCS}{SearchAlgorithm}; suggest you run configure and select a different algorithm\n$@&quot; if $@;</td></tr>
<tr><td class="h">347</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{searchFn} = $TWiki::cfg{RCS}{SearchAlgorithm}.&#39;::search&#39;;</td></tr>
<tr><td class="h">348</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">349</td><td colspan="6"></td></tr><tr><td class="h">350</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L350">1</a></div></td><td><div>7</div><div>3</div><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;no strict &#39;refs&#39;;</td></tr>
<tr><td class="h">351</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &amp;{$this-&gt;{searchFn}}($searchString, $topics, $options,</td></tr>
<tr><td class="h">352</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sDir, $this-&gt;{session}-&gt;{sandbox});</td></tr>
<tr><td class="h">353</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L353">1</a></div></td><td><div>6</div><div>3</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;use strict &#39;refs&#39;;</td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">355</td><td colspan="6"></td></tr><tr><td class="h">356 - 362</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod moveWeb(  $newWeb )

Move a web.

=cut</pre></td></tr>
<tr><td class="h">363</td><td colspan="6"></td></tr><tr><td class="h">364</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub moveWeb {</td></tr>
<tr><td class="h">365</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L365">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $newWeb ) = @_;</td></tr>
<tr><td class="h">366</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web},</td></tr>
<tr><td class="h">367</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{DataDir}.&#39;/&#39;.$newWeb );</td></tr>
<tr><td class="h">368</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L368">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -d $TWiki::cfg{PubDir}.&#39;/&#39;.$this-&gt;{web} ) {</td></tr>
<tr><td class="h">369</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $TWiki::cfg{PubDir}.&#39;/&#39;.$this-&gt;{web},</td></tr>
<tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{PubDir}.&#39;/&#39;.$newWeb );</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">372</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">373</td><td colspan="6"></td></tr><tr><td class="h">374 - 385</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getRevision($version) -&gt; $text

   * =$version= if 0 or undef, or out of range (version number &gt; number of revs) will return the latest revision.

Get the text of the given revision.

Designed to be overridden by subclasses, which can call up to this method
if the main file revision is required.

=cut</pre></td></tr>
<tr><td class="h">386</td><td colspan="6"></td></tr><tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getRevision {</td></tr>
<tr><td class="h">388</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L388">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">389</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_readFile( $this-&gt;{file} );</td></tr>
<tr><td class="h">390</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">391</td><td colspan="6"></td></tr><tr><td class="h">392 - 398</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod storedDataExists() -&gt; $boolean

Establishes if there is stored data associated with this handler.

=cut</pre></td></tr>
<tr><td class="h">399</td><td colspan="6"></td></tr><tr><td class="h">400</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub storedDataExists {</td></tr>
<tr><td class="h">401</td><td><div class="c3">94</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L401">94</a></div></td><td><div>307</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">402</td><td><div class="c3">94</div></td><td></td><td></td><td></td><td><div>1439</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return -e $this-&gt;{file};</td></tr>
<tr><td class="h">403</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">404</td><td colspan="6"></td></tr><tr><td class="h">405 - 412</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getTimestamp() -&gt; $integer

Get the timestamp of the file
Returns 0 if no file, otherwise epoch seconds

=cut</pre></td></tr>
<tr><td class="h">413</td><td colspan="6"></td></tr><tr><td class="h">414</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getTimestamp {</td></tr>
<tr><td class="h">415</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L415">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">416</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $date = 0;</td></tr>
<tr><td class="h">417</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L417">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $this-&gt;{file} ) {</td></tr>
<tr><td class="h">418</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: Why big number if fail?</td></tr>
<tr><td class="h">419</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L419">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$date = (stat $this-&gt;{file})[9] || 600000000;</td></tr>
<tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">421</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $date;</td></tr>
<tr><td class="h">422</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">423</td><td colspan="6"></td></tr><tr><td class="h">424 - 430</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod restoreLatestRevision($wikiname)

Restore the plaintext file from the revision at the head.

=cut</pre></td></tr>
<tr><td class="h">431</td><td colspan="6"></td></tr><tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub restoreLatestRevision {</td></tr>
<tr><td class="h">433</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L433">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $user ) = @_;</td></tr>
<tr><td class="h">434</td><td colspan="6"></td></tr><tr><td class="h">435</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rev = $this-&gt;numRevisions();</td></tr>
<tr><td class="h">436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = $this-&gt;getRevision( $rev );</td></tr>
<tr><td class="h">437</td><td colspan="6"></td></tr><tr><td class="h">438</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If there is no ,v, create it</td></tr>
<tr><td class="h">439</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L439">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( -e $this-&gt;{rcsFile} ) {</td></tr>
<tr><td class="h">440</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;addRevisionFromText( $text, &quot;restored&quot;, $user, time() );</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">442</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_saveFile( $this-&gt;{file}, $text );</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">444</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">445</td><td colspan="6"></td></tr><tr><td class="h">446 - 456</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod removeWeb( $web )

   * =$web= - web being removed

Destroy a web, utterly. Removed the data and attachments in the web.

Use with great care! No backup is taken!

=cut</pre></td></tr>
<tr><td class="h">457</td><td colspan="6"></td></tr><tr><td class="h">458</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub removeWeb {</td></tr>
<tr><td class="h">459</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L459">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">460</td><td colspan="6"></td></tr><tr><td class="h">461</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Just make sure of the context</td></tr>
<tr><td class="h">462</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(!$this-&gt;{topic}) if DEBUG;</td></tr>
<tr><td class="h">463</td><td colspan="6"></td></tr><tr><td class="h">464</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_rmtree( $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web} );</td></tr>
<tr><td class="h">465</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_rmtree( $TWiki::cfg{PubDir}.&#39;/&#39;.$this-&gt;{web} );</td></tr>
<tr><td class="h">466</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">467</td><td colspan="6"></td></tr><tr><td class="h">468 - 474</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod moveTopic( $newWeb, $newTopic )

Move/rename a topic.

=cut</pre></td></tr>
<tr><td class="h">475</td><td colspan="6"></td></tr><tr><td class="h">476</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub moveTopic {</td></tr>
<tr><td class="h">477</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L477">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $newWeb, $newTopic ) = @_;</td></tr>
<tr><td class="h">478</td><td colspan="6"></td></tr><tr><td class="h">479</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldWeb = $this-&gt;{web};</td></tr>
<tr><td class="h">480</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldTopic = $this-&gt;{topic};</td></tr>
<tr><td class="h">481</td><td colspan="6"></td></tr><tr><td class="h">482</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Move data file</td></tr>
<tr><td class="h">483</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $new = new TWiki::Store::RcsFile( $this-&gt;{session},</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newWeb, $newTopic, &#39;&#39; );</td></tr>
<tr><td class="h">485</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $this-&gt;{file}, $new-&gt;{file} );</td></tr>
<tr><td class="h">486</td><td colspan="6"></td></tr><tr><td class="h">487</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Move history</td></tr>
<tr><td class="h">488</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_mkPathTo( $new-&gt;{rcsFile});</td></tr>
<tr><td class="h">489</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L489">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $this-&gt;{rcsFile} ) {</td></tr>
<tr><td class="h">490</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $this-&gt;{rcsFile}, $new-&gt;{rcsFile} );</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">492</td><td colspan="6"></td></tr><tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Move attachments</td></tr>
<tr><td class="h">494</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $from = $TWiki::cfg{PubDir}.&#39;/&#39;.$this-&gt;{web}.&#39;/&#39;.$this-&gt;{topic};</td></tr>
<tr><td class="h">495</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L495">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $from ) {</td></tr>
<tr><td class="h">496</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $to = $TWiki::cfg{PubDir}.&#39;/&#39;.$newWeb.&#39;/&#39;.$newTopic;</td></tr>
<tr><td class="h">497</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $from, $to );</td></tr>
<tr><td class="h">498</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">499</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">500</td><td colspan="6"></td></tr><tr><td class="h">501 - 507</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod copyTopic( $newWeb, $newTopic )

Copy a topic.

=cut</pre></td></tr>
<tr><td class="h">508</td><td colspan="6"></td></tr><tr><td class="h">509</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub copyTopic {</td></tr>
<tr><td class="h">510</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L510">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $newWeb, $newTopic ) = @_;</td></tr>
<tr><td class="h">511</td><td colspan="6"></td></tr><tr><td class="h">512</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldWeb = $this-&gt;{web};</td></tr>
<tr><td class="h">513</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldTopic = $this-&gt;{topic};</td></tr>
<tr><td class="h">514</td><td colspan="6"></td></tr><tr><td class="h">515</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $new = new TWiki::Store::RcsFile( $this-&gt;{session},</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newWeb, $newTopic, &#39;&#39; );</td></tr>
<tr><td class="h">517</td><td colspan="6"></td></tr><tr><td class="h">518</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_copyFile( $this-&gt;{file}, $new-&gt;{file} );</td></tr>
<tr><td class="h">519</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L519">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $this-&gt;{rcsFile} ) {</td></tr>
<tr><td class="h">520</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_copyFile( $this-&gt;{rcsFile}, $new-&gt;{rcsFile} );</td></tr>
<tr><td class="h">521</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">522</td><td colspan="6"></td></tr><tr><td class="h">523</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L523">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( opendir(DIR, $TWiki::cfg{PubDir}.&#39;/&#39;.$this-&gt;{web}.&#39;/&#39;.</td></tr>
<tr><td class="h">524</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topic} )) {</td></tr>
<tr><td class="h">525</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for my $att ( grep { !/^\./ } readdir DIR ) {</td></tr>
<tr><td class="h">526</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$att = TWiki::Sandbox::untaintUnchecked( $att );</td></tr>
<tr><td class="h">527</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $oldAtt = new TWiki::Store::RcsFile(</td></tr>
<tr><td class="h">528</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}, $this-&gt;{web}, $this-&gt;{topic}, $att );</td></tr>
<tr><td class="h">529</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oldAtt-&gt;copyAttachment( $newWeb, $newTopic );</td></tr>
<tr><td class="h">530</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">531</td><td colspan="6"></td></tr><tr><td class="h">532</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closedir DIR;</td></tr>
<tr><td class="h">533</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">534</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">535</td><td colspan="6"></td></tr><tr><td class="h">536 - 542</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod moveAttachment( $newWeb, $newTopic, $newAttachment )

Move an attachment from one topic to another. The name is retained.

=cut</pre></td></tr>
<tr><td class="h">543</td><td colspan="6"></td></tr><tr><td class="h">544</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub moveAttachment {</td></tr>
<tr><td class="h">545</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L545">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $newWeb, $newTopic, $newAttachment ) = @_;</td></tr>
<tr><td class="h">546</td><td colspan="6"></td></tr><tr><td class="h">547</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME might want to delete old directories if empty</td></tr>
<tr><td class="h">548</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $new = TWiki::Store::RcsFile-&gt;new( $this-&gt;{session}, $newWeb,</td></tr>
<tr><td class="h">549</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newTopic, $newAttachment );</td></tr>
<tr><td class="h">550</td><td colspan="6"></td></tr><tr><td class="h">551</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $this-&gt;{file}, $new-&gt;{file} );</td></tr>
<tr><td class="h">552</td><td colspan="6"></td></tr><tr><td class="h">553</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L553">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $this-&gt;{rcsFile} ) {</td></tr>
<tr><td class="h">554</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_moveFile( $this-&gt;{rcsFile}, $new-&gt;{rcsFile} );</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">556</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">557</td><td colspan="6"></td></tr><tr><td class="h">558 - 564</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod copyAttachment( $newWeb, $newTopic )

Copy an attachment from one topic to another. The name is retained.

=cut</pre></td></tr>
<tr><td class="h">565</td><td colspan="6"></td></tr><tr><td class="h">566</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub copyAttachment {</td></tr>
<tr><td class="h">567</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L567">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $newWeb, $newTopic ) = @_;</td></tr>
<tr><td class="h">568</td><td colspan="6"></td></tr><tr><td class="h">569</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldWeb = $this-&gt;{web};</td></tr>
<tr><td class="h">570</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldTopic = $this-&gt;{topic};</td></tr>
<tr><td class="h">571</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $attachment = $this-&gt;{attachment};</td></tr>
<tr><td class="h">572</td><td colspan="6"></td></tr><tr><td class="h">573</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $new = TWiki::Store::RcsFile-&gt;new( $this-&gt;{session}, $newWeb,</td></tr>
<tr><td class="h">574</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newTopic, $attachment );</td></tr>
<tr><td class="h">575</td><td colspan="6"></td></tr><tr><td class="h">576</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_copyFile( $this-&gt;{file}, $new-&gt;{file} );</td></tr>
<tr><td class="h">577</td><td colspan="6"></td></tr><tr><td class="h">578</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L578">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( -e $this-&gt;{rcsFile} ) {</td></tr>
<tr><td class="h">579</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_copyFile( $this-&gt;{rcsFile}, $new-&gt;{rcsFile} );</td></tr>
<tr><td class="h">580</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">581</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">582</td><td colspan="6"></td></tr><tr><td class="h">583 - 589</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod isAsciiDefault (   ) -&gt; $boolean

Check if this file type is known to be an ascii type file.

=cut</pre></td></tr>
<tr><td class="h">590</td><td colspan="6"></td></tr><tr><td class="h">591</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isAsciiDefault {</td></tr>
<tr><td class="h">592</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L592">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">593</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $this-&gt;{attachment} =~</td></tr>
<tr><td class="h">594</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/$TWiki::cfg{RCS}{asciiFileSuffixes}/ );</td></tr>
<tr><td class="h">595</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">596</td><td colspan="6"></td></tr><tr><td class="h">597 - 607</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod setLock($lock, $user)

Set a lock on the topic, if $lock, otherwise clear it.
$user is a wikiname.

SMELL: there is a tremendous amount of potential for race
conditions using this locking approach.

=cut</pre></td></tr>
<tr><td class="h">608</td><td colspan="6"></td></tr><tr><td class="h">609</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub setLock {</td></tr>
<tr><td class="h">610</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L610">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $lock, $user ) = @_;</td></tr>
<tr><td class="h">611</td><td colspan="6"></td></tr><tr><td class="h">612</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L612">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$user = $this-&gt;{session}-&gt;{user} unless $user;</td></tr>
<tr><td class="h">613</td><td colspan="6"></td></tr><tr><td class="h">614</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $filename = $this-&gt;_controlFileName(&#39;lock&#39;);</td></tr>
<tr><td class="h">615</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L615">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $lock ) {</td></tr>
<tr><td class="h">616</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $lockTime = time();</td></tr>
<tr><td class="h">617</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_saveFile( $filename, $user.&quot;\n&quot;.$lockTime );</td></tr>
<tr><td class="h">618</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">619</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L619">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $filename ||</td></tr>
<tr><td class="h">620</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: failed to delete &#39;.$filename.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">621</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">622</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">623</td><td colspan="6"></td></tr><tr><td class="h">624 - 630</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod isLocked( ) -&gt; ($user, $time)

See if a twiki lock exists. Return the lock user and lock time if it does.

=cut</pre></td></tr>
<tr><td class="h">631</td><td colspan="6"></td></tr><tr><td class="h">632</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isLocked {</td></tr>
<tr><td class="h">633</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L633">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">634</td><td colspan="6"></td></tr><tr><td class="h">635</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $filename = $this-&gt;_controlFileName(&#39;lock&#39;);</td></tr>
<tr><td class="h">636</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L636">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( -e $filename ) {</td></tr>
<tr><td class="h">637</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $t = $this-&gt;_readFile( $filename );</td></tr>
<tr><td class="h">638</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return split( /\s+/, $t, 2 );</td></tr>
<tr><td class="h">639</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">640</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( undef, undef );</td></tr>
<tr><td class="h">641</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">642</td><td colspan="6"></td></tr><tr><td class="h">643 - 651</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod setLease( $lease )

   * =$lease= reference to lease hash, or undef if the existing lease is to be cleared.

Set an lease on the topic.

=cut</pre></td></tr>
<tr><td class="h">652</td><td colspan="6"></td></tr><tr><td class="h">653</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub setLease {</td></tr>
<tr><td class="h">654</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L654">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $lease ) = @_;</td></tr>
<tr><td class="h">655</td><td colspan="6"></td></tr><tr><td class="h">656</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $filename = $this-&gt;_controlFileName(&#39;lease&#39;);</td></tr>
<tr><td class="h">657</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L657">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L657">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $lease ) {</td></tr>
<tr><td class="h">658</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_saveFile( $filename, join( &quot;\n&quot;, %$lease ) );</td></tr>
<tr><td class="h">659</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( -e $filename ) {</td></tr>
<tr><td class="h">660</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L660">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $filename ||</td></tr>
<tr><td class="h">661</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: failed to delete &#39;.$filename.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">662</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">663</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">664</td><td colspan="6"></td></tr><tr><td class="h">665 - 671</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getLease() -&gt; $lease

Get the current lease on the topic.

=cut</pre></td></tr>
<tr><td class="h">672</td><td colspan="6"></td></tr><tr><td class="h">673</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getLease {</td></tr>
<tr><td class="h">674</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L674">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">675</td><td colspan="6"></td></tr><tr><td class="h">676</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $filename = $this-&gt;_controlFileName(&#39;lease&#39;);</td></tr>
<tr><td class="h">677</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L677">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( -e $filename ) {</td></tr>
<tr><td class="h">678</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $t = $this-&gt;_readFile( $filename );</td></tr>
<tr><td class="h">679</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $lease = { split( /\r?\n/, $t ) };</td></tr>
<tr><td class="h">680</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $lease;</td></tr>
<tr><td class="h">681</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">682</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">683</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">684</td><td colspan="6"></td></tr><tr><td class="h">685 - 692</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod removeSpuriousLeases( $web )

Remove leases that are not related to a topic. These can get left behind in
some store implementations when a topic is created, but never saved.

=cut</pre></td></tr>
<tr><td class="h">693</td><td colspan="6"></td></tr><tr><td class="h">694</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub removeSpuriousLeases {</td></tr>
<tr><td class="h">695</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L695">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">696</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $TWiki::cfg{DataDir}.&#39;/&#39;.$this-&gt;{web}.&#39;/&#39;;</td></tr>
<tr><td class="h">697</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L697">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (opendir(W, $web)) {</td></tr>
<tr><td class="h">698</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $f (readdir(W)) {</td></tr>
<tr><td class="h">699</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L699">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($f =~ /^(.*)\.lease$/) {</td></tr>
<tr><td class="h">700</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L700">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! -e &quot;$1.txt,v&quot;) {</td></tr>
<tr><td class="h">701</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink($f);</td></tr>
<tr><td class="h">702</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">703</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">704</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">705</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closedir(W);</td></tr>
<tr><td class="h">706</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">707</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">708</td><td colspan="6"></td></tr><tr><td class="h">709</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _saveStream {</td></tr>
<tr><td class="h">710</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L710">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $fh ) = @_;</td></tr>
<tr><td class="h">711</td><td colspan="6"></td></tr><tr><td class="h">712</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($fh) if DEBUG;</td></tr>
<tr><td class="h">713</td><td colspan="6"></td></tr><tr><td class="h">714</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_mkPathTo( $this-&gt;{file} );</td></tr>
<tr><td class="h">715</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L715">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;open( F, &#39;&gt;&#39;.$this-&gt;{file} ) ||</td></tr>
<tr><td class="h">716</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: open &#39;.$this-&gt;{file}.&#39; failed: &#39;.$! );</td></tr>
<tr><td class="h">717</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L717">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;binmode( F ) ||</td></tr>
<tr><td class="h">718</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: failed to binmode &#39;.$this-&gt;{file}.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">719</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text;</td></tr>
<tr><td class="h">720</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;binmode(F);</td></tr>
<tr><td class="h">721</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while( read( $fh, $text, 1024 )) {</td></tr>
<tr><td class="h">722</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print F $text;</td></tr>
<tr><td class="h">723</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">724</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L724">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;close(F) ||</td></tr>
<tr><td class="h">725</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: close &#39;.$this-&gt;{file}.&#39; failed: &#39;.$! );;</td></tr>
<tr><td class="h">726</td><td colspan="6"></td></tr><tr><td class="h">727</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;chmod( $TWiki::cfg{RCS}{filePermission}, $this-&gt;{file} );</td></tr>
<tr><td class="h">728</td><td colspan="6"></td></tr><tr><td class="h">729</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">730</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">731</td><td colspan="6"></td></tr><tr><td class="h">732</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _copyFile {</td></tr>
<tr><td class="h">733</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L733">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $from, $to ) = @_;</td></tr>
<tr><td class="h">734</td><td colspan="6"></td></tr><tr><td class="h">735</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_mkPathTo( $to );</td></tr>
<tr><td class="h">736</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L736">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( File::Copy::copy( $from, $to ) ) {</td></tr>
<tr><td class="h">737</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: copy &#39;.$from.&#39; to &#39;.$to.&#39; failed: &#39;.$! );</td></tr>
<tr><td class="h">738</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">739</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">740</td><td colspan="6"></td></tr><tr><td class="h">741</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _moveFile {</td></tr>
<tr><td class="h">742</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L742">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $from, $to ) = @_;</td></tr>
<tr><td class="h">743</td><td colspan="6"></td></tr><tr><td class="h">744</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_mkPathTo( $to );</td></tr>
<tr><td class="h">745</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L745">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( File::Copy::move( $from, $to ) ) {</td></tr>
<tr><td class="h">746</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: move &#39;.$from.&#39; to &#39;.$to.&#39; failed: &#39;.$! );</td></tr>
<tr><td class="h">747</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">748</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">749</td><td colspan="6"></td></tr><tr><td class="h">750</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _saveFile {</td></tr>
<tr><td class="h">751</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L751">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $name, $text ) = @_;</td></tr>
<tr><td class="h">752</td><td colspan="6"></td></tr><tr><td class="h">753</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_mkPathTo( $name );</td></tr>
<tr><td class="h">754</td><td colspan="6"></td></tr><tr><td class="h">755</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L755">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;open( FILE, &#39;&gt;&#39;.$name ) ||</td></tr>
<tr><td class="h">756</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: failed to create file &#39;.$name.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">757</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L757">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;binmode( FILE ) ||</td></tr>
<tr><td class="h">758</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: failed to binmode &#39;.$name.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">759</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print FILE $text;</td></tr>
<tr><td class="h">760</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L760">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;close( FILE) ||</td></tr>
<tr><td class="h">761</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: failed to create file &#39;.$name.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">762</td><td colspan="6"></td></tr><tr><td class="h">763</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">764</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">765</td><td colspan="6"></td></tr><tr><td class="h">766</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _readFile {</td></tr>
<tr><td class="h">767</td><td><div class="c3">45</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L767">45</a></div></td><td><div>167</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $name ) = @_;</td></tr>
<tr><td class="h">768</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>113</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $data;</td></tr>
<tr><td class="h">769</td><td><div class="c3">45</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L769">50</a></div></td><td></td><td></td><td><div>805</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( open( IN_FILE, &#39;&lt;&#39;, $name )) {</td></tr>
<tr><td class="h">770</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>166</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binmode( IN_FILE );</td></tr>
<tr><td class="h">771</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>205</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $/ = undef;</td></tr>
<tr><td class="h">772</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>958</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data = &lt;IN_FILE&gt;;</td></tr>
<tr><td class="h">773</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>384</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close( IN_FILE );</td></tr>
<tr><td class="h">774</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">775</td><td><div class="c3">45</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L775">50</a></div></td><td></td><td><div>225</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data ||= &#39;&#39;;</td></tr>
<tr><td class="h">776</td><td><div class="c3">45</div></td><td></td><td></td><td></td><td><div>647</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $data;</td></tr>
<tr><td class="h">777</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">778</td><td colspan="6"></td></tr><tr><td class="h">779</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _mkTmpFilename {</td></tr>
<tr><td class="h">780</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L780">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tmpdir = File::Spec-&gt;tmpdir();</td></tr>
<tr><td class="h">781</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = _mktemp( &#39;twikiAttachmentXXXXXX&#39;, $tmpdir );</td></tr>
<tr><td class="h">782</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return File::Spec-&gt;catfile($tmpdir, $file);</td></tr>
<tr><td class="h">783</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">784</td><td colspan="6"></td></tr><tr><td class="h">785</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Adapted from CPAN - File::MkTemp</td></tr>
<tr><td class="h">786</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _mktemp {</td></tr>
<tr><td class="h">787</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L787">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($template,$dir,$ext,$keepgen,$lookup);</td></tr>
<tr><td class="h">788</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my (@template,@letters);</td></tr>
<tr><td class="h">789</td><td colspan="6"></td></tr><tr><td class="h">790</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(@_ == 1 || @_ == 2 || @_ == 3) if DEBUG;</td></tr>
<tr><td class="h">791</td><td colspan="6"></td></tr><tr><td class="h">792</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($template,$dir,$ext) = @_;</td></tr>
<tr><td class="h">793</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@template = split //, $template;</td></tr>
<tr><td class="h">794</td><td colspan="6"></td></tr><tr><td class="h">795</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($template =~ /XXXXXX$/) if DEBUG;</td></tr>
<tr><td class="h">796</td><td colspan="6"></td></tr><tr><td class="h">797</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L797">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($dir){</td></tr>
<tr><td class="h">798</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(-e $dir) if DEBUG;</td></tr>
<tr><td class="h">799</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">800</td><td colspan="6"></td></tr><tr><td class="h">801</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@letters =</td></tr>
<tr><td class="h">802</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split(//,&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;);</td></tr>
<tr><td class="h">803</td><td colspan="6"></td></tr><tr><td class="h">804</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$keepgen = 1;</td></tr>
<tr><td class="h">805</td><td colspan="6"></td></tr><tr><td class="h">806</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ($keepgen){</td></tr>
<tr><td class="h">807</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (my $i = $#template; $i &gt;= 0 &amp;&amp; ($template[$i] eq &#39;X&#39;); $i--){</td></tr>
<tr><td class="h">808</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template[$i] = $letters[int(rand 52)];</td></tr>
<tr><td class="h">809</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L809">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">810</td><td colspan="6"></td></tr><tr><td class="h">811</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef $template;</td></tr>
<tr><td class="h">812</td><td colspan="6"></td></tr><tr><td class="h">813</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = pack &#39;a&#39; x @template, @template;</td></tr>
<tr><td class="h">814</td><td colspan="6"></td></tr><tr><td class="h">815</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L815">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = $template . $ext if ($ext);</td></tr>
<tr><td class="h">816</td><td colspan="6"></td></tr><tr><td class="h">817</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L817">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($dir){</td></tr>
<tr><td class="h">818</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$lookup = File::Spec-&gt;catfile($dir, $template);</td></tr>
<tr><td class="h">819</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L819">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keepgen = 0 unless (-e $lookup);</td></tr>
<tr><td class="h">820</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">821</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keepgen = 0;</td></tr>
<tr><td class="h">822</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">823</td><td colspan="6"></td></tr><tr><td class="h">824</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L824">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $keepgen == 0;</td></tr>
<tr><td class="h">825</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">826</td><td colspan="6"></td></tr><tr><td class="h">827</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return($template);</td></tr>
<tr><td class="h">828</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">829</td><td colspan="6"></td></tr><tr><td class="h">830</td><td></td><td></td><td></td><td></td><td></td><td class="s"># remove a directory and all subdirectories.</td></tr>
<tr><td class="h">831</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _rmtree {</td></tr>
<tr><td class="h">832</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L832">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $root = shift;</td></tr>
<tr><td class="h">833</td><td colspan="6"></td></tr><tr><td class="h">834</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L834">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( opendir( D, $root ) ) {</td></tr>
<tr><td class="h">835</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $entry ( grep { !/^\.+$/ } readdir( D ) ) {</td></tr>
<tr><td class="h">836</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry =~ /^(.*)$/;</td></tr>
<tr><td class="h">837</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry = $root.&#39;/&#39;.$1;</td></tr>
<tr><td class="h">838</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L838">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( -d $entry ) {</td></tr>
<tr><td class="h">839</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_rmtree( $entry );</td></tr>
<tr><td class="h">840</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">841</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L841">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( unlink( $entry ) ) {</td></tr>
<tr><td class="h">842</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: Failed to delete file &#39;.</td></tr>
<tr><td class="h">843</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">844</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">845</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">846</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">847</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closedir(D);</td></tr>
<tr><td class="h">848</td><td colspan="6"></td></tr><tr><td class="h">849</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L849">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rmdir( $root ) ||</td></tr>
<tr><td class="h">850</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: Failed to delete &#39;.$root.&#39;: &#39;.$! );</td></tr>
<tr><td class="h">851</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">852</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">853</td><td colspan="6"></td></tr><tr><td class="h">854 - 860</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getStream() -&gt; \*STREAM

Return a text stream that will supply the text stored in the topic.

=cut</pre></td></tr>
<tr><td class="h">861</td><td colspan="6"></td></tr><tr><td class="h">862</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getStream {</td></tr>
<tr><td class="h">863</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L863">2</a></div></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = shift;</td></tr>
<tr><td class="h">864</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $strm;</td></tr>
<tr><td class="h">865</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L865">50</a></div></td><td></td><td></td><td><div>120</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( open( $strm, &#39;&lt;&#39;.$this-&gt;{file} )) {</td></tr>
<tr><td class="h">866</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( &#39;RCS: stream open &#39;.$this-&gt;{file}.</td></tr>
<tr><td class="h">867</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39; failed: &#39;.$! );</td></tr>
<tr><td class="h">868</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">869</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $strm;</td></tr>
<tr><td class="h">870</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">871</td><td colspan="6"></td></tr><tr><td class="h">872 - 883</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod numRevisions() -&gt; $integer

Must be provided by subclasses.

Find out how many revisions there are. If there is a problem, such
as a nonexistent file, returns 0.

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">884</td><td colspan="6"></td></tr><tr><td class="h">885 - 895</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod initBinary()

Initialise a binary file.

Must be provided by subclasses.

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">896</td><td colspan="6"></td></tr><tr><td class="h">897 - 907</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod initText()

Initialise a text file.

Must be provided by subclasses.

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">908</td><td colspan="6"></td></tr><tr><td class="h">909 - 933</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod addRevisionFromText($text, $comment, $user, $date)

Add new revision. Replace file with text.
   * =$text= of new revision
   * =$comment= checkin comment
   * =$user= is a wikiname.
   * =$date= in epoch seconds; may be ignored

*Virtual method* - must be implemented by subclasses

=pod

---++ ObjectMethod addRevisionFromStream($fh, $comment, $user, $date)

Add new revision. Replace file with contents of stream.
   * =$fh= filehandle for contents of new revision
   * =$comment= checkin comment
   * =$user= is a wikiname.
   * =$date= in epoch seconds; may be ignored

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">934</td><td colspan="6"></td></tr><tr><td class="h">935 - 947</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod replaceRevision($text, $comment, $user, $date)

Replace the top revision.
   * =$text= is the new revision
   * =$date= is in epoch seconds.
   * =$user= is a wikiname.
   * =$comment= is a string

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">948</td><td colspan="6"></td></tr><tr><td class="h">949 - 957</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod deleteRevision()

Delete the last revision - do nothing if there is only one revision

*Virtual method* - must be implemented by subclasses

=cut to implementation</pre></td></tr>
<tr><td class="h">958</td><td colspan="6"></td></tr><tr><td class="h">959 - 968</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod revisionDiff (   $rev1, $rev2, $contextLines  ) -&gt; \@diffArray

rev2 newer than rev1.
Return reference to an array of [ diffType, $right, $left ]

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">969</td><td colspan="6"></td></tr><tr><td class="h">970 - 978</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getRevision($version) -&gt; $text

Get the text for a given revision. The version number must be an integer.

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">979</td><td colspan="6"></td></tr><tr><td class="h">980 - 989</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getRevisionAtTime($time) -&gt; $rev

Get a single-digit version number for the rev that was alive at the
given epoch-secs time, or undef it none could be found.

*Virtual method* - must be implemented by subclasses

=cut</pre></td></tr>
<tr><td class="h">990</td><td colspan="6"></td></tr><tr><td class="h">991</td><td colspan="6"></td></tr><tr><td class="h">992 - 1001</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getAttachmentAttributes($web, $topic, $attachment)

returns [stat] for any given web, topic, $attachment
SMELL - should this return a hash of arbitrary attributes so that 
SMELL + attributes supported by the underlying filesystem are supported
SMELL + (eg: windows directories supporting photo &quot;author&quot;, &quot;dimension&quot; fields)

=cut</pre></td></tr>
<tr><td class="h">1002</td><td colspan="6"></td></tr><tr><td class="h">1003</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getAttachmentAttributes {</td></tr>
<tr><td class="h">1004</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L1004">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic, $attachment ) = @_;</td></tr>
<tr><td class="h">1005</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $attachment) if DEBUG;</td></tr>
<tr><td class="h">1006</td><td colspan="6"></td></tr><tr><td class="h">1007</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dir = dirForTopicAttachments($web, $topic);</td></tr>
<tr><td class="h">1008</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @stat = stat ($dir.&quot;/&quot;.$attachment);</td></tr>
<tr><td class="h">1009</td><td colspan="6"></td></tr><tr><td class="h">1010</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return @stat;</td></tr>
<tr><td class="h">1011</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1012</td><td colspan="6"></td></tr><tr><td class="h">1013 - 1018</td><td colspan="5"></td><td class="s"><pre>=pod

sub _constructAttributesForAutoAttached
as long as stat is defined, return an emulated set of attributes for that attachment.

=cut</pre></td></tr>
<tr><td class="h">1019</td><td colspan="6"></td></tr><tr><td class="h">1020</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _constructAttributesForAutoAttached {</td></tr>
<tr><td class="h">1021</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L1021">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($file, $stat) = @_;</td></tr>
<tr><td class="h">1022</td><td colspan="6"></td></tr><tr><td class="h">1023</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %pairs = (</td></tr>
<tr><td class="h">1024</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name    =&gt; $file,</td></tr>
<tr><td class="h">1025</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1026</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path    =&gt; $file,</td></tr>
<tr><td class="h">1027</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size    =&gt; $stat-&gt;[7],</td></tr>
<tr><td class="h">1028</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date    =&gt; $stat-&gt;[9], </td></tr>
<tr><td class="h">1029</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user    =&gt; &#39;UnknownUser&#39;, </td></tr>
<tr><td class="h">1030</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1031</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attr    =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1032</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;autoattached =&gt; &#39;1&#39;</td></tr>
<tr><td class="h">1033</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1034</td><td colspan="6"></td></tr><tr><td class="h">1035</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L1035">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($#$stat &gt; 0) {</td></tr>
<tr><td class="h">1036</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return \%pairs;</td></tr>
<tr><td class="h">1037</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1038</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">1039</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1040</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1041</td><td colspan="6"></td></tr><tr><td class="h">1042</td><td colspan="6"></td></tr><tr><td class="h">1043 - 1050</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getAttachmentList($web, $topic)

returns {} of filename =&gt; { key =&gt; value, key2 =&gt; value } for any given web, topic
Ignores files starting with _ or ending with ,v

=cut</pre></td></tr>
<tr><td class="h">1051</td><td colspan="6"></td></tr><tr><td class="h">1052</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getAttachmentList {</td></tr>
<tr><td class="h">1053</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L1053">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic ) = @_;</td></tr>
<tr><td class="h">1054</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dir = dirForTopicAttachments($web, $topic);</td></tr>
<tr><td class="h">1055</td><td colspan="6"></td></tr><tr><td class="h">1056</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L1056">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;opendir DIR, $dir || return &#39;&#39;;</td></tr>
<tr><td class="h">1057</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %attachmentList = ();</td></tr>
<tr><td class="h">1058</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @files = sort grep { m/^[^\.*_]/ } readdir( DIR );</td></tr>
<tr><td class="h">1059</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@files = grep { !/.*,v/ } @files;</td></tr>
<tr><td class="h">1060</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $attachment ( @files ) {</td></tr>
<tr><td class="h">1061</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @stat = stat ($dir.&quot;/&quot;.$attachment);</td></tr>
<tr><td class="h">1062</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attachmentList{$attachment} = _constructAttributesForAutoAttached($attachment, \@stat);</td></tr>
<tr><td class="h">1063</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1064</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;closedir( DIR );</td></tr>
<tr><td class="h">1065</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return %attachmentList;</td></tr>
<tr><td class="h">1066</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1067</td><td colspan="6"></td></tr><tr><td class="h">1068</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub dirForTopicAttachments {</td></tr>
<tr><td class="h">1069</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L1069">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($web, $topic ) = @_;</td></tr>
<tr><td class="h">1070</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $TWiki::cfg{PubDir}.&#39;/&#39;.$web.&#39;/&#39;.$topic;</td></tr>
<tr><td class="h">1071</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1072</td><td colspan="6"></td></tr><tr><td class="h">1073 - 1079</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod stringify()

Generate string representation for debugging

=cut</pre></td></tr>
<tr><td class="h">1080</td><td colspan="6"></td></tr><tr><td class="h">1081</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub stringify {</td></tr>
<tr><td class="h">1082</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L1082">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1083</td><td colspan="6"></td></tr><tr><td class="h">1084</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L1084">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L1084">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--branch.html#L1084">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--condition.html#L1084">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{web}.&#39;.&#39;.</td></tr>
<tr><td class="h">1085</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($this-&gt;{topic} || &#39;{no topic}&#39;).</td></tr>
<tr><td class="h">1086</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($this-&gt;{attachment} ? &#39;:&#39;.$this-&gt;{attachment} : &#39;&#39;).</td></tr>
<tr><td class="h">1087</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{file}.(-e $this-&gt;{file} ? &#39;(e)&#39; : &#39;&#39;).</td></tr>
<tr><td class="h">1088</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;/&#39;.$this-&gt;{rcsFile}.(-e $this-&gt;{rcsFile} ? &#39;(e)&#39; : &#39;&#39;);</td></tr>
<tr><td class="h">1089</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1090</td><td colspan="6"></td></tr><tr><td class="h">1091</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Chop out recognisable path components to prevent hacking based on error</td></tr>
<tr><td class="h">1092</td><td></td><td></td><td></td><td></td><td></td><td class="s"># messages</td></tr>
<tr><td class="h">1093</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _hidePath {</td></tr>
<tr><td class="h">1094</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Store-RcsFile-pm--subroutine.html#L1094">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $erf ) = @_;</td></tr>
<tr><td class="h">1095</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$erf =~ s#.*(/\w+/\w+\.[\w,]*)$#...$1#;</td></tr>
<tr><td class="h">1096</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $erf;</td></tr>
<tr><td class="h">1097</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1098</td><td colspan="6"></td></tr><tr><td class="h">1099</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
