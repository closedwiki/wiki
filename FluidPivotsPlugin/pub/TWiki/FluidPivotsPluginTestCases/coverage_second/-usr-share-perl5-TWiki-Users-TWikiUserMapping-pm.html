<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Users/TWikiUserMapping.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Users/TWikiUserMapping.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">50.8%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Module of TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2007 Sven Dowideit, SvenDowideit@home.org.au</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and TWiki Contributors. All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">19</td><td colspan="6"></td></tr><tr><td class="h">20 - 42</td><td colspan="5"></td><td class="s"><pre>=begin twiki

---+ package TWiki::Users::TWikiUserMapping

User mapping is the process by which TWiki maps from a username (a login name) to a wikiname and back. It is also
where groups are maintained.

By default TWiki maintains user topics and group topics in the %MAINWEB% that
define users and group. These topics are
   * !TWikiUsers - stores a mapping from usernames to TWiki names
   * !WikiName - for each user, stores info about the user
   * !GroupNameGroup - for each group, a topic ending with &quot;Group&quot; stores a list of users who are part of that group.

Many sites will want to override this behaviour, for example to get users and groups from a corporate database.

This class implements the basic TWiki behaviour using topics to store users, but is also designed to be subclassed
so that other services can be used.

Subclasses should be named &#39;XxxxUserMapping&#39; so that configure can find them.

*All* methods in this class should be implemented by subclasses.

=cut</pre></td></tr>
<tr><td class="h">43</td><td colspan="6"></td></tr><tr><td class="h">44</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Users::TWikiUserMapping;</td></tr>
<tr><td class="h">45</td><td colspan="6"></td></tr><tr><td class="h">46</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L46">1</a></div></td><td><div>6</div><div>3</div><div>7</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">47</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L47">1</a></div></td><td><div>6</div><div>3</div><div>4</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">48</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L48">1</a></div></td><td><div>6</div><div>3</div><div>7</div></td><td class="s">use Assert;</td></tr>
<tr><td class="h">49</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L49">1</a></div></td><td><div>6</div><div>3</div><div>7</div></td><td class="s">use TWiki::User;</td></tr>
<tr><td class="h">50</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L50">1</a></div></td><td><div>7</div><div>2</div><div>8</div></td><td class="s">use TWiki::Time;</td></tr>
<tr><td class="h">51</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L51">1</a></div></td><td><div>6</div><div>3</div><div>16</div></td><td class="s">use Error qw( :try );</td></tr>
<tr><td class="h">52</td><td colspan="6"></td></tr><tr><td class="h">53 - 60</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ClassMethod new( $session ) -&gt; $object

Constructs a new user mapping handler of this type, referring to $session
for any required TWiki services.

=cut</pre></td></tr>
<tr><td class="h">61</td><td colspan="6"></td></tr><tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">63</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L63">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $class, $session ) = @_;</td></tr>
<tr><td class="h">64</td><td colspan="6"></td></tr><tr><td class="h">65</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = bless( {}, $class );</td></tr>
<tr><td class="h">66</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session} = $session;</td></tr>
<tr><td class="h">67</td><td colspan="6"></td></tr><tr><td class="h">68</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%{$this-&gt;{U2W}} = ();</td></tr>
<tr><td class="h">69</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%{$this-&gt;{W2U}} = ();</td></tr>
<tr><td class="h">70</td><td colspan="6"></td></tr><tr><td class="h">71</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this;</td></tr>
<tr><td class="h">72</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">73</td><td colspan="6"></td></tr><tr><td class="h">74 - 83</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod finish

Complete processing after the client&#39;s HTTP request has been responded
to.
   1 breaking circular references to allow garbage collection in persistent
     environments

=cut</pre></td></tr>
<tr><td class="h">84</td><td colspan="6"></td></tr><tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub finish {</td></tr>
<tr><td class="h">86</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L86">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">87</td><td colspan="6"></td></tr><tr><td class="h">88</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">89</td><td colspan="6"></td></tr><tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td class="s"># callback for search function to collate results</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _collateGroups {</td></tr>
<tr><td class="h">92</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L92">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ref = shift;</td></tr>
<tr><td class="h">93</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $group = shift;</td></tr>
<tr><td class="h">94</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L94">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $group;</td></tr>
<tr><td class="h">95</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $groupObject = $ref-&gt;{users}-&gt;findUser( $group );</td></tr>
<tr><td class="h">96</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L96">0</a></div></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@{$ref-&gt;{list}}, $groupObject) if $groupObject;</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">98</td><td colspan="6"></td></tr><tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td class="s"># get a list of groups defined in this TWiki </td></tr>
<tr><td class="h">100</td><td colspan="6"></td></tr><tr><td class="h">101 - 111</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getListOfGroups( ) -&gt; @listOfUserObjects

Get a list of groups defined by the mapping manager. By default,
TWiki defines groups using topics in the Main web. Subclasses should
override this to list groups from their own databases.

Returns a list of TWiki::User objects, one per group.

=cut</pre></td></tr>
<tr><td class="h">112</td><td colspan="6"></td></tr><tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getListOfGroups {</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L114">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">115</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users::TWikiUserMapping&#39;)) if DEBUG;</td></tr>
<tr><td class="h">116</td><td colspan="6"></td></tr><tr><td class="h">117</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list;</td></tr>
<tr><td class="h">118</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $users = $this-&gt;{session}-&gt;{users};</td></tr>
<tr><td class="h">119</td><td colspan="6"></td></tr><tr><td class="h">120</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;{search}-&gt;searchWeb</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_callback     =&gt; \&amp;_collateGroups,</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_cbdata       =&gt;  { list =&gt; \@list, users =&gt; $users },</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inline        =&gt; 1,</td></tr>
<tr><td class="h">125</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;search        =&gt; &quot;Set GROUP =&quot;,</td></tr>
<tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;web           =&gt; $TWiki::cfg{UsersWebName},</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;topic         =&gt; &quot;*Group&quot;,</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type          =&gt; &#39;regex&#39;,</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nosummary     =&gt; &#39;on&#39;,</td></tr>
<tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nosearch      =&gt; &#39;on&#39;,</td></tr>
<tr><td class="h">131</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noheader      =&gt; &#39;on&#39;,</td></tr>
<tr><td class="h">132</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nototal       =&gt; &#39;on&#39;,</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noempty       =&gt; &#39;on&#39;,</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format	     =&gt; &#39;$web.$topic&#39;,</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;separator     =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">137</td><td colspan="6"></td></tr><tr><td class="h">138</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @list;</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">140</td><td colspan="6"></td></tr><tr><td class="h">141 - 154</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod addUserToMapping( $user, $addingUser ) -&gt; $topicName

Add a user to the persistant mapping that maps from usernames to wikinames
and vice-versa. The default implementation uses a special topic called
&quot;TWikiUsers&quot; in the users web. Subclasses will provide other implementations
(usually stubs if they have other ways of mapping usernames to wikinames).

Group names must be acceptable to $TWiki::cfg{NameFilter}

$user is the user being added. $addingUser is the user doing the adding.

=cut</pre></td></tr>
<tr><td class="h">155</td><td colspan="6"></td></tr><tr><td class="h">156</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub addUserToMapping {</td></tr>
<tr><td class="h">157</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L157">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $user, $me ) = @_;</td></tr>
<tr><td class="h">158</td><td colspan="6"></td></tr><tr><td class="h">159</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users::TWikiUserMapping&#39;)) if DEBUG;</td></tr>
<tr><td class="h">160</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($user-&gt;isa( &#39;TWiki::User&#39;)) if DEBUG;</td></tr>
<tr><td class="h">161</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($me-&gt;isa( &#39;TWiki::User&#39;)) if DEBUG;</td></tr>
<tr><td class="h">162</td><td colspan="6"></td></tr><tr><td class="h">163</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">164</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $meta, $text ) =</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;readTopic( undef, $TWiki::cfg{UsersWebName},</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{UsersTopicName}, undef );</td></tr>
<tr><td class="h">167</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = &#39;&#39;;</td></tr>
<tr><td class="h">168</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $entry = &quot;\t* &quot;;</td></tr>
<tr><td class="h">169</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L169">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$entry .= $user-&gt;web().&quot;.&quot;</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $user-&gt;web() eq $TWiki::cfg{UsersWebName};</td></tr>
<tr><td class="h">171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$entry .= $user-&gt;wikiName().&quot; - &quot;;</td></tr>
<tr><td class="h">172</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L172">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$entry .= $user-&gt;login() . &quot; - &quot; if $user-&gt;login();</td></tr>
<tr><td class="h">173</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $today = TWiki::Time::formatTime(time(), &#39;$day $mon $year&#39;, &#39;gmtime&#39;);</td></tr>
<tr><td class="h">174</td><td colspan="6"></td></tr><tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# add to the cache</td></tr>
<tr><td class="h">176</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{U2W}{$user-&gt;login()} = $user-&gt;{web} . &quot;.&quot; . $user-&gt;wikiName();</td></tr>
<tr><td class="h">177</td><td colspan="6"></td></tr><tr><td class="h">178</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# add name alphabetically to list</td></tr>
<tr><td class="h">179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $line ( split( /\r?\n/, $text) ) {</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# TODO: I18N fix here once basic auth problem with 8-bit user names is</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# solved</td></tr>
<tr><td class="h">182</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L182">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $entry ) {</td></tr>
<tr><td class="h">183</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $web, $name, $odate ) = ( &#39;&#39;, &#39;&#39;, &#39;&#39; );</td></tr>
<tr><td class="h">184</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L184">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L184">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ /^\s+\*\s($TWiki::regex{webNameRegex}\.)?($TWiki::regex{wikiWordRegex})\s*(?:-\s*\w+\s*)?-\s*(.*)/ ) {</td></tr>
<tr><td class="h">185</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--condition.html#L185">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web = $1 || $TWiki::cfg{UsersWebName};</td></tr>
<tr><td class="h">186</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $2;</td></tr>
<tr><td class="h">187</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$odate = $3;</td></tr>
<tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $line =~ /^\s+\*\s([A-Z]) - / ) {</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#	* A - &lt;a name=&quot;A&quot;&gt;- - - -&lt;/a&gt;^M</td></tr>
<tr><td class="h">190</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $1;</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">192</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L192">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--condition.html#L192">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $name &amp;&amp; ( $user-&gt;wikiName() le $name ) ) {</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# found alphabetical position</td></tr>
<tr><td class="h">194</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L194">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $user-&gt;wikiName() eq $name ) {</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# adjusting existing user - keep original registration date</td></tr>
<tr><td class="h">196</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry .= $odate;</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">198</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry .= $today.&quot;\n&quot;.$line;</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# don&#39;t adjust if unchanged</td></tr>
<tr><td class="h">201</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L201">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $TWiki::cfg{UsersTopicName} if( $entry eq $line );</td></tr>
<tr><td class="h">202</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = $entry;</td></tr>
<tr><td class="h">203</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry = &#39;&#39;;</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">206</td><td colspan="6"></td></tr><tr><td class="h">207</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= $line.&quot;\n&quot;;</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">209</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L209">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $entry ) {</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# brand new file - add to end</td></tr>
<tr><td class="h">211</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= &quot;$entry$today\n&quot;;</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">213</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;saveTopic( $me, $TWiki::cfg{UsersWebName},</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{UsersTopicName},</td></tr>
<tr><td class="h">215</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result, $meta );</td></tr>
<tr><td class="h">216</td><td colspan="6"></td></tr><tr><td class="h">217</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $TWiki::cfg{UsersTopicName};</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">219</td><td colspan="6"></td></tr><tr><td class="h">220 - 227</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod lookupLoginName($username) -&gt; $wikiName

Map a username to the corresponding wikiname. This is used for lookups during
user resolution, and should be as fast as possible.

=cut</pre></td></tr>
<tr><td class="h">228</td><td colspan="6"></td></tr><tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub lookupLoginName {</td></tr>
<tr><td class="h">230</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L230">4</a></div></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $loginUser) = @_;</td></tr>
<tr><td class="h">231</td><td colspan="6"></td></tr><tr><td class="h">232</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_loadMapping();</td></tr>
<tr><td class="h">233</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{U2W}{$loginUser};</td></tr>
<tr><td class="h">234</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">235</td><td colspan="6"></td></tr><tr><td class="h">236 - 243</td><td colspan="5"></td><td class="s"><pre>=pod

---++ Objectmethod lookupWikiName($wikiname) -&gt; $username

Map a wikiname to the corresponding username. This is used for lookups during
user resolution, and should be as fast as possible.

=cut</pre></td></tr>
<tr><td class="h">244</td><td colspan="6"></td></tr><tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub lookupWikiName {</td></tr>
<tr><td class="h">246</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L246">3</a></div></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $wikiName) = @_;</td></tr>
<tr><td class="h">247</td><td colspan="6"></td></tr><tr><td class="h">248</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_loadMapping();</td></tr>
<tr><td class="h">249</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{W2U}{$wikiName};</td></tr>
<tr><td class="h">250</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">251</td><td colspan="6"></td></tr><tr><td class="h">252 - 258</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getListOfAllWikiNames() -&gt; @wikinames

Returns a list of all wikinames of users known to the mapping manager.

=cut</pre></td></tr>
<tr><td class="h">259</td><td colspan="6"></td></tr><tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getListOfAllWikiNames {</td></tr>
<tr><td class="h">261</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L261">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this ) = @_;</td></tr>
<tr><td class="h">262</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users::TWikiUserMapping&#39;)) if DEBUG;</td></tr>
<tr><td class="h">263</td><td colspan="6"></td></tr><tr><td class="h">264</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_loadMapping();</td></tr>
<tr><td class="h">265</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return keys(%{$this-&gt;{W2U}});</td></tr>
<tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">267</td><td colspan="6"></td></tr><tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Build hash to translate between username (e.g. jsmith)</td></tr>
<tr><td class="h">269</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and WikiName (e.g. Main.JaneSmith).</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _loadMapping {</td></tr>
<tr><td class="h">271</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L271">7</a></div></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">272</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users::TWikiUserMapping&#39;)) if DEBUG;</td></tr>
<tr><td class="h">273</td><td colspan="6"></td></tr><tr><td class="h">274</td><td><div class="c3">7</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L274">100</a></div></td><td></td><td></td><td><div>43</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $this-&gt;{CACHED};</td></tr>
<tr><td class="h">275</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{CACHED} = 1;</td></tr>
<tr><td class="h">276</td><td colspan="6"></td></tr><tr><td class="h">277</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">278</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L278">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $store-&gt;topicExists($TWiki::cfg{UsersWebName},</td></tr>
<tr><td class="h">279</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{UsersTopicName} )) {</td></tr>
<tr><td class="h">280</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $text = $store-&gt;readTopicRaw( undef,</td></tr>
<tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{UsersWebName},</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{UsersTopicName},</td></tr>
<tr><td class="h">283</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef );</td></tr>
<tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Get the WikiNames and userids, and build hashes in both directions</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# This matches:</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   * TWikiGuest - guest - 10 Mar 2005</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   * TWikiGuest - 10 Mar 2005</td></tr>
<tr><td class="h">288</td><td><div class="c3">1</div><div class="c3">5</div></td><td></td><td></td><td></td><td><div>81</div><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^\s*\* ($TWiki::regex{webNameRegex}\.)?($TWiki::regex{wikiWordRegex})\s*(?:-\s*(\S+)\s*)?-.*$/$this-&gt;_cacheUser($1,$2,$3)/gome;</td></tr>
<tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">290</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If there is no mapping topic, then</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# map only guest to TWikiGuest.</td></tr>
<tr><td class="h">292</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_cacheUser(undef, $TWiki::cfg{DefaultUserWikiName},</td></tr>
<tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{DefaultUserLogin});</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">296</td><td colspan="6"></td></tr><tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _cacheUser {</td></tr>
<tr><td class="h">298</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L298">5</a></div></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my($this, $web, $wUser, $lUser) = @_;</td></tr>
<tr><td class="h">299</td><td><div class="c3">5</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--condition.html#L299">50</a></div></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web ||= $TWiki::cfg{UsersWebName};</td></tr>
<tr><td class="h">300</td><td><div class="c3">5</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--condition.html#L300">100</a></div></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$lUser ||= $wUser;	# userid</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: Should filter in for security...</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: filter prevents use of password managers with wierd usernames,</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# like the DOMAIN\username used in the swamp of despair.</td></tr>
<tr><td class="h">304</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$lUser =~ s/$TWiki::cfg{NameFilter}//go;</td></tr>
<tr><td class="h">305</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $wwn = $web.&#39;.&#39;.$wUser;</td></tr>
<tr><td class="h">306</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{U2W}{$lUser} = $wwn;</td></tr>
<tr><td class="h">307</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>97</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{W2U}{$wwn} = $lUser;</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">309</td><td colspan="6"></td></tr><tr><td class="h">310 - 321</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod groupMembers($group) -&gt; @members

Return a list of user objects that are members of this group. Should only be
called on groups.

Note that groups may be defined recursively, so a group may contain other
groups. This method should *only* return users i.e. all contained groups
should be fully expanded.

=cut</pre></td></tr>
<tr><td class="h">322</td><td colspan="6"></td></tr><tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub groupMembers {</td></tr>
<tr><td class="h">324</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L324">1</a></div></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">325</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $group = shift;</td></tr>
<tr><td class="h">326</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users::TWikiUserMapping&#39;)) if DEBUG;</td></tr>
<tr><td class="h">327</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">328</td><td colspan="6"></td></tr><tr><td class="h">329</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L329">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--condition.html#L329">33</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( !defined $group-&gt;{members} &amp;&amp;</td></tr>
<tr><td class="h">330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;topicExists( $group-&gt;{web}, $group-&gt;{wikiname} )) {</td></tr>
<tr><td class="h">331</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $text =</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;readTopicRaw( undef,</td></tr>
<tr><td class="h">333</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group-&gt;{web}, $group-&gt;{wikiname},</td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef );</td></tr>
<tr><td class="h">335</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach( split( /\r?\n/, $text ) ) {</td></tr>
<tr><td class="h">336</td><td><div class="c3">26</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L336">100</a></div></td><td></td><td></td><td><div>176</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( /$TWiki::regex{setRegex}GROUP\s*=\s*(.+)$/ ) {</td></tr>
<tr><td class="h">337</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--branch.html#L337">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless( $1 eq &#39;Set&#39; );</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note: if there are multiple GROUP assignments in the</td></tr>
<tr><td class="h">339</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# topic, only the last will be taken.</td></tr>
<tr><td class="h">340</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group-&gt;{members} = </td></tr>
<tr><td class="h">341</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;{users}-&gt;expandUserList( $2 );</td></tr>
<tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">343</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">344</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# backlink the user to the group</td></tr>
<tr><td class="h">345</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $user ( @{$group-&gt;{members}} ) {</td></tr>
<tr><td class="h">346</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @{$user-&gt;{groups}}, $group );</td></tr>
<tr><td class="h">347</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">348</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">349</td><td colspan="6"></td></tr><tr><td class="h">350</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $group-&gt;{members};</td></tr>
<tr><td class="h">351</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">352</td><td colspan="6"></td></tr><tr><td class="h">353 - 364</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod isGroup($user) -&gt; boolean

Establish if a user object refers to a user group or not.

The default implementation is to check if the wikiname of the user ends with
&#39;Group&#39;. Subclasses may override this behaviour to provide alternative
interpretations. The $TWiki::cfg{SuperAdminGroup} is recognized as a
group no matter what it&#39;s name is.

=cut</pre></td></tr>
<tr><td class="h">365</td><td colspan="6"></td></tr><tr><td class="h">366</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isGroup {</td></tr>
<tr><td class="h">367</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-TWikiUserMapping-pm--subroutine.html#L367">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $user) = @_;</td></tr>
<tr><td class="h">368</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($user-&gt;isa( &#39;TWiki::User&#39;)) if DEBUG;</td></tr>
<tr><td class="h">369</td><td colspan="6"></td></tr><tr><td class="h">370</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $user-&gt;wikiName() =~ /Group$/;</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">372</td><td colspan="6"></td></tr><tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
