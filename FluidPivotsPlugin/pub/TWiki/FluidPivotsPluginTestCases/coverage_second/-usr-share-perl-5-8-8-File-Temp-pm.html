<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl/5.8.8/File/Temp.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl/5.8.8/File/Temp.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">10.0%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s">package File::Temp;</td></tr>
<tr><td class="h">2</td><td colspan="6"></td></tr><tr><td class="h">3 - 128</td><td colspan="5"></td><td class="s"><pre>=head1 NAME

File::Temp - return name and handle of a temporary file safely

=begin __INTERNALS

=head1 PORTABILITY

This section is at the top in order to provide easier access to
porters.  It is not expected to be rendered by a standard pod
formatting tool. Please skip straight to the SYNOPSIS section if you
are not trying to port this module to a new platform.

This module is designed to be portable across operating systems and it
currently supports Unix, VMS, DOS, OS/2, Windows and Mac OS
(Classic). When porting to a new OS there are generally three main
issues that have to be solved:

=over 4

=item *

Can the OS unlink an open file? If it can not then the
C&lt;_can_unlink_opened_file&gt; method should be modified.

=item *

Are the return values from C&lt;stat&gt; reliable? By default all the
return values from C&lt;stat&gt; are compared when unlinking a temporary
file using the filename and the handle. Operating systems other than
unix do not always have valid entries in all fields. If C&lt;unlink0&gt; fails
then the C&lt;stat&gt; comparison should be modified accordingly.

=item *

Security. Systems that can not support a test for the sticky bit
on a directory can not use the MEDIUM and HIGH security tests.
The C&lt;_can_do_level&gt; method should be modified accordingly.

=back

=end __INTERNALS

=head1 SYNOPSIS

  use File::Temp qw/ tempfile tempdir /;

  $fh = tempfile();
  ($fh, $filename) = tempfile();

  ($fh, $filename) = tempfile( $template, DIR =&gt; $dir);
  ($fh, $filename) = tempfile( $template, SUFFIX =&gt; &#39;.dat&#39;);


  $dir = tempdir( CLEANUP =&gt; 1 );
  ($fh, $filename) = tempfile( DIR =&gt; $dir );

Object interface:

  require File::Temp;
  use File::Temp ();

  $fh = new File::Temp($template);
  $fname = $fh-&gt;filename;

  $tmp = new File::Temp( UNLINK =&gt; 0, SUFFIX =&gt; &#39;.dat&#39; );
  print $tmp &quot;Some data\n&quot;;
  print &quot;Filename is $tmp\n&quot;;

The following interfaces are provided for compatibility with
existing APIs. They should not be used in new code.

MkTemp family:

  use File::Temp qw/ :mktemp  /;

  ($fh, $file) = mkstemp( &quot;tmpfileXXXXX&quot; );
  ($fh, $file) = mkstemps( &quot;tmpfileXXXXXX&quot;, $suffix);

  $tmpdir = mkdtemp( $template );

  $unopened_file = mktemp( $template );

POSIX functions:

  use File::Temp qw/ :POSIX /;

  $file = tmpnam();
  $fh = tmpfile();

  ($fh, $file) = tmpnam();

Compatibility functions:

  $unopened_file = File::Temp::tempnam( $dir, $pfx );

=head1 DESCRIPTION

C&lt;File::Temp&gt; can be used to create and open temporary files in a safe
way.  There is both a function interface and an object-oriented
interface.  The File::Temp constructor or the tempfile() function can
be used to return the name and the open filehandle of a temporary
file.  The tempdir() function can be used to create a temporary
directory.

The security aspect of temporary file creation is emphasized such that
a filehandle and filename are returned together.  This helps guarantee
that a race condition can not occur where the temporary file is
created by another process between checking for the existence of the
file and its opening.  Additional security levels are provided to
check, for example, that the sticky bit is set on world writable
directories.  See L&lt;&quot;safe_level&quot;&gt; for more information.

For compatibility with popular C library functions, Perl implementations of
the mkstemp() family of functions are provided. These are, mkstemp(),
mkstemps(), mkdtemp() and mktemp().

Additionally, implementations of the standard L&lt;POSIX|POSIX&gt;
tmpnam() and tmpfile() functions are provided if required.

Implementations of mktemp(), tmpnam(), and tempnam() are provided,
but should be used with caution since they return only a filename
that was valid when function was called, so cannot guarantee
that the file will not exist by the time the caller opens the filename.

=cut</pre></td></tr>
<tr><td class="h">129</td><td colspan="6"></td></tr><tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td class="s"># 5.6.0 gives us S_IWOTH, S_IWGRP, our and auto-vivifying filehandls</td></tr>
<tr><td class="h">131</td><td></td><td></td><td></td><td></td><td></td><td class="s"># People would like a version on 5.005 so give them what they want :-)</td></tr>
<tr><td class="h">132</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L132">1</a></div></td><td><div>16</div><div>2</div><div>4</div></td><td class="s">use 5.005;</td></tr>
<tr><td class="h">133</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L133">1</a></div></td><td><div>6</div><div>2</div><div>5</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">134</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L134">1</a></div></td><td><div>5</div><div>3</div><div>7</div></td><td class="s">use Carp;</td></tr>
<tr><td class="h">135</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L135">1</a></div></td><td><div>6</div><div>12</div><div>6</div></td><td class="s">use File::Spec 0.8;</td></tr>
<tr><td class="h">136</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L136">1</a></div></td><td><div>6</div><div>2</div><div>8</div></td><td class="s">use File::Path qw/ rmtree /;</td></tr>
<tr><td class="h">137</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L137">1</a></div></td><td><div>12</div><div>16</div><div>5</div></td><td class="s">use Fcntl 1.03;</td></tr>
<tr><td class="h">138</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L138">1</a></div></td><td><div>12</div><div>3</div><div>9</div></td><td class="s">use Errno;</td></tr>
<tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td class="s">require VMS::Stdio if $^O eq &#39;VMS&#39;;</td></tr>
<tr><td class="h">140</td><td colspan="6"></td></tr><tr><td class="h">141</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Need the Symbol package if we are running older perl</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td class="s">require Symbol if $] &lt; 5.006;</td></tr>
<tr><td class="h">143</td><td colspan="6"></td></tr><tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td class="s">### For the OO interface</td></tr>
<tr><td class="h">145</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L145">1</a></div></td><td><div>8</div><div>2</div><div>8</div></td><td class="s">use base qw/ IO::Handle /;</td></tr>
<tr><td class="h">146</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L146">1</a></div></td><td><div>7</div><div>2</div><div>7</div></td><td class="s">use overload &#39;&quot;&quot;&#39; =&gt; &quot;STRINGIFY&quot;;</td></tr>
<tr><td class="h">147</td><td colspan="6"></td></tr><tr><td class="h">148</td><td colspan="6"></td></tr><tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td class="s"># use &#39;our&#39; on v5.6.0</td></tr>
<tr><td class="h">150</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L150">1</a></div></td><td><div>6</div><div>2</div><div>6</div></td><td class="s">use vars qw($VERSION @EXPORT_OK %EXPORT_TAGS $DEBUG $KEEP_ALL);</td></tr>
<tr><td class="h">151</td><td colspan="6"></td></tr><tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td class="s">$DEBUG = 0;</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td class="s">$KEEP_ALL = 0;</td></tr>
<tr><td class="h">154</td><td colspan="6"></td></tr><tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td class="s"># We are exporting functions</td></tr>
<tr><td class="h">156</td><td colspan="6"></td></tr><tr><td class="h">157</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L157">1</a></div></td><td><div>7</div><div>2</div><div>4</div></td><td class="s">use base qw/Exporter/;</td></tr>
<tr><td class="h">158</td><td colspan="6"></td></tr><tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Export list - to allow fine tuning of export table</td></tr>
<tr><td class="h">160</td><td colspan="6"></td></tr><tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td class="s">@EXPORT_OK = qw{</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tempfile</td></tr>
<tr><td class="h">163</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tempdir</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpnam</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpfile</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mktemp</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkstemp</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkstemps</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mkdtemp</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink0</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cleanup</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">173</td><td colspan="6"></td></tr><tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Groups of functions for export</td></tr>
<tr><td class="h">175</td><td colspan="6"></td></tr><tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td class="s">%EXPORT_TAGS = (</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;POSIX&#39; =&gt; [qw/ tmpnam tmpfile /],</td></tr>
<tr><td class="h">178</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mktemp&#39; =&gt; [qw/ mktemp mkstemp mkstemps mkdtemp/],</td></tr>
<tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">180</td><td colspan="6"></td></tr><tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td class="s"># add contents of these tags to @EXPORT</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td class="s">Exporter::export_tags(&#39;POSIX&#39;,&#39;mktemp&#39;);</td></tr>
<tr><td class="h">183</td><td colspan="6"></td></tr><tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Version number</td></tr>
<tr><td class="h">185</td><td colspan="6"></td></tr><tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td class="s">$VERSION = &#39;0.16&#39;;</td></tr>
<tr><td class="h">187</td><td colspan="6"></td></tr><tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This is a list of characters that can be used in random filenames</td></tr>
<tr><td class="h">189</td><td colspan="6"></td></tr><tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td class="s">my @CHARS = (qw/ A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a b c d e f g h i j k l m n o p q r s t u v w x y z</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 1 2 3 4 5 6 7 8 9 _</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/);</td></tr>
<tr><td class="h">194</td><td colspan="6"></td></tr><tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Maximum number of tries to make a temp file before failing</td></tr>
<tr><td class="h">196</td><td colspan="6"></td></tr><tr><td class="h">197</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L197">1</a></div></td><td><div>11</div><div>2</div><div>6</div></td><td class="s">use constant MAX_TRIES =&gt; 1000;</td></tr>
<tr><td class="h">198</td><td colspan="6"></td></tr><tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Minimum number of X characters that should be in a template</td></tr>
<tr><td class="h">200</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L200">1</a></div></td><td><div>6</div><div>2</div><div>4</div></td><td class="s">use constant MINX =&gt; 4;</td></tr>
<tr><td class="h">201</td><td colspan="6"></td></tr><tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Default template when no template supplied</td></tr>
<tr><td class="h">203</td><td colspan="6"></td></tr><tr><td class="h">204</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L204">1</a></div></td><td><div>6</div><div>2</div><div>6</div></td><td class="s">use constant TEMPXXX =&gt; &#39;X&#39; x 10;</td></tr>
<tr><td class="h">205</td><td colspan="6"></td></tr><tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Constants for the security level</td></tr>
<tr><td class="h">207</td><td colspan="6"></td></tr><tr><td class="h">208</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L208">1</a></div></td><td><div>6</div><div>2</div><div>4</div></td><td class="s">use constant STANDARD =&gt; 0;</td></tr>
<tr><td class="h">209</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L209">1</a></div></td><td><div>6</div><div>2</div><div>4</div></td><td class="s">use constant MEDIUM   =&gt; 1;</td></tr>
<tr><td class="h">210</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L210">1</a></div></td><td><div>6</div><div>2</div><div>4</div></td><td class="s">use constant HIGH     =&gt; 2;</td></tr>
<tr><td class="h">211</td><td colspan="6"></td></tr><tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td class="s"># OPENFLAGS. If we defined the flag to use with Sysopen here this gives</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td class="s"># us an optimisation when many temporary files are requested</td></tr>
<tr><td class="h">214</td><td colspan="6"></td></tr><tr><td class="h">215</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $OPENFLAGS = O_CREAT | O_EXCL | O_RDWR;</td></tr>
<tr><td class="h">216</td><td colspan="6"></td></tr><tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td class="s">unless ($^O eq &#39;MacOS&#39;) {</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;for my $oflag (qw/ NOFOLLOW BINARY LARGEFILE EXLOCK NOINHERIT /) {</td></tr>
<tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($bit, $func) = (0, &quot;Fcntl::O_&quot; . $oflag);</td></tr>
<tr><td class="h">220</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L220">1</a></div></td><td><div>6</div><div>3</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;no strict &#39;refs&#39;;</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$OPENFLAGS |= $bit if eval {</td></tr>
<tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure that redefined die handlers do not cause problems</td></tr>
<tr><td class="h">223</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# eg CGI::Carp</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__DIE__} = sub {};</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__WARN__} = sub {};</td></tr>
<tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bit = &amp;$func();</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1;</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">231</td><td colspan="6"></td></tr><tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td class="s"># On some systems the O_TEMPORARY flag can be used to tell the OS</td></tr>
<tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td class="s"># to automatically remove the file when it is closed. This is fine</td></tr>
<tr><td class="h">234</td><td></td><td></td><td></td><td></td><td></td><td class="s"># in most cases but not if tempfile is called with UNLINK=&gt;0 and</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td class="s"># the filename is requested -- in the case where the filename is to</td></tr>
<tr><td class="h">236</td><td></td><td></td><td></td><td></td><td></td><td class="s"># be passed to another routine. This happens on windows. We overcome</td></tr>
<tr><td class="h">237</td><td></td><td></td><td></td><td></td><td></td><td class="s"># this by using a second open flags variable</td></tr>
<tr><td class="h">238</td><td colspan="6"></td></tr><tr><td class="h">239</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $OPENTEMPFLAGS = $OPENFLAGS;</td></tr>
<tr><td class="h">240</td><td></td><td></td><td></td><td></td><td></td><td class="s">unless ($^O eq &#39;MacOS&#39;) {</td></tr>
<tr><td class="h">241</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;for my $oflag (qw/ TEMPORARY /) {</td></tr>
<tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($bit, $func) = (0, &quot;Fcntl::O_&quot; . $oflag);</td></tr>
<tr><td class="h">243</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L243">1</a></div></td><td><div>6</div><div>3</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;no strict &#39;refs&#39;;</td></tr>
<tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$OPENTEMPFLAGS |= $bit if eval {</td></tr>
<tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure that redefined die handlers do not cause problems</td></tr>
<tr><td class="h">246</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# eg CGI::Carp</td></tr>
<tr><td class="h">247</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__DIE__} = sub {};</td></tr>
<tr><td class="h">248</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $SIG{__WARN__} = sub {};</td></tr>
<tr><td class="h">249</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bit = &amp;$func();</td></tr>
<tr><td class="h">250</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1;</td></tr>
<tr><td class="h">251</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">252</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">254</td><td colspan="6"></td></tr><tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td class="s"># INTERNAL ROUTINES - not to be used outside of package</td></tr>
<tr><td class="h">256</td><td colspan="6"></td></tr><tr><td class="h">257</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Generic routine for getting a temporary filename</td></tr>
<tr><td class="h">258</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modelled on OpenBSD _gettemp() in mktemp.c</td></tr>
<tr><td class="h">259</td><td colspan="6"></td></tr><tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td class="s"># The template must contain X&#39;s that are to be replaced</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td class="s"># with the random values</td></tr>
<tr><td class="h">262</td><td colspan="6"></td></tr><tr><td class="h">263</td><td></td><td></td><td></td><td></td><td></td><td class="s">#  Arguments:</td></tr>
<tr><td class="h">264</td><td colspan="6"></td></tr><tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td class="s">#  TEMPLATE   - string containing the XXXXX&#39;s that is converted</td></tr>
<tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td class="s">#           to a random filename and opened if required</td></tr>
<tr><td class="h">267</td><td colspan="6"></td></tr><tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Optionally, a hash can also be supplied containing specific options</td></tr>
<tr><td class="h">269</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   &quot;open&quot; =&gt; if true open the temp file, else just return the name</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td class="s">#             default is 0</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   &quot;mkdir&quot;=&gt; if true, we are creating a temp directory rather than tempfile</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td class="s">#             default is 0</td></tr>
<tr><td class="h">273</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   &quot;suffixlen&quot; =&gt; number of characters at end of PATH to be ignored.</td></tr>
<tr><td class="h">274</td><td></td><td></td><td></td><td></td><td></td><td class="s">#                  default is 0.</td></tr>
<tr><td class="h">275</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   &quot;unlink_on_close&quot; =&gt; indicates that, if possible,  the OS should remove</td></tr>
<tr><td class="h">276</td><td></td><td></td><td></td><td></td><td></td><td class="s">#                        the file as soon as it is closed. Usually indicates</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td class="s">#                        use of the O_TEMPORARY flag to sysopen.</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td class="s">#                        Usually irrelevant on unix</td></tr>
<tr><td class="h">279</td><td colspan="6"></td></tr><tr><td class="h">280</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Optionally a reference to a scalar can be passed into the function</td></tr>
<tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td class="s"># On error this will be used to store the reason for the error</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   &quot;ErrStr&quot;  =&gt; \$errstr</td></tr>
<tr><td class="h">283</td><td colspan="6"></td></tr><tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td class="s"># &quot;open&quot; and &quot;mkdir&quot; can not both be true</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td class="s"># &quot;unlink_on_close&quot; is not used when &quot;mkdir&quot; is true.</td></tr>
<tr><td class="h">286</td><td colspan="6"></td></tr><tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s"># The default options are equivalent to mktemp().</td></tr>
<tr><td class="h">288</td><td colspan="6"></td></tr><tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns:</td></tr>
<tr><td class="h">290</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   filehandle - open file handle (if called with doopen=1, else undef)</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   temp name  - name of the temp file or directory</td></tr>
<tr><td class="h">292</td><td colspan="6"></td></tr><tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td class="s"># For example:</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   ($fh, $name) = _gettemp($template, &quot;open&quot; =&gt; 1);</td></tr>
<tr><td class="h">295</td><td colspan="6"></td></tr><tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td class="s"># for the current version, failures are associated with</td></tr>
<tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td class="s"># stored in an error string and returned to give the reason whilst debugging</td></tr>
<tr><td class="h">298</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine is not called by any external function</td></tr>
<tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _gettemp {</td></tr>
<tr><td class="h">300</td><td colspan="6"></td></tr><tr><td class="h">301</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L301">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L301">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: ($fh, $name) = _gettemp($template, OPTIONS);&#39;</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) &gt;= 1;</td></tr>
<tr><td class="h">303</td><td colspan="6"></td></tr><tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# the internal error string - expect it to be overridden</td></tr>
<tr><td class="h">305</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Need this in case the caller decides not to supply us a value</td></tr>
<tr><td class="h">306</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# need an anonymous scalar</td></tr>
<tr><td class="h">307</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $tempErrStr;</td></tr>
<tr><td class="h">308</td><td colspan="6"></td></tr><tr><td class="h">309</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Default options</td></tr>
<tr><td class="h">310</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my %options = (</td></tr>
<tr><td class="h">311</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">312</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot; =&gt; 0,</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; 0,</td></tr>
<tr><td class="h">314</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;unlink_on_close&quot; =&gt; 0,</td></tr>
<tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$tempErrStr,</td></tr>
<tr><td class="h">316</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">317</td><td colspan="6"></td></tr><tr><td class="h">318</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the template</td></tr>
<tr><td class="h">319</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">320</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L320">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (ref($template)) {</td></tr>
<tr><td class="h">321</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Use a warning here since we have not yet merged ErrStr</td></tr>
<tr><td class="h">322</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;File::Temp::_gettemp: template must not be a reference&quot;;</td></tr>
<tr><td class="h">323</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">325</td><td colspan="6"></td></tr><tr><td class="h">326</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check that the number of entries on stack are even</td></tr>
<tr><td class="h">327</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L327">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (scalar(@_) % 2 != 0) {</td></tr>
<tr><td class="h">328</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Use a warning here since we have not yet merged ErrStr</td></tr>
<tr><td class="h">329</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;File::Temp::_gettemp: Must have even number of options&quot;;</td></tr>
<tr><td class="h">330</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">331</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">332</td><td colspan="6"></td></tr><tr><td class="h">333</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the options and merge with defaults</td></tr>
<tr><td class="h">334</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L334">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;%options = (%options, @_)  if @_;</td></tr>
<tr><td class="h">335</td><td colspan="6"></td></tr><tr><td class="h">336</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure the error string is set to undef</td></tr>
<tr><td class="h">337</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;${$options{ErrStr}} = undef;</td></tr>
<tr><td class="h">338</td><td colspan="6"></td></tr><tr><td class="h">339</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Can not open the file and make a directory in a single call</td></tr>
<tr><td class="h">340</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L340">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L340">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($options{&quot;open&quot;} &amp;&amp; $options{&quot;mkdir&quot;}) {</td></tr>
<tr><td class="h">341</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;doopen and domkdir can not both be true\n&quot;;</td></tr>
<tr><td class="h">342</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">343</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">344</td><td colspan="6"></td></tr><tr><td class="h">345</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Find the start of the end of the  Xs (position of last X)</td></tr>
<tr><td class="h">346</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Substr starts from 0</td></tr>
<tr><td class="h">347</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $start = length($template) - 1 - $options{&quot;suffixlen&quot;};</td></tr>
<tr><td class="h">348</td><td colspan="6"></td></tr><tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check that we have at least MINX x X (eg &#39;XXXX&quot;) at the end of the string</td></tr>
<tr><td class="h">350</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# (taking suffixlen into account). Any fewer is insecure.</td></tr>
<tr><td class="h">351</td><td colspan="6"></td></tr><tr><td class="h">352</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it using substr - no reason to use a pattern match since</td></tr>
<tr><td class="h">353</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we know where we are looking and what we are looking for</td></tr>
<tr><td class="h">354</td><td colspan="6"></td></tr><tr><td class="h">355</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L355">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (substr($template, $start - MINX + 1, MINX) ne &#39;X&#39; x MINX) {</td></tr>
<tr><td class="h">356</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;The template must end with at least &quot;.</td></tr>
<tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MINX . &quot; &#39;X&#39; characters\n&quot;;</td></tr>
<tr><td class="h">358</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">359</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">360</td><td colspan="6"></td></tr><tr><td class="h">361</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Replace all the X at the end of the substring with a</td></tr>
<tr><td class="h">362</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# random character or just all the XX at the end of a full string.</td></tr>
<tr><td class="h">363</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it as an if, since the suffix adjusts which section to replace</td></tr>
<tr><td class="h">364</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and suffixlen=0 returns nothing if used in the substr directly</td></tr>
<tr><td class="h">365</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and generate a full path from the template</td></tr>
<tr><td class="h">366</td><td colspan="6"></td></tr><tr><td class="h">367</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $path = _replace_XX($template, $options{&quot;suffixlen&quot;});</td></tr>
<tr><td class="h">368</td><td colspan="6"></td></tr><tr><td class="h">369</td><td colspan="6"></td></tr><tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Split the path into constituent parts - eventually we need to check</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# whether the directory exists</td></tr>
<tr><td class="h">372</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# We need to know whether we are making a temp directory</td></tr>
<tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# or a tempfile</td></tr>
<tr><td class="h">374</td><td colspan="6"></td></tr><tr><td class="h">375</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($volume, $directories, $file);</td></tr>
<tr><td class="h">376</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $parent; # parent directory</td></tr>
<tr><td class="h">377</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L377">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($options{&quot;mkdir&quot;}) {</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# There is no filename at the end</td></tr>
<tr><td class="h">379</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($volume, $directories, $file) = File::Spec-&gt;splitpath( $path, 1);</td></tr>
<tr><td class="h">380</td><td colspan="6"></td></tr><tr><td class="h">381</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The parent is then $directories without the last directory</td></tr>
<tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Split the directory and put it back together again</td></tr>
<tr><td class="h">383</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @dirs = File::Spec-&gt;splitdir($directories);</td></tr>
<tr><td class="h">384</td><td colspan="6"></td></tr><tr><td class="h">385</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If @dirs only has one entry (i.e. the directory template) that means</td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we are in the current directory</td></tr>
<tr><td class="h">387</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L387">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($#dirs == 0) {</td></tr>
<tr><td class="h">388</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;curdir;</td></tr>
<tr><td class="h">389</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">390</td><td colspan="6"></td></tr><tr><td class="h">391</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L391">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($^O eq &#39;VMS&#39;) {  # need volume to avoid relative dir spec</td></tr>
<tr><td class="h">392</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catdir($volume, @dirs[0..$#dirs-1]);</td></tr>
<tr><td class="h">393</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L393">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = &#39;sys$disk:[]&#39; if $parent eq &#39;&#39;;</td></tr>
<tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">395</td><td colspan="6"></td></tr><tr><td class="h">396</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Put it back together without the last one</td></tr>
<tr><td class="h">397</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catdir(@dirs[0..$#dirs-1]);</td></tr>
<tr><td class="h">398</td><td colspan="6"></td></tr><tr><td class="h">399</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ...and attach the volume (no filename)</td></tr>
<tr><td class="h">400</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catpath($volume, $parent, &#39;&#39;);</td></tr>
<tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">402</td><td colspan="6"></td></tr><tr><td class="h">403</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">404</td><td colspan="6"></td></tr><tr><td class="h">405</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">406</td><td colspan="6"></td></tr><tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get rid of the last filename (use File::Basename for this?)</td></tr>
<tr><td class="h">408</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($volume, $directories, $file) = File::Spec-&gt;splitpath( $path );</td></tr>
<tr><td class="h">409</td><td colspan="6"></td></tr><tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Join up without the file part</td></tr>
<tr><td class="h">411</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;catpath($volume,$directories,&#39;&#39;);</td></tr>
<tr><td class="h">412</td><td colspan="6"></td></tr><tr><td class="h">413</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If $parent is empty replace with curdir</td></tr>
<tr><td class="h">414</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L414">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$parent = File::Spec-&gt;curdir</td></tr>
<tr><td class="h">415</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $directories ne &#39;&#39;;</td></tr>
<tr><td class="h">416</td><td colspan="6"></td></tr><tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">418</td><td colspan="6"></td></tr><tr><td class="h">419</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check that the parent directories exist</td></tr>
<tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do this even for the case where we are simply returning a name</td></tr>
<tr><td class="h">421</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# not a file -- no point returning a name that includes a directory</td></tr>
<tr><td class="h">422</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# that does not exist or is not writable</td></tr>
<tr><td class="h">423</td><td colspan="6"></td></tr><tr><td class="h">424</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L424">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unless (-d $parent) {</td></tr>
<tr><td class="h">425</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not a directory&quot;;</td></tr>
<tr><td class="h">426</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">427</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">428</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L428">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unless (-w $parent) {</td></tr>
<tr><td class="h">429</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not writable\n&quot;;</td></tr>
<tr><td class="h">430</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">431</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">432</td><td colspan="6"></td></tr><tr><td class="h">433</td><td colspan="6"></td></tr><tr><td class="h">434</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check the stickiness of the directory and chown giveaway if required</td></tr>
<tr><td class="h">435</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If the directory is world writable the sticky bit</td></tr>
<tr><td class="h">436</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# must be set</td></tr>
<tr><td class="h">437</td><td colspan="6"></td></tr><tr><td class="h">438</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L438">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L438">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (File::Temp-&gt;safe_level == MEDIUM) {</td></tr>
<tr><td class="h">439</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $safeerr;</td></tr>
<tr><td class="h">440</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L440">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (_is_safe($parent,\$safeerr)) {</td></tr>
<tr><td class="h">441</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not safe ($safeerr)&quot;;</td></tr>
<tr><td class="h">442</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">444</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif (File::Temp-&gt;safe_level == HIGH) {</td></tr>
<tr><td class="h">445</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $safeerr;</td></tr>
<tr><td class="h">446</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L446">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (_is_verysafe($parent, \$safeerr)) {</td></tr>
<tr><td class="h">447</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Parent directory ($parent) is not safe ($safeerr)&quot;;</td></tr>
<tr><td class="h">448</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">449</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">450</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">451</td><td colspan="6"></td></tr><tr><td class="h">452</td><td colspan="6"></td></tr><tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Now try MAX_TRIES time to open the file</td></tr>
<tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;for (my $i = 0; $i &lt; MAX_TRIES; $i++) {</td></tr>
<tr><td class="h">455</td><td colspan="6"></td></tr><tr><td class="h">456</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Try to open the file if requested</td></tr>
<tr><td class="h">457</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L457">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L457">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;open&quot;}) {</td></tr>
<tr><td class="h">458</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fh;</td></tr>
<tr><td class="h">459</td><td colspan="6"></td></tr><tr><td class="h">460</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If we are running before perl5.6.0 we can not auto-vivify</td></tr>
<tr><td class="h">461</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L461">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($] &lt; 5.006) {</td></tr>
<tr><td class="h">462</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fh = &amp;Symbol::gensym;</td></tr>
<tr><td class="h">463</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">464</td><td colspan="6"></td></tr><tr><td class="h">465</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Try to make sure this will be marked close-on-exec</td></tr>
<tr><td class="h">466</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# XXX: Win32 doesn&#39;t respect this, nor the proper fcntl,</td></tr>
<tr><td class="h">467</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#      but may have O_NOINHERIT. This may or may not be in Fcntl.</td></tr>
<tr><td class="h">468</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $^F = 2;</td></tr>
<tr><td class="h">469</td><td colspan="6"></td></tr><tr><td class="h">470</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Store callers umask</td></tr>
<tr><td class="h">471</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $umask = umask();</td></tr>
<tr><td class="h">472</td><td colspan="6"></td></tr><tr><td class="h">473</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Set a known umask</td></tr>
<tr><td class="h">474</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask(066);</td></tr>
<tr><td class="h">475</td><td colspan="6"></td></tr><tr><td class="h">476</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Attempt to open the file</td></tr>
<tr><td class="h">477</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $open_success = undef;</td></tr>
<tr><td class="h">478</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L478">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L478">0</a></div><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L478">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $^O eq &#39;VMS&#39; and $options{&quot;unlink_on_close&quot;} &amp;&amp; !$KEEP_ALL) {</td></tr>
<tr><td class="h">479</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# make it auto delete on close by setting FAB$V_DLT bit</td></tr>
<tr><td class="h">480</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fh = VMS::Stdio::vmssysopen($path, $OPENFLAGS, 0600, &#39;fop=dlt&#39;);</td></tr>
<tr><td class="h">481</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$open_success = $fh;</td></tr>
<tr><td class="h">482</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">483</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L483">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L483">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $flags = ( ($options{&quot;unlink_on_close&quot;} &amp;&amp; !$KEEP_ALL) ?</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$OPENTEMPFLAGS :</td></tr>
<tr><td class="h">485</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$OPENFLAGS );</td></tr>
<tr><td class="h">486</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$open_success = sysopen($fh, $path, $flags, 0600);</td></tr>
<tr><td class="h">487</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">488</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L488">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $open_success ) {</td></tr>
<tr><td class="h">489</td><td colspan="6"></td></tr><tr><td class="h">490</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Reset umask</td></tr>
<tr><td class="h">491</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L491">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask($umask) if defined $umask;</td></tr>
<tr><td class="h">492</td><td colspan="6"></td></tr><tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Opened successfully - return file handle and name</td></tr>
<tr><td class="h">494</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">495</td><td colspan="6"></td></tr><tr><td class="h">496</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">497</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Reset umask</td></tr>
<tr><td class="h">498</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L498">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask($umask) if defined $umask;</td></tr>
<tr><td class="h">499</td><td colspan="6"></td></tr><tr><td class="h">500</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Error opening file - abort with error</td></tr>
<tr><td class="h">501</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if the reason was anything but EEXIST</td></tr>
<tr><td class="h">502</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L502">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($!{EEXIST}) {</td></tr>
<tr><td class="h">503</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Could not create temp file $path: $!&quot;;</td></tr>
<tr><td class="h">504</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">505</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">506</td><td colspan="6"></td></tr><tr><td class="h">507</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Loop round for another try</td></tr>
<tr><td class="h">508</td><td colspan="6"></td></tr><tr><td class="h">509</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">510</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($options{&quot;mkdir&quot;}) {</td></tr>
<tr><td class="h">511</td><td colspan="6"></td></tr><tr><td class="h">512</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Store callers umask</td></tr>
<tr><td class="h">513</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $umask = umask();</td></tr>
<tr><td class="h">514</td><td colspan="6"></td></tr><tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Set a known umask</td></tr>
<tr><td class="h">516</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask(066);</td></tr>
<tr><td class="h">517</td><td colspan="6"></td></tr><tr><td class="h">518</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Open the temp directory</td></tr>
<tr><td class="h">519</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L519">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mkdir( $path, 0700)) {</td></tr>
<tr><td class="h">520</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# created okay</td></tr>
<tr><td class="h">521</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Reset umask</td></tr>
<tr><td class="h">522</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L522">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask($umask) if defined $umask;</td></tr>
<tr><td class="h">523</td><td colspan="6"></td></tr><tr><td class="h">524</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef, $path;</td></tr>
<tr><td class="h">525</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">526</td><td colspan="6"></td></tr><tr><td class="h">527</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Reset umask</td></tr>
<tr><td class="h">528</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L528">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;umask($umask) if defined $umask;</td></tr>
<tr><td class="h">529</td><td colspan="6"></td></tr><tr><td class="h">530</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Abort with error if the reason for failure was anything</td></tr>
<tr><td class="h">531</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# except EEXIST</td></tr>
<tr><td class="h">532</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L532">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($!{EEXIST}) {</td></tr>
<tr><td class="h">533</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Could not create directory $path: $!&quot;;</td></tr>
<tr><td class="h">534</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">535</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">536</td><td colspan="6"></td></tr><tr><td class="h">537</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Loop round for another try</td></tr>
<tr><td class="h">538</td><td colspan="6"></td></tr><tr><td class="h">539</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">540</td><td colspan="6"></td></tr><tr><td class="h">541</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">542</td><td colspan="6"></td></tr><tr><td class="h">543</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Return true if the file can not be found</td></tr>
<tr><td class="h">544</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Directory has been checked previously</td></tr>
<tr><td class="h">545</td><td colspan="6"></td></tr><tr><td class="h">546</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L546">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (undef, $path) unless -e $path;</td></tr>
<tr><td class="h">547</td><td colspan="6"></td></tr><tr><td class="h">548</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Try again until MAX_TRIES</td></tr>
<tr><td class="h">549</td><td colspan="6"></td></tr><tr><td class="h">550</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">551</td><td colspan="6"></td></tr><tr><td class="h">552</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Did not successfully open the tempfile/dir</td></tr>
<tr><td class="h">553</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# so try again with a different set of random letters</td></tr>
<tr><td class="h">554</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# No point in trying to increment unless we have only</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 1 X say and the randomness could come up with the same</td></tr>
<tr><td class="h">556</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# file MAX_TRIES in a row.</td></tr>
<tr><td class="h">557</td><td colspan="6"></td></tr><tr><td class="h">558</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Store current attempt - in principal this implies that the</td></tr>
<tr><td class="h">559</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 3rd time around the open attempt that the first temp file</td></tr>
<tr><td class="h">560</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# name could be generated again. Probably should store each</td></tr>
<tr><td class="h">561</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# attempt and make sure that none are repeated</td></tr>
<tr><td class="h">562</td><td colspan="6"></td></tr><tr><td class="h">563</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $original = $path;</td></tr>
<tr><td class="h">564</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $counter = 0;  # Stop infinite loop</td></tr>
<tr><td class="h">565</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $MAX_GUESS = 50;</td></tr>
<tr><td class="h">566</td><td colspan="6"></td></tr><tr><td class="h">567</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L567">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;do {</td></tr>
<tr><td class="h">568</td><td colspan="6"></td></tr><tr><td class="h">569</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Generate new name from original template</td></tr>
<tr><td class="h">570</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path = _replace_XX($template, $options{&quot;suffixlen&quot;});</td></tr>
<tr><td class="h">571</td><td colspan="6"></td></tr><tr><td class="h">572</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$counter++;</td></tr>
<tr><td class="h">573</td><td colspan="6"></td></tr><tr><td class="h">574</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} until ($path ne $original || $counter &gt; $MAX_GUESS);</td></tr>
<tr><td class="h">575</td><td colspan="6"></td></tr><tr><td class="h">576</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check for out of control looping</td></tr>
<tr><td class="h">577</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L577">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($counter &gt; $MAX_GUESS) {</td></tr>
<tr><td class="h">578</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${$options{ErrStr}} = &quot;Tried to get a new temp name different to the previous value $MAX_GUESS times.\nSomething wrong with template?? ($template)&quot;;</td></tr>
<tr><td class="h">579</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">580</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">581</td><td colspan="6"></td></tr><tr><td class="h">582</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">583</td><td colspan="6"></td></tr><tr><td class="h">584</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If we get here, we have run out of tries</td></tr>
<tr><td class="h">585</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;${ $options{ErrStr} } = &quot;Have exceeded the maximum number of attempts (&quot;</td></tr>
<tr><td class="h">586</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;. MAX_TRIES . &quot;) to open temp file/dir&quot;;</td></tr>
<tr><td class="h">587</td><td colspan="6"></td></tr><tr><td class="h">588</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return ();</td></tr>
<tr><td class="h">589</td><td colspan="6"></td></tr><tr><td class="h">590</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">591</td><td colspan="6"></td></tr><tr><td class="h">592</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to return a random character from the</td></tr>
<tr><td class="h">593</td><td></td><td></td><td></td><td></td><td></td><td class="s"># character list. Does not do an srand() since rand()</td></tr>
<tr><td class="h">594</td><td></td><td></td><td></td><td></td><td></td><td class="s"># will do one automatically</td></tr>
<tr><td class="h">595</td><td colspan="6"></td></tr><tr><td class="h">596</td><td></td><td></td><td></td><td></td><td></td><td class="s"># No arguments. Return value is the random character</td></tr>
<tr><td class="h">597</td><td colspan="6"></td></tr><tr><td class="h">598</td><td></td><td></td><td></td><td></td><td></td><td class="s"># No longer called since _replace_XX runs a few percent faster if</td></tr>
<tr><td class="h">599</td><td></td><td></td><td></td><td></td><td></td><td class="s"># I inline the code. This is important if we are creating thousands of</td></tr>
<tr><td class="h">600</td><td></td><td></td><td></td><td></td><td></td><td class="s"># temporary files.</td></tr>
<tr><td class="h">601</td><td colspan="6"></td></tr><tr><td class="h">602</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _randchar {</td></tr>
<tr><td class="h">603</td><td colspan="6"></td></tr><tr><td class="h">604</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L604">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;$CHARS[ int( rand( $#CHARS ) ) ];</td></tr>
<tr><td class="h">605</td><td colspan="6"></td></tr><tr><td class="h">606</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">607</td><td colspan="6"></td></tr><tr><td class="h">608</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to replace the XXXX... with random characters</td></tr>
<tr><td class="h">609</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This has to be done by _gettemp() every time it fails to</td></tr>
<tr><td class="h">610</td><td></td><td></td><td></td><td></td><td></td><td class="s"># open a temp file/dir</td></tr>
<tr><td class="h">611</td><td colspan="6"></td></tr><tr><td class="h">612</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Arguments:  $template (the template with XXX),</td></tr>
<tr><td class="h">613</td><td></td><td></td><td></td><td></td><td></td><td class="s">#             $ignore   (number of characters at end to ignore)</td></tr>
<tr><td class="h">614</td><td colspan="6"></td></tr><tr><td class="h">615</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns:    modified template</td></tr>
<tr><td class="h">616</td><td colspan="6"></td></tr><tr><td class="h">617</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _replace_XX {</td></tr>
<tr><td class="h">618</td><td colspan="6"></td></tr><tr><td class="h">619</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L619">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L619">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: _replace_XX($template, $ignore)&#39;</td></tr>
<tr><td class="h">620</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">621</td><td colspan="6"></td></tr><tr><td class="h">622</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($path, $ignore) = @_;</td></tr>
<tr><td class="h">623</td><td colspan="6"></td></tr><tr><td class="h">624</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it as an if, since the suffix adjusts which section to replace</td></tr>
<tr><td class="h">625</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and suffixlen=0 returns nothing if used in the substr directly</td></tr>
<tr><td class="h">626</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Alternatively, could simply set $ignore to length($path)-1</td></tr>
<tr><td class="h">627</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Don&#39;t want to always use substr when not required though.</td></tr>
<tr><td class="h">628</td><td colspan="6"></td></tr><tr><td class="h">629</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L629">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($ignore) {</td></tr>
<tr><td class="h">630</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;substr($path, 0, - $ignore) =~ s/X(?=X*\z)/$CHARS[ int( rand( $#CHARS ) ) ]/ge;</td></tr>
<tr><td class="h">631</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">632</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s/X(?=X*\z)/$CHARS[ int( rand( $#CHARS ) ) ]/ge;</td></tr>
<tr><td class="h">633</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">634</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return $path;</td></tr>
<tr><td class="h">635</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">636</td><td colspan="6"></td></tr><tr><td class="h">637</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to force a temp file to be writable after</td></tr>
<tr><td class="h">638</td><td></td><td></td><td></td><td></td><td></td><td class="s"># it is created so that we can unlink it. Windows seems to occassionally</td></tr>
<tr><td class="h">639</td><td></td><td></td><td></td><td></td><td></td><td class="s"># force a file to be readonly when written to certain temp locations</td></tr>
<tr><td class="h">640</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _force_writable {</td></tr>
<tr><td class="h">641</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L641">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $file = shift;</td></tr>
<tr><td class="h">642</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $umask = umask();</td></tr>
<tr><td class="h">643</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;umask(066);</td></tr>
<tr><td class="h">644</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;chmod 0600, $file;</td></tr>
<tr><td class="h">645</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L645">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;umask($umask) if defined $umask;</td></tr>
<tr><td class="h">646</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">647</td><td colspan="6"></td></tr><tr><td class="h">648</td><td colspan="6"></td></tr><tr><td class="h">649</td><td></td><td></td><td></td><td></td><td></td><td class="s"># internal routine to check to see if the directory is safe</td></tr>
<tr><td class="h">650</td><td></td><td></td><td></td><td></td><td></td><td class="s"># First checks to see if the directory is not owned by the</td></tr>
<tr><td class="h">651</td><td></td><td></td><td></td><td></td><td></td><td class="s"># current user or root. Then checks to see if anyone else</td></tr>
<tr><td class="h">652</td><td></td><td></td><td></td><td></td><td></td><td class="s"># can write to the directory and if so, checks to see if</td></tr>
<tr><td class="h">653</td><td></td><td></td><td></td><td></td><td></td><td class="s"># it has the sticky bit set</td></tr>
<tr><td class="h">654</td><td colspan="6"></td></tr><tr><td class="h">655</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Will not work on systems that do not support sticky bit</td></tr>
<tr><td class="h">656</td><td colspan="6"></td></tr><tr><td class="h">657</td><td></td><td></td><td></td><td></td><td></td><td class="s">#Args:  directory path to check</td></tr>
<tr><td class="h">658</td><td></td><td></td><td></td><td></td><td></td><td class="s">#       Optionally: reference to scalar to contain error message</td></tr>
<tr><td class="h">659</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns true if the path is safe and false otherwise.</td></tr>
<tr><td class="h">660</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns undef if can not even run stat() on the path</td></tr>
<tr><td class="h">661</td><td colspan="6"></td></tr><tr><td class="h">662</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine based on version written by Tom Christiansen</td></tr>
<tr><td class="h">663</td><td colspan="6"></td></tr><tr><td class="h">664</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Presumably, by the time we actually attempt to create the</td></tr>
<tr><td class="h">665</td><td></td><td></td><td></td><td></td><td></td><td class="s"># file or directory in this directory, it may not be safe</td></tr>
<tr><td class="h">666</td><td></td><td></td><td></td><td></td><td></td><td class="s"># anymore... Have to run _is_safe directly after the open.</td></tr>
<tr><td class="h">667</td><td colspan="6"></td></tr><tr><td class="h">668</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _is_safe {</td></tr>
<tr><td class="h">669</td><td colspan="6"></td></tr><tr><td class="h">670</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L670">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $path = shift;</td></tr>
<tr><td class="h">671</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $err_ref = shift;</td></tr>
<tr><td class="h">672</td><td colspan="6"></td></tr><tr><td class="h">673</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Stat path</td></tr>
<tr><td class="h">674</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my @info = stat($path);</td></tr>
<tr><td class="h">675</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L675">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unless (scalar(@info)) {</td></tr>
<tr><td class="h">676</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;stat(path) returned no values&quot;;</td></tr>
<tr><td class="h">677</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">678</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;};</td></tr>
<tr><td class="h">679</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L679">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1 if $^O eq &#39;VMS&#39;;  # owner delete control at file level</td></tr>
<tr><td class="h">680</td><td colspan="6"></td></tr><tr><td class="h">681</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check to see whether owner is neither superuser (or a system uid) nor me</td></tr>
<tr><td class="h">682</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Use the real uid from the $&lt; variable</td></tr>
<tr><td class="h">683</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# UID is in [4]</td></tr>
<tr><td class="h">684</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L684">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L684">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($info[4] &gt; File::Temp-&gt;top_system_uid() &amp;&amp; $info[4] != $&lt;) {</td></tr>
<tr><td class="h">685</td><td colspan="6"></td></tr><tr><td class="h">686</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;Carp::cluck(sprintf &quot;uid=$info[4] topuid=%s \$&lt;=$&lt; path=&#39;$path&#39;&quot;,</td></tr>
<tr><td class="h">687</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File::Temp-&gt;top_system_uid());</td></tr>
<tr><td class="h">688</td><td colspan="6"></td></tr><tr><td class="h">689</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L689">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;Directory owned neither by root nor the current user&quot;</td></tr>
<tr><td class="h">690</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ref($err_ref);</td></tr>
<tr><td class="h">691</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">692</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">693</td><td colspan="6"></td></tr><tr><td class="h">694</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# check whether group or other can write file</td></tr>
<tr><td class="h">695</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# use 066 to detect either reading or writing</td></tr>
<tr><td class="h">696</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# use 022 to check writability</td></tr>
<tr><td class="h">697</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do it with S_IWOTH and S_IWGRP for portability (maybe)</td></tr>
<tr><td class="h">698</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# mode is in info[2]</td></tr>
<tr><td class="h">699</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L699">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L699">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (($info[2] &amp; &amp;Fcntl::S_IWGRP) ||   # Is group writable?</td></tr>
<tr><td class="h">700</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($info[2] &amp; &amp;Fcntl::S_IWOTH) ) {  # Is world writable?</td></tr>
<tr><td class="h">701</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Must be a directory</td></tr>
<tr><td class="h">702</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L702">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (-d $path) {</td></tr>
<tr><td class="h">703</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L703">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;Path ($path) is not a directory&quot;</td></tr>
<tr><td class="h">704</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ref($err_ref);</td></tr>
<tr><td class="h">705</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">706</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">707</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Must have sticky bit set</td></tr>
<tr><td class="h">708</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L708">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (-k $path) {</td></tr>
<tr><td class="h">709</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L709">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$err_ref = &quot;Sticky bit not set on $path when dir is group|world writable&quot;</td></tr>
<tr><td class="h">710</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ref($err_ref);</td></tr>
<tr><td class="h">711</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">712</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">713</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">714</td><td colspan="6"></td></tr><tr><td class="h">715</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">716</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">717</td><td colspan="6"></td></tr><tr><td class="h">718</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Internal routine to check whether a directory is safe</td></tr>
<tr><td class="h">719</td><td></td><td></td><td></td><td></td><td></td><td class="s"># for temp files. Safer than _is_safe since it checks for</td></tr>
<tr><td class="h">720</td><td></td><td></td><td></td><td></td><td></td><td class="s"># the possibility of chown giveaway and if that is a possibility</td></tr>
<tr><td class="h">721</td><td></td><td></td><td></td><td></td><td></td><td class="s"># checks each directory in the path to see if it is safe (with _is_safe)</td></tr>
<tr><td class="h">722</td><td colspan="6"></td></tr><tr><td class="h">723</td><td></td><td></td><td></td><td></td><td></td><td class="s"># If _PC_CHOWN_RESTRICTED is not set, does the full test of each</td></tr>
<tr><td class="h">724</td><td></td><td></td><td></td><td></td><td></td><td class="s"># directory anyway.</td></tr>
<tr><td class="h">725</td><td colspan="6"></td></tr><tr><td class="h">726</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Takes optional second arg as scalar ref to error reason</td></tr>
<tr><td class="h">727</td><td colspan="6"></td></tr><tr><td class="h">728</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _is_verysafe {</td></tr>
<tr><td class="h">729</td><td colspan="6"></td></tr><tr><td class="h">730</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Need POSIX - but only want to bother if really necessary due to overhead</td></tr>
<tr><td class="h">731</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L731">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;require POSIX;</td></tr>
<tr><td class="h">732</td><td colspan="6"></td></tr><tr><td class="h">733</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $path = shift;</td></tr>
<tr><td class="h">734</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L734">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;print &quot;_is_verysafe testing $path\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">735</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L735">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1 if $^O eq &#39;VMS&#39;;  # owner delete control at file level</td></tr>
<tr><td class="h">736</td><td colspan="6"></td></tr><tr><td class="h">737</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $err_ref = shift;</td></tr>
<tr><td class="h">738</td><td colspan="6"></td></tr><tr><td class="h">739</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Should Get the value of _PC_CHOWN_RESTRICTED if it is defined</td></tr>
<tr><td class="h">740</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and If it is not there do the extensive test</td></tr>
<tr><td class="h">741</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $chown_restricted;</td></tr>
<tr><td class="h">742</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$chown_restricted = &amp;POSIX::_PC_CHOWN_RESTRICTED()</td></tr>
<tr><td class="h">743</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L743">0</a></div></td><td></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if eval { &amp;POSIX::_PC_CHOWN_RESTRICTED(); 1};</td></tr>
<tr><td class="h">744</td><td colspan="6"></td></tr><tr><td class="h">745</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If chown_resticted is set to some value we should test it</td></tr>
<tr><td class="h">746</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L746">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if (defined $chown_restricted) {</td></tr>
<tr><td class="h">747</td><td colspan="6"></td></tr><tr><td class="h">748</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Return if the current directory is safe</td></tr>
<tr><td class="h">749</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L749">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _is_safe($path,$err_ref) if POSIX::sysconf( $chown_restricted );</td></tr>
<tr><td class="h">750</td><td colspan="6"></td></tr><tr><td class="h">751</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">752</td><td colspan="6"></td></tr><tr><td class="h">753</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# To reach this point either, the _PC_CHOWN_RESTRICTED symbol</td></tr>
<tr><td class="h">754</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# was not avialable or the symbol was there but chown giveaway</td></tr>
<tr><td class="h">755</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# is allowed. Either way, we now have to test the entire tree for</td></tr>
<tr><td class="h">756</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# safety.</td></tr>
<tr><td class="h">757</td><td colspan="6"></td></tr><tr><td class="h">758</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Convert path to an absolute directory if required</td></tr>
<tr><td class="h">759</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L759">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;unless (File::Spec-&gt;file_name_is_absolute($path)) {</td></tr>
<tr><td class="h">760</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$path = File::Spec-&gt;rel2abs($path);</td></tr>
<tr><td class="h">761</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">762</td><td colspan="6"></td></tr><tr><td class="h">763</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Split directory into components - assume no file</td></tr>
<tr><td class="h">764</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my ($volume, $directories, undef) = File::Spec-&gt;splitpath( $path, 1);</td></tr>
<tr><td class="h">765</td><td colspan="6"></td></tr><tr><td class="h">766</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Slightly less efficient than having a function in File::Spec</td></tr>
<tr><td class="h">767</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# to chop off the end of a directory or even a function that</td></tr>
<tr><td class="h">768</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# can handle ../ in a directory tree</td></tr>
<tr><td class="h">769</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Sometimes splitdir() returns a blank at the end</td></tr>
<tr><td class="h">770</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# so we will probably check the bottom directory twice in some cases</td></tr>
<tr><td class="h">771</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my @dirs = File::Spec-&gt;splitdir($directories);</td></tr>
<tr><td class="h">772</td><td colspan="6"></td></tr><tr><td class="h">773</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Concatenate one less directory each time around</td></tr>
<tr><td class="h">774</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;foreach my $pos (0.. $#dirs) {</td></tr>
<tr><td class="h">775</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get a directory name</td></tr>
<tr><td class="h">776</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dir = File::Spec-&gt;catpath($volume,</td></tr>
<tr><td class="h">777</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File::Spec-&gt;catdir(@dirs[0.. $#dirs - $pos]),</td></tr>
<tr><td class="h">778</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&#39;</td></tr>
<tr><td class="h">779</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">780</td><td colspan="6"></td></tr><tr><td class="h">781</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L781">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;TESTING DIR $dir\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">782</td><td colspan="6"></td></tr><tr><td class="h">783</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check the directory</td></tr>
<tr><td class="h">784</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L784">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless _is_safe($dir,$err_ref);</td></tr>
<tr><td class="h">785</td><td colspan="6"></td></tr><tr><td class="h">786</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">787</td><td colspan="6"></td></tr><tr><td class="h">788</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">789</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">790</td><td colspan="6"></td></tr><tr><td class="h">791</td><td colspan="6"></td></tr><tr><td class="h">792</td><td colspan="6"></td></tr><tr><td class="h">793</td><td></td><td></td><td></td><td></td><td></td><td class="s"># internal routine to determine whether unlink works on this</td></tr>
<tr><td class="h">794</td><td></td><td></td><td></td><td></td><td></td><td class="s"># platform for files that are currently open.</td></tr>
<tr><td class="h">795</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns true if we can, false otherwise.</td></tr>
<tr><td class="h">796</td><td colspan="6"></td></tr><tr><td class="h">797</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Currently WinNT, OS/2 and VMS can not unlink an opened file</td></tr>
<tr><td class="h">798</td><td></td><td></td><td></td><td></td><td></td><td class="s"># On VMS this is because the O_EXCL flag is used to open the</td></tr>
<tr><td class="h">799</td><td></td><td></td><td></td><td></td><td></td><td class="s"># temporary file. Currently I do not know enough about the issues</td></tr>
<tr><td class="h">800</td><td></td><td></td><td></td><td></td><td></td><td class="s"># on VMS to decide whether O_EXCL is a requirement.</td></tr>
<tr><td class="h">801</td><td colspan="6"></td></tr><tr><td class="h">802</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _can_unlink_opened_file {</td></tr>
<tr><td class="h">803</td><td colspan="6"></td></tr><tr><td class="h">804</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L804">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L804">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L804">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;MSWin32&#39; || $^O eq &#39;os2&#39; || $^O eq &#39;VMS&#39; || $^O eq &#39;dos&#39; || $^O eq &#39;MacOS&#39;) {</td></tr>
<tr><td class="h">805</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">806</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">807</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">808</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">809</td><td colspan="6"></td></tr><tr><td class="h">810</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">811</td><td colspan="6"></td></tr><tr><td class="h">812</td><td></td><td></td><td></td><td></td><td></td><td class="s"># internal routine to decide which security levels are allowed</td></tr>
<tr><td class="h">813</td><td></td><td></td><td></td><td></td><td></td><td class="s"># see safe_level() for more information on this</td></tr>
<tr><td class="h">814</td><td colspan="6"></td></tr><tr><td class="h">815</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Controls whether the supplied security level is allowed</td></tr>
<tr><td class="h">816</td><td colspan="6"></td></tr><tr><td class="h">817</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   $cando = _can_do_level( $level )</td></tr>
<tr><td class="h">818</td><td colspan="6"></td></tr><tr><td class="h">819</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _can_do_level {</td></tr>
<tr><td class="h">820</td><td colspan="6"></td></tr><tr><td class="h">821</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Get security level</td></tr>
<tr><td class="h">822</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L822">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;my $level = shift;</td></tr>
<tr><td class="h">823</td><td colspan="6"></td></tr><tr><td class="h">824</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Always have to be able to do STANDARD</td></tr>
<tr><td class="h">825</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L825">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;return 1 if $level == STANDARD;</td></tr>
<tr><td class="h">826</td><td colspan="6"></td></tr><tr><td class="h">827</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Currently, the systems that can do HIGH or MEDIUM are identical</td></tr>
<tr><td class="h">828</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L828">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L828">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;if ( $^O eq &#39;MSWin32&#39; || $^O eq &#39;os2&#39; || $^O eq &#39;cygwin&#39; || $^O eq &#39;dos&#39; || $^O eq &#39;MacOS&#39; || $^O eq &#39;mpeix&#39;) {</td></tr>
<tr><td class="h">829</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">830</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">831</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">832</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">833</td><td colspan="6"></td></tr><tr><td class="h">834</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">835</td><td colspan="6"></td></tr><tr><td class="h">836</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine sets up a deferred unlinking of a specified</td></tr>
<tr><td class="h">837</td><td></td><td></td><td></td><td></td><td></td><td class="s"># filename and filehandle. It is used in the following cases:</td></tr>
<tr><td class="h">838</td><td></td><td></td><td></td><td></td><td></td><td class="s">#  - Called by unlink0 if an opened file can not be unlinked</td></tr>
<tr><td class="h">839</td><td></td><td></td><td></td><td></td><td></td><td class="s">#  - Called by tempfile() if files are to be removed on shutdown</td></tr>
<tr><td class="h">840</td><td></td><td></td><td></td><td></td><td></td><td class="s">#  - Called by tempdir() if directories are to be removed on shutdown</td></tr>
<tr><td class="h">841</td><td colspan="6"></td></tr><tr><td class="h">842</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Arguments:</td></tr>
<tr><td class="h">843</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   _deferred_unlink( $fh, $fname, $isdir );</td></tr>
<tr><td class="h">844</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">845</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   - filehandle (so that it can be expclicitly closed if open</td></tr>
<tr><td class="h">846</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   - filename   (the thing we want to remove)</td></tr>
<tr><td class="h">847</td><td></td><td></td><td></td><td></td><td></td><td class="s">#   - isdir      (flag to indicate that we are being given a directory)</td></tr>
<tr><td class="h">848</td><td></td><td></td><td></td><td></td><td></td><td class="s">#                 [and hence no filehandle]</td></tr>
<tr><td class="h">849</td><td colspan="6"></td></tr><tr><td class="h">850</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Status is not referred to since all the magic is done with an END block</td></tr>
<tr><td class="h">851</td><td colspan="6"></td></tr><tr><td class="h">852</td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">853</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Will set up two lexical variables to contain all the files to be</td></tr>
<tr><td class="h">854</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# removed. One array for files, another for directories They will</td></tr>
<tr><td class="h">855</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# only exist in this block.</td></tr>
<tr><td class="h">856</td><td colspan="6"></td></tr><tr><td class="h">857</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;#  This means we only have to set up a single END block to remove</td></tr>
<tr><td class="h">858</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;#  all files. </td></tr>
<tr><td class="h">859</td><td colspan="6"></td></tr><tr><td class="h">860</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# in order to prevent child processes inadvertently deleting the parent</td></tr>
<tr><td class="h">861</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# temp files we use a hash to store the temp files and directories</td></tr>
<tr><td class="h">862</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# created by a particular process id.</td></tr>
<tr><td class="h">863</td><td colspan="6"></td></tr><tr><td class="h">864</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# %files_to_unlink contains values that are references to an array of</td></tr>
<tr><td class="h">865</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# array references containing the filehandle and filename associated with</td></tr>
<tr><td class="h">866</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# the temp file.</td></tr>
<tr><td class="h">867</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my (%files_to_unlink, %dirs_to_unlink);</td></tr>
<tr><td class="h">868</td><td colspan="6"></td></tr><tr><td class="h">869</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Set up an end block to use these arrays</td></tr>
<tr><td class="h">870</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;END {</td></tr>
<tr><td class="h">871</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;cleanup();</td></tr>
<tr><td class="h">872</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">873</td><td colspan="6"></td></tr><tr><td class="h">874</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Cleanup function. Always triggered on END but can be invoked</td></tr>
<tr><td class="h">875</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# manually.</td></tr>
<tr><td class="h">876</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub cleanup {</td></tr>
<tr><td class="h">877</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L877">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L877">1</a></div></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!$KEEP_ALL) {</td></tr>
<tr><td class="h">878</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Files</td></tr>
<tr><td class="h">879</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @files = (exists $files_to_unlink{$$} ?</td></tr>
<tr><td class="h">880</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L880">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $files_to_unlink{$$} } : () );</td></tr>
<tr><td class="h">881</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $file (@files) {</td></tr>
<tr><td class="h">882</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# close the filehandle without checking its state</td></tr>
<tr><td class="h">883</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in order to make real sure that this is closed</td></tr>
<tr><td class="h">884</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if its already closed then I dont care about the answer</td></tr>
<tr><td class="h">885</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# probably a better way to do this</td></tr>
<tr><td class="h">886</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close($file-&gt;[0]);  # file handle is [0]</td></tr>
<tr><td class="h">887</td><td colspan="6"></td></tr><tr><td class="h">888</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L888">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f $file-&gt;[1]) {  # file name is [1]</td></tr>
<tr><td class="h">889</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_force_writable( $file-&gt;[1] ); # for windows</td></tr>
<tr><td class="h">890</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L890">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $file-&gt;[1] or warn &quot;Error removing &quot;.$file-&gt;[1];</td></tr>
<tr><td class="h">891</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">892</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">893</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Dirs</td></tr>
<tr><td class="h">894</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @dirs = (exists $dirs_to_unlink{$$} ?</td></tr>
<tr><td class="h">895</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L895">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $dirs_to_unlink{$$} } : () );</td></tr>
<tr><td class="h">896</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $dir (@dirs) {</td></tr>
<tr><td class="h">897</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L897">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d $dir) {</td></tr>
<tr><td class="h">898</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rmtree($dir, $DEBUG, 0);</td></tr>
<tr><td class="h">899</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">900</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">901</td><td colspan="6"></td></tr><tr><td class="h">902</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# clear the arrays</td></tr>
<tr><td class="h">903</td><td><div class="c3">1</div><div class="c0">0</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L903">50</a></div></td><td></td><td></td><td><div>6</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $files_to_unlink{$$} } = ()</td></tr>
<tr><td class="h">904</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists $files_to_unlink{$$};</td></tr>
<tr><td class="h">905</td><td><div class="c3">1</div><div class="c0">0</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L905">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{ $dirs_to_unlink{$$} } = ()</td></tr>
<tr><td class="h">906</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists $dirs_to_unlink{$$};</td></tr>
<tr><td class="h">907</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">908</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">909</td><td colspan="6"></td></tr><tr><td class="h">910</td><td colspan="6"></td></tr><tr><td class="h">911</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# This is the sub called to register a file for deferred unlinking</td></tr>
<tr><td class="h">912</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# This could simply store the input parameters and defer everything</td></tr>
<tr><td class="h">913</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# until the END block. For now we do a bit of checking at this</td></tr>
<tr><td class="h">914</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# point in order to make sure that (1) we have a file/dir to delete</td></tr>
<tr><td class="h">915</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# and (2) we have been called with the correct arguments.</td></tr>
<tr><td class="h">916</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub _deferred_unlink {</td></tr>
<tr><td class="h">917</td><td colspan="6"></td></tr><tr><td class="h">918</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L918">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L918">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &#39;Usage:  _deferred_unlink($fh, $fname, $isdir)&#39;</td></tr>
<tr><td class="h">919</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 3;</td></tr>
<tr><td class="h">920</td><td colspan="6"></td></tr><tr><td class="h">921</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($fh, $fname, $isdir) = @_;</td></tr>
<tr><td class="h">922</td><td colspan="6"></td></tr><tr><td class="h">923</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L923">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;Setting up deferred removal of $fname\n&quot;</td></tr>
<tr><td class="h">924</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $DEBUG;</td></tr>
<tr><td class="h">925</td><td colspan="6"></td></tr><tr><td class="h">926</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If we have a directory, check that it is a directory</td></tr>
<tr><td class="h">927</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L927">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($isdir) {</td></tr>
<tr><td class="h">928</td><td colspan="6"></td></tr><tr><td class="h">929</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L929">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-d $fname) {</td></tr>
<tr><td class="h">930</td><td colspan="6"></td></tr><tr><td class="h">931</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Directory exists so store it</td></tr>
<tr><td class="h">932</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# first on VMS turn []foo into [.foo] for rmtree</td></tr>
<tr><td class="h">933</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L933">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fname = VMS::Filespec::vmspath($fname) if $^O eq &#39;VMS&#39;;</td></tr>
<tr><td class="h">934</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L934">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dirs_to_unlink{$$} = [] </td></tr>
<tr><td class="h">935</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless exists $dirs_to_unlink{$$};</td></tr>
<tr><td class="h">936</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@{ $dirs_to_unlink{$$} }, $fname);</td></tr>
<tr><td class="h">937</td><td colspan="6"></td></tr><tr><td class="h">938</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">939</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L939">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;Request to remove directory $fname could not be completed since it does not exist!\n&quot; if $^W;</td></tr>
<tr><td class="h">940</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">941</td><td colspan="6"></td></tr><tr><td class="h">942</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">943</td><td colspan="6"></td></tr><tr><td class="h">944</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L944">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (-f $fname) {</td></tr>
<tr><td class="h">945</td><td colspan="6"></td></tr><tr><td class="h">946</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# file exists so store handle and name for later removal</td></tr>
<tr><td class="h">947</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L947">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$files_to_unlink{$$} = []</td></tr>
<tr><td class="h">948</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless exists $files_to_unlink{$$};</td></tr>
<tr><td class="h">949</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@{ $files_to_unlink{$$} }, [$fh, $fname]);</td></tr>
<tr><td class="h">950</td><td colspan="6"></td></tr><tr><td class="h">951</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">952</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L952">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;Request to remove file $fname could not be completed since it is not there!\n&quot; if $^W;</td></tr>
<tr><td class="h">953</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">954</td><td colspan="6"></td></tr><tr><td class="h">955</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">956</td><td colspan="6"></td></tr><tr><td class="h">957</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">958</td><td colspan="6"></td></tr><tr><td class="h">959</td><td colspan="6"></td></tr><tr><td class="h">960</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">961</td><td colspan="6"></td></tr><tr><td class="h">962 - 998</td><td colspan="5"></td><td class="s"><pre>=head1 OBJECT-ORIENTED INTERFACE

This is the primary interface for interacting with
C&lt;File::Temp&gt;. Using the OO interface a temporary file can be created
when the object is constructed and the file can be removed when the
object is no longer required.

Note that there is no method to obtain the filehandle from the
C&lt;File::Temp&gt; object. The object itself acts as a filehandle. Also,
the object is configured such that it stringifies to the name of the
temporary file.

=over 4

=item B&lt;new&gt;

Create a temporary file object.

  my $tmp = new File::Temp();

by default the object is constructed as if C&lt;tempfile&gt;
was called without options, but with the additional behaviour
that the temporary file is removed by the object destructor
if UNLINK is set to true (the default).

Supported arguments are the same as for C&lt;tempfile&gt;: UNLINK
(defaulting to true), DIR and SUFFIX. Additionally, the filename
template is specified using the TEMPLATE option. The OPEN option
is not supported (the file is always opened).

 $tmp = new File::Temp( TEMPLATE =&gt; &#39;tempXXXXX&#39;,
                        DIR =&gt; &#39;mydir&#39;,
                        SUFFIX =&gt; &#39;.dat&#39;);

Arguments are case insensitive.

=cut</pre></td></tr>
<tr><td class="h">999</td><td colspan="6"></td></tr><tr><td class="h">1000</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">1001</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1001">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my $proto = shift;</td></tr>
<tr><td class="h">1002</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1002">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $class = ref($proto) || $proto;</td></tr>
<tr><td class="h">1003</td><td colspan="6"></td></tr><tr><td class="h">1004</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# read arguments and convert keys to upper case</td></tr>
<tr><td class="h">1005</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my %args = @_;</td></tr>
<tr><td class="h">1006</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;%args = map { uc($_), $args{$_} } keys %args;</td></tr>
<tr><td class="h">1007</td><td colspan="6"></td></tr><tr><td class="h">1008</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# see if they are unlinking (defaulting to yes)</td></tr>
<tr><td class="h">1009</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1009">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $unlink = (exists $args{UNLINK} ? $args{UNLINK} : 1 );</td></tr>
<tr><td class="h">1010</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;delete $args{UNLINK};</td></tr>
<tr><td class="h">1011</td><td colspan="6"></td></tr><tr><td class="h">1012</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# template (store it in an error so that it will</td></tr>
<tr><td class="h">1013</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# disappear from the arg list of tempfile</td></tr>
<tr><td class="h">1014</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1014">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my @template = ( exists $args{TEMPLATE} ? $args{TEMPLATE} : () );</td></tr>
<tr><td class="h">1015</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;delete $args{TEMPLATE};</td></tr>
<tr><td class="h">1016</td><td colspan="6"></td></tr><tr><td class="h">1017</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Protect OPEN</td></tr>
<tr><td class="h">1018</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;delete $args{OPEN};</td></tr>
<tr><td class="h">1019</td><td colspan="6"></td></tr><tr><td class="h">1020</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Open the file and retain file handle and file name</td></tr>
<tr><td class="h">1021</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = tempfile( @template, %args );</td></tr>
<tr><td class="h">1022</td><td colspan="6"></td></tr><tr><td class="h">1023</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1023">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;print &quot;Tmp: $fh - $path\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1024</td><td colspan="6"></td></tr><tr><td class="h">1025</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Store the filename in the scalar slot</td></tr>
<tr><td class="h">1026</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;${*$fh} = $path;</td></tr>
<tr><td class="h">1027</td><td colspan="6"></td></tr><tr><td class="h">1028</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Store unlink information in hash slot (plus other constructor info)</td></tr>
<tr><td class="h">1029</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;%{*$fh} = %args;</td></tr>
<tr><td class="h">1030</td><td colspan="6"></td></tr><tr><td class="h">1031</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# create the object</td></tr>
<tr><td class="h">1032</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;bless $fh, $class;</td></tr>
<tr><td class="h">1033</td><td colspan="6"></td></tr><tr><td class="h">1034</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# final method-based configuration</td></tr>
<tr><td class="h">1035</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$fh-&gt;unlink_on_destroy( $unlink );</td></tr>
<tr><td class="h">1036</td><td colspan="6"></td></tr><tr><td class="h">1037</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1038</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1039</td><td colspan="6"></td></tr><tr><td class="h">1040 - 1049</td><td colspan="5"></td><td class="s"><pre>=item B&lt;filename&gt;

Return the name of the temporary file associated with this object.

  $filename = $tmp-&gt;filename;

This method is called automatically when the object is used as
a string.

=cut</pre></td></tr>
<tr><td class="h">1050</td><td colspan="6"></td></tr><tr><td class="h">1051</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub filename {</td></tr>
<tr><td class="h">1052</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1052">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1053</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return ${*$self};</td></tr>
<tr><td class="h">1054</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1055</td><td colspan="6"></td></tr><tr><td class="h">1056</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub STRINGIFY {</td></tr>
<tr><td class="h">1057</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1057">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1058</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $self-&gt;filename;</td></tr>
<tr><td class="h">1059</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1060</td><td colspan="6"></td></tr><tr><td class="h">1061 - 1070</td><td colspan="5"></td><td class="s"><pre>=item B&lt;unlink_on_destroy&gt;

Control whether the file is unlinked when the object goes out of scope.
The file is removed if this value is true and $KEEP_ALL is not.

 $fh-&gt;unlink_on_destroy( 1 );

Default is for the file to be removed.

=cut</pre></td></tr>
<tr><td class="h">1071</td><td colspan="6"></td></tr><tr><td class="h">1072</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink_on_destroy {</td></tr>
<tr><td class="h">1073</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1073">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1074</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1074">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">1075</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;${*$self}{UNLINK} = shift;</td></tr>
<tr><td class="h">1076</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1077</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return ${*$self}{UNLINK};</td></tr>
<tr><td class="h">1078</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1079</td><td colspan="6"></td></tr><tr><td class="h">1080 - 1091</td><td colspan="5"></td><td class="s"><pre>=item B&lt;DESTROY&gt;

When the object goes out of scope, the destructor is called. This
destructor will attempt to unlink the file (using C&lt;unlink1&gt;)
if the constructor was called with UNLINK set to 1 (the default state
if UNLINK is not specified).

No error is given if the unlink fails.

If the global variable $KEEP_ALL is true, the file will not be removed.

=cut</pre></td></tr>
<tr><td class="h">1092</td><td colspan="6"></td></tr><tr><td class="h">1093</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub DESTROY {</td></tr>
<tr><td class="h">1094</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1094">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">1095</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1095">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1095">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (${*$self}{UNLINK} &amp;&amp; !$KEEP_ALL) {</td></tr>
<tr><td class="h">1096</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1096">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;# ---------&gt;   Unlinking $self\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1097</td><td colspan="6"></td></tr><tr><td class="h">1098</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The unlink1 may fail if the file has been closed</td></tr>
<tr><td class="h">1099</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# by the caller. This leaves us with the decision</td></tr>
<tr><td class="h">1100</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# of whether to refuse to remove the file or simply</td></tr>
<tr><td class="h">1101</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do an unlink without test. Seems to be silly</td></tr>
<tr><td class="h">1102</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# to do this when we are trying to be careful</td></tr>
<tr><td class="h">1103</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# about security</td></tr>
<tr><td class="h">1104</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_force_writable( $self-&gt;filename ); # for windows</td></tr>
<tr><td class="h">1105</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1105">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unlink1( $self, $self-&gt;filename )</td></tr>
<tr><td class="h">1106</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or unlink($self-&gt;filename);</td></tr>
<tr><td class="h">1107</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1108</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1109</td><td colspan="6"></td></tr><tr><td class="h">1110</td><td></td><td></td><td></td><td></td><td></td><td class="s">=back</td></tr>
<tr><td class="h">1111</td><td colspan="6"></td></tr><tr><td class="h">1112 - 1192</td><td colspan="5"></td><td class="s"><pre>=head1 FUNCTIONS

This section describes the recommended interface for generating
temporary files and directories.

=over 4

=item B&lt;tempfile&gt;

This is the basic function to generate temporary files.
The behaviour of the file can be changed using various options:

  $fh = tempfile();
  ($fh, $filename) = tempfile();

Create a temporary file in  the directory specified for temporary
files, as specified by the tmpdir() function in L&lt;File::Spec&gt;.

  ($fh, $filename) = tempfile($template);

Create a temporary file in the current directory using the supplied
template.  Trailing `X&#39; characters are replaced with random letters to
generate the filename.  At least four `X&#39; characters must be present
at the end of the template.

  ($fh, $filename) = tempfile($template, SUFFIX =&gt; $suffix)

Same as previously, except that a suffix is added to the template
after the `X&#39; translation.  Useful for ensuring that a temporary
filename has a particular extension when needed by other applications.
But see the WARNING at the end.

  ($fh, $filename) = tempfile($template, DIR =&gt; $dir);

Translates the template as before except that a directory name
is specified.

  ($fh, $filename) = tempfile($template, UNLINK =&gt; 1);

Return the filename and filehandle as before except that the file is
automatically removed when the program exits (dependent on
$KEEP_ALL). Default is for the file to be removed if a file handle is
requested and to be kept if the filename is requested. In a scalar
context (where no filename is returned) the file is always deleted
either (depending on the operating system) on exit or when it is
closed (unless $KEEP_ALL is true when the temp file is created).

Use the object-oriented interface if fine-grained control of when
a file is removed is required.

If the template is not specified, a template is always
automatically generated. This temporary file is placed in tmpdir()
(L&lt;File::Spec&gt;) unless a directory is specified explicitly with the
DIR option.

  $fh = tempfile( $template, DIR =&gt; $dir );

If called in scalar context, only the filehandle is returned and the
file will automatically be deleted when closed on operating systems
that support this (see the description of tmpfile() elsewhere in this
document).  This is the preferred mode of operation, as if you only
have a filehandle, you can never create a race condition by fumbling
with the filename. On systems that can not unlink an open file or can
not mark a file as temporary when it is opened (for example, Windows
NT uses the C&lt;O_TEMPORARY&gt; flag) the file is marked for deletion when
the program ends (equivalent to setting UNLINK to 1). The C&lt;UNLINK&gt;
flag is ignored if present.

  (undef, $filename) = tempfile($template, OPEN =&gt; 0);

This will return the filename based on the template but
will not open this file.  Cannot be used in conjunction with
UNLINK set to true. Default is to always open the file
to protect from possible race conditions. A warning is issued
if warnings are turned on. Consider using the tmpnam()
and mktemp() functions described elsewhere in this document
if opening the file is not required.

Options can be combined as required.

=cut</pre></td></tr>
<tr><td class="h">1193</td><td colspan="6"></td></tr><tr><td class="h">1194</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tempfile {</td></tr>
<tr><td class="h">1195</td><td colspan="6"></td></tr><tr><td class="h">1196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Can not check for argument count since we can have any</td></tr>
<tr><td class="h">1197</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# number of args</td></tr>
<tr><td class="h">1198</td><td colspan="6"></td></tr><tr><td class="h">1199</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Default options</td></tr>
<tr><td class="h">1200</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1200">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my %options = (</td></tr>
<tr><td class="h">1201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;DIR&quot;    =&gt; undef,  # Directory prefix</td></tr>
<tr><td class="h">1202</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;SUFFIX&quot; =&gt; &#39;&#39;,     # Template suffix</td></tr>
<tr><td class="h">1203</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;UNLINK&quot; =&gt; 0,      # Do not unlink file on exit</td></tr>
<tr><td class="h">1204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;OPEN&quot;   =&gt; 1,      # Open file</td></tr>
<tr><td class="h">1205</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1206</td><td colspan="6"></td></tr><tr><td class="h">1207</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check to see whether we have an odd or even number of arguments</td></tr>
<tr><td class="h">1208</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1208">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = (scalar(@_) % 2 == 1 ? shift(@_) : undef);</td></tr>
<tr><td class="h">1209</td><td colspan="6"></td></tr><tr><td class="h">1210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the options and merge with defaults</td></tr>
<tr><td class="h">1211</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1211">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;%options = (%options, @_)  if @_;</td></tr>
<tr><td class="h">1212</td><td colspan="6"></td></tr><tr><td class="h">1213</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# First decision is whether or not to open the file</td></tr>
<tr><td class="h">1214</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1214">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (! $options{&quot;OPEN&quot;}) {</td></tr>
<tr><td class="h">1215</td><td colspan="6"></td></tr><tr><td class="h">1216</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1216">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;tempfile(): temporary filename requested but not opened.\nPossibly unsafe, consider using tempfile() with OPEN set to true\n&quot;</td></tr>
<tr><td class="h">1217</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $^W;</td></tr>
<tr><td class="h">1218</td><td colspan="6"></td></tr><tr><td class="h">1219</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1220</td><td colspan="6"></td></tr><tr><td class="h">1221</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1221">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1221">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($options{&quot;DIR&quot;} and $^O eq &#39;VMS&#39;) {</td></tr>
<tr><td class="h">1222</td><td colspan="6"></td></tr><tr><td class="h">1223</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# on VMS turn []foo into [.foo] for concatenation</td></tr>
<tr><td class="h">1224</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options{&quot;DIR&quot;} = VMS::Filespec::vmspath($options{&quot;DIR&quot;});</td></tr>
<tr><td class="h">1225</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1226</td><td colspan="6"></td></tr><tr><td class="h">1227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Construct the template</td></tr>
<tr><td class="h">1228</td><td colspan="6"></td></tr><tr><td class="h">1229</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Have a choice of trying to work around the mkstemp/mktemp/tmpnam etc</td></tr>
<tr><td class="h">1230</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# functions or simply constructing a template and using _gettemp()</td></tr>
<tr><td class="h">1231</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# explicitly. Go for the latter</td></tr>
<tr><td class="h">1232</td><td colspan="6"></td></tr><tr><td class="h">1233</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# First generate a template if not defined and prefix the directory</td></tr>
<tr><td class="h">1234</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# If no template must prefix the temp directory</td></tr>
<tr><td class="h">1235</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1235">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (defined $template) {</td></tr>
<tr><td class="h">1236</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1236">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1237</td><td colspan="6"></td></tr><tr><td class="h">1238</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile($options{&quot;DIR&quot;}, $template);</td></tr>
<tr><td class="h">1239</td><td colspan="6"></td></tr><tr><td class="h">1240</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1241</td><td colspan="6"></td></tr><tr><td class="h">1242</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1243</td><td colspan="6"></td></tr><tr><td class="h">1244</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1244">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1245</td><td colspan="6"></td></tr><tr><td class="h">1246</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile($options{&quot;DIR&quot;}, TEMPXXX);</td></tr>
<tr><td class="h">1247</td><td colspan="6"></td></tr><tr><td class="h">1248</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1249</td><td colspan="6"></td></tr><tr><td class="h">1250</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catfile(File::Spec-&gt;tmpdir, TEMPXXX);</td></tr>
<tr><td class="h">1251</td><td colspan="6"></td></tr><tr><td class="h">1252</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1253</td><td colspan="6"></td></tr><tr><td class="h">1254</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1255</td><td colspan="6"></td></tr><tr><td class="h">1256</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Now add a suffix</td></tr>
<tr><td class="h">1257</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$template .= $options{&quot;SUFFIX&quot;};</td></tr>
<tr><td class="h">1258</td><td colspan="6"></td></tr><tr><td class="h">1259</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Determine whether we should tell _gettemp to unlink the file</td></tr>
<tr><td class="h">1260</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# On unix this is irrelevant and can be worked out after the file is</td></tr>
<tr><td class="h">1261</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# opened (simply by unlinking the open filehandle). On Windows or VMS</td></tr>
<tr><td class="h">1262</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we have to indicate temporary-ness when we open the file. In general</td></tr>
<tr><td class="h">1263</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# we only want a true temporary file if we are returning just the</td></tr>
<tr><td class="h">1264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# filehandle - if the user wants the filename they probably do not</td></tr>
<tr><td class="h">1265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# want the file to disappear as soon as they close it (which may be</td></tr>
<tr><td class="h">1266</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# important if they want a child process to use the file)</td></tr>
<tr><td class="h">1267</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# For this reason, tie unlink_on_close to the return context regardless</td></tr>
<tr><td class="h">1268</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# of OS.</td></tr>
<tr><td class="h">1269</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1269">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $unlink_on_close = ( wantarray ? 0 : 1);</td></tr>
<tr><td class="h">1270</td><td colspan="6"></td></tr><tr><td class="h">1271</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Create the file</td></tr>
<tr><td class="h">1272</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path, $errstr);</td></tr>
<tr><td class="h">1273</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1273">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Error in tempfile() using $template: $errstr&quot;</td></tr>
<tr><td class="h">1274</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($fh, $path) = _gettemp($template,</td></tr>
<tr><td class="h">1275</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; $options{&#39;OPEN&#39;},</td></tr>
<tr><td class="h">1276</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1277</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;unlink_on_close&quot; =&gt; $unlink_on_close,</td></tr>
<tr><td class="h">1278</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; length($options{&#39;SUFFIX&#39;}),</td></tr>
<tr><td class="h">1279</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1280</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1281</td><td colspan="6"></td></tr><tr><td class="h">1282</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Set up an exit handler that can do whatever is right for the</td></tr>
<tr><td class="h">1283</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# system. This removes files at exit when requested explicitly or when</td></tr>
<tr><td class="h">1284</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# system is asked to unlink_on_close but is unable to do so because</td></tr>
<tr><td class="h">1285</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# of OS limitations.</td></tr>
<tr><td class="h">1286</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# The latter should be achieved by using a tied filehandle.</td></tr>
<tr><td class="h">1287</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do not check return status since this is all done with END blocks.</td></tr>
<tr><td class="h">1288</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1288">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;_deferred_unlink($fh, $path, 0) if $options{&quot;UNLINK&quot;};</td></tr>
<tr><td class="h">1289</td><td colspan="6"></td></tr><tr><td class="h">1290</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Return</td></tr>
<tr><td class="h">1291</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1291">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (wantarray()) {</td></tr>
<tr><td class="h">1292</td><td colspan="6"></td></tr><tr><td class="h">1293</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1293">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&#39;OPEN&#39;}) {</td></tr>
<tr><td class="h">1294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">1295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1296</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (undef, $path);</td></tr>
<tr><td class="h">1297</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1298</td><td colspan="6"></td></tr><tr><td class="h">1299</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1300</td><td colspan="6"></td></tr><tr><td class="h">1301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Unlink the file. It is up to unlink0 to decide what to do with</td></tr>
<tr><td class="h">1302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# this (whether to unlink now or to defer until later)</td></tr>
<tr><td class="h">1303</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1303">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unlink0($fh, $path) or croak &quot;Error unlinking file $path using unlink0&quot;;</td></tr>
<tr><td class="h">1304</td><td colspan="6"></td></tr><tr><td class="h">1305</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Return just the filehandle.</td></tr>
<tr><td class="h">1306</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1307</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1308</td><td colspan="6"></td></tr><tr><td class="h">1309</td><td colspan="6"></td></tr><tr><td class="h">1310</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1311</td><td colspan="6"></td></tr><tr><td class="h">1312 - 1363</td><td colspan="5"></td><td class="s"><pre>=item B&lt;tempdir&gt;

This is the recommended interface for creation of temporary directories.
The behaviour of the function depends on the arguments:

  $tempdir = tempdir();

Create a directory in tmpdir() (see L&lt;File::Spec|File::Spec&gt;).

  $tempdir = tempdir( $template );

Create a directory from the supplied template. This template is
similar to that described for tempfile(). `X&#39; characters at the end
of the template are replaced with random letters to construct the
directory name. At least four `X&#39; characters must be in the template.

  $tempdir = tempdir ( DIR =&gt; $dir );

Specifies the directory to use for the temporary directory.
The temporary directory name is derived from an internal template.

  $tempdir = tempdir ( $template, DIR =&gt; $dir );

Prepend the supplied directory name to the template. The template
should not include parent directory specifications itself. Any parent
directory specifications are removed from the template before
prepending the supplied directory.

  $tempdir = tempdir ( $template, TMPDIR =&gt; 1 );

Using the supplied template, create the temporary directory in
a standard location for temporary files. Equivalent to doing

  $tempdir = tempdir ( $template, DIR =&gt; File::Spec-&gt;tmpdir);

but shorter. Parent directory specifications are stripped from the
template itself. The C&lt;TMPDIR&gt; option is ignored if C&lt;DIR&gt; is set
explicitly.  Additionally, C&lt;TMPDIR&gt; is implied if neither a template
nor a directory are supplied.

  $tempdir = tempdir( $template, CLEANUP =&gt; 1);

Create a temporary directory using the supplied template, but
attempt to remove it (and all files inside it) when the program
exits. Note that an attempt will be made to remove all files from
the directory even if they were not created by this module (otherwise
why ask to clean it up?). The directory removal is made with
the rmtree() function from the L&lt;File::Path|File::Path&gt; module.
Of course, if the template is not specified, the temporary directory
will be created in tmpdir() and will also be removed at program exit.

=cut</pre></td></tr>
<tr><td class="h">1364</td><td colspan="6"></td></tr><tr><td class="h">1365</td><td></td><td></td><td></td><td></td><td></td><td class="s"># &#39;</td></tr>
<tr><td class="h">1366</td><td colspan="6"></td></tr><tr><td class="h">1367</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tempdir  {</td></tr>
<tr><td class="h">1368</td><td colspan="6"></td></tr><tr><td class="h">1369</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Can not check for argument count since we can have any</td></tr>
<tr><td class="h">1370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# number of args</td></tr>
<tr><td class="h">1371</td><td colspan="6"></td></tr><tr><td class="h">1372</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Default options</td></tr>
<tr><td class="h">1373</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1373">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my %options = (</td></tr>
<tr><td class="h">1374</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;CLEANUP&quot;    =&gt; 0,  # Remove directory on exit</td></tr>
<tr><td class="h">1375</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;DIR&quot;        =&gt; &#39;&#39;, # Root directory</td></tr>
<tr><td class="h">1376</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;TMPDIR&quot;     =&gt; 0,  # Use tempdir with template</td></tr>
<tr><td class="h">1377</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1378</td><td colspan="6"></td></tr><tr><td class="h">1379</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Check to see whether we have an odd or even number of arguments</td></tr>
<tr><td class="h">1380</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1380">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = (scalar(@_) % 2 == 1 ? shift(@_) : undef );</td></tr>
<tr><td class="h">1381</td><td colspan="6"></td></tr><tr><td class="h">1382</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read the options and merge with defaults</td></tr>
<tr><td class="h">1383</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1383">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;%options = (%options, @_)  if @_;</td></tr>
<tr><td class="h">1384</td><td colspan="6"></td></tr><tr><td class="h">1385</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Modify or generate the template</td></tr>
<tr><td class="h">1386</td><td colspan="6"></td></tr><tr><td class="h">1387</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Deal with the DIR and TMPDIR options</td></tr>
<tr><td class="h">1388</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1388">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (defined $template) {</td></tr>
<tr><td class="h">1389</td><td colspan="6"></td></tr><tr><td class="h">1390</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Need to strip directory path if using DIR or TMPDIR</td></tr>
<tr><td class="h">1391</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1391">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1391">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&#39;TMPDIR&#39;} || $options{&#39;DIR&#39;}) {</td></tr>
<tr><td class="h">1392</td><td colspan="6"></td></tr><tr><td class="h">1393</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Strip parent directory from the filename</td></tr>
<tr><td class="h">1394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">1395</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# There is no filename at the end</td></tr>
<tr><td class="h">1396</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1396">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = VMS::Filespec::vmspath($template) if $^O eq &#39;VMS&#39;;</td></tr>
<tr><td class="h">1397</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($volume, $directories, undef) = File::Spec-&gt;splitpath( $template, 1);</td></tr>
<tr><td class="h">1398</td><td colspan="6"></td></tr><tr><td class="h">1399</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Last directory is then our template</td></tr>
<tr><td class="h">1400</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = (File::Spec-&gt;splitdir($directories))[-1];</td></tr>
<tr><td class="h">1401</td><td colspan="6"></td></tr><tr><td class="h">1402</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prepend the supplied directory or temp dir</td></tr>
<tr><td class="h">1403</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1403">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1403">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1404</td><td colspan="6"></td></tr><tr><td class="h">1405</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir($options{&quot;DIR&quot;}, $template);</td></tr>
<tr><td class="h">1406</td><td colspan="6"></td></tr><tr><td class="h">1407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($options{TMPDIR}) {</td></tr>
<tr><td class="h">1408</td><td colspan="6"></td></tr><tr><td class="h">1409</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prepend tmpdir</td></tr>
<tr><td class="h">1410</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir(File::Spec-&gt;tmpdir, $template);</td></tr>
<tr><td class="h">1411</td><td colspan="6"></td></tr><tr><td class="h">1412</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1413</td><td colspan="6"></td></tr><tr><td class="h">1414</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1415</td><td colspan="6"></td></tr><tr><td class="h">1416</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1417</td><td colspan="6"></td></tr><tr><td class="h">1418</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1418">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($options{&quot;DIR&quot;}) {</td></tr>
<tr><td class="h">1419</td><td colspan="6"></td></tr><tr><td class="h">1420</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir($options{&quot;DIR&quot;}, TEMPXXX);</td></tr>
<tr><td class="h">1421</td><td colspan="6"></td></tr><tr><td class="h">1422</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1423</td><td colspan="6"></td></tr><tr><td class="h">1424</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = File::Spec-&gt;catdir(File::Spec-&gt;tmpdir, TEMPXXX);</td></tr>
<tr><td class="h">1425</td><td colspan="6"></td></tr><tr><td class="h">1426</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1427</td><td colspan="6"></td></tr><tr><td class="h">1428</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1429</td><td colspan="6"></td></tr><tr><td class="h">1430</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Create the directory</td></tr>
<tr><td class="h">1431</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $tempdir;</td></tr>
<tr><td class="h">1432</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $suffixlen = 0;</td></tr>
<tr><td class="h">1433</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1433">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;VMS&#39;) {  # dir names can end in delimiters</td></tr>
<tr><td class="h">1434</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$template =~ m/([\.\]:&gt;]+)$/;</td></tr>
<tr><td class="h">1435</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$suffixlen = length($1);</td></tr>
<tr><td class="h">1436</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1437</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1437">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1437">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ( ($^O eq &#39;MacOS&#39;) &amp;&amp; (substr($template, -1) eq &#39;:&#39;) ) {</td></tr>
<tr><td class="h">1438</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# dir name has a trailing &#39;:&#39;</td></tr>
<tr><td class="h">1439</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;++$suffixlen;</td></tr>
<tr><td class="h">1440</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1441</td><td colspan="6"></td></tr><tr><td class="h">1442</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $errstr;</td></tr>
<tr><td class="h">1443</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1443">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Error in tempdir() using $template: $errstr&quot;</td></tr>
<tr><td class="h">1444</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ((undef, $tempdir) = _gettemp($template,</td></tr>
<tr><td class="h">1445</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">1446</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 1 ,</td></tr>
<tr><td class="h">1447</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; $suffixlen,</td></tr>
<tr><td class="h">1448</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1449</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1450</td><td colspan="6"></td></tr><tr><td class="h">1451</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Install exit handler; must be dynamic to get lexical</td></tr>
<tr><td class="h">1452</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1452">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1452">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ( $options{&#39;CLEANUP&#39;} &amp;&amp; -d $tempdir) {</td></tr>
<tr><td class="h">1453</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_deferred_unlink(undef, $tempdir, 1);</td></tr>
<tr><td class="h">1454</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1455</td><td colspan="6"></td></tr><tr><td class="h">1456</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Return the dir name</td></tr>
<tr><td class="h">1457</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $tempdir;</td></tr>
<tr><td class="h">1458</td><td colspan="6"></td></tr><tr><td class="h">1459</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1460</td><td colspan="6"></td></tr><tr><td class="h">1461</td><td></td><td></td><td></td><td></td><td></td><td class="s">=back</td></tr>
<tr><td class="h">1462</td><td colspan="6"></td></tr><tr><td class="h">1463 - 1483</td><td colspan="5"></td><td class="s"><pre>=head1 MKTEMP FUNCTIONS

The following functions are Perl implementations of the
mktemp() family of temp file generation system calls.

=over 4

=item B&lt;mkstemp&gt;

Given a template, returns a filehandle to the temporary file and the name
of the file.

  ($fh, $name) = mkstemp( $template );

In scalar context, just the filehandle is returned.

The template may be any filename with some number of X&#39;s appended
to it, for example F&lt;/tmp/temp.XXXX&gt;. The trailing X&#39;s are replaced
with unique alphanumeric combinations.

=cut</pre></td></tr>
<tr><td class="h">1484</td><td colspan="6"></td></tr><tr><td class="h">1485</td><td colspan="6"></td></tr><tr><td class="h">1486</td><td colspan="6"></td></tr><tr><td class="h">1487</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mkstemp {</td></tr>
<tr><td class="h">1488</td><td colspan="6"></td></tr><tr><td class="h">1489</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1489">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1489">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mkstemp(template)&quot;</td></tr>
<tr><td class="h">1490</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 1;</td></tr>
<tr><td class="h">1491</td><td colspan="6"></td></tr><tr><td class="h">1492</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1493</td><td colspan="6"></td></tr><tr><td class="h">1494</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path, $errstr);</td></tr>
<tr><td class="h">1495</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1495">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Error in mkstemp using $template: $errstr&quot;</td></tr>
<tr><td class="h">1496</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($fh, $path) = _gettemp($template,</td></tr>
<tr><td class="h">1497</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 1,</td></tr>
<tr><td class="h">1498</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1499</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; 0,</td></tr>
<tr><td class="h">1500</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1501</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1502</td><td colspan="6"></td></tr><tr><td class="h">1503</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1503">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (wantarray()) {</td></tr>
<tr><td class="h">1504</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">1505</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1506</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1507</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1508</td><td colspan="6"></td></tr><tr><td class="h">1509</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1510</td><td colspan="6"></td></tr><tr><td class="h">1511</td><td colspan="6"></td></tr><tr><td class="h">1512 - 1524</td><td colspan="5"></td><td class="s"><pre>=item B&lt;mkstemps&gt;

Similar to mkstemp(), except that an extra argument can be supplied
with a suffix to be appended to the template.

  ($fh, $name) = mkstemps( $template, $suffix );

For example a template of C&lt;testXXXXXX&gt; and suffix of C&lt;.dat&gt;
would generate a file similar to F&lt;testhGji_w.dat&gt;.

Returns just the filehandle alone when called in scalar context.

=cut</pre></td></tr>
<tr><td class="h">1525</td><td colspan="6"></td></tr><tr><td class="h">1526</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mkstemps {</td></tr>
<tr><td class="h">1527</td><td colspan="6"></td></tr><tr><td class="h">1528</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1528">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1528">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mkstemps(template, suffix)&quot;</td></tr>
<tr><td class="h">1529</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 2;</td></tr>
<tr><td class="h">1530</td><td colspan="6"></td></tr><tr><td class="h">1531</td><td colspan="6"></td></tr><tr><td class="h">1532</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1533</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $suffix   = shift;</td></tr>
<tr><td class="h">1534</td><td colspan="6"></td></tr><tr><td class="h">1535</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$template .= $suffix;</td></tr>
<tr><td class="h">1536</td><td colspan="6"></td></tr><tr><td class="h">1537</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path, $errstr);</td></tr>
<tr><td class="h">1538</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1538">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Error in mkstemps using $template: $errstr&quot;</td></tr>
<tr><td class="h">1539</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($fh, $path) = _gettemp($template,</td></tr>
<tr><td class="h">1540</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 1,</td></tr>
<tr><td class="h">1541</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1542</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; length($suffix),</td></tr>
<tr><td class="h">1543</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1544</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1545</td><td colspan="6"></td></tr><tr><td class="h">1546</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1546">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (wantarray()) {</td></tr>
<tr><td class="h">1547</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ($fh, $path);</td></tr>
<tr><td class="h">1548</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1549</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1550</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1551</td><td colspan="6"></td></tr><tr><td class="h">1552</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1553</td><td colspan="6"></td></tr><tr><td class="h">1554 - 1566</td><td colspan="5"></td><td class="s"><pre>=item B&lt;mkdtemp&gt;

Create a directory from a template. The template must end in
X&#39;s that are replaced by the routine.

  $tmpdir_name = mkdtemp($template);

Returns the name of the temporary directory created.
Returns undef on failure.

Directory must be removed by the caller.

=cut</pre></td></tr>
<tr><td class="h">1567</td><td colspan="6"></td></tr><tr><td class="h">1568</td><td></td><td></td><td></td><td></td><td></td><td class="s">#&#39; # for emacs</td></tr>
<tr><td class="h">1569</td><td colspan="6"></td></tr><tr><td class="h">1570</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mkdtemp {</td></tr>
<tr><td class="h">1571</td><td colspan="6"></td></tr><tr><td class="h">1572</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1572">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1572">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mkdtemp(template)&quot;</td></tr>
<tr><td class="h">1573</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 1;</td></tr>
<tr><td class="h">1574</td><td colspan="6"></td></tr><tr><td class="h">1575</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1576</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $suffixlen = 0;</td></tr>
<tr><td class="h">1577</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1577">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;VMS&#39;) {  # dir names can end in delimiters</td></tr>
<tr><td class="h">1578</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$template =~ m/([\.\]:&gt;]+)$/;</td></tr>
<tr><td class="h">1579</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$suffixlen = length($1);</td></tr>
<tr><td class="h">1580</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1581</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1581">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1581">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ( ($^O eq &#39;MacOS&#39;) &amp;&amp; (substr($template, -1) eq &#39;:&#39;) ) {</td></tr>
<tr><td class="h">1582</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# dir name has a trailing &#39;:&#39;</td></tr>
<tr><td class="h">1583</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;++$suffixlen;</td></tr>
<tr><td class="h">1584</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1585</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($junk, $tmpdir, $errstr);</td></tr>
<tr><td class="h">1586</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1586">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Error creating temp directory from template $template\: $errstr&quot;</td></tr>
<tr><td class="h">1587</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($junk, $tmpdir) = _gettemp($template,</td></tr>
<tr><td class="h">1588</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">1589</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 1 ,</td></tr>
<tr><td class="h">1590</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; $suffixlen,</td></tr>
<tr><td class="h">1591</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1592</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1593</td><td colspan="6"></td></tr><tr><td class="h">1594</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $tmpdir;</td></tr>
<tr><td class="h">1595</td><td colspan="6"></td></tr><tr><td class="h">1596</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1597</td><td colspan="6"></td></tr><tr><td class="h">1598 - 1607</td><td colspan="5"></td><td class="s"><pre>=item B&lt;mktemp&gt;

Returns a valid temporary filename but does not guarantee
that the file will not be opened by someone else.

  $unopened_file = mktemp($template);

Template is the same as that required by mkstemp().

=cut</pre></td></tr>
<tr><td class="h">1608</td><td colspan="6"></td></tr><tr><td class="h">1609</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mktemp {</td></tr>
<tr><td class="h">1610</td><td colspan="6"></td></tr><tr><td class="h">1611</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1611">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1611">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Usage: mktemp(template)&quot;</td></tr>
<tr><td class="h">1612</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if scalar(@_) != 1;</td></tr>
<tr><td class="h">1613</td><td colspan="6"></td></tr><tr><td class="h">1614</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1615</td><td colspan="6"></td></tr><tr><td class="h">1616</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($tmpname, $junk, $errstr);</td></tr>
<tr><td class="h">1617</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1617">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;croak &quot;Error getting name to temp file from template $template: $errstr&quot;</td></tr>
<tr><td class="h">1618</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (($junk, $tmpname) = _gettemp($template,</td></tr>
<tr><td class="h">1619</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;open&quot; =&gt; 0,</td></tr>
<tr><td class="h">1620</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;mkdir&quot;=&gt; 0 ,</td></tr>
<tr><td class="h">1621</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;suffixlen&quot; =&gt; 0,</td></tr>
<tr><td class="h">1622</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ErrStr&quot; =&gt; \$errstr,</td></tr>
<tr><td class="h">1623</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) );</td></tr>
<tr><td class="h">1624</td><td colspan="6"></td></tr><tr><td class="h">1625</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $tmpname;</td></tr>
<tr><td class="h">1626</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1627</td><td colspan="6"></td></tr><tr><td class="h">1628</td><td></td><td></td><td></td><td></td><td></td><td class="s">=back</td></tr>
<tr><td class="h">1629</td><td colspan="6"></td></tr><tr><td class="h">1630 - 1667</td><td colspan="5"></td><td class="s"><pre>=head1 POSIX FUNCTIONS

This section describes the re-implementation of the tmpnam()
and tmpfile() functions described in L&lt;POSIX&gt;
using the mkstemp() from this module.

Unlike the L&lt;POSIX|POSIX&gt; implementations, the directory used
for the temporary file is not specified in a system include
file (C&lt;P_tmpdir&gt;) but simply depends on the choice of tmpdir()
returned by L&lt;File::Spec|File::Spec&gt;. On some implementations this
location can be set using the C&lt;TMPDIR&gt; environment variable, which
may not be secure.
If this is a problem, simply use mkstemp() and specify a template.

=over 4

=item B&lt;tmpnam&gt;

When called in scalar context, returns the full name (including path)
of a temporary file (uses mktemp()). The only check is that the file does
not already exist, but there is no guarantee that that condition will
continue to apply.

  $file = tmpnam();

When called in list context, a filehandle to the open file and
a filename are returned. This is achieved by calling mkstemp()
after constructing a suitable template.

  ($fh, $file) = tmpnam();

If possible, this form should be used to prevent possible
race conditions.

See L&lt;File::Spec/tmpdir&gt; for information on the choice of temporary
directory for a particular operating system.

=cut</pre></td></tr>
<tr><td class="h">1668</td><td colspan="6"></td></tr><tr><td class="h">1669</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tmpnam {</td></tr>
<tr><td class="h">1670</td><td colspan="6"></td></tr><tr><td class="h">1671</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;# Retrieve the temporary directory name</td></tr>
<tr><td class="h">1672</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1672">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;my $tmpdir = File::Spec-&gt;tmpdir;</td></tr>
<tr><td class="h">1673</td><td colspan="6"></td></tr><tr><td class="h">1674</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1674">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;croak &quot;Error temporary directory is not writable&quot;</td></tr>
<tr><td class="h">1675</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $tmpdir eq &#39;&#39;;</td></tr>
<tr><td class="h">1676</td><td colspan="6"></td></tr><tr><td class="h">1677</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;# Use a ten character template and append to tmpdir</td></tr>
<tr><td class="h">1678</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;my $template = File::Spec-&gt;catfile($tmpdir, TEMPXXX);</td></tr>
<tr><td class="h">1679</td><td colspan="6"></td></tr><tr><td class="h">1680</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1680">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;if (wantarray() ) {</td></tr>
<tr><td class="h">1681</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return mkstemp($template);</td></tr>
<tr><td class="h">1682</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1683</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return mktemp($template);</td></tr>
<tr><td class="h">1684</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1685</td><td colspan="6"></td></tr><tr><td class="h">1686</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1687</td><td colspan="6"></td></tr><tr><td class="h">1688 - 1701</td><td colspan="5"></td><td class="s"><pre>=item B&lt;tmpfile&gt;

Returns the filehandle of a temporary file.

  $fh = tmpfile();

The file is removed when the filehandle is closed or when the program
exits. No access to the filename is provided.

If the temporary file can not be created undef is returned.
Currently this command will probably not work when the temporary
directory is on an NFS file system.

=cut</pre></td></tr>
<tr><td class="h">1702</td><td colspan="6"></td></tr><tr><td class="h">1703</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tmpfile {</td></tr>
<tr><td class="h">1704</td><td colspan="6"></td></tr><tr><td class="h">1705</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Simply call tmpnam() in a list context</td></tr>
<tr><td class="h">1706</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1706">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $file) = tmpnam();</td></tr>
<tr><td class="h">1707</td><td colspan="6"></td></tr><tr><td class="h">1708</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure file is removed when filehandle is closed</td></tr>
<tr><td class="h">1709</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# This will fail on NFS</td></tr>
<tr><td class="h">1710</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1710">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;unlink0($fh, $file)</td></tr>
<tr><td class="h">1711</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;or return undef;</td></tr>
<tr><td class="h">1712</td><td colspan="6"></td></tr><tr><td class="h">1713</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return $fh;</td></tr>
<tr><td class="h">1714</td><td colspan="6"></td></tr><tr><td class="h">1715</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1716</td><td colspan="6"></td></tr><tr><td class="h">1717</td><td></td><td></td><td></td><td></td><td></td><td class="s">=back</td></tr>
<tr><td class="h">1718</td><td colspan="6"></td></tr><tr><td class="h">1719 - 1744</td><td colspan="5"></td><td class="s"><pre>=head1 ADDITIONAL FUNCTIONS

These functions are provided for backwards compatibility
with common tempfile generation C library functions.

They are not exported and must be addressed using the full package
name.

=over 4

=item B&lt;tempnam&gt;

Return the name of a temporary file in the specified directory
using a prefix. The file is guaranteed not to exist at the time
the function was called, but such guarantees are good for one
clock tick only.  Always use the proper form of C&lt;sysopen&gt;
with C&lt;O_CREAT | O_EXCL&gt; if you must open such a filename.

  $filename = File::Temp::tempnam( $dir, $prefix );

Equivalent to running mktemp() with $dir/$prefixXXXXXXXX
(using unix file convention as an example)

Because this function uses mktemp(), it can suffer from race conditions.

=cut</pre></td></tr>
<tr><td class="h">1745</td><td colspan="6"></td></tr><tr><td class="h">1746</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tempnam {</td></tr>
<tr><td class="h">1747</td><td colspan="6"></td></tr><tr><td class="h">1748</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1748">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1748">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &#39;Usage tempnam($dir, $prefix)&#39; unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1749</td><td colspan="6"></td></tr><tr><td class="h">1750</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($dir, $prefix) = @_;</td></tr>
<tr><td class="h">1751</td><td colspan="6"></td></tr><tr><td class="h">1752</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Add a string to the prefix</td></tr>
<tr><td class="h">1753</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;$prefix .= &#39;XXXXXXXX&#39;;</td></tr>
<tr><td class="h">1754</td><td colspan="6"></td></tr><tr><td class="h">1755</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Concatenate the directory to the file</td></tr>
<tr><td class="h">1756</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $template = File::Spec-&gt;catfile($dir, $prefix);</td></tr>
<tr><td class="h">1757</td><td colspan="6"></td></tr><tr><td class="h">1758</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return mktemp($template);</td></tr>
<tr><td class="h">1759</td><td colspan="6"></td></tr><tr><td class="h">1760</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1761</td><td colspan="6"></td></tr><tr><td class="h">1762</td><td></td><td></td><td></td><td></td><td></td><td class="s">=back</td></tr>
<tr><td class="h">1763</td><td colspan="6"></td></tr><tr><td class="h">1764 - 1811</td><td colspan="5"></td><td class="s"><pre>=head1 UTILITY FUNCTIONS

Useful functions for dealing with the filehandle and filename.

=over 4

=item B&lt;unlink0&gt;

Given an open filehandle and the associated filename, make a safe
unlink. This is achieved by first checking that the filename and
filehandle initially point to the same file and that the number of
links to the file is 1 (all fields returned by stat() are compared).
Then the filename is unlinked and the filehandle checked once again to
verify that the number of links on that file is now 0.  This is the
closest you can come to making sure that the filename unlinked was the
same as the file whose descriptor you hold.

  unlink0($fh, $path)
     or die &quot;Error unlinking file $path safely&quot;;

Returns false on error. The filehandle is not closed since on some
occasions this is not required.

On some platforms, for example Windows NT, it is not possible to
unlink an open file (the file must be closed first). On those
platforms, the actual unlinking is deferred until the program ends and
good status is returned. A check is still performed to make sure that
the filehandle and filename are pointing to the same thing (but not at
the time the end block is executed since the deferred removal may not
have access to the filehandle).

Additionally, on Windows NT not all the fields returned by stat() can
be compared. For example, the C&lt;dev&gt; and C&lt;rdev&gt; fields seem to be
different.  Also, it seems that the size of the file returned by stat()
does not always agree, with C&lt;stat(FH)&gt; being more accurate than
C&lt;stat(filename)&gt;, presumably because of caching issues even when
using autoflush (this is usually overcome by waiting a while after
writing to the tempfile before attempting to C&lt;unlink0&gt; it).

Finally, on NFS file systems the link count of the file handle does
not always go to zero immediately after unlinking. Currently, this
command is expected to fail on NFS disks.

This function is disabled if the global variable $KEEP_ALL is true
and an unlink on open file is supported. If the unlink is to be deferred
to the END block, the file is still registered for removal.

=cut</pre></td></tr>
<tr><td class="h">1812</td><td colspan="6"></td></tr><tr><td class="h">1813</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink0 {</td></tr>
<tr><td class="h">1814</td><td colspan="6"></td></tr><tr><td class="h">1815</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1815">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1815">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: unlink0(filehandle, filename)&#39;</td></tr>
<tr><td class="h">1816</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1817</td><td colspan="6"></td></tr><tr><td class="h">1818</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read args</td></tr>
<tr><td class="h">1819</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = @_;</td></tr>
<tr><td class="h">1820</td><td colspan="6"></td></tr><tr><td class="h">1821</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1821">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;cmpstat($fh, $path) or return 0;</td></tr>
<tr><td class="h">1822</td><td colspan="6"></td></tr><tr><td class="h">1823</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# attempt remove the file (does not work on some platforms)</td></tr>
<tr><td class="h">1824</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1824">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if (_can_unlink_opened_file()) {</td></tr>
<tr><td class="h">1825</td><td colspan="6"></td></tr><tr><td class="h">1826</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# return early (Without unlink) if we have been instructed to retain files.</td></tr>
<tr><td class="h">1827</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1827">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $KEEP_ALL;</td></tr>
<tr><td class="h">1828</td><td colspan="6"></td></tr><tr><td class="h">1829</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# XXX: do *not* call this on a directory; possible race</td></tr>
<tr><td class="h">1830</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#      resulting in recursive removal</td></tr>
<tr><td class="h">1831</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1831">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;unlink0: $path has become a directory!&quot; if -d $path;</td></tr>
<tr><td class="h">1832</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1832">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unlink($path) or return 0;</td></tr>
<tr><td class="h">1833</td><td colspan="6"></td></tr><tr><td class="h">1834</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Stat the filehandle</td></tr>
<tr><td class="h">1835</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @fh = stat $fh;</td></tr>
<tr><td class="h">1836</td><td colspan="6"></td></tr><tr><td class="h">1837</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1837">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;Link count = $fh[3] \n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1838</td><td colspan="6"></td></tr><tr><td class="h">1839</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Make sure that the link count is zero</td></tr>
<tr><td class="h">1840</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# - Cygwin provides deferred unlinking, however,</td></tr>
<tr><td class="h">1841</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#   on Win9x the link count remains 1</td></tr>
<tr><td class="h">1842</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# On NFS the link count may still be 1 but we cant know that</td></tr>
<tr><td class="h">1843</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we are on NFS</td></tr>
<tr><td class="h">1844</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1844">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1844">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $fh[3] == 0 or $^O eq &#39;cygwin&#39; ? 1 : 0);</td></tr>
<tr><td class="h">1845</td><td colspan="6"></td></tr><tr><td class="h">1846</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1847</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_deferred_unlink($fh, $path, 0);</td></tr>
<tr><td class="h">1848</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1849</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1850</td><td colspan="6"></td></tr><tr><td class="h">1851</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1852</td><td colspan="6"></td></tr><tr><td class="h">1853 - 1876</td><td colspan="5"></td><td class="s"><pre>=item B&lt;cmpstat&gt;

Compare C&lt;stat&gt; of filehandle with C&lt;stat&gt; of provided filename.  This
can be used to check that the filename and filehandle initially point
to the same file and that the number of links to the file is 1 (all
fields returned by stat() are compared).

  cmpstat($fh, $path)
     or die &quot;Error comparing handle with file&quot;;

Returns false if the stat information differs or if the link count is
greater than 1.

On certain platofms, eg Windows, not all the fields returned by stat()
can be compared. For example, the C&lt;dev&gt; and C&lt;rdev&gt; fields seem to be
different in Windows.  Also, it seems that the size of the file
returned by stat() does not always agree, with C&lt;stat(FH)&gt; being more
accurate than C&lt;stat(filename)&gt;, presumably because of caching issues
even when using autoflush (this is usually overcome by waiting a while
after writing to the tempfile before attempting to C&lt;unlink0&gt; it).

Not exported by default.

=cut</pre></td></tr>
<tr><td class="h">1877</td><td colspan="6"></td></tr><tr><td class="h">1878</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub cmpstat {</td></tr>
<tr><td class="h">1879</td><td colspan="6"></td></tr><tr><td class="h">1880</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1880">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1880">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: cmpstat(filehandle, filename)&#39;</td></tr>
<tr><td class="h">1881</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1882</td><td colspan="6"></td></tr><tr><td class="h">1883</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read args</td></tr>
<tr><td class="h">1884</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = @_;</td></tr>
<tr><td class="h">1885</td><td colspan="6"></td></tr><tr><td class="h">1886</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1886">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;warn &quot;Comparing stat\n&quot;</td></tr>
<tr><td class="h">1887</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if $DEBUG;</td></tr>
<tr><td class="h">1888</td><td colspan="6"></td></tr><tr><td class="h">1889</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Stat the filehandle - which may be closed if someone has manually</td></tr>
<tr><td class="h">1890</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# closed the file. Can not turn off warnings without using $^W</td></tr>
<tr><td class="h">1891</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# unless we upgrade to 5.006 minimum requirement</td></tr>
<tr><td class="h">1892</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my @fh;</td></tr>
<tr><td class="h">1893</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1894</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local ($^W) = 0;</td></tr>
<tr><td class="h">1895</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@fh = stat $fh;</td></tr>
<tr><td class="h">1896</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1897</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1897">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return unless @fh;</td></tr>
<tr><td class="h">1898</td><td colspan="6"></td></tr><tr><td class="h">1899</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1899">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L1899">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($fh[3] &gt; 1 &amp;&amp; $^W) {</td></tr>
<tr><td class="h">1900</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1900">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;unlink0: fstat found too many links; SB=@fh&quot; if $^W;</td></tr>
<tr><td class="h">1901</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1902</td><td colspan="6"></td></tr><tr><td class="h">1903</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Stat the path</td></tr>
<tr><td class="h">1904</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my @path = stat $path;</td></tr>
<tr><td class="h">1905</td><td colspan="6"></td></tr><tr><td class="h">1906</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1906">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;unless (@path) {</td></tr>
<tr><td class="h">1907</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1907">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;unlink0: $path is gone already&quot; if $^W;</td></tr>
<tr><td class="h">1908</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">1909</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1910</td><td colspan="6"></td></tr><tr><td class="h">1911</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# this is no longer a file, but may be a directory, or worse</td></tr>
<tr><td class="h">1912</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1912">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;unless (-f $path) {</td></tr>
<tr><td class="h">1913</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;confess &quot;panic: $path is no longer a file: SB=@fh&quot;;</td></tr>
<tr><td class="h">1914</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1915</td><td colspan="6"></td></tr><tr><td class="h">1916</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Do comparison of each member of the array</td></tr>
<tr><td class="h">1917</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# On WinNT dev and rdev seem to be different</td></tr>
<tr><td class="h">1918</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# depending on whether it is a file or a handle.</td></tr>
<tr><td class="h">1919</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Cannot simply compare all members of the stat return</td></tr>
<tr><td class="h">1920</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Select the ones we can use</td></tr>
<tr><td class="h">1921</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my @okstat = (0..$#fh);  # Use all by default</td></tr>
<tr><td class="h">1922</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1922">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1922">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1922">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1922">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1922">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;if ($^O eq &#39;MSWin32&#39;) {</td></tr>
<tr><td class="h">1923</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (1,2,3,4,5,7,8,9,10);</td></tr>
<tr><td class="h">1924</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;os2&#39;) {</td></tr>
<tr><td class="h">1925</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0, 2..$#fh);</td></tr>
<tr><td class="h">1926</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;VMS&#39;) { # device and file ID are sufficient</td></tr>
<tr><td class="h">1927</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0, 1);</td></tr>
<tr><td class="h">1928</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;dos&#39;) {</td></tr>
<tr><td class="h">1929</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0,2..7,11..$#fh);</td></tr>
<tr><td class="h">1930</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;} elsif ($^O eq &#39;mpeix&#39;) {</td></tr>
<tr><td class="h">1931</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@okstat = (0..4,8..10);</td></tr>
<tr><td class="h">1932</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1933</td><td colspan="6"></td></tr><tr><td class="h">1934</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Now compare each entry explicitly by number</td></tr>
<tr><td class="h">1935</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;for (@okstat) {</td></tr>
<tr><td class="h">1936</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1936">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print &quot;Comparing: $_ : $fh[$_] and $path[$_]\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1937</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Use eq rather than == since rdev, blksize, and blocks (6, 11,</td></tr>
<tr><td class="h">1938</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# and 12) will be &#39;&#39; on platforms that do not support them.  This</td></tr>
<tr><td class="h">1939</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# is fine since we are only comparing integers.</td></tr>
<tr><td class="h">1940</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1940">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($fh[$_] eq $path[$_]) {</td></tr>
<tr><td class="h">1941</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1941">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;warn &quot;Did not match $_ element of stat\n&quot; if $DEBUG;</td></tr>
<tr><td class="h">1942</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">1943</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1944</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1945</td><td colspan="6"></td></tr><tr><td class="h">1946</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">1947</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1948</td><td colspan="6"></td></tr><tr><td class="h">1949 - 1966</td><td colspan="5"></td><td class="s"><pre>=item B&lt;unlink1&gt;

Similar to C&lt;unlink0&gt; except after file comparison using cmpstat, the
filehandle is closed prior to attempting to unlink the file. This
allows the file to be removed without using an END block, but does
mean that the post-unlink comparison of the filehandle state provided
by C&lt;unlink0&gt; is not available.

  unlink1($fh, $path)
     or die &quot;Error closing and unlinking file&quot;;

Usually called from the object destructor when using the OO interface.

Not exported by default.

This function is disabled if the global variable $KEEP_ALL is true.

=cut</pre></td></tr>
<tr><td class="h">1967</td><td colspan="6"></td></tr><tr><td class="h">1968</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub unlink1 {</td></tr>
<tr><td class="h">1969</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1969">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L1969">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;croak &#39;Usage: unlink1(filehandle, filename)&#39;</td></tr>
<tr><td class="h">1970</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless scalar(@_) == 2;</td></tr>
<tr><td class="h">1971</td><td colspan="6"></td></tr><tr><td class="h">1972</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Read args</td></tr>
<tr><td class="h">1973</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my ($fh, $path) = @_;</td></tr>
<tr><td class="h">1974</td><td colspan="6"></td></tr><tr><td class="h">1975</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1975">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;cmpstat($fh, $path) or return 0;</td></tr>
<tr><td class="h">1976</td><td colspan="6"></td></tr><tr><td class="h">1977</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Close the file</td></tr>
<tr><td class="h">1978</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1978">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;close( $fh ) or return 0;</td></tr>
<tr><td class="h">1979</td><td colspan="6"></td></tr><tr><td class="h">1980</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# Make sure the file is writable (for windows)</td></tr>
<tr><td class="h">1981</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;_force_writable( $path );</td></tr>
<tr><td class="h">1982</td><td colspan="6"></td></tr><tr><td class="h">1983</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# return early (without unlink) if we have been instructed to retain files.</td></tr>
<tr><td class="h">1984</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L1984">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return 1 if $KEEP_ALL;</td></tr>
<tr><td class="h">1985</td><td colspan="6"></td></tr><tr><td class="h">1986</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# remove the file</td></tr>
<tr><td class="h">1987</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;return unlink($path);</td></tr>
<tr><td class="h">1988</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1989</td><td colspan="6"></td></tr><tr><td class="h">1990 - 2082</td><td colspan="5"></td><td class="s"><pre>=item B&lt;cleanup&gt;

Calling this function will cause any temp files or temp directories
that are registered for removal to be removed. This happens automatically
when the process exits but can be triggered manually if the caller is sure
that none of the temp files are required. This method can be registered as
an Apache callback.

On OSes where temp files are automatically removed when the temp file
is closed, calling this function will have no effect other than to remove
temporary directories (which may include temporary files).

  File::Temp::cleanup();

Not exported by default.

=back

=head1 PACKAGE VARIABLES

These functions control the global state of the package.

=over 4

=item B&lt;safe_level&gt;

Controls the lengths to which the module will go to check the safety of the
temporary file or directory before proceeding.
Options are:

=over 8

=item STANDARD

Do the basic security measures to ensure the directory exists and
is writable, that the umask() is fixed before opening of the file,
that temporary files are opened only if they do not already exist, and
that possible race conditions are avoided.  Finally the L&lt;unlink0|&quot;unlink0&quot;&gt;
function is used to remove files safely.

=item MEDIUM

In addition to the STANDARD security, the output directory is checked
to make sure that it is owned either by root or the user running the
program. If the directory is writable by group or by other, it is then
checked to make sure that the sticky bit is set.

Will not work on platforms that do not support the C&lt;-k&gt; test
for sticky bit.

=item HIGH

In addition to the MEDIUM security checks, also check for the
possibility of ``chown() giveaway&#39;&#39; using the L&lt;POSIX|POSIX&gt;
sysconf() function. If this is a possibility, each directory in the
path is checked in turn for safeness, recursively walking back to the
root directory.

For platforms that do not support the L&lt;POSIX|POSIX&gt;
C&lt;_PC_CHOWN_RESTRICTED&gt; symbol (for example, Windows NT) it is
assumed that ``chown() giveaway&#39;&#39; is possible and the recursive test
is performed.

=back

The level can be changed as follows:

  File::Temp-&gt;safe_level( File::Temp::HIGH );

The level constants are not exported by the module.

Currently, you must be running at least perl v5.6.0 in order to
run with MEDIUM or HIGH security. This is simply because the
safety tests use functions from L&lt;Fcntl|Fcntl&gt; that are not
available in older versions of perl. The problem is that the version
number for Fcntl is the same in perl 5.6.0 and in 5.005_03 even though
they are different versions.

On systems that do not support the HIGH or MEDIUM safety levels
(for example Win NT or OS/2) any attempt to change the level will
be ignored. The decision to ignore rather than raise an exception
allows portable programs to be written with high security in mind
for the systems that can support this without those programs failing
on systems where the extra tests are irrelevant.

If you really need to see whether the change has been accepted
simply examine the return value of C&lt;safe_level&gt;.

  $newlevel = File::Temp-&gt;safe_level( File::Temp::HIGH );
  die &quot;Could not change to high security&quot;
      if $newlevel != File::Temp::HIGH;

=cut</pre></td></tr>
<tr><td class="h">2083</td><td colspan="6"></td></tr><tr><td class="h">2084</td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">2085</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;# protect from using the variable itself</td></tr>
<tr><td class="h">2086</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $LEVEL = STANDARD;</td></tr>
<tr><td class="h">2087</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub safe_level {</td></tr>
<tr><td class="h">2088</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L2088">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">2089</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2089">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">2090</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $level = shift;</td></tr>
<tr><td class="h">2091</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2091">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L2091">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (($level != STANDARD) &amp;&amp; ($level != MEDIUM) &amp;&amp; ($level != HIGH)) {</td></tr>
<tr><td class="h">2092</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2092">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp &quot;safe_level: Specified level ($level) not STANDARD, MEDIUM or HIGH - ignoring\n&quot; if $^W;</td></tr>
<tr><td class="h">2093</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2094</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Dont allow this on perl 5.005 or earlier</td></tr>
<tr><td class="h">2095</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2095">0</a></div></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--condition.html#L2095">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($] &lt; 5.006 &amp;&amp; $level != STANDARD) {</td></tr>
<tr><td class="h">2096</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Cant do MEDIUM or HIGH checks</td></tr>
<tr><td class="h">2097</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Currently requires perl 5.006 or newer to do the safe checks&quot;;</td></tr>
<tr><td class="h">2098</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2099</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Check that we are allowed to change level</td></tr>
<tr><td class="h">2100</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Silently ignore if we can not.</td></tr>
<tr><td class="h">2101</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2101">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$LEVEL = $level if _can_do_level($level);</td></tr>
<tr><td class="h">2102</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2103</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2104</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $LEVEL;</td></tr>
<tr><td class="h">2105</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2106</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2107</td><td colspan="6"></td></tr><tr><td class="h">2108 - 2127</td><td colspan="5"></td><td class="s"><pre>=item TopSystemUID

This is the highest UID on the current system that refers to a root
UID. This is used to make sure that the temporary directory is
owned by a system UID (C&lt;root&gt;, C&lt;bin&gt;, C&lt;sys&gt; etc) rather than
simply by root.

This is required since on many unix systems C&lt;/tmp&gt; is not owned
by root.

Default is to assume that any UID less than or equal to 10 is a root
UID.

  File::Temp-&gt;top_system_uid(10);
  my $topid = File::Temp-&gt;top_system_uid;

This value can be adjusted to reduce security checking if required.
The value is only relevant when C&lt;safe_level&gt; is set to MEDIUM or higher.

=cut</pre></td></tr>
<tr><td class="h">2128</td><td colspan="6"></td></tr><tr><td class="h">2129</td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">2130</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;my $TopSystemUID = 10;</td></tr>
<tr><td class="h">2131</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;sub top_system_uid {</td></tr>
<tr><td class="h">2132</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl-5-8-8-File-Temp-pm--subroutine.html#L2132">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">2133</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2133">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@_) {</td></tr>
<tr><td class="h">2134</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $newuid = shift;</td></tr>
<tr><td class="h">2135</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl-5-8-8-File-Temp-pm--branch.html#L2135">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;top_system_uid: UIDs should be numeric&quot;</td></tr>
<tr><td class="h">2136</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $newuid =~ /^\d+$/s;</td></tr>
<tr><td class="h">2137</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TopSystemUID = $newuid;</td></tr>
<tr><td class="h">2138</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2139</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $TopSystemUID;</td></tr>
<tr><td class="h">2140</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2141</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2142</td><td colspan="6"></td></tr><tr><td class="h">2143 - 2242</td><td colspan="5"></td><td class="s"><pre>=item B&lt;$KEEP_ALL&gt;

Controls whether temporary files and directories should be retained
regardless of any instructions in the program to remove them
automatically.  This is useful for debugging but should not be used in
production code.

  $File::Temp::KEEP_ALL = 1;

Default is for files to be removed as requested by the caller.

In some cases, files will only be retained if this variable is true
when the file is created. This means that you can not create a temporary
file, set this variable and expect the temp file to still be around
when the program exits.

=item B&lt;$DEBUG&gt;

Controls whether debugging messages should be enabled.

  $File::Temp::DEBUG = 1;

Default is for debugging mode to be disabled.

=back

=head1 WARNING

For maximum security, endeavour always to avoid ever looking at,
touching, or even imputing the existence of the filename.  You do not
know that that filename is connected to the same file as the handle
you have, and attempts to check this can only trigger more race
conditions.  It&#39;s far more secure to use the filehandle alone and
dispense with the filename altogether.

If you need to pass the handle to something that expects a filename
then, on a unix system, use C&lt;&quot;/dev/fd/&quot; . fileno($fh)&gt; for arbitrary
programs, or more generally C&lt;&lt; &quot;+&lt;=&amp;&quot; . fileno($fh) &gt;&gt; for Perl
programs.  You will have to clear the close-on-exec bit on that file
descriptor before passing it to another process.

    use Fcntl qw/F_SETFD F_GETFD/;
    fcntl($tmpfh, F_SETFD, 0)
        or die &quot;Can&#39;t clear close-on-exec flag on temp fh: $!\n&quot;;

=head2 Temporary files and NFS

Some problems are associated with using temporary files that reside
on NFS file systems and it is recommended that a local filesystem
is used whenever possible. Some of the security tests will most probably
fail when the temp file is not local. Additionally, be aware that
the performance of I/O operations over NFS will not be as good as for
a local disk.

=head2 Forking

In some cases files created by File::Temp are removed from within an
END block. Since END blocks are triggered when a child process exits
(unless C&lt;POSIX::_exit()&gt; is used by the child) File::Temp takes care
to only remove those temp files created by a particular process ID. This
means that a child will not attempt to remove temp files created by the
parent process.

=head2 BINMODE

The file returned by File::Temp will have been opened in binary mode
if such a mode is available. If that is not correct, use the binmode()
function to change the mode of the filehandle.

=head1 HISTORY

Originally began life in May 1999 as an XS interface to the system
mkstemp() function. In March 2000, the OpenBSD mkstemp() code was
translated to Perl for total control of the code&#39;s
security checking, to ensure the presence of the function regardless of
operating system and to help with portability. The module was shipped
as a standard part of perl from v5.6.1.

=head1 SEE ALSO

L&lt;POSIX/tmpnam&gt;, L&lt;POSIX/tmpfile&gt;, L&lt;File::Spec&gt;, L&lt;File::Path&gt;

See L&lt;IO::File&gt; and L&lt;File::MkTemp&gt;, L&lt;Apachae::TempFile&gt; for
different implementations of temporary file handling.

=head1 AUTHOR

Tim Jenness E&lt;lt&gt;tjenness@cpan.orgE&lt;gt&gt;

Copyright (C) 1999-2005 Tim Jenness and the UK Particle Physics and
Astronomy Research Council. All Rights Reserved.  This program is free
software; you can redistribute it and/or modify it under the same
terms as Perl itself.

Original Perl implementation loosely based on the OpenBSD C code for
mkstemp(). Thanks to Tom Christiansen for suggesting that this module
should be written and providing ideas for code improvements and
security enhancements.

=cut</pre></td></tr>
<tr><td class="h">2243</td><td colspan="6"></td></tr><tr><td class="h">2244</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
