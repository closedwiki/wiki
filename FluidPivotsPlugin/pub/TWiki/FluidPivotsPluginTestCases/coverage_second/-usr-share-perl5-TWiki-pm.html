<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">46.9%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 1999-2007 Peter Thoeny, peter@thoeny.org</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and TWiki Contributors. All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Additional copyrights apply to some or all of the code in this</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># file as follows:</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Based on parts of Ward Cunninghams original Wiki and JosWiki.</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 1998 Markus Peter - SPiN GmbH (warpi@spin.de)</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Some changes by Dave Harris (drh@bhresearch.co.uk) incorporated</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">20</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">26</td><td colspan="6"></td></tr><tr><td class="h">27 - 40</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TWiki

TWiki operates by creating a singleton object (known as the Session
object) that acts as a point of reference for all the different
modules in the system. This package is the class for this singleton,
and also contains the vast bulk of the basic constants and the per-
site configuration mechanisms.

Global variables are avoided wherever possible to avoid problems
with CGI accelerators such as mod_perl.

=cut</pre></td></tr>
<tr><td class="h">41</td><td colspan="6"></td></tr><tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki;</td></tr>
<tr><td class="h">43</td><td colspan="6"></td></tr><tr><td class="h">44</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L44">1</a></div></td><td><div>5</div><div>3</div><div>4</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">45</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L45">1</a></div></td><td><div>13</div><div>4</div><div>6</div></td><td class="s">use Assert;</td></tr>
<tr><td class="h">46</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L46">1</a></div></td><td><div>13</div><div>3</div><div>6</div></td><td class="s">use Error qw( :try );</td></tr>
<tr><td class="h">47</td><td colspan="6"></td></tr><tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td class="s">require 5.005;       # For regex objects and internationalisation</td></tr>
<tr><td class="h">49</td><td colspan="6"></td></tr><tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Site configuration constants</td></tr>
<tr><td class="h">51</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L51">1</a></div></td><td><div>7</div><div>2</div><div>6</div></td><td class="s">use vars qw( %cfg );</td></tr>
<tr><td class="h">52</td><td colspan="6"></td></tr><tr><td class="h">53</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Uncomment this and the __END__ to enable AutoLoader</td></tr>
<tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td class="s">#use AutoLoader &#39;AUTOLOAD&#39;;</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td class="s"># You then need to autosplit TWiki.pm:</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td class="s"># cd lib</td></tr>
<tr><td class="h">57</td><td></td><td></td><td></td><td></td><td></td><td class="s"># perl -e &#39;use AutoSplit; autosplit(&quot;TWiki.pm&quot;, &quot;auto&quot;)&#39;</td></tr>
<tr><td class="h">58</td><td colspan="6"></td></tr><tr><td class="h">59</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Other computed constants</td></tr>
<tr><td class="h">60</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">use vars qw(</td></tr>
<tr><td class="h">61</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TranslationToken</td></tr>
<tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twikiLibDir</td></tr>
<tr><td class="h">63</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%regex</td></tr>
<tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%constantTags</td></tr>
<tr><td class="h">65</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%functionTags</td></tr>
<tr><td class="h">66</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%contextFreeSyntax</td></tr>
<tr><td class="h">67</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%restDispatch</td></tr>
<tr><td class="h">68</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$VERSION $RELEASE</td></tr>
<tr><td class="h">69</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TRUE</td></tr>
<tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$FALSE</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sharedSandbox</td></tr>
<tr><td class="h">72</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L72">1</a></div></td><td><div>7</div><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">73</td><td colspan="6"></td></tr><tr><td class="h">74</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Token character that must not occur in any normal text - converted</td></tr>
<tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td class="s"># to a flag character if it ever does occur (very unlikely)</td></tr>
<tr><td class="h">76</td><td></td><td></td><td></td><td></td><td></td><td class="s"># TWiki uses $TranslationToken to mark points in the text. This is</td></tr>
<tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td class="s"># normally \0, which is not a useful character in any 8-bit character</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td class="s"># set we can find, nor in UTF-8. But if you *do* encounter problems</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td class="s"># with it, the workaround is to change $TranslationToken to something</td></tr>
<tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td class="s"># longer that is unlikely to occur in your text - for example</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td class="s"># muRfleFli5ble8leep (do *not* use punctuation characters or whitspace</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td class="s"># in the string!)</td></tr>
<tr><td class="h">83</td><td></td><td></td><td></td><td></td><td></td><td class="s"># See Codev.NationalCharTokenClash for more.</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td class="s">$TranslationToken= &quot;\0&quot;;</td></tr>
<tr><td class="h">85</td><td colspan="6"></td></tr><tr><td class="h">86 - 94</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod getTWikiLibDir() -&gt; $path

STATIC method.

Returns the full path of the directory containing TWiki.pm

=cut</pre></td></tr>
<tr><td class="h">95</td><td colspan="6"></td></tr><tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getTWikiLibDir {</td></tr>
<tr><td class="h">97</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L97">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L97">1</a></div></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $twikiLibDir ) {</td></tr>
<tr><td class="h">98</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $twikiLibDir;</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">100</td><td colspan="6"></td></tr><tr><td class="h">101</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: Should just use $INC{&quot;TWiki.pm&quot;} to get path used to load this</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# module.</td></tr>
<tr><td class="h">103</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dir = &#39;&#39;;</td></tr>
<tr><td class="h">104</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach $dir ( @INC ) {</td></tr>
<tr><td class="h">105</td><td><div class="c3">7</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L105">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L105">67</a></div></td><td></td><td><div>110</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $dir &amp;&amp; -e &quot;$dir/TWiki.pm&quot; ) {</td></tr>
<tr><td class="h">106</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twikiLibDir = $dir;</td></tr>
<tr><td class="h">107</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last;</td></tr>
<tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">110</td><td colspan="6"></td></tr><tr><td class="h">111</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# fix path relative to location of called script</td></tr>
<tr><td class="h">112</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L112">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $twikiLibDir =~ /^\./ ) {</td></tr>
<tr><td class="h">113</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print STDERR &quot;WARNING: TWiki lib path $twikiLibDir is relative; you should make it absolute, otherwise some scripts may not run from the command line.&quot;;</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $bin;</td></tr>
<tr><td class="h">115</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L115">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L115">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L115">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $ENV{SCRIPT_FILENAME} &amp;&amp;</td></tr>
<tr><td class="h">116</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{SCRIPT_FILENAME} =~ /^(.+)\/[^\/]+$/ ) {</td></tr>
<tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# CGI script name</td></tr>
<tr><td class="h">118</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bin = $1;</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $0 =~ /^(.*)\/.*?$/ ) {</td></tr>
<tr><td class="h">120</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# program name</td></tr>
<tr><td class="h">121</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bin = $1;</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# last ditch; relative to current directory.</td></tr>
<tr><td class="h">124</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require Cwd;</td></tr>
<tr><td class="h">125</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import Cwd qw( cwd );</td></tr>
<tr><td class="h">126</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bin = cwd();</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">128</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twikiLibDir = &quot;$bin/$twikiLibDir/&quot;;</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# normalize &quot;/../&quot; and &quot;/./&quot;</td></tr>
<tr><td class="h">130</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ( $twikiLibDir =~ s|([\\/])[^\\/]+[\\/]\.\.[\\/]|$1| ) {</td></tr>
<tr><td class="h">131</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">132</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twikiLibDir =~ s|([\\/])\.[\\/]|$1|g;</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">134</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$twikiLibDir =~ s|([\\/])[\\/]*|$1|g; # reduce &quot;//&quot; to &quot;/&quot;</td></tr>
<tr><td class="h">135</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$twikiLibDir =~ s|[\\/]$||;           # cut trailing &quot;/&quot;</td></tr>
<tr><td class="h">136</td><td colspan="6"></td></tr><tr><td class="h">137</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $twikiLibDir;</td></tr>
<tr><td class="h">138</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">139</td><td colspan="6"></td></tr><tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td class="s">BEGIN {</td></tr>
<tr><td class="h">141</td><td colspan="6"></td></tr><tr><td class="h">142</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L142">1</a></div></td><td><div>12</div><div>3</div><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;use TWiki::Sandbox;   # system command sandbox</td></tr>
<tr><td class="h">143</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L143">1</a></div></td><td><div>615</div><div>3</div><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;use TWiki::Configure::Load;    # read configuration files</td></tr>
<tr><td class="h">144</td><td colspan="6"></td></tr><tr><td class="h">145</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L145">1</a></div></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$TRUE = 1;</td></tr>
<tr><td class="h">146</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$FALSE = 0;</td></tr>
<tr><td class="h">147</td><td colspan="6"></td></tr><tr><td class="h">148</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( DEBUG ) {</td></tr>
<tr><td class="h">149</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If ASSERTs are on, then warnings are errors. Paranoid,</td></tr>
<tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# but the only way to be sure we eliminate them all.</td></tr>
<tr><td class="h">151</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Look out also for $cfg{WarningsAreErrors}, below, which</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is another way to install this handler without enabling</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ASSERTs</td></tr>
<tr><td class="h">154</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ASSERTS are turned on by defining the environment variable</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# TWIKI_ASSERTS. If ASSERTs are off, this is assumed to be a</td></tr>
<tr><td class="h">156</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# production environment, and no stack traces or paths are</td></tr>
<tr><td class="h">157</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# output to the browser.</td></tr>
<tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$SIG{&#39;__WARN__&#39;} = sub { die @_ };</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Error::Debug = 1; # verbose stack traces, please</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">161</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Error::Debug = 0; # no verbose stack traces</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">163</td><td colspan="6"></td></tr><tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# DO NOT CHANGE THE FORMAT OF $VERSION</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Automatically expanded on checkin of this module</td></tr>
<tr><td class="h">166</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$VERSION = &#39;$Date: 2007-03-03 15:45:48 +0100 (Sat, 03 Mar 2007) $ $Rev: 13046 $ &#39;;</td></tr>
<tr><td class="h">167</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$RELEASE = &#39;TWiki-4.1.2&#39;;</td></tr>
<tr><td class="h">168</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$VERSION =~ s/^.*?\((.*)\).*: (\d+) .*?$/$RELEASE, $1, build $2/;</td></tr>
<tr><td class="h">169</td><td colspan="6"></td></tr><tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Default handlers for different %TAGS%</td></tr>
<tr><td class="h">171</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>216</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%functionTags = (</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALLVARIABLES      =&gt; \&amp;_ALLVARIABLES,</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTACHURL         =&gt; \&amp;_ATTACHURL,</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTACHURLPATH     =&gt; \&amp;_ATTACHURLPATH,</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATE              =&gt; \&amp;_DATE,</td></tr>
<tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISPLAYTIME       =&gt; \&amp;_DISPLAYTIME,</td></tr>
<tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENCODE            =&gt; \&amp;_ENCODE,</td></tr>
<tr><td class="h">178</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENV               =&gt; \&amp;_ENV,</td></tr>
<tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMFIELD         =&gt; \&amp;_FORMFIELD,</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GMTIME            =&gt; \&amp;_GMTIME,</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GROUPS            =&gt; \&amp;_GROUPS,</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTTP_HOST         =&gt; \&amp;_HTTP_HOST_deprecated,</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTTP              =&gt; \&amp;_HTTP,</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTTPS             =&gt; \&amp;_HTTPS,</td></tr>
<tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICON              =&gt; \&amp;_ICON,</td></tr>
<tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICONURL           =&gt; \&amp;_ICONURL,</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICONURLPATH       =&gt; \&amp;_ICONURLPATH,</td></tr>
<tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF                =&gt; \&amp;_IF,</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INCLUDE           =&gt; \&amp;_INCLUDE,</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTURLENCODE      =&gt; \&amp;_INTURLENCODE,</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGUAGES         =&gt; \&amp;_LANGUAGES,</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAKETEXT          =&gt; \&amp;_MAKETEXT,</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;META              =&gt; \&amp;_META,</td></tr>
<tr><td class="h">194</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;METASEARCH        =&gt; \&amp;_METASEARCH,</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOP               =&gt; \&amp;_NOP,</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PLUGINVERSION     =&gt; \&amp;_PLUGINVERSION,</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUBURL            =&gt; \&amp;_PUBURL,</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUBURLPATH        =&gt; \&amp;_PUBURLPATH,</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUERYPARAMS       =&gt; \&amp;_QUERYPARAMS,</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUERYSTRING       =&gt; \&amp;_QUERYSTRING,</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RELATIVETOPICPATH =&gt; \&amp;_RELATIVETOPICPATH,</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REMOTE_ADDR       =&gt; \&amp;_REMOTE_ADDR_deprecated,</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REMOTE_PORT       =&gt; \&amp;_REMOTE_PORT_deprecated,</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REMOTE_USER       =&gt; \&amp;_REMOTE_USER_deprecated,</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REVINFO           =&gt; \&amp;_REVINFO,</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCRIPTNAME        =&gt; \&amp;_SCRIPTNAME,</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCRIPTURL         =&gt; \&amp;_SCRIPTURL,</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCRIPTURLPATH     =&gt; \&amp;_SCRIPTURLPATH,</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEARCH            =&gt; \&amp;_SEARCH,</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEP               =&gt; \&amp;_SEP,</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVERTIME        =&gt; \&amp;_SERVERTIME,</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPACEDTOPIC       =&gt; \&amp;_SPACEDTOPIC_deprecated,</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPACEOUT          =&gt; \&amp;_SPACEOUT,</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;TMPL:P&#39;          =&gt; \&amp;_TMPLP,</td></tr>
<tr><td class="h">215</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TOPICLIST         =&gt; \&amp;_TOPICLIST,</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;URLENCODE         =&gt; \&amp;_ENCODE,</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;URLPARAM          =&gt; \&amp;_URLPARAM,</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGUAGE          =&gt; \&amp;_LANGUAGE,</td></tr>
<tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USERINFO          =&gt; \&amp;_USERINFO,</td></tr>
<tr><td class="h">220</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USERNAME          =&gt; \&amp;_USERNAME_deprecated,</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VAR               =&gt; \&amp;_VAR,</td></tr>
<tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WEBLIST           =&gt; \&amp;_WEBLIST,</td></tr>
<tr><td class="h">223</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WIKINAME          =&gt; \&amp;_WIKINAME_deprecated,</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WIKIUSERNAME      =&gt; \&amp;_WIKIUSERNAME_deprecated</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">226</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$contextFreeSyntax{IF} = 1;</td></tr>
<tr><td class="h">227</td><td colspan="6"></td></tr><tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Constant tag strings _not_ dependent on config</td></tr>
<tr><td class="h">229</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%constantTags = (</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDSECTION        =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WIKIVERSION       =&gt; $VERSION,</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STARTSECTION      =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">233</td><td colspan="6"></td></tr><tr><td class="h">234</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STARTINCLUDE      =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STOPINCLUDE       =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">236</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">237</td><td colspan="6"></td></tr><tr><td class="h">238</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L238">50</a></div></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( ( $TWiki::cfg{DetailedOS} = $^O ) ) {</td></tr>
<tr><td class="h">239</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require Config;</td></tr>
<tr><td class="h">240</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{DetailedOS} = $Config::Config{&#39;osname&#39;};</td></tr>
<tr><td class="h">241</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">242</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;UNIX&#39;;</td></tr>
<tr><td class="h">243</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L243">50</a></div></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($TWiki::cfg{DetailedOS} =~ /darwin/i) { # MacOS X</td></tr>
<tr><td class="h">244</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;UNIX&#39;;</td></tr>
<tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($TWiki::cfg{DetailedOS} =~ /Win/i) {</td></tr>
<tr><td class="h">246</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;WINDOWS&#39;;</td></tr>
<tr><td class="h">247</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($TWiki::cfg{DetailedOS} =~ /vms/i) {</td></tr>
<tr><td class="h">248</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;VMS&#39;;</td></tr>
<tr><td class="h">249</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($TWiki::cfg{DetailedOS} =~ /bsdos/i) {</td></tr>
<tr><td class="h">250</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;UNIX&#39;;</td></tr>
<tr><td class="h">251</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($TWiki::cfg{DetailedOS} =~ /dos/i) {</td></tr>
<tr><td class="h">252</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;DOS&#39;;</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($TWiki::cfg{DetailedOS} =~ /^MacOS$/i) { # MacOS 9 or earlier</td></tr>
<tr><td class="h">254</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;MACINTOSH&#39;;</td></tr>
<tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($TWiki::cfg{DetailedOS} =~ /os2/i) {</td></tr>
<tr><td class="h">256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS} = &#39;OS2&#39;;</td></tr>
<tr><td class="h">257</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">258</td><td colspan="6"></td></tr><tr><td class="h">259</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Validate and untaint Apache&#39;s SERVER_NAME Environment variable</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# for use in referencing virtualhost-based paths for separate data/ and templates/ instances, etc</td></tr>
<tr><td class="h">261</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L261">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L261">33</a></div></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $ENV{SERVER_NAME} &amp;&amp;</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{SERVER_NAME} =~ /^(([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6})$/ ) {</td></tr>
<tr><td class="h">263</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{SERVER_NAME} =</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Sandbox::untaintUnchecked( $ENV{SERVER_NAME} );</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">266</td><td colspan="6"></td></tr><tr><td class="h">267</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# readConfig is defined in TWiki::Configure::Load to allow overriding it</td></tr>
<tr><td class="h">268</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Configure::Load::readConfig();</td></tr>
<tr><td class="h">269</td><td colspan="6"></td></tr><tr><td class="h">270</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L270">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{WarningsAreErrors} ) {</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note: Warnings are always errors if ASSERTs are enabled</td></tr>
<tr><td class="h">272</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$SIG{&#39;__WARN__&#39;} = sub { die @_ };</td></tr>
<tr><td class="h">273</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">274</td><td colspan="6"></td></tr><tr><td class="h">275</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L275">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseLocale} ) {</td></tr>
<tr><td class="h">276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require locale;</td></tr>
<tr><td class="h">277</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import locale();</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">279</td><td colspan="6"></td></tr><tr><td class="h">280</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Constant tags dependent on the config</td></tr>
<tr><td class="h">281</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{AUTHREALM}       = $TWiki::cfg{AuthRealm};</td></tr>
<tr><td class="h">282</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{HOMETOPIC}       = $TWiki::cfg{HomeTopicName};</td></tr>
<tr><td class="h">283</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{MAINWEB}         = $TWiki::cfg{UsersWebName};</td></tr>
<tr><td class="h">284</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{TRASHWEB}        = $TWiki::cfg{TrashWebName};</td></tr>
<tr><td class="h">285</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{NOTIFYTOPIC}     = $TWiki::cfg{NotifyTopicName};</td></tr>
<tr><td class="h">286</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{SCRIPTSUFFIX}    = $TWiki::cfg{ScriptSuffix};</td></tr>
<tr><td class="h">287</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{LOCALSITEPREFS}  = $TWiki::cfg{LocalSitePreferences};</td></tr>
<tr><td class="h">288</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{STATISTICSTOPIC} = $TWiki::cfg{Stats}{TopicName};</td></tr>
<tr><td class="h">289</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{TWIKIWEB}        = $TWiki::cfg{SystemWebName};</td></tr>
<tr><td class="h">290</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{WEBPREFSTOPIC}   = $TWiki::cfg{WebPrefsTopicName};</td></tr>
<tr><td class="h">291</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{DEFAULTURLHOST}  = $TWiki::cfg{DefaultUrlHost};</td></tr>
<tr><td class="h">292</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{WIKIPREFSTOPIC}  = $TWiki::cfg{SitePrefsTopicName};</td></tr>
<tr><td class="h">293</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{WIKIUSERSTOPIC}  = $TWiki::cfg{UsersTopicName};</td></tr>
<tr><td class="h">294</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{WIKIWEBMASTER}   = $TWiki::cfg{WebMasterEmail};</td></tr>
<tr><td class="h">295</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{WIKIWEBMASTERNAME} = $TWiki::cfg{WebMasterName};</td></tr>
<tr><td class="h">296</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L296">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{NoFollow} ) {</td></tr>
<tr><td class="h">297</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{NOFOLLOW} = &#39;rel=&#39;.$TWiki::cfg{NoFollow};</td></tr>
<tr><td class="h">298</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">299</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L299">50</a></div></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{ALLOWLOGINNAME} = $TWiki::cfg{Register}{AllowLoginName} || 0;</td></tr>
<tr><td class="h">300</td><td colspan="6"></td></tr><tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# locale setup</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Note that &#39;use locale&#39; must be done in BEGIN block for regexes and</td></tr>
<tr><td class="h">305</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# sorting to</td></tr>
<tr><td class="h">306</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# work properly, although regexes can still work without this in</td></tr>
<tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;non-locale regexes&#39; mode.</td></tr>
<tr><td class="h">308</td><td colspan="6"></td></tr><tr><td class="h">309</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L309">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $TWiki::cfg{UseLocale} ) {</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Set environment variables for grep </td></tr>
<tr><td class="h">311</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{LC_CTYPE} = $TWiki::cfg{Site}{Locale};</td></tr>
<tr><td class="h">312</td><td colspan="6"></td></tr><tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Load POSIX for I18N support.</td></tr>
<tr><td class="h">314</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require POSIX;</td></tr>
<tr><td class="h">315</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import POSIX qw( locale_h LC_CTYPE );</td></tr>
<tr><td class="h">316</td><td colspan="6"></td></tr><tr><td class="h">317</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: mod_perl compatibility note: If TWiki is running under Apache,</td></tr>
<tr><td class="h">318</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# won&#39;t this play with the Apache process&#39;s locale settings too?</td></tr>
<tr><td class="h">319</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# What effects would this have?</td></tr>
<tr><td class="h">320</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setlocale(&amp;LC_CTYPE, $TWiki::cfg{Site}{Locale});</td></tr>
<tr><td class="h">321</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">322</td><td colspan="6"></td></tr><tr><td class="h">323</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{CHARSET} = $TWiki::cfg{Site}{CharSet};</td></tr>
<tr><td class="h">324</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{SHORTLANG} = $TWiki::cfg{Site}{Lang};</td></tr>
<tr><td class="h">325</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$constantTags{LANG} = $TWiki::cfg{Site}{FullLang};</td></tr>
<tr><td class="h">326</td><td colspan="6"></td></tr><tr><td class="h">327</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Set up pre-compiled regexes for use in rendering.  All regexes with</td></tr>
<tr><td class="h">328</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# unchanging variables in match should use the &#39;/o&#39; option.</td></tr>
<tr><td class="h">329</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# In the regex hash, all precompiled REs have &quot;Regex&quot; at the</td></tr>
<tr><td class="h">330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# end of the name. Anything else is a string, either intended</td></tr>
<tr><td class="h">331</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# for use as a character class, or as a sub-expression in</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# another compiled RE.</td></tr>
<tr><td class="h">333</td><td colspan="6"></td></tr><tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Build up character class components for use in regexes.</td></tr>
<tr><td class="h">335</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Depends on locale mode and Perl version, and finally on</td></tr>
<tr><td class="h">336</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# whether locale-based regexes are turned off.</td></tr>
<tr><td class="h">337</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L337">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L337">25</a></div></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( not $TWiki::cfg{UseLocale} or $] &lt; 5.006</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or not $TWiki::cfg{Site}{LocaleRegexes} ) {</td></tr>
<tr><td class="h">339</td><td colspan="6"></td></tr><tr><td class="h">340</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# No locales needed/working, or Perl 5.005, so just use</td></tr>
<tr><td class="h">341</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# any additional national characters defined in TWiki.cfg</td></tr>
<tr><td class="h">342</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{upperAlpha} = &#39;A-Z&#39;.$TWiki::cfg{UpperNational};</td></tr>
<tr><td class="h">343</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{lowerAlpha} = &#39;a-z&#39;.$TWiki::cfg{LowerNational};</td></tr>
<tr><td class="h">344</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{numeric}    = &#39;\d&#39;;</td></tr>
<tr><td class="h">345</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{mixedAlpha} = $regex{upperAlpha}.$regex{lowerAlpha};</td></tr>
<tr><td class="h">346</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">347</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Perl 5.006 or higher with working locales</td></tr>
<tr><td class="h">348</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{upperAlpha} = &#39;[:upper:]&#39;;</td></tr>
<tr><td class="h">349</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{lowerAlpha} = &#39;[:lower:]&#39;;</td></tr>
<tr><td class="h">350</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{numeric}    = &#39;[:digit:]&#39;;</td></tr>
<tr><td class="h">351</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$regex{mixedAlpha} = &#39;[:alpha:]&#39;;</td></tr>
<tr><td class="h">352</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">353</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{mixedAlphaNum} = $regex{mixedAlpha}.$regex{numeric};</td></tr>
<tr><td class="h">354</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{lowerAlphaNum} = $regex{lowerAlpha}.$regex{numeric};</td></tr>
<tr><td class="h">355</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{upperAlphaNum} = $regex{upperAlpha}.$regex{numeric};</td></tr>
<tr><td class="h">356</td><td colspan="6"></td></tr><tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Compile regexes for efficiency and ease of use</td></tr>
<tr><td class="h">358</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Note: qr// locks in regex modes (i.e. &#39;-xism&#39; here) - see Friedl</td></tr>
<tr><td class="h">359</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# book at http://regex.info/. </td></tr>
<tr><td class="h">360</td><td colspan="6"></td></tr><tr><td class="h">361</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{linkProtocolPattern} =</td></tr>
<tr><td class="h">362</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{LinkProtocolPattern};</td></tr>
<tr><td class="h">363</td><td colspan="6"></td></tr><tr><td class="h">364</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Header patterns based on &#39;+++&#39;. The &#39;###&#39; are reserved for numbered</td></tr>
<tr><td class="h">365</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# headers</td></tr>
<tr><td class="h">366</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;---++ Header&#39;, &#39;---## Header&#39;</td></tr>
<tr><td class="h">367</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{headerPatternDa} = qr/^---+(\++|\#+)(.*)$/m;</td></tr>
<tr><td class="h">368</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;&lt;h6&gt;Header&lt;/h6&gt;</td></tr>
<tr><td class="h">369</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{headerPatternHt} = qr/^&lt;h([1-6])&gt;(.+?)&lt;\/h\1&gt;/mi;</td></tr>
<tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;---++!! Header&#39; or &#39;---++ Header %NOTOC% ^top&#39;</td></tr>
<tr><td class="h">371</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{headerPatternNoTOC} = &#39;(\!\!+|%NOTOC%)&#39;;</td></tr>
<tr><td class="h">372</td><td colspan="6"></td></tr><tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TWiki concept regexes</td></tr>
<tr><td class="h">374</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{wikiWordRegex} = qr/[$regex{upperAlpha}]+[$regex{lowerAlphaNum}]+[$regex{upperAlpha}]+[$regex{mixedAlphaNum}]*/o;</td></tr>
<tr><td class="h">375</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{webNameBaseRegex} = qr/[$regex{upperAlpha}]+[$regex{mixedAlphaNum}_]*/o;</td></tr>
<tr><td class="h">376</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{webNameRegex} = qr/$regex{webNameBaseRegex}(?:(?:[\.\/]$regex{webNameBaseRegex})+)*/o;</td></tr>
<tr><td class="h">377</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{defaultWebNameRegex} = qr/_[$regex{mixedAlphaNum}_]+/o;</td></tr>
<tr><td class="h">378</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{anchorRegex} = qr/\#[$regex{mixedAlphaNum}_]+/o;</td></tr>
<tr><td class="h">379</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{abbrevRegex} = qr/[$regex{upperAlpha}]{3,}s?\b/o;</td></tr>
<tr><td class="h">380</td><td colspan="6"></td></tr><tr><td class="h">381</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Simplistic email regex, e.g. for WebNotify processing - no i18n</td></tr>
<tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# characters allowed</td></tr>
<tr><td class="h">383</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{emailAddrRegex} = qr/([A-Za-z0-9\.\+\-\_]+\@[A-Za-z0-9\.\-]+)/;</td></tr>
<tr><td class="h">384</td><td colspan="6"></td></tr><tr><td class="h">385</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Filename regex, for attachments</td></tr>
<tr><td class="h">386</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{filenameRegex} = qr/[$regex{mixedAlphaNum}\.]+/o;</td></tr>
<tr><td class="h">387</td><td colspan="6"></td></tr><tr><td class="h">388</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Multi-character alpha-based regexes</td></tr>
<tr><td class="h">389</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{mixedAlphaNumRegex} = qr/[$regex{mixedAlphaNum}]*/o;</td></tr>
<tr><td class="h">390</td><td colspan="6"></td></tr><tr><td class="h">391</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# %TAG% name</td></tr>
<tr><td class="h">392</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{tagNameRegex} = &#39;[&#39;.$regex{mixedAlpha}.&#39;][&#39;.$regex{mixedAlphaNum}.&#39;_:]*&#39;;</td></tr>
<tr><td class="h">393</td><td colspan="6"></td></tr><tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Set statement in a topic</td></tr>
<tr><td class="h">395</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{bulletRegex} = &#39;^(?:\t|   )+\*&#39;;</td></tr>
<tr><td class="h">396</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{setRegex} = $regex{bulletRegex}.&#39;\s+(Set|Local)\s+&#39;;</td></tr>
<tr><td class="h">397</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{setVarRegex} = $regex{setRegex}.&#39;(&#39;.$regex{tagNameRegex}.&#39;)\s*=\s*(.*)$&#39;;</td></tr>
<tr><td class="h">398</td><td colspan="6"></td></tr><tr><td class="h">399</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Character encoding regexes</td></tr>
<tr><td class="h">400</td><td colspan="6"></td></tr><tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 7-bit ASCII only</td></tr>
<tr><td class="h">402</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{validAsciiStringRegex} = qr/^[\x00-\x7F]+$/o;</td></tr>
<tr><td class="h">403</td><td colspan="6"></td></tr><tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Regex to match only a valid UTF-8 character, taking care to avoid</td></tr>
<tr><td class="h">405</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# security holes due to overlong encodings by excluding the relevant</td></tr>
<tr><td class="h">406</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# gaps in UTF-8 encoding space - see &#39;perldoc perlunicode&#39;, Unicode</td></tr>
<tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Encodings section.  Tested against Markus Kuhn&#39;s UTF-8 test file</td></tr>
<tr><td class="h">408</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# at http://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt.</td></tr>
<tr><td class="h">409</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{validUtf8CharRegex} = qr{</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Single byte - ASCII</td></tr>
<tr><td class="h">411</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\x00-\x7F] </td></tr>
<tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</td></tr>
<tr><td class="h">413</td><td colspan="6"></td></tr><tr><td class="h">414</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 2 bytes</td></tr>
<tr><td class="h">415</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\xC2-\xDF][\x80-\xBF] </td></tr>
<tr><td class="h">416</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</td></tr>
<tr><td class="h">417</td><td colspan="6"></td></tr><tr><td class="h">418</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 3 bytes</td></tr>
<tr><td class="h">419</td><td colspan="6"></td></tr><tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Avoid illegal codepoints - negative lookahead</td></tr>
<tr><td class="h">421</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?!\xEF\xBF[\xBE\xBF])    </td></tr>
<tr><td class="h">422</td><td colspan="6"></td></tr><tr><td class="h">423</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Match valid codepoints</td></tr>
<tr><td class="h">424</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?:</td></tr>
<tr><td class="h">425</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([\xE0][\xA0-\xBF])|</td></tr>
<tr><td class="h">426</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([\xE1-\xEC\xEE-\xEF][\x80-\xBF])|</td></tr>
<tr><td class="h">427</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([\xED][\x80-\x9F])</td></tr>
<tr><td class="h">428</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
<tr><td class="h">429</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\x80-\xBF]</td></tr>
<tr><td class="h">430</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</td></tr>
<tr><td class="h">431</td><td colspan="6"></td></tr><tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 4 bytes </td></tr>
<tr><td class="h">433</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?:</td></tr>
<tr><td class="h">434</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([\xF0][\x90-\xBF])|</td></tr>
<tr><td class="h">435</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([\xF1-\xF3][\x80-\xBF])|</td></tr>
<tr><td class="h">436</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([\xF4][\x80-\x8F])</td></tr>
<tr><td class="h">437</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
<tr><td class="h">438</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\x80-\xBF][\x80-\xBF]</td></tr>
<tr><td class="h">439</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}xo;</td></tr>
<tr><td class="h">440</td><td colspan="6"></td></tr><tr><td class="h">441</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>64</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$regex{validUtf8StringRegex} =</td></tr>
<tr><td class="h">442</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qr/^ (?: $regex{validUtf8CharRegex} )+ $/xo;</td></tr>
<tr><td class="h">443</td><td colspan="6"></td></tr><tr><td class="h">444</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Check for unsafe search regex mode (affects filtering in) - default</td></tr>
<tr><td class="h">445</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# to safe mode</td></tr>
<tr><td class="h">446</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L446">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{ForceUnsafeRegexes} = 0 unless defined $TWiki::cfg{ForceUnsafeRegexes};</td></tr>
<tr><td class="h">447</td><td colspan="6"></td></tr><tr><td class="h">448</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# initialize lib directory early because of later &#39;cd&#39;s</td></tr>
<tr><td class="h">449</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;getTWikiLibDir();</td></tr>
<tr><td class="h">450</td><td colspan="6"></td></tr><tr><td class="h">451</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &quot;shared&quot; between mod_perl instances</td></tr>
<tr><td class="h">452</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$sharedSandbox = new TWiki::Sandbox(</td></tr>
<tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{OS}, $TWiki::cfg{DetailedOS} );</td></tr>
<tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td class="s">};</td></tr>
<tr><td class="h">455</td><td colspan="6"></td></tr><tr><td class="h">456</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L456">1</a></div></td><td><div>14</div><div>3</div><div>11</div></td><td class="s">use TWiki::Access;    # access control</td></tr>
<tr><td class="h">457</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L457">1</a></div></td><td><div>13</div><div>3</div><div>11</div></td><td class="s">use TWiki::Attach;    # file attachments</td></tr>
<tr><td class="h">458</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L458">1</a></div></td><td><div>9</div><div>3</div><div>6</div></td><td class="s">use TWiki::Attrs;     # tag attribute handling</td></tr>
<tr><td class="h">459</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L459">1</a></div></td><td><div>14</div><div>4</div><div>13</div></td><td class="s">use TWiki::Client;    # client session handling</td></tr>
<tr><td class="h">460</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L460">1</a></div></td><td><div>13</div><div>3</div><div>10</div></td><td class="s">use TWiki::Form;      # forms</td></tr>
<tr><td class="h">461</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L461">1</a></div></td><td><div>13</div><div>3</div><div>9</div></td><td class="s">use TWiki::Net;       # SMTP, get URL</td></tr>
<tr><td class="h">462</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L462">1</a></div></td><td><div>10</div><div>4</div><div>8</div></td><td class="s">use TWiki::Plugins;   # plugins handler</td></tr>
<tr><td class="h">463</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L463">1</a></div></td><td><div>7</div><div>3</div><div>8</div></td><td class="s">use TWiki::Prefs;     # preferences</td></tr>
<tr><td class="h">464</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L464">1</a></div></td><td><div>10</div><div>4</div><div>9</div></td><td class="s">use TWiki::Render;    # HTML generation</td></tr>
<tr><td class="h">465</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L465">1</a></div></td><td><div>11</div><div>3</div><div>8</div></td><td class="s">use TWiki::Search;    # search engine</td></tr>
<tr><td class="h">466</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L466">1</a></div></td><td><div>8</div><div>2</div><div>7</div></td><td class="s">use TWiki::Store;     # file I/O and rcs related functions</td></tr>
<tr><td class="h">467</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L467">1</a></div></td><td><div>17</div><div>3</div><div>9</div></td><td class="s">use TWiki::Templates; # TWiki template language</td></tr>
<tr><td class="h">468</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L468">1</a></div></td><td><div>7</div><div>3</div><div>6</div></td><td class="s">use TWiki::Time;      # date/time conversions</td></tr>
<tr><td class="h">469</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L469">1</a></div></td><td><div>14</div><div>3</div><div>8</div></td><td class="s">use TWiki::Users;     # user handler</td></tr>
<tr><td class="h">470</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L470">1</a></div></td><td><div>9</div><div>4</div><div>9</div></td><td class="s">use TWiki::I18N;      # i18n handler</td></tr>
<tr><td class="h">471</td><td colspan="6"></td></tr><tr><td class="h">472 - 479</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod UTF82SiteCharSet( $utf8 ) -&gt; $ascii

Auto-detect UTF-8 vs. site charset in string, and convert UTF-8 into site
charset.

=cut</pre></td></tr>
<tr><td class="h">480</td><td colspan="6"></td></tr><tr><td class="h">481</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub UTF82SiteCharSet {</td></tr>
<tr><td class="h">482</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L482">2</a></div></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text ) = @_;</td></tr>
<tr><td class="h">483</td><td colspan="6"></td></tr><tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Detect character encoding of the full topic name from URL</td></tr>
<tr><td class="h">485</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L485">50</a></div></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if( $text =~ $regex{validAsciiStringRegex} );</td></tr>
<tr><td class="h">486</td><td colspan="6"></td></tr><tr><td class="h">487</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If not UTF-8 - assume in site character set, no conversion required</td></tr>
<tr><td class="h">488</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L488">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless( $text =~ $regex{validUtf8StringRegex} );</td></tr>
<tr><td class="h">489</td><td colspan="6"></td></tr><tr><td class="h">490</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If site charset is already UTF-8, there is no need to convert anything:</td></tr>
<tr><td class="h">491</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L491">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $TWiki::cfg{Site}{CharSet} =~ /^utf-?8$/i ) {</td></tr>
<tr><td class="h">492</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# warn if using Perl older than 5.8</td></tr>
<tr><td class="h">493</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L493">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $] &lt;  5.008 ) {</td></tr>
<tr><td class="h">494</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;writeWarning( &#39;UTF-8 not supported on Perl &#39;.$].</td></tr>
<tr><td class="h">495</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39; - use Perl 5.8 or higher..&#39; );</td></tr>
<tr><td class="h">496</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">497</td><td colspan="6"></td></tr><tr><td class="h">498</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: is this true yet?</td></tr>
<tr><td class="h">499</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;writeWarning( &#39;UTF-8 not yet supported as site charset -&#39;.</td></tr>
<tr><td class="h">500</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;TWiki is likely to have problems&#39; );</td></tr>
<tr><td class="h">501</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">502</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">503</td><td colspan="6"></td></tr><tr><td class="h">504</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Convert into ISO-8859-1 if it is the site charset</td></tr>
<tr><td class="h">505</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L505">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $TWiki::cfg{Site}{CharSet} =~ /^iso-?8859-?15?$/i ) {</td></tr>
<tr><td class="h">506</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ISO-8859-1 maps onto first 256 codepoints of Unicode</td></tr>
<tr><td class="h">507</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (conversion from &#39;perldoc perluniintro&#39;)</td></tr>
<tr><td class="h">508</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/ ([\xC2\xC3]) ([\x80-\xBF]) / </td></tr>
<tr><td class="h">509</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chr( ord($1) &lt;&lt; 6 &amp; 0xC0 | ord($2) &amp; 0x3F )</td></tr>
<tr><td class="h">510</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/egx;</td></tr>
<tr><td class="h">511</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">512</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Convert from UTF-8 into some other site charset</td></tr>
<tr><td class="h">513</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L513">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $] &gt;= 5.008 ) {</td></tr>
<tr><td class="h">514</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require Encode;</td></tr>
<tr><td class="h">515</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import Encode qw(:fallbacks);</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Map $TWiki::cfg{Site}{CharSet} into real encoding name</td></tr>
<tr><td class="h">517</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $charEncoding =</td></tr>
<tr><td class="h">518</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Encode::resolve_alias( $TWiki::cfg{Site}{CharSet} );</td></tr>
<tr><td class="h">519</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L519">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( not $charEncoding ) {</td></tr>
<tr><td class="h">520</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;writeWarning</td></tr>
<tr><td class="h">521</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &#39;Conversion to &quot;&#39;.$TWiki::cfg{Site}{CharSet}.</td></tr>
<tr><td class="h">522</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&quot; not supported, or name not recognised - check &#39;.</td></tr>
<tr><td class="h">523</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&quot;perldoc Encode::Supported&quot;&#39; );</td></tr>
<tr><td class="h">524</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">525</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Convert text using Encode:</td></tr>
<tr><td class="h">526</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# - first, convert from UTF8 bytes into internal</td></tr>
<tr><td class="h">527</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (UTF-8) characters</td></tr>
<tr><td class="h">528</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = Encode::decode(&#39;utf8&#39;, $text);    </td></tr>
<tr><td class="h">529</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# - then convert into site charset from internal UTF-8,</td></tr>
<tr><td class="h">530</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# inserting \x{NNNN} for characters that can&#39;t be converted</td></tr>
<tr><td class="h">531</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =</td></tr>
<tr><td class="h">532</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Encode::encode( $charEncoding, $text,</td></tr>
<tr><td class="h">533</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;FB_PERLQQ() );</td></tr>
<tr><td class="h">534</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">535</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">536</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require Unicode::MapUTF8;    # Pre-5.8 Perl versions</td></tr>
<tr><td class="h">537</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $charEncoding = $TWiki::cfg{Site}{CharSet};</td></tr>
<tr><td class="h">538</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L538">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( not Unicode::MapUTF8::utf8_supported_charset($charEncoding) ) {</td></tr>
<tr><td class="h">539</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;writeWarning</td></tr>
<tr><td class="h">540</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &#39;Conversion to &quot;&#39;.$TWiki::cfg{Site}{CharSet}.</td></tr>
<tr><td class="h">541</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&quot; not supported, or name not recognised - check &#39;.</td></tr>
<tr><td class="h">542</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&quot;perldoc Unicode::MapUTF8&quot;&#39; );</td></tr>
<tr><td class="h">543</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">544</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Convert text</td></tr>
<tr><td class="h">545</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =</td></tr>
<tr><td class="h">546</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unicode::MapUTF8::from_utf8({</td></tr>
<tr><td class="h">547</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-string =&gt; $text,</td></tr>
<tr><td class="h">548</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-charset =&gt; $charEncoding</td></tr>
<tr><td class="h">549</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">550</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: Check for failed conversion?</td></tr>
<tr><td class="h">551</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">552</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">553</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">554</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">556</td><td colspan="6"></td></tr><tr><td class="h">557 - 571</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod writeCompletePage( $text, $pageType, $contentType )

Write a complete HTML page with basic header to the browser.
   * =$text= is the text of the page body (&amp;lt;html&amp;gt; to &amp;lt;/html&amp;gt; if it&#39;s HTML)
   * =$pageType= - May be &quot;edit&quot;, which will cause headers to be generated that force
     caching for 24 hours, to prevent Codev.BackFromPreviewLosesText bug, which caused
     data loss with IE5 and IE6.
   * =$contentType= - page content type | text/html

This method removes noautolink and nop tags before outputting the page unless
$contentType is text/plain.

=cut</pre></td></tr>
<tr><td class="h">572</td><td colspan="6"></td></tr><tr><td class="h">573</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub writeCompletePage {</td></tr>
<tr><td class="h">574</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L574">1</a></div></td><td><div>150</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $text, $pageType, $contentType ) = @_;</td></tr>
<tr><td class="h">575</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L575">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$contentType ||= &#39;text/html&#39;;</td></tr>
<tr><td class="h">576</td><td colspan="6"></td></tr><tr><td class="h">577</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L577">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $contentType ne &#39;text/plain&#39; ) {</td></tr>
<tr><td class="h">578</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Remove &lt;nop&gt; and &lt;noautolink&gt; tags</td></tr>
<tr><td class="h">579</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>49612</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/([\t ]?)[ \t]*&lt;\/?(nop|noautolink)\/?&gt;/$1/gis;</td></tr>
<tr><td class="h">580</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L580">50</a></div></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text .= &quot;\n&quot; unless $text =~ /\n$/s;</td></tr>
<tr><td class="h">581</td><td colspan="6"></td></tr><tr><td class="h">582</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $htmlHeader = join(</td></tr>
<tr><td class="h">583</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;\n&quot;,</td></tr>
<tr><td class="h">584</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { &#39;&lt;!--&#39;.$_.&#39;--&gt;&#39;.$this-&gt;{htmlHeaders}{$_} }</td></tr>
<tr><td class="h">585</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys %{$this-&gt;{htmlHeaders}} );</td></tr>
<tr><td class="h">586</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L586">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s!(&lt;/head&gt;)!$htmlHeader$1!i if $htmlHeader;</td></tr>
<tr><td class="h">587</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chomp($text);</td></tr>
<tr><td class="h">588</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">589</td><td colspan="6"></td></tr><tr><td class="h">590</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L590">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;inContext(&#39;command_line&#39;)) {</td></tr>
<tr><td class="h">591</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# can&#39;t use simple length() in case we have UNICODE</td></tr>
<tr><td class="h">592</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# see perldoc -f length</td></tr>
<tr><td class="h">593</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L593">1</a></div></td><td><div>239</div><div>3</div><div>6</div><div>3</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $len = do { use bytes; length( $text ); };</td></tr>
<tr><td class="h">594</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;writePageHeader( undef, $pageType, $contentType, $len );</td></tr>
<tr><td class="h">595</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">596</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>843</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print $text;</td></tr>
<tr><td class="h">597</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">598</td><td colspan="6"></td></tr><tr><td class="h">599 - 615</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod writePageHeader( $query, $pageType, $contentType, $contentLength )

All parameters are optional.

   * =$query= CGI query object | Session CGI query (there is no good reason to set this)
   * =$pageType= - May be &quot;edit&quot;, which will cause headers to be generated that force caching for 24 hours, to prevent Codev.BackFromPreviewLosesText bug, which caused data loss with IE5 and IE6.
   * =$contentType= - page content type | text/html
   * =$contentLength= - content-length | no content-length will be set if this is undefined, as required by HTTP1.1

Implements the post-Dec2001 release plugin API, which requires the
writeHeaderHandler in plugin to return a string of HTTP headers, CR/LF
delimited. Filters any illegal headers. Plugin headers will override
core settings.

=cut</pre></td></tr>
<tr><td class="h">616</td><td colspan="6"></td></tr><tr><td class="h">617</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub writePageHeader {</td></tr>
<tr><td class="h">618</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L618">1</a></div></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $query, $pageType, $contentType, $contentLength ) = @_;</td></tr>
<tr><td class="h">619</td><td colspan="6"></td></tr><tr><td class="h">620</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">621</td><td colspan="6"></td></tr><tr><td class="h">622</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L622">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$query = $this-&gt;{cgiQuery} unless $query;</td></tr>
<tr><td class="h">623</td><td colspan="6"></td></tr><tr><td class="h">624</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Handle Edit pages - future versions will extend to caching</td></tr>
<tr><td class="h">625</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# of other types of page, with expiry time driven by page type.</td></tr>
<tr><td class="h">626</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $pluginHeaders, $coreHeaders );</td></tr>
<tr><td class="h">627</td><td colspan="6"></td></tr><tr><td class="h">628</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $hopts = {};</td></tr>
<tr><td class="h">629</td><td colspan="6"></td></tr><tr><td class="h">630</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Add a content-length if one has been provided. HTTP1.1 says a</td></tr>
<tr><td class="h">631</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# content-length should _not_ be specified unless the length is</td></tr>
<tr><td class="h">632</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# known. There is a bug in Netscape such that it interprets a</td></tr>
<tr><td class="h">633</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 0 content-length as &quot;download until disconnect&quot; but that is</td></tr>
<tr><td class="h">634</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# a bug. The correct way is to not set a content-length.</td></tr>
<tr><td class="h">635</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L635">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{&#39;Content-Length&#39;} = $contentLength if $contentLength;</td></tr>
<tr><td class="h">636</td><td colspan="6"></td></tr><tr><td class="h">637</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L637">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L637">33</a></div></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($pageType &amp;&amp; $pageType eq &#39;edit&#39;) {</td></tr>
<tr><td class="h">638</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Get time now in HTTP header format</td></tr>
<tr><td class="h">639</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $lastModifiedString =</td></tr>
<tr><td class="h">640</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Time::formatTime(time, &#39;$http&#39;, &#39;gmtime&#39;);</td></tr>
<tr><td class="h">641</td><td colspan="6"></td></tr><tr><td class="h">642</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Expiry time is set high to avoid any data loss.  Each instance of </td></tr>
<tr><td class="h">643</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Edit page has a unique URL with time-string suffix (fix for </td></tr>
<tr><td class="h">644</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# RefreshEditPage), so this long expiry time simply means that the </td></tr>
<tr><td class="h">645</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# browser Back button always works.  The next Edit on this page </td></tr>
<tr><td class="h">646</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# will use another URL and therefore won&#39;t use any cached </td></tr>
<tr><td class="h">647</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# version of this Edit page.</td></tr>
<tr><td class="h">648</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $expireHours = 24;</td></tr>
<tr><td class="h">649</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $expireSeconds = $expireHours * 60 * 60;</td></tr>
<tr><td class="h">650</td><td colspan="6"></td></tr><tr><td class="h">651</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# and cache control headers, to ensure edit page </td></tr>
<tr><td class="h">652</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is cached until required expiry time.</td></tr>
<tr><td class="h">653</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{&#39;last-modified&#39;} = $lastModifiedString;</td></tr>
<tr><td class="h">654</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{expires} = &quot;+${expireHours}h&quot;;</td></tr>
<tr><td class="h">655</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{&#39;cache-control&#39;} = &quot;max-age=$expireSeconds&quot;;</td></tr>
<tr><td class="h">656</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">657</td><td colspan="6"></td></tr><tr><td class="h">658</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# DEPRECATED plugins header handler. Plugins should use</td></tr>
<tr><td class="h">659</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# modifyHeaderHandler instead.</td></tr>
<tr><td class="h">660</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L660">50</a></div></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pluginHeaders = $this-&gt;{plugins}-&gt;writeHeaderHandler( $query ) || &#39;&#39;;</td></tr>
<tr><td class="h">661</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L661">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $pluginHeaders ) {</td></tr>
<tr><td class="h">662</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ( split /\r\n/, $pluginHeaders ) {</td></tr>
<tr><td class="h">663</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L663">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( m/^([\-a-z]+): (.*)$/i ) {</td></tr>
<tr><td class="h">664</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{$1} = $2;</td></tr>
<tr><td class="h">665</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">666</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">667</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">668</td><td colspan="6"></td></tr><tr><td class="h">669</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L669">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$contentType = &#39;text/html&#39; unless $contentType;</td></tr>
<tr><td class="h">670</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L670">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if(defined($TWiki::cfg{Site}{CharSet})) {</td></tr>
<tr><td class="h">671</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$contentType .= &#39;; charset=&#39;.$TWiki::cfg{Site}{CharSet};</td></tr>
<tr><td class="h">672</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">673</td><td colspan="6"></td></tr><tr><td class="h">674</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# use our version of the content type</td></tr>
<tr><td class="h">675</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{&#39;Content-Type&#39;} = $contentType;</td></tr>
<tr><td class="h">676</td><td colspan="6"></td></tr><tr><td class="h">677</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# New (since 1.026)</td></tr>
<tr><td class="h">678</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;modifyHeaderHandler( $hopts, $this-&gt;{cgiQuery} );</td></tr>
<tr><td class="h">679</td><td colspan="6"></td></tr><tr><td class="h">680</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# add cookie(s)</td></tr>
<tr><td class="h">681</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{loginManager}-&gt;modifyHeader( $hopts );</td></tr>
<tr><td class="h">682</td><td colspan="6"></td></tr><tr><td class="h">683</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $hdr = CGI::header( $hopts );</td></tr>
<tr><td class="h">684</td><td colspan="6"></td></tr><tr><td class="h">685</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print $hdr;</td></tr>
<tr><td class="h">686</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">687</td><td colspan="6"></td></tr><tr><td class="h">688 - 707</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod redirect( $url, $passthrough )

Redirects the request to =$url=, *unless*
   1 It is overridden by a plugin declaring a =redirectCgiQueryHandler=.
   1 =$session-&gt;{cgiQuery}= is =undef= or
   1 $query-&gt;param(&#39;noredirect&#39;) is set to a true value.
Thus a redirect is only generated when in a CGI context.

Normally this method will ignore parameters to the current query.
If $passthrough is set, then it will pass all parameters that were passed
to the current query on to the redirect target. If the request_method was
GET, then all parameters can be passed in the URL. If the
request_method was POST then it caches the form data and passes over a
cache reference in the redirect GET.

Passthrough is only meaningful if the redirect target is on the same server.

=cut</pre></td></tr>
<tr><td class="h">708</td><td colspan="6"></td></tr><tr><td class="h">709</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub redirect {</td></tr>
<tr><td class="h">710</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L710">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $url, $passthru ) = @_;</td></tr>
<tr><td class="h">711</td><td colspan="6"></td></tr><tr><td class="h">712</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">713</td><td colspan="6"></td></tr><tr><td class="h">714</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $query = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">715</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if we got here without a query, there&#39;s not much more we can do</td></tr>
<tr><td class="h">716</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L716">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $query;</td></tr>
<tr><td class="h">717</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if noredirect is set, don&#39;t generate the redirect, throw an exception instead.</td></tr>
<tr><td class="h">718</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# This is a HACK used to support TWikiDrawPlugin. It is deprecated and must be</td></tr>
<tr><td class="h">719</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# replaced by REST handlers in the plugin.</td></tr>
<tr><td class="h">720</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L720">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $query-&gt;param( &#39;noredirect&#39; )) {</td></tr>
<tr><td class="h">721</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;ERROR: $url&quot;;</td></tr>
<tr><td class="h">722</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">723</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">724</td><td colspan="6"></td></tr><tr><td class="h">725</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L725">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($passthru) {</td></tr>
<tr><td class="h">726</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $existing = &#39;&#39;;</td></tr>
<tr><td class="h">727</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L727">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($url =~ s/\?(.*)$//) {</td></tr>
<tr><td class="h">728</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$existing = $1;</td></tr>
<tr><td class="h">729</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">730</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L730">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($ENV{REQUEST_METHOD} eq &#39;POST&#39;) {</td></tr>
<tr><td class="h">731</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Redirecting from a port to a get</td></tr>
<tr><td class="h">732</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cache = $this-&gt;cacheQuery();</td></tr>
<tr><td class="h">733</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L733">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($cache) {</td></tr>
<tr><td class="h">734</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &quot;?$cache&quot;;</td></tr>
<tr><td class="h">735</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">736</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">737</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L737">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($query-&gt;query_string()) {</td></tr>
<tr><td class="h">738</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &#39;?&#39;.$query-&gt;query_string();</td></tr>
<tr><td class="h">739</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">740</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L740">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($existing) {</td></tr>
<tr><td class="h">741</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L741">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($url =~ /\?/) {</td></tr>
<tr><td class="h">742</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &#39;;&#39;;</td></tr>
<tr><td class="h">743</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">744</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &#39;?&#39;;</td></tr>
<tr><td class="h">745</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">746</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= $existing;</td></tr>
<tr><td class="h">747</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">748</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">749</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">750</td><td colspan="6"></td></tr><tr><td class="h">751</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L751">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if( $this-&gt;{plugins}-&gt;redirectCgiQueryHandler( $query, $url ) );</td></tr>
<tr><td class="h">752</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L752">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if( $this-&gt;{loginManager}-&gt;redirectCgiQuery( $query, $url ) );</td></tr>
<tr><td class="h">753</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Login manager returned 0 from redirectCgiQuery&quot;;</td></tr>
<tr><td class="h">754</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">755</td><td colspan="6"></td></tr><tr><td class="h">756 - 768</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod cacheQuery() -&gt; $queryString

Caches the current query in the params cache, and returns a rewritten
query string for the cache to be picked up again on the other side of a
redirect.

We can&#39;t encode post params into a redirect, because they may exceed the
size of the GET request. So we cache the params, and reload them when the
redirect target is reached.

=cut</pre></td></tr>
<tr><td class="h">769</td><td colspan="6"></td></tr><tr><td class="h">770</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub cacheQuery {</td></tr>
<tr><td class="h">771</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L771">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">772</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $query = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">773</td><td colspan="6"></td></tr><tr><td class="h">774</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L774">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless (scalar($query-&gt;param()));</td></tr>
<tr><td class="h">775</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Don&#39;t double-cache</td></tr>
<tr><td class="h">776</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L776">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if ($query-&gt;param(&#39;twiki_redirect_cache&#39;));</td></tr>
<tr><td class="h">777</td><td colspan="6"></td></tr><tr><td class="h">778</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;require Digest::MD5;</td></tr>
<tr><td class="h">779</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $md5 = new Digest::MD5();</td></tr>
<tr><td class="h">780</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$md5-&gt;add($$, time(), rand(time));</td></tr>
<tr><td class="h">781</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $uid = $md5-&gt;hexdigest();</td></tr>
<tr><td class="h">782</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $passthruFilename = $TWiki::cfg{TempfileDir} . &#39;/passthru_&#39; . $uid;</td></tr>
<tr><td class="h">783</td><td colspan="6"></td></tr><tr><td class="h">784</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L784">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ( -d $TWiki::cfg{TempfileDir} ) {</td></tr>
<tr><td class="h">785</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L785">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( mkdir($TWiki::cfg{TempfileDir}) ) {</td></tr>
<tr><td class="h">786</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Could not create $TWiki::cfg{TempfileDir} for passthrough files&quot;;</td></tr>
<tr><td class="h">787</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">788</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">789</td><td colspan="6"></td></tr><tr><td class="h">790</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L790">1</a></div></td><td><div>7</div><div>2</div><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;use Fcntl;</td></tr>
<tr><td class="h">791</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#passthrough file is only written to once, so if it already exists, suspect a security hack (O_EXCL)</td></tr>
<tr><td class="h">792</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L792">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;open(F, &quot;&gt;$passthruFilename&quot;, O_RDWR|O_EXCL|O_CREAT, 0644) || die &quot;{TempfileDir} cache not writable $!&quot;;</td></tr>
<tr><td class="h">793</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;save(\*F);</td></tr>
<tr><td class="h">794</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;close(F);</td></tr>
<tr><td class="h">795</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;twiki_redirect_cache=&#39;.$uid;</td></tr>
<tr><td class="h">796</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">797</td><td colspan="6"></td></tr><tr><td class="h">798 - 804</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod isValidWikiWord( $name ) -&gt; $boolean

Check for a valid WikiWord or WikiName

=cut</pre></td></tr>
<tr><td class="h">805</td><td colspan="6"></td></tr><tr><td class="h">806</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isValidWikiWord {</td></tr>
<tr><td class="h">807</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L807">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L807">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name  = shift || &#39;&#39;;</td></tr>
<tr><td class="h">808</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $name =~ m/^$regex{wikiWordRegex}$/o )</td></tr>
<tr><td class="h">809</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">810</td><td colspan="6"></td></tr><tr><td class="h">811 - 817</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod isValidTopicName( $name ) -&gt; $boolean

Check for a valid topic name

=cut</pre></td></tr>
<tr><td class="h">818</td><td colspan="6"></td></tr><tr><td class="h">819</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isValidTopicName {</td></tr>
<tr><td class="h">820</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L820">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $name ) = @_;</td></tr>
<tr><td class="h">821</td><td colspan="6"></td></tr><tr><td class="h">822</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L822">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return isValidWikiWord( @_ ) || isValidAbbrev( @_ );</td></tr>
<tr><td class="h">823</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">824</td><td colspan="6"></td></tr><tr><td class="h">825 - 831</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod isValidAbbrev( $name ) -&gt; $boolean

Check for a valid ABBREV (acronym)

=cut</pre></td></tr>
<tr><td class="h">832</td><td colspan="6"></td></tr><tr><td class="h">833</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isValidAbbrev {</td></tr>
<tr><td class="h">834</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L834">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L834">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = shift || &#39;&#39;;</td></tr>
<tr><td class="h">835</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $name =~ m/^$regex{abbrevRegex}$/o )</td></tr>
<tr><td class="h">836</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">837</td><td colspan="6"></td></tr><tr><td class="h">838 - 846</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod isValidWebName( $name, $system ) -&gt; $boolean

STATIC Check for a valid web name. If $system is true, then
system web names are considered valid (names starting with _)
otherwise only user web names are valid

=cut</pre></td></tr>
<tr><td class="h">847</td><td colspan="6"></td></tr><tr><td class="h">848</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isValidWebName {</td></tr>
<tr><td class="h">849</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L849">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L849">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = shift || &#39;&#39;;</td></tr>
<tr><td class="h">850</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sys = shift;</td></tr>
<tr><td class="h">851</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L851">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L851">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if ( $sys &amp;&amp; $name =~ m/^$regex{defaultWebNameRegex}$/o );</td></tr>
<tr><td class="h">852</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $name =~ m/^$regex{webNameRegex}$/o )</td></tr>
<tr><td class="h">853</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">854</td><td colspan="6"></td></tr><tr><td class="h">855 - 864</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod readOnlyMirrorWeb( $theWeb ) -&gt; ( $mirrorSiteName, $mirrorViewURL, $mirrorLink, $mirrorNote )

If this is a mirrored web, return information about the mirror. The info
is returned in a quadruple:

| site name | URL | link | note |

=cut</pre></td></tr>
<tr><td class="h">865</td><td colspan="6"></td></tr><tr><td class="h">866</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub readOnlyMirrorWeb {</td></tr>
<tr><td class="h">867</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L867">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $theWeb ) = @_;</td></tr>
<tr><td class="h">868</td><td colspan="6"></td></tr><tr><td class="h">869</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">870</td><td colspan="6"></td></tr><tr><td class="h">871</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @mirrorInfo = ( &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39; );</td></tr>
<tr><td class="h">872</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L872">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{SiteWebTopicName} ) {</td></tr>
<tr><td class="h">873</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mirrorSiteName =</td></tr>
<tr><td class="h">874</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs}-&gt;getWebPreferencesValue( &#39;MIRRORSITENAME&#39;, $theWeb );</td></tr>
<tr><td class="h">875</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L875">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L875">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $mirrorSiteName &amp;&amp; $mirrorSiteName ne $TWiki::cfg{SiteWebTopicName} ) {</td></tr>
<tr><td class="h">876</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mirrorViewURL  =</td></tr>
<tr><td class="h">877</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs}-&gt;getWebPreferencesValue( &#39;MIRRORVIEWURL&#39;, $theWeb );</td></tr>
<tr><td class="h">878</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mirrorLink = $this-&gt;{templates}-&gt;readTemplate( &#39;mirrorlink&#39; );</td></tr>
<tr><td class="h">879</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorLink =~ s/%MIRRORSITENAME%/$mirrorSiteName/g;</td></tr>
<tr><td class="h">880</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorLink =~ s/%MIRRORVIEWURL%/$mirrorViewURL/g;</td></tr>
<tr><td class="h">881</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorLink =~ s/\s*$//g;</td></tr>
<tr><td class="h">882</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mirrorNote = $this-&gt;{templates}-&gt;readTemplate( &#39;mirrornote&#39; );</td></tr>
<tr><td class="h">883</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorNote =~ s/%MIRRORSITENAME%/$mirrorSiteName/g;</td></tr>
<tr><td class="h">884</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorNote =~ s/%MIRRORVIEWURL%/$mirrorViewURL/g;</td></tr>
<tr><td class="h">885</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorNote = $this-&gt;{renderer}-&gt;getRenderedVersion</td></tr>
<tr><td class="h">886</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $mirrorNote, $theWeb, $TWiki::cfg{HomeTopic} );</td></tr>
<tr><td class="h">887</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mirrorNote =~ s/\s*$//g;</td></tr>
<tr><td class="h">888</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@mirrorInfo = ( $mirrorSiteName, $mirrorViewURL, $mirrorLink, $mirrorNote );</td></tr>
<tr><td class="h">889</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">890</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">891</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @mirrorInfo;</td></tr>
<tr><td class="h">892</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">893</td><td colspan="6"></td></tr><tr><td class="h">894 - 900</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getSkin () -&gt; $string

Get the currently requested skin path

=cut</pre></td></tr>
<tr><td class="h">901</td><td colspan="6"></td></tr><tr><td class="h">902</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getSkin {</td></tr>
<tr><td class="h">903</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L903">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">904</td><td colspan="6"></td></tr><tr><td class="h">905</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">906</td><td colspan="6"></td></tr><tr><td class="h">907</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L907">50</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $skinpath = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;SKIN&#39; ) || &#39;&#39;;</td></tr>
<tr><td class="h">908</td><td colspan="6"></td></tr><tr><td class="h">909</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L909">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{cgiQuery} ) {</td></tr>
<tr><td class="h">910</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $resurface = $this-&gt;{cgiQuery}-&gt;param( &#39;skin&#39; );</td></tr>
<tr><td class="h">911</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L911">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$skinpath = $resurface if $resurface;</td></tr>
<tr><td class="h">912</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">913</td><td colspan="6"></td></tr><tr><td class="h">914</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $epidermis = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;COVER&#39; );</td></tr>
<tr><td class="h">915</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L915">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$skinpath = $epidermis.&#39;,&#39;.$skinpath if $epidermis;</td></tr>
<tr><td class="h">916</td><td colspan="6"></td></tr><tr><td class="h">917</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L917">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{cgiQuery} ) {</td></tr>
<tr><td class="h">918</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$epidermis = $this-&gt;{cgiQuery}-&gt;param( &#39;cover&#39; );</td></tr>
<tr><td class="h">919</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L919">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$skinpath = $epidermis.&#39;,&#39;.$skinpath if $epidermis;</td></tr>
<tr><td class="h">920</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">921</td><td colspan="6"></td></tr><tr><td class="h">922</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $skinpath;</td></tr>
<tr><td class="h">923</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">924</td><td colspan="6"></td></tr><tr><td class="h">925 - 948</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getScriptUrl( $absolute, $script, $web, $topic, ... ) -&gt; $scriptURL

Returns the URL to a TWiki script, providing the web and topic as
&quot;path info&quot; parameters.  The result looks something like this:
&quot;http://host/twiki/bin/$script/$web/$topic&quot;.
   * =...= - an arbitrary number of name,value parameter pairs that will be url-encoded and added to the url. The special parameter name &#39;#&#39; is reserved for specifying an anchor. e.g. &lt;tt&gt;getScriptUrl(&#39;x&#39;,&#39;y&#39;,&#39;view&#39;,&#39;#&#39;=&gt;&#39;XXX&#39;,a=&gt;1,b=&gt;2)&lt;/tt&gt; will give &lt;tt&gt;.../view/x/y?a=1&amp;b=2#XXX&lt;/tt&gt;

If $absolute is set, generates an absolute URL. $absolute is advisory only;
TWiki can decide to generate absolute URLs (for example when run from the
command-line) even when relative URLs have been requested.

The default script url is taken from {ScriptUrlPath}, unless there is
an exception defined for the given script in {ScriptUrlPaths}. Both
{ScriptUrlPath} and {ScriptUrlPaths} may be absolute or relative URIs. If
they are absolute, then they will always generate absolute URLs. if they
are relative, then they will be converted to absolute when required (e.g.
when running from the command line, or when generating rss). If
$script is not given, absolute URLs will always be generated.

If either the web or the topic is defined, will generate a full url (including web and topic). Otherwise will generate only up to the script name. An undefined web will default to the main web name.

=cut</pre></td></tr>
<tr><td class="h">949</td><td colspan="6"></td></tr><tr><td class="h">950</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getScriptUrl {</td></tr>
<tr><td class="h">951</td><td><div class="c3">69</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L951">69</a></div></td><td><div>327</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $absolute, $script, $web, $topic, @params ) = @_;</td></tr>
<tr><td class="h">952</td><td colspan="6"></td></tr><tr><td class="h">953</td><td><div class="c3">69</div></td><td></td><td></td><td></td><td><div>166</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">954</td><td><div class="c3">69</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L954">25</a></div></td><td></td><td><div>429</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$absolute ||= ($this-&gt;inContext( &#39;command_line&#39; ) ||</td></tr>
<tr><td class="h">955</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;inContext( &#39;rss&#39; ) ||</td></tr>
<tr><td class="h">956</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;inContext( &#39;absolute_urls&#39; ));</td></tr>
<tr><td class="h">957</td><td colspan="6"></td></tr><tr><td class="h">958</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: topics and webs that contain spaces?</td></tr>
<tr><td class="h">959</td><td colspan="6"></td></tr><tr><td class="h">960</td><td><div class="c3">69</div></td><td></td><td></td><td></td><td><div>186</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url;</td></tr>
<tr><td class="h">961</td><td><div class="c3">69</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L961">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L961">33</a></div></td><td></td><td><div>452</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( defined $TWiki::cfg{ScriptUrlPaths} &amp;&amp; $script) {</td></tr>
<tr><td class="h">962</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $TWiki::cfg{ScriptUrlPaths}{$script};</td></tr>
<tr><td class="h">963</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">964</td><td><div class="c3">69</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L964">50</a></div></td><td></td><td></td><td><div>314</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( defined( $url )) {</td></tr>
<tr><td class="h">965</td><td><div class="c3">69</div></td><td></td><td></td><td></td><td><div>240</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $TWiki::cfg{ScriptUrlPath};</td></tr>
<tr><td class="h">966</td><td><div class="c3">69</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L966">100</a></div></td><td></td><td></td><td><div>312</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $script ) {</td></tr>
<tr><td class="h">967</td><td><div class="c3">68</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L967">50</a></div></td><td></td><td></td><td><div>365</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &#39;/&#39; unless $url =~ /\/$/;</td></tr>
<tr><td class="h">968</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>190</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= $script;</td></tr>
<tr><td class="h">969</td><td><div class="c3">68</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L969">50</a></div></td><td></td><td></td><td><div>371</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= $TWiki::cfg{ScriptSuffix} if $script;</td></tr>
<tr><td class="h">970</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">971</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">972</td><td colspan="6"></td></tr><tr><td class="h">973</td><td><div class="c3">69</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L973">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L973">67</a></div></td><td></td><td><div>458</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $absolute &amp;&amp; $url !~ /^[a-z]+:/ ) {</td></tr>
<tr><td class="h">974</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# See http://www.ietf.org/rfc/rfc2396.txt for the definition of</td></tr>
<tr><td class="h">975</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &quot;absolute URI&quot;. TWiki bastardises this definition by assuming</td></tr>
<tr><td class="h">976</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# that all relative URLs lack the &lt;authority&gt; component as well.</td></tr>
<tr><td class="h">977</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $this-&gt;{urlHost}.$url;</td></tr>
<tr><td class="h">978</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">979</td><td colspan="6"></td></tr><tr><td class="h">980</td><td><div class="c3">69</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L980">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L980">67</a></div></td><td></td><td><div>495</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $web || $topic ) {</td></tr>
<tr><td class="h">981</td><td><div class="c3">43</div></td><td></td><td></td><td></td><td><div>180</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $web, $topic ) =</td></tr>
<tr><td class="h">982</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;normalizeWebTopicName( $web, $topic );</td></tr>
<tr><td class="h">983</td><td colspan="6"></td></tr><tr><td class="h">984</td><td><div class="c3">43</div></td><td></td><td></td><td></td><td><div>234</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= urlEncode( &#39;/&#39;.$web.&#39;/&#39;.$topic );</td></tr>
<tr><td class="h">985</td><td colspan="6"></td></tr><tr><td class="h">986</td><td><div class="c3">43</div></td><td></td><td></td><td></td><td><div>174</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= _make_params(0, @params);</td></tr>
<tr><td class="h">987</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">988</td><td colspan="6"></td></tr><tr><td class="h">989</td><td><div class="c3">69</div></td><td></td><td></td><td></td><td><div>359</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url;</td></tr>
<tr><td class="h">990</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">991</td><td colspan="6"></td></tr><tr><td class="h">992</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _make_params {</td></tr>
<tr><td class="h">993</td><td><div class="c3">68</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L993">68</a></div></td><td><div>262</div></td><td class="s">&nbsp;&nbsp;my ( $notfirst, @args ) = @_;</td></tr>
<tr><td class="h">994</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>195</div></td><td class="s">&nbsp;&nbsp;my $url = &#39;&#39;;</td></tr>
<tr><td class="h">995</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>181</div></td><td class="s">&nbsp;&nbsp;my $ps = &#39;&#39;;</td></tr>
<tr><td class="h">996</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>184</div></td><td class="s">&nbsp;&nbsp;my $anchor = &#39;&#39;;</td></tr>
<tr><td class="h">997</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>335</div></td><td class="s">&nbsp;&nbsp;while( my $p = shift @args ) {</td></tr>
<tr><td class="h">998</td><td><div class="c3">35</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L998">100</a></div></td><td></td><td></td><td><div>140</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $p eq &#39;#&#39; ) {</td></tr>
<tr><td class="h">999</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>132</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor .= &#39;#&#39; . shift( @args );</td></tr>
<tr><td class="h">1000</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1001</td><td><div class="c3">12</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1001">50</a></div></td><td></td><td><div>77</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ps .= &#39;;&#39; . $p.&#39;=&#39;.urlEncode(shift( @args )||&#39;&#39;);</td></tr>
<tr><td class="h">1002</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1003</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1004</td><td><div class="c3">68</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1004">100</a></div></td><td></td><td></td><td><div>297</div></td><td class="s">&nbsp;&nbsp;if( $ps ) {</td></tr>
<tr><td class="h">1005</td><td><div class="c3">8</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1005">50</a></div></td><td></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ps =~ s/^;/?/ unless $notfirst;</td></tr>
<tr><td class="h">1006</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$url .= $ps;</td></tr>
<tr><td class="h">1007</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1008</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>189</div></td><td class="s">&nbsp;&nbsp;$url .= $anchor;</td></tr>
<tr><td class="h">1009</td><td><div class="c3">68</div></td><td></td><td></td><td></td><td><div>284</div></td><td class="s">&nbsp;&nbsp;return $url;</td></tr>
<tr><td class="h">1010</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1011</td><td colspan="6"></td></tr><tr><td class="h">1012 - 1024</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getPubUrl($absolute, $web, $topic, $attachment) -&gt; $url

Composes a pub url. If $absolute is set, returns an absolute URL.
If $absolute is set, generates an absolute URL. $absolute is advisory only;
TWiki can decide to generate absolute URLs (for example when run from the
command-line) even when relative URLs have been requested.

$web, $topic and $attachment are optional. A partial URL path will be
generated if one or all is not given.

=cut</pre></td></tr>
<tr><td class="h">1025</td><td colspan="6"></td></tr><tr><td class="h">1026</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getPubUrl {</td></tr>
<tr><td class="h">1027</td><td><div class="c3">40</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1027">40</a></div></td><td><div>167</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $absolute, $web, $topic, $attachment ) = @_;</td></tr>
<tr><td class="h">1028</td><td colspan="6"></td></tr><tr><td class="h">1029</td><td><div class="c3">40</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1029">25</a></div></td><td></td><td><div>209</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$absolute ||= ($this-&gt;inContext( &#39;command_line&#39; ) ||</td></tr>
<tr><td class="h">1030</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;inContext( &#39;rss&#39; ) ||</td></tr>
<tr><td class="h">1031</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;inContext( &#39;absolute_urls&#39; ));</td></tr>
<tr><td class="h">1032</td><td colspan="6"></td></tr><tr><td class="h">1033</td><td><div class="c3">40</div></td><td></td><td></td><td></td><td><div>139</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = &#39;&#39;;</td></tr>
<tr><td class="h">1034</td><td><div class="c3">40</div></td><td></td><td></td><td></td><td><div>147</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$url .= $TWiki::cfg{PubUrlPath};</td></tr>
<tr><td class="h">1035</td><td><div class="c3">40</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1035">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1035">67</a></div></td><td></td><td><div>310</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $absolute &amp;&amp; $url !~ /^[a-z]+:/ ) {</td></tr>
<tr><td class="h">1036</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# See http://www.ietf.org/rfc/rfc2396.txt for the definition of</td></tr>
<tr><td class="h">1037</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &quot;absolute URI&quot;. TWiki bastardises this definition by assuming</td></tr>
<tr><td class="h">1038</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# that all relative URLs lack the &lt;authority&gt; component as well.</td></tr>
<tr><td class="h">1039</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $this-&gt;{urlHost}.$url;</td></tr>
<tr><td class="h">1040</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1041</td><td><div class="c3">40</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1041">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1041">50</a></div></td><td></td><td><div>413</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $web || $topic || $attachment ) {</td></tr>
<tr><td class="h">1042</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>97</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $web, $topic ) =</td></tr>
<tr><td class="h">1043</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;normalizeWebTopicName( $web, $topic );</td></tr>
<tr><td class="h">1044</td><td colspan="6"></td></tr><tr><td class="h">1045</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>108</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $path = &#39;/&#39;.$web.&#39;/&#39;.$topic;</td></tr>
<tr><td class="h">1046</td><td><div class="c3">24</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1046">100</a></div></td><td></td><td></td><td><div>109</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path .= &#39;/&#39;.$attachment if $attachment;</td></tr>
<tr><td class="h">1047</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= urlEncode( $path );</td></tr>
<tr><td class="h">1048</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1049</td><td colspan="6"></td></tr><tr><td class="h">1050</td><td><div class="c3">40</div></td><td></td><td></td><td></td><td><div>233</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url;</td></tr>
<tr><td class="h">1051</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1052</td><td colspan="6"></td></tr><tr><td class="h">1053 - 1059</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getIconUrl( $absolute, $iconName ) -&gt; $iconURL

Map an icon name to a URL path.

=cut</pre></td></tr>
<tr><td class="h">1060</td><td colspan="6"></td></tr><tr><td class="h">1061</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getIconUrl {</td></tr>
<tr><td class="h">1062</td><td><div class="c3">14</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1062">14</a></div></td><td><div>57</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $absolute, $iconName ) = @_;</td></tr>
<tr><td class="h">1063</td><td colspan="6"></td></tr><tr><td class="h">1064</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>68</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $iconTopic = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;ICONTOPIC&#39; );</td></tr>
<tr><td class="h">1065</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>72</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $web, $topic) = $this-&gt;normalizeWebTopicName(</td></tr>
<tr><td class="h">1066</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{webName}, $iconTopic );</td></tr>
<tr><td class="h">1067</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$iconName =~ s/^.*\.(.*?)$/$1/;</td></tr>
<tr><td class="h">1068</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td><div>70</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getPubUrl( $absolute, $web, $topic, $iconName.&#39;.gif&#39; );</td></tr>
<tr><td class="h">1069</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1070</td><td colspan="6"></td></tr><tr><td class="h">1071 - 1078</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod mapToIconFileName( $fileName, $default ) -&gt; $fileName

Maps from a filename (or just the extension) to the name of the
file that contains the image for that file type.

=cut</pre></td></tr>
<tr><td class="h">1079</td><td colspan="6"></td></tr><tr><td class="h">1080</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub mapToIconFileName {</td></tr>
<tr><td class="h">1081</td><td><div class="c3">9</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1081">9</a></div></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $fileName, $default ) = @_;</td></tr>
<tr><td class="h">1082</td><td colspan="6"></td></tr><tr><td class="h">1083</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @bits = ( split( /\./, $fileName ) );</td></tr>
<tr><td class="h">1084</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $fileExt = lc $bits[$#bits];</td></tr>
<tr><td class="h">1085</td><td colspan="6"></td></tr><tr><td class="h">1086</td><td><div class="c3">9</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1086">100</a></div></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{_ICONMAP} ) {</td></tr>
<tr><td class="h">1087</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $iconTopic = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;ICONTOPIC&#39; );</td></tr>
<tr><td class="h">1088</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $web, $topic) = $this-&gt;normalizeWebTopicName(</td></tr>
<tr><td class="h">1089</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{webName}, $iconTopic );</td></tr>
<tr><td class="h">1090</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $/ = undef;</td></tr>
<tr><td class="h">1091</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {</td></tr>
<tr><td class="h">1092</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1092">1</a></div></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $icons = $this-&gt;{store}-&gt;getAttachmentStream(</td></tr>
<tr><td class="h">1093</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef, $web, $topic, &#39;_filetypes.txt&#39; );</td></tr>
<tr><td class="h">1094</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>92</div><div>198</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%{$this-&gt;{_ICONMAP}} = split( /\s+/, &lt;$icons&gt; );</td></tr>
<tr><td class="h">1095</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close( $icons );</td></tr>
<tr><td class="h">1096</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch Error::Simple with {</td></tr>
<tr><td class="h">1097</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1097">0</a></div></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%{$this-&gt;{_ICONMAP}} = ();</td></tr>
<tr><td class="h">1098</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1099</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1100</td><td colspan="6"></td></tr><tr><td class="h">1101</td><td><div class="c3">9</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1101">33</a></div></td><td></td><td><div>121</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{_ICONMAP}-&gt;{$fileExt} || $default || &#39;else&#39;;</td></tr>
<tr><td class="h">1102</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1103</td><td colspan="6"></td></tr><tr><td class="h">1104 - 1125</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getOopsUrl( $template, @options ) -&gt; $absoluteOopsURL

Composes a URL for an &quot;oops&quot; error page. The @options consists of a list
of key =&gt; value pairs. The following keys are used:
   * =-web= - web name
   * =-topic= - topic name
   * =-def= - optional template def within the main template file
   * =-params= - a single parameter, or a reference to an array of parameters  These are passed in the URL as &#39;&amp;param1=&#39; etc.

Do _not_ include the &quot;oops&quot; part in front of the template name.

Alternatively you can pass a reference to an OopsException in place of the template. All other parameters will be ignored.

The returned URL ends up looking something like this:
&quot;http://host/twiki/bin/oops/$web/$topic?template=$template&amp;param1=$scriptParams[0]...&quot;

Note: if {keep} is true in the params, then they will also be pushed into the
current query.

=cut</pre></td></tr>
<tr><td class="h">1126</td><td colspan="6"></td></tr><tr><td class="h">1127</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getOopsUrl {</td></tr>
<tr><td class="h">1128</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1128">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1129</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1130</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1131</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $params;</td></tr>
<tr><td class="h">1132</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $keep;</td></tr>
<tr><td class="h">1133</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $query;</td></tr>
<tr><td class="h">1134</td><td colspan="6"></td></tr><tr><td class="h">1135</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1135">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $template-&gt;isa(&#39;TWiki::OopsException&#39;) ) {</td></tr>
<tr><td class="h">1136</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# The parameters were provided when the exception was thrown</td></tr>
<tr><td class="h">1137</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params = $template;</td></tr>
<tr><td class="h">1138</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template = $params-&gt;{template};</td></tr>
<tr><td class="h">1139</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1140</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# The params are in the parameter array</td></tr>
<tr><td class="h">1141</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params = { @_ };</td></tr>
<tr><td class="h">1142</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1143</td><td colspan="6"></td></tr><tr><td class="h">1144</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1144">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($params-&gt;{keep}) {</td></tr>
<tr><td class="h">1145</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">1146</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$keep = 1;</td></tr>
<tr><td class="h">1147</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1148</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;delete($params-&gt;{keep});</td></tr>
<tr><td class="h">1149</td><td colspan="6"></td></tr><tr><td class="h">1150</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1150">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $params-&gt;{web} || $this-&gt;{webName};</td></tr>
<tr><td class="h">1151</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1151">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = $params-&gt;{topic} || $this-&gt;{topicName};</td></tr>
<tr><td class="h">1152</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $def = $params-&gt;{def};</td></tr>
<tr><td class="h">1153</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $PARAMS = $params-&gt;{params};</td></tr>
<tr><td class="h">1154</td><td colspan="6"></td></tr><tr><td class="h">1155</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Build a query string for the new URL.</td></tr>
<tr><td class="h">1156</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Push all URL params into the current query as well if {keep} is</td></tr>
<tr><td class="h">1157</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# set, because if it is, GET params will be ignored when it is</td></tr>
<tr><td class="h">1158</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# restored.</td></tr>
<tr><td class="h">1159</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @urlParams = ( template =&gt; &#39;oops&#39;.$template );</td></tr>
<tr><td class="h">1160</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1160">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;param(-name =&gt; &quot;template&quot;, -value =&gt; &#39;oops&#39;.$template ) if $keep;</td></tr>
<tr><td class="h">1161</td><td colspan="6"></td></tr><tr><td class="h">1162</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1162">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($def) {</td></tr>
<tr><td class="h">1163</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @urlParams, def =&gt; $def );</td></tr>
<tr><td class="h">1164</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1164">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;param(-name =&gt; &quot;def&quot;, -value =&gt; $def ) if $keep;</td></tr>
<tr><td class="h">1165</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1166</td><td colspan="6"></td></tr><tr><td class="h">1167</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1167">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1167">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( ref($PARAMS) eq &quot;ARRAY&quot; ) {</td></tr>
<tr><td class="h">1168</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $n = 1;</td></tr>
<tr><td class="h">1169</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $p ( @$PARAMS ) {</td></tr>
<tr><td class="h">1170</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1170">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$p = &#39;&#39; unless defined $p;</td></tr>
<tr><td class="h">1171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @urlParams, &quot;param$n&quot; =&gt; $p );</td></tr>
<tr><td class="h">1172</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1172">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;param(-name =&gt; &quot;param$n&quot;, -value =&gt; $p ) if $keep;</td></tr>
<tr><td class="h">1173</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$n++;</td></tr>
<tr><td class="h">1174</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1175</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( defined $PARAMS ) {</td></tr>
<tr><td class="h">1176</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @urlParams, param1 =&gt; $PARAMS );</td></tr>
<tr><td class="h">1177</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1177">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;param(-name =&gt; &quot;param1&quot;, -value =&gt; $PARAMS ) if $keep;</td></tr>
<tr><td class="h">1178</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1179</td><td colspan="6"></td></tr><tr><td class="h">1180</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;enterContext( &#39;absolute_urls&#39; );</td></tr>
<tr><td class="h">1181</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = $this-&gt;getScriptUrl( 0, &#39;oops&#39;, $web, $topic, @urlParams );</td></tr>
<tr><td class="h">1182</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;leaveContext( &#39;absolute_urls&#39; );</td></tr>
<tr><td class="h">1183</td><td colspan="6"></td></tr><tr><td class="h">1184</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url;</td></tr>
<tr><td class="h">1185</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1186</td><td colspan="6"></td></tr><tr><td class="h">1187 - 1199</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod normalizeWebTopicName( $theWeb, $theTopic ) -&gt; ( $theWeb, $theTopic )

Normalize a Web&lt;nop&gt;.&lt;nop&gt;TopicName

See TWikiFuncDotPm for a full specification of the expansion (not duplicated here)

*WARNING* if there is no web specification (in the web or topic parameters) the web
defaults to $TWiki::cfg{UsersWebName}. If there is no topic specification, or the topic
is &#39;0&#39;, the topic defaults to the web home topic name.

=cut</pre></td></tr>
<tr><td class="h">1200</td><td colspan="6"></td></tr><tr><td class="h">1201</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub normalizeWebTopicName {</td></tr>
<tr><td class="h">1202</td><td><div class="c3">163</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1202">163</a></div></td><td><div>635</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic ) = @_;</td></tr>
<tr><td class="h">1203</td><td colspan="6"></td></tr><tr><td class="h">1204</td><td><div class="c3">163</div></td><td></td><td></td><td></td><td><div>406</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1205</td><td><div class="c3">163</div></td><td></td><td></td><td></td><td><div>400</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $topic) if DEBUG;</td></tr>
<tr><td class="h">1206</td><td colspan="6"></td></tr><tr><td class="h">1207</td><td><div class="c3">163</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1207">100</a></div></td><td></td><td></td><td><div>1178</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $topic =~ m|^(.*)[./](.*?)$| ) {</td></tr>
<tr><td class="h">1208</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>119</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web = $1;</td></tr>
<tr><td class="h">1209</td><td><div class="c3">31</div></td><td></td><td></td><td></td><td><div>106</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic = $2;</td></tr>
<tr><td class="h">1210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1211</td><td><div class="c3">163</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1211">50</a></div></td><td></td><td><div>732</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web ||= $cfg{UsersWebName};</td></tr>
<tr><td class="h">1212</td><td><div class="c3">163</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1212">50</a></div></td><td></td><td><div>698</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$topic ||= $cfg{HomeTopicName};</td></tr>
<tr><td class="h">1213</td><td><div class="c3">163</div><div class="c3">15</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1213">50</a></div></td><td></td><td></td><td><div>482</div><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s/%((MAIN|TWIKI|USERS|SYSTEM|DOC)WEB)%/$this-&gt;_expandTagOnTopicRendering($1)||&#39;&#39;/e;</td></tr>
<tr><td class="h">1214</td><td><div class="c3">163</div></td><td></td><td></td><td></td><td><div>487</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s#\.#/#go;</td></tr>
<tr><td class="h">1215</td><td><div class="c3">163</div></td><td></td><td></td><td></td><td><div>873</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return( $web, $topic );</td></tr>
<tr><td class="h">1216</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1217</td><td colspan="6"></td></tr><tr><td class="h">1218 - 1230</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ClassMethod new( $loginName, $query, \%initialContext )

Constructs a new TWiki object. Parameters are taken from the query object.

   * =$loginName= is the username of the user you want to be logged-in if none is
     available from a session or browser. Used mainly for side scripts and debugging.
   * =$query= the CGI query (may be undef, in which case an empty query is used)
   * =\%initialContext= - reference to a hash containing context name=value pairs
     to be pre-installed in the context hash

=cut</pre></td></tr>
<tr><td class="h">1231</td><td colspan="6"></td></tr><tr><td class="h">1232</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">1233</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1233">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $class, $loginName, $query, $initialContext ) = @_;</td></tr>
<tr><td class="h">1234</td><td colspan="6"></td></tr><tr><td class="h">1235</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1235">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$query ||= new CGI( {} );</td></tr>
<tr><td class="h">1236</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = bless( {}, $class );</td></tr>
<tr><td class="h">1237</td><td colspan="6"></td></tr><tr><td class="h">1238</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{htmlHeaders} = {};</td></tr>
<tr><td class="h">1239</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1239">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{context} = $initialContext || {};</td></tr>
<tr><td class="h">1240</td><td colspan="6"></td></tr><tr><td class="h">1241</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# create the various sub-objects</td></tr>
<tr><td class="h">1242</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{sandbox} = $sharedSandbox;</td></tr>
<tr><td class="h">1243</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins} = new TWiki::Plugins( $this );</td></tr>
<tr><td class="h">1244</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{net} = new TWiki::Net( $this );</td></tr>
<tr><td class="h">1245</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{store} = new TWiki::Store( $this );</td></tr>
<tr><td class="h">1246</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{search} = new TWiki::Search( $this );</td></tr>
<tr><td class="h">1247</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{templates} = new TWiki::Templates( $this );</td></tr>
<tr><td class="h">1248</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{attach} = new TWiki::Attach( $this );</td></tr>
<tr><td class="h">1249</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{loginManager} = TWiki::Client::makeLoginManager( $this );</td></tr>
<tr><td class="h">1250</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# cache CGI information in the session object</td></tr>
<tr><td class="h">1251</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{cgiQuery} = $query;</td></tr>
<tr><td class="h">1252</td><td colspan="6"></td></tr><tr><td class="h">1253</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{users} = new TWiki::Users( $this );</td></tr>
<tr><td class="h">1254</td><td colspan="6"></td></tr><tr><td class="h">1255</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Make %ENV safer, preventing hijack of the search path</td></tr>
<tr><td class="h">1256</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: can this be done in a BEGIN block? Or is the environment</td></tr>
<tr><td class="h">1257</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# set per-query?</td></tr>
<tr><td class="h">1258</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1258">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{SafeEnvPath} ) {</td></tr>
<tr><td class="h">1259</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{PATH} = $TWiki::cfg{SafeEnvPath};</td></tr>
<tr><td class="h">1260</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1261</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;delete @ENV{ qw( IFS CDPATH ENV BASH_ENV ) };</td></tr>
<tr><td class="h">1262</td><td colspan="6"></td></tr><tr><td class="h">1263</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{security} = new TWiki::Access( $this );</td></tr>
<tr><td class="h">1264</td><td colspan="6"></td></tr><tr><td class="h">1265</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = &#39;&#39;;</td></tr>
<tr><td class="h">1266</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = $query-&gt;param( &#39;topic&#39; );</td></tr>
<tr><td class="h">1267</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1267">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $topic ) {</td></tr>
<tr><td class="h">1268</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1268">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1268">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1268">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $topic =~ /^$regex{linkProtocolPattern}\:\/\//o &amp;&amp;</td></tr>
<tr><td class="h">1269</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{cgiQuery} ) {</td></tr>
<tr><td class="h">1270</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# redirect to URI</td></tr>
<tr><td class="h">1271</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1271">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($TWiki::cfg{AllowRedirectUrl}) {</td></tr>
<tr><td class="h">1272</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print $this-&gt;redirect( $topic );</td></tr>
<tr><td class="h">1273</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">1274</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1275</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# for security, ignore redirect to URL</td></tr>
<tr><td class="h">1276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic = &#39;&#39;;</td></tr>
<tr><td class="h">1277</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1278</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $topic =~ /((?:.*[\.\/])+)(.*)/ ) {</td></tr>
<tr><td class="h">1279</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is &#39;bin/script?topic=Webname.SomeTopic&#39;</td></tr>
<tr><td class="h">1280</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web   = $1;</td></tr>
<tr><td class="h">1281</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic = $2;</td></tr>
<tr><td class="h">1282</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s/\./\//go;</td></tr>
<tr><td class="h">1283</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s/\/$//o;</td></tr>
<tr><td class="h">1284</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# jump to WebHome if &#39;bin/script?topic=Webname.&#39;</td></tr>
<tr><td class="h">1285</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1285">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1285">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic = $TWiki::cfg{HomeTopicName} if( $web &amp;&amp; ! $topic );</td></tr>
<tr><td class="h">1286</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1287</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# otherwise assume &#39;bin/script/Webname?topic=SomeTopic&#39;</td></tr>
<tr><td class="h">1288</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1289</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic = &#39;&#39;;</td></tr>
<tr><td class="h">1290</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1291</td><td colspan="6"></td></tr><tr><td class="h">1292</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: &quot;The Microsoft Internet Information Server is broken with</td></tr>
<tr><td class="h">1293</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# respect to additional path information. If you use the Perl DLL</td></tr>
<tr><td class="h">1294</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# library, the IIS server will attempt to execute the additional</td></tr>
<tr><td class="h">1295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# path information as a Perl script. If you use the ordinary file</td></tr>
<tr><td class="h">1296</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# associations mapping, the path information will be present in the</td></tr>
<tr><td class="h">1297</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# environment, but incorrect. The best thing to do is to avoid using</td></tr>
<tr><td class="h">1298</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# additional path information.&quot;</td></tr>
<tr><td class="h">1299</td><td colspan="6"></td></tr><tr><td class="h">1300</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Clean up PATH_INFO problems, e.g.  Support.CobaltRaqInstall.  A valid</td></tr>
<tr><td class="h">1301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# PATH_INFO is &#39;/Main/WebHome&#39;, i.e. the text after the script name;</td></tr>
<tr><td class="h">1302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# invalid PATH_INFO is often a full path starting with &#39;/cgi-bin/...&#39;.</td></tr>
<tr><td class="h">1303</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pathInfo = $query-&gt;path_info();</td></tr>
<tr><td class="h">1304</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1304">50</a></div></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cgiScriptName = $ENV{SCRIPT_NAME} || &#39;&#39;;</td></tr>
<tr><td class="h">1305</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$pathInfo =~ s!$cgiScriptName/!/!i;</td></tr>
<tr><td class="h">1306</td><td colspan="6"></td></tr><tr><td class="h">1307</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get the web and topic names from PATH_INFO</td></tr>
<tr><td class="h">1308</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1308">50</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1308">0</a></div></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $pathInfo =~ /\/((?:.*[\.\/])+)(.*)/ ) {</td></tr>
<tr><td class="h">1309</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is &#39;bin/script/Webname/SomeTopic&#39; or &#39;bin/script/Webname/&#39;</td></tr>
<tr><td class="h">1310</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1310">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web   = $1 unless $web;</td></tr>
<tr><td class="h">1311</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1311">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topic = $2 unless $topic;</td></tr>
<tr><td class="h">1312</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s/\./\//go;</td></tr>
<tr><td class="h">1313</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s/\/$//o;</td></tr>
<tr><td class="h">1314</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $pathInfo =~ /\/(.*)/ ) {</td></tr>
<tr><td class="h">1315</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is &#39;bin/script/Webname&#39; or &#39;bin/script/&#39;</td></tr>
<tr><td class="h">1316</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1316">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web = $1 unless $web;</td></tr>
<tr><td class="h">1317</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1318</td><td colspan="6"></td></tr><tr><td class="h">1319</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# All roads lead to WebHome</td></tr>
<tr><td class="h">1320</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1320">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$topic = $TWiki::cfg{HomeTopicName} if ( $topic =~ /\.\./ );</td></tr>
<tr><td class="h">1321</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$topic =~ s/$TWiki::cfg{NameFilter}//go;</td></tr>
<tr><td class="h">1322</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1322">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$topic = $TWiki::cfg{HomeTopicName} unless $topic;</td></tr>
<tr><td class="h">1323</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topicName} = TWiki::Sandbox::untaintUnchecked( $topic );</td></tr>
<tr><td class="h">1324</td><td colspan="6"></td></tr><tr><td class="h">1325</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web   =~ s/$TWiki::cfg{NameFilter}//go;</td></tr>
<tr><td class="h">1326</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{requestedWebName} = TWiki::Sandbox::untaintUnchecked( $web ); #can be an empty string</td></tr>
<tr><td class="h">1327</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1327">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web = $TWiki::cfg{UsersWebName} unless $web;</td></tr>
<tr><td class="h">1328</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{webName} = TWiki::Sandbox::untaintUnchecked( $web );</td></tr>
<tr><td class="h">1329</td><td colspan="6"></td></tr><tr><td class="h">1330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Convert UTF-8 web and topic name from URL into site charset</td></tr>
<tr><td class="h">1331</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if necessary - no effect if URL is not in UTF-8</td></tr>
<tr><td class="h">1332</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# handle topic and web names seperately; encoding is not necessarily shared</td></tr>
<tr><td class="h">1333</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $webNameTemp = $this-&gt;UTF82SiteCharSet( $this-&gt;{webName} );</td></tr>
<tr><td class="h">1334</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1334">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $webNameTemp ) {</td></tr>
<tr><td class="h">1335</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{webName} = $webNameTemp;</td></tr>
<tr><td class="h">1336</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1337</td><td colspan="6"></td></tr><tr><td class="h">1338</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topicNameTemp = $this-&gt;UTF82SiteCharSet( $this-&gt;{topicName} );</td></tr>
<tr><td class="h">1339</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1339">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $topicNameTemp ) {</td></tr>
<tr><td class="h">1340</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topicName} = $topicNameTemp;</td></tr>
<tr><td class="h">1341</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1342</td><td colspan="6"></td></tr><tr><td class="h">1343</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Item3270 - here&#39;s the appropriate place to enforce TWiki spec:</td></tr>
<tr><td class="h">1344</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# All topic name sources are evaluated, site charset applied</td></tr>
<tr><td class="h">1345</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topicName}  =</td></tr>
<tr><td class="h">1346</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Sandbox::untaintUnchecked(ucfirst $this-&gt;{topicName});</td></tr>
<tr><td class="h">1347</td><td colspan="6"></td></tr><tr><td class="h">1348</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{scriptUrlPath} = $TWiki::cfg{ScriptUrlPath};</td></tr>
<tr><td class="h">1349</td><td colspan="6"></td></tr><tr><td class="h">1350</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = $query-&gt;url();</td></tr>
<tr><td class="h">1351</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1351">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1351">25</a></div></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url &amp;&amp; $url =~ m!^([^:]*://[^/]*)(.*)/.*$! &amp;&amp; $2 ) {</td></tr>
<tr><td class="h">1352</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{urlHost} = $1;</td></tr>
<tr><td class="h">1353</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If the urlHost in the url is localhost, this is a lot less</td></tr>
<tr><td class="h">1354</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# useful than the default url host. This is because new CGI(&quot;&quot;)</td></tr>
<tr><td class="h">1355</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# assigns this host by default - it&#39;s a default setting, used</td></tr>
<tr><td class="h">1356</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# when there is nothing better available.</td></tr>
<tr><td class="h">1357</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1357">50</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1357">0</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{urlHost} eq &#39;http://localhost&#39; ) {</td></tr>
<tr><td class="h">1358</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{urlHost} = $TWiki::cfg{DefaultUrlHost};</td></tr>
<tr><td class="h">1359</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $TWiki::cfg{RemovePortNumber} ) {</td></tr>
<tr><td class="h">1360</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{urlHost} =~ s/\:[0-9]+$//;</td></tr>
<tr><td class="h">1361</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1362</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1362">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{GetScriptUrlFromCgi} ) {</td></tr>
<tr><td class="h">1363</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: this is a really dangerous hack. It will fail</td></tr>
<tr><td class="h">1364</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# spectacularly with mod_perl.</td></tr>
<tr><td class="h">1365</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: why not just use $query-&gt;script_name?</td></tr>
<tr><td class="h">1366</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{scriptUrlPath} = $2;</td></tr>
<tr><td class="h">1367</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1368</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1369</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{urlHost} = $TWiki::cfg{DefaultUrlHost};</td></tr>
<tr><td class="h">1370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1371</td><td colspan="6"></td></tr><tr><td class="h">1372</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# setup the cgi session, from a cookie or the url. this may return</td></tr>
<tr><td class="h">1373</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the login, but even if it does, plugins will get the chance to override</td></tr>
<tr><td class="h">1374</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# it below.</td></tr>
<tr><td class="h">1375</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $login = $this-&gt;{remoteUser} = $this-&gt;{loginManager}-&gt;loadSession($loginName);</td></tr>
<tr><td class="h">1376</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $prefs = new TWiki::Prefs( $this );</td></tr>
<tr><td class="h">1377</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs} = $prefs;</td></tr>
<tr><td class="h">1378</td><td colspan="6"></td></tr><tr><td class="h">1379</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Push global preferences from TWiki.TWikiPreferences</td></tr>
<tr><td class="h">1380</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefs-&gt;pushGlobalPreferences();</td></tr>
<tr><td class="h">1381</td><td colspan="6"></td></tr><tr><td class="h">1382</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $plogin = $this-&gt;{plugins}-&gt;load( $TWiki::cfg{DisableAllPlugins} );</td></tr>
<tr><td class="h">1383</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1383">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$login = $plogin if $plogin;</td></tr>
<tr><td class="h">1384</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1384">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$login ||= $TWiki::cfg{DefaultUserLogin};</td></tr>
<tr><td class="h">1385</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1385">50</a></div></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $login =~ /$TWiki::cfg{LoginNameFilterIn}/) {</td></tr>
<tr><td class="h">1386</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Illegal format for login name &#39;$login&#39; (does not match &quot;.$TWiki::cfg{LoginNameFilterIn}.&quot;)&quot;;</td></tr>
<tr><td class="h">1387</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1388</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$login = TWiki::Sandbox::untaintUnchecked( $login );</td></tr>
<tr><td class="h">1389</td><td colspan="6"></td></tr><tr><td class="h">1390</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = $this-&gt;{users}-&gt;findUser( $login );</td></tr>
<tr><td class="h">1391</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{user} = $user;</td></tr>
<tr><td class="h">1392</td><td colspan="6"></td></tr><tr><td class="h">1393</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Static session variables that can be expanded in topics when they</td></tr>
<tr><td class="h">1394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# are enclosed in % signs</td></tr>
<tr><td class="h">1395</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: should collapse these into one. The duplication is pretty</td></tr>
<tr><td class="h">1396</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# pointless. Could get rid of the SESSION_TAGS hash, might be</td></tr>
<tr><td class="h">1397</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the easiest thing to do, but then that would allow other</td></tr>
<tr><td class="h">1398</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# upper-case named fields in the object to be accessed as well...</td></tr>
<tr><td class="h">1399</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{BASEWEB}        = $this-&gt;{webName};</td></tr>
<tr><td class="h">1400</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{BASETOPIC}      = $this-&gt;{topicName};</td></tr>
<tr><td class="h">1401</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGTOPIC} = $this-&gt;{topicName};</td></tr>
<tr><td class="h">1402</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGWEB}   = $this-&gt;{webName};</td></tr>
<tr><td class="h">1403</td><td colspan="6"></td></tr><tr><td class="h">1404</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Push plugin settings</td></tr>
<tr><td class="h">1405</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;settings();</td></tr>
<tr><td class="h">1406</td><td colspan="6"></td></tr><tr><td class="h">1407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Now the rest of the preferences</td></tr>
<tr><td class="h">1408</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefs-&gt;pushGlobalPreferencesSiteSpecific();</td></tr>
<tr><td class="h">1409</td><td colspan="6"></td></tr><tr><td class="h">1410</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefs-&gt;pushPreferences(</td></tr>
<tr><td class="h">1411</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{UsersWebName}, $user-&gt;wikiName(),</td></tr>
<tr><td class="h">1412</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;USER &#39;.$user-&gt;wikiName() );</td></tr>
<tr><td class="h">1413</td><td colspan="6"></td></tr><tr><td class="h">1414</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefs-&gt;pushWebPreferences( $this-&gt;{webName} );</td></tr>
<tr><td class="h">1415</td><td colspan="6"></td></tr><tr><td class="h">1416</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefs-&gt;pushPreferences(</td></tr>
<tr><td class="h">1417</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{webName}, $this-&gt;{topicName}, &#39;TOPIC&#39; );</td></tr>
<tr><td class="h">1418</td><td colspan="6"></td></tr><tr><td class="h">1419</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefs-&gt;pushPreferenceValues( &#39;SESSION&#39;,</td></tr>
<tr><td class="h">1420</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{loginManager}-&gt;getSessionValues() );</td></tr>
<tr><td class="h">1421</td><td colspan="6"></td></tr><tr><td class="h">1422</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# requires preferences (such as NEWTOPICBGCOLOR)</td></tr>
<tr><td class="h">1423</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{renderer} = new TWiki::Render( $this );</td></tr>
<tr><td class="h">1424</td><td colspan="6"></td></tr><tr><td class="h">1425</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Finish plugin initialization - register handlers</td></tr>
<tr><td class="h">1426</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;enable();</td></tr>
<tr><td class="h">1427</td><td colspan="6"></td></tr><tr><td class="h">1428</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# language information; must be loaded after</td></tr>
<tr><td class="h">1429</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# *all possible preferences sources* are available</td></tr>
<tr><td class="h">1430</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{i18n} = TWiki::I18N::get( $this );</td></tr>
<tr><td class="h">1431</td><td colspan="6"></td></tr><tr><td class="h">1432</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this;</td></tr>
<tr><td class="h">1433</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1434</td><td colspan="6"></td></tr><tr><td class="h">1435</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Uncomment when enabling AutoLoader</td></tr>
<tr><td class="h">1436</td><td></td><td></td><td></td><td></td><td></td><td class="s">#__END__</td></tr>
<tr><td class="h">1437</td><td colspan="6"></td></tr><tr><td class="h">1438 - 1448</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod finish

Complete processing after the client&#39;s HTTP request has been responded
to. Right now this does two things:
   1 calling TWiki::Client to flushing the user&#39;s session (if any) to disk,
   2 breaking circular references to allow garbage collection in persistent
     environments

=cut</pre></td></tr>
<tr><td class="h">1449</td><td colspan="6"></td></tr><tr><td class="h">1450</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub finish {</td></tr>
<tr><td class="h">1451</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1451">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1452</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{loginManager}-&gt;finish();</td></tr>
<tr><td class="h">1453</td><td colspan="6"></td></tr><tr><td class="h">1454</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    use Data::Dumper;</td></tr>
<tr><td class="h">1455</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    $Data::Dumper::Indent = 1;</td></tr>
<tr><td class="h">1456</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    warn &quot;prepared to finish&quot;;</td></tr>
<tr><td class="h">1457</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    warn Dumper($this);</td></tr>
<tr><td class="h">1458</td><td colspan="6"></td></tr><tr><td class="h">1459</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs}-&gt;finish();</td></tr>
<tr><td class="h">1460</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{users}-&gt;finish();</td></tr>
<tr><td class="h">1461</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{store}-&gt;finish();</td></tr>
<tr><td class="h">1462</td><td colspan="6"></td></tr><tr><td class="h">1463</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%$this = ();</td></tr>
<tr><td class="h">1464</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;}</td></tr>
<tr><td class="h">1465 - 1475</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod writeLog( $action, $webTopic, $extra, $user )

   * =$action= - what happened, e.g. view, save, rename
   * =$wbTopic= - what it happened to
   * =$extra= - extra info, such as minor flag
   * =$user= - user who did the saving (user object or string user name)
Write the log for an event to the logfile

=cut</pre></td></tr>
<tr><td class="h">1476</td><td colspan="6"></td></tr><tr><td class="h">1477</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub writeLog {</td></tr>
<tr><td class="h">1478</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1478">1</a></div></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1479</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1480</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1480">50</a></div></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $action = shift || &#39;&#39;;</td></tr>
<tr><td class="h">1481</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1481">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $webTopic = shift || &#39;&#39;;</td></tr>
<tr><td class="h">1482</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1482">50</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $extra = shift || &#39;&#39;;</td></tr>
<tr><td class="h">1483</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = shift;</td></tr>
<tr><td class="h">1484</td><td colspan="6"></td></tr><tr><td class="h">1485</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1485">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$user = $this-&gt;{user} unless $user;</td></tr>
<tr><td class="h">1486</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1486">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1486">33</a></div></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( ref($user) &amp;&amp; $user-&gt;isa(&#39;TWiki::User&#39;)) {</td></tr>
<tr><td class="h">1487</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user = $user-&gt;wikiName();</td></tr>
<tr><td class="h">1488</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1489</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1489">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $user eq $cfg{DefaultUserWikiName} ) {</td></tr>
<tr><td class="h">1490</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cgiQuery = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">1491</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1491">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $cgiQuery ) {</td></tr>
<tr><td class="h">1492</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $agent = $cgiQuery-&gt;user_agent();</td></tr>
<tr><td class="h">1493</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1493">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $agent ) {</td></tr>
<tr><td class="h">1494</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$agent =~ m/([\w]+)/;</td></tr>
<tr><td class="h">1495</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$extra .= &#39; &#39;.$1;</td></tr>
<tr><td class="h">1496</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1497</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1498</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1499</td><td colspan="6"></td></tr><tr><td class="h">1500</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1500">50</a></div></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remoteAddr = $ENV{REMOTE_ADDR} || &#39;&#39;;</td></tr>
<tr><td class="h">1501</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &quot;$user | $action | $webTopic | $extra | $remoteAddr |&quot;;</td></tr>
<tr><td class="h">1502</td><td colspan="6"></td></tr><tr><td class="h">1503</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_writeReport( $TWiki::cfg{LogFileName}, $text );</td></tr>
<tr><td class="h">1504</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1505</td><td colspan="6"></td></tr><tr><td class="h">1506 - 1514</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod writeWarning( $text )

Prints date, time, and contents $text to $TWiki::cfg{WarningFileName}, typically
&#39;warnings.txt&#39;. Use for warnings and errors that may require admin
intervention. Use this for defensive programming warnings (e.g. assertions).

=cut</pre></td></tr>
<tr><td class="h">1515</td><td colspan="6"></td></tr><tr><td class="h">1516</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub writeWarning {</td></tr>
<tr><td class="h">1517</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1517">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1518</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1519</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_writeReport( $TWiki::cfg{WarningFileName}, @_ );</td></tr>
<tr><td class="h">1520</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1521</td><td colspan="6"></td></tr><tr><td class="h">1522 - 1529</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod writeDebug( $text )

Prints date, time, and contents of $text to $TWiki::cfg{DebugFileName}, typically
&#39;debug.txt&#39;.  Use for debugging messages.

=cut</pre></td></tr>
<tr><td class="h">1530</td><td colspan="6"></td></tr><tr><td class="h">1531</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub writeDebug {</td></tr>
<tr><td class="h">1532</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1532">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1533</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1534</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_writeReport( $TWiki::cfg{DebugFileName}, @_ );</td></tr>
<tr><td class="h">1535</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1536</td><td colspan="6"></td></tr><tr><td class="h">1537</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Concatenates date, time, and $text to a log file.</td></tr>
<tr><td class="h">1538</td><td></td><td></td><td></td><td></td><td></td><td class="s"># The logfilename can optionally use a %DATE% variable to support</td></tr>
<tr><td class="h">1539</td><td></td><td></td><td></td><td></td><td></td><td class="s"># logs that are rotated once a month.</td></tr>
<tr><td class="h">1540</td><td></td><td></td><td></td><td></td><td></td><td class="s"># | =$log= | Base filename for log file |</td></tr>
<tr><td class="h">1541</td><td></td><td></td><td></td><td></td><td></td><td class="s"># | =$message= | Message to print |</td></tr>
<tr><td class="h">1542</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _writeReport {</td></tr>
<tr><td class="h">1543</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1543">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $log, $message ) = @_;</td></tr>
<tr><td class="h">1544</td><td colspan="6"></td></tr><tr><td class="h">1545</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1545">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $log ) {</td></tr>
<tr><td class="h">1546</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>145</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $time =</td></tr>
<tr><td class="h">1547</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Time::formatTime( time(), &#39;$year$mo&#39;, &#39;servertime&#39;);</td></tr>
<tr><td class="h">1548</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$log =~ s/%DATE%/$time/go;</td></tr>
<tr><td class="h">1549</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$time = TWiki::Time::formatTime( time(), undef, &#39;servertime&#39; );</td></tr>
<tr><td class="h">1550</td><td colspan="6"></td></tr><tr><td class="h">1551</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1551">50</a></div></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( open( FILE, &quot;&gt;&gt;$log&quot; ) ) {</td></tr>
<tr><td class="h">1552</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print FILE &quot;| $time | $message\n&quot;;</td></tr>
<tr><td class="h">1553</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close( FILE );</td></tr>
<tr><td class="h">1554</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1555</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print STDERR &#39;Could not write &quot;&#39;.$message.&#39;&quot; to &#39;.&quot;$log: $!\n&quot;;</td></tr>
<tr><td class="h">1556</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1557</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1558</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1559</td><td colspan="6"></td></tr><tr><td class="h">1560</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _removeNewlines {</td></tr>
<tr><td class="h">1561</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1561">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $theTag ) = @_;</td></tr>
<tr><td class="h">1562</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theTag =~ s/[\r\n]+/ /gs;</td></tr>
<tr><td class="h">1563</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $theTag;</td></tr>
<tr><td class="h">1564</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1565</td><td colspan="6"></td></tr><tr><td class="h">1566</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Convert relative URLs to absolute URIs</td></tr>
<tr><td class="h">1567</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _rewriteURLInInclude {</td></tr>
<tr><td class="h">1568</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1568">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $theHost, $theAbsPath, $url ) = @_;</td></tr>
<tr><td class="h">1569</td><td colspan="6"></td></tr><tr><td class="h">1570</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# leave out an eventual final non-directory component from the absolute path</td></tr>
<tr><td class="h">1571</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theAbsPath =~ s/(.*?)[^\/]*$/$1/;</td></tr>
<tr><td class="h">1572</td><td colspan="6"></td></tr><tr><td class="h">1573</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1573">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1573">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1573">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1573">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1573">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url =~ /^\// ) {</td></tr>
<tr><td class="h">1574</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fix absolute URL</td></tr>
<tr><td class="h">1575</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $theHost.$url;</td></tr>
<tr><td class="h">1576</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $url =~ /^\./ ) {</td></tr>
<tr><td class="h">1577</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fix relative URL</td></tr>
<tr><td class="h">1578</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $theHost.$theAbsPath.&#39;/&#39;.$url;</td></tr>
<tr><td class="h">1579</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $url =~ /^$regex{linkProtocolPattern}\:/o ) {</td></tr>
<tr><td class="h">1580</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# full qualified URL, do nothing</td></tr>
<tr><td class="h">1581</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $url =~ /^#/ ) {</td></tr>
<tr><td class="h">1582</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# anchor. This needs to be left relative to the including topic</td></tr>
<tr><td class="h">1583</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# so do nothing</td></tr>
<tr><td class="h">1584</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $url ) {</td></tr>
<tr><td class="h">1585</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: is this test enough to detect relative URLs?</td></tr>
<tr><td class="h">1586</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $theHost.$theAbsPath.&#39;/&#39;.$url;</td></tr>
<tr><td class="h">1587</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1588</td><td colspan="6"></td></tr><tr><td class="h">1589</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url;</td></tr>
<tr><td class="h">1590</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1591</td><td colspan="6"></td></tr><tr><td class="h">1592</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _fixIncludeLink {</td></tr>
<tr><td class="h">1593</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1593">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $theWeb, $theLink, $theLabel ) = @_;</td></tr>
<tr><td class="h">1594</td><td colspan="6"></td></tr><tr><td class="h">1595</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# [[...][...]] link</td></tr>
<tr><td class="h">1596</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1596">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1596">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $theLink =~ /^($regex{webNameRegex}\.|$regex{defaultWebNameRegex}\.|$regex{linkProtocolPattern}\:|\/)/o ) {</td></tr>
<tr><td class="h">1597</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1597">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $theLabel ) {</td></tr>
<tr><td class="h">1598</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;[[$theLink][$theLabel]]&quot;;</td></tr>
<tr><td class="h">1599</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1600</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;[[$theLink]]&quot;;</td></tr>
<tr><td class="h">1601</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1602</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $theLabel ) {</td></tr>
<tr><td class="h">1603</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;[[$theWeb.$theLink][$theLabel]]&quot;;</td></tr>
<tr><td class="h">1604</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1605</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;[[$theWeb.$theLink][$theLink]]&quot;;</td></tr>
<tr><td class="h">1606</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1607</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1608</td><td colspan="6"></td></tr><tr><td class="h">1609</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Clean-up HTML text so that it can be shown embedded in a topic</td></tr>
<tr><td class="h">1610</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _cleanupIncludedHTML {</td></tr>
<tr><td class="h">1611</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1611">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $text, $host, $path, $options ) = @_;</td></tr>
<tr><td class="h">1612</td><td colspan="6"></td></tr><tr><td class="h">1613</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: Make aware of &lt;base&gt; tag</td></tr>
<tr><td class="h">1614</td><td colspan="6"></td></tr><tr><td class="h">1615</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1615">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^.*?&lt;\/head&gt;//is</td></tr>
<tr><td class="h">1616</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disableremoveheaders} );   # remove all HEAD</td></tr>
<tr><td class="h">1617</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1617">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;script.*?&lt;\/script&gt;//gis</td></tr>
<tr><td class="h">1618</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disableremovescript} );    # remove all SCRIPTs</td></tr>
<tr><td class="h">1619</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1619">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^.*?&lt;body[^&gt;]*&gt;//is</td></tr>
<tr><td class="h">1620</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disableremovebody} );      # remove all to &lt;BODY&gt;</td></tr>
<tr><td class="h">1621</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1621">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(?:\n)&lt;\/body&gt;.*//is</td></tr>
<tr><td class="h">1622</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disableremovebody} );      # remove &lt;/BODY&gt;</td></tr>
<tr><td class="h">1623</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1623">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(?:\n)&lt;\/html&gt;.*//is</td></tr>
<tr><td class="h">1624</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disableremoveheaders} );   # remove &lt;/HTML&gt;</td></tr>
<tr><td class="h">1625</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1625">0</a></div></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(&lt;[^&gt;]*&gt;)/_removeNewlines($1)/ges</td></tr>
<tr><td class="h">1626</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disablecompresstags} );    # replace newlines in html tags with space</td></tr>
<tr><td class="h">1627</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1627">0</a></div></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(\s(?:href|src|action)=([&quot;&#39;]))(.*?)\2/$1._rewriteURLInInclude( $host, $path, $3 ).$2/geois</td></tr>
<tr><td class="h">1628</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( $options-&gt;{disablerewriteurls} );</td></tr>
<tr><td class="h">1629</td><td colspan="6"></td></tr><tr><td class="h">1630</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1631</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1632</td><td colspan="6"></td></tr><tr><td class="h">1633 - 1639</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod applyPatternToIncludedText( $text, $pattern ) -&gt; $text

Apply a pattern on included text to extract a subset

=cut</pre></td></tr>
<tr><td class="h">1640</td><td colspan="6"></td></tr><tr><td class="h">1641</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub applyPatternToIncludedText {</td></tr>
<tr><td class="h">1642</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1642">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $theText, $thePattern ) = @_;</td></tr>
<tr><td class="h">1643</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$thePattern =~ s/([^\\])([\$\@\%\&amp;\#\&#39;\`\/])/$1\\$2/g;  # escape some special chars</td></tr>
<tr><td class="h">1644</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$thePattern = TWiki::Sandbox::untaintUnchecked( $thePattern );</td></tr>
<tr><td class="h">1645</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1645">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theText = &#39;&#39; unless( $theText =~ s/$thePattern/$1/is );</td></tr>
<tr><td class="h">1646</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $theText;</td></tr>
<tr><td class="h">1647</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1648</td><td colspan="6"></td></tr><tr><td class="h">1649</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Fetch content from a URL for inclusion by an INCLUDE</td></tr>
<tr><td class="h">1650</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _includeUrl {</td></tr>
<tr><td class="h">1651</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1651">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $url, $pattern, $web, $topic, $raw, $options, $warn ) = @_;</td></tr>
<tr><td class="h">1652</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &#39;&#39;;</td></tr>
<tr><td class="h">1653</td><td colspan="6"></td></tr><tr><td class="h">1654</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# For speed, read file directly if URL matches an attachment directory</td></tr>
<tr><td class="h">1655</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1655">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url =~ /^$this-&gt;{urlHost}$TWiki::cfg{PubUrlPath}\/([^\/\.]+)\/([^\/\.]+)\/([^\/]+)$/ ) {</td></tr>
<tr><td class="h">1656</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $incWeb = $1;</td></tr>
<tr><td class="h">1657</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $incTopic = $2;</td></tr>
<tr><td class="h">1658</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $incAtt = $3;</td></tr>
<tr><td class="h">1659</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: Check for MIME type, not file suffix</td></tr>
<tr><td class="h">1660</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1660">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $incAtt =~ m/\.(txt|html?)$/i ) {</td></tr>
<tr><td class="h">1661</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1661">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{store}-&gt;attachmentExists(</td></tr>
<tr><td class="h">1662</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$incWeb, $incTopic, $incAtt )) {</td></tr>
<tr><td class="h">1663</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;bad_attachment&#39;, $url );</td></tr>
<tr><td class="h">1664</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1665</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1665">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1665">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $incWeb ne $web || $incTopic ne $topic ) {</td></tr>
<tr><td class="h">1666</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# CODE_SMELL: Does not account for not yet authenticated user</td></tr>
<tr><td class="h">1667</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1667">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{security}-&gt;checkAccessPermission(</td></tr>
<tr><td class="h">1668</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;view&#39;, $this-&gt;{user}, undef, undef, $incTopic, $incWeb ) ) {</td></tr>
<tr><td class="h">1669</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;access_denied&#39;,</td></tr>
<tr><td class="h">1670</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;$incWeb.$incTopic&quot; );</td></tr>
<tr><td class="h">1671</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1672</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1673</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{store}-&gt;readAttachment( undef, $incWeb, $incTopic,</td></tr>
<tr><td class="h">1674</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$incAtt );</td></tr>
<tr><td class="h">1675</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1675">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = _cleanupIncludedHTML( $text, $this-&gt;{urlHost},</td></tr>
<tr><td class="h">1676</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{PubUrlPath}, $options )</td></tr>
<tr><td class="h">1677</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $raw;</td></tr>
<tr><td class="h">1678</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1678">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = applyPatternToIncludedText( $text, $pattern )</td></tr>
<tr><td class="h">1679</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $pattern );</td></tr>
<tr><td class="h">1680</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1680">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = &quot;&lt;literal&gt;\n&quot; . $text . &quot;\n&lt;/literal&gt;&quot; if ( $options-&gt;{literal} );</td></tr>
<tr><td class="h">1681</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1682</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1683</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fall through; try to include file over http based on MIME setting</td></tr>
<tr><td class="h">1684</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1685</td><td colspan="6"></td></tr><tr><td class="h">1686</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1686">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;urls_not_allowed&#39; )</td></tr>
<tr><td class="h">1687</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $TWiki::cfg{INCLUDE}{AllowURLs};</td></tr>
<tr><td class="h">1688</td><td colspan="6"></td></tr><tr><td class="h">1689</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: should use the URI module from CPAN to parse the URL</td></tr>
<tr><td class="h">1690</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: but additional CPAN adds to code bloat</td></tr>
<tr><td class="h">1691</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $path = $url;</td></tr>
<tr><td class="h">1692</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1692">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($path =~ s!^(https?)://!!) {</td></tr>
<tr><td class="h">1693</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;_includeWarning( $warn, &#39;bad_protocol&#39;, $url );</td></tr>
<tr><td class="h">1694</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1695</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1696</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $protocol = $1;</td></tr>
<tr><td class="h">1697</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $user, $pass );</td></tr>
<tr><td class="h">1698</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1698">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($path =~ s!([^/\@:]+)(?::([^/\@:]+))?@!!) {</td></tr>
<tr><td class="h">1699</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $user, $pass ) = ( $1, $2 );</td></tr>
<tr><td class="h">1700</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1701</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1701">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($path =~ s!([^:/]+)(?::([0-9]+))?!! ) {</td></tr>
<tr><td class="h">1702</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;geturl_failed&#39;, $url );</td></tr>
<tr><td class="h">1703</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1704</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $host, $port ) = ( $1, $2 );</td></tr>
<tr><td class="h">1705</td><td colspan="6"></td></tr><tr><td class="h">1706</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;try {</td></tr>
<tr><td class="h">1707</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1707">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{net}-&gt;getUrl( $protocol, $host, $port, $path, $user, $pass );</td></tr>
<tr><td class="h">1708</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\r\n/\n/gs;</td></tr>
<tr><td class="h">1709</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\r/\n/gs;</td></tr>
<tr><td class="h">1710</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^(.*?\n)\n//s;</td></tr>
<tr><td class="h">1711</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $httpHeader = $1;</td></tr>
<tr><td class="h">1712</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Trap 4xx and 5xx</td></tr>
<tr><td class="h">1713</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1713">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die $text if ($httpHeader =~ /^HTTP\/[\d.]+\s[45]\d\d\s/s);</td></tr>
<tr><td class="h">1714</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $contentType = &#39;&#39;;</td></tr>
<tr><td class="h">1715</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1715">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $httpHeader =~ /content\-type\:\s*([^\n]*)/ois ) {</td></tr>
<tr><td class="h">1716</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$contentType = $1;</td></tr>
<tr><td class="h">1717</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1718</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1718">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1718">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $contentType =~ /^text\/html/ ) {</td></tr>
<tr><td class="h">1719</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s/[#?].*$//;</td></tr>
<tr><td class="h">1720</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host = $protocol.&#39;://&#39;.$host;</td></tr>
<tr><td class="h">1721</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1721">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host .= &quot;:$port&quot; if $port;</td></tr>
<tr><td class="h">1722</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1722">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = _cleanupIncludedHTML( $text, $host, $path, $options )</td></tr>
<tr><td class="h">1723</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $raw;</td></tr>
<tr><td class="h">1724</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $contentType =~ /^text\/(plain|css)/ ) {</td></tr>
<tr><td class="h">1725</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# do nothing</td></tr>
<tr><td class="h">1726</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1727</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;_includeWarning(</td></tr>
<tr><td class="h">1728</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$warn, &#39;bad_content&#39;, $contentType );</td></tr>
<tr><td class="h">1729</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1730</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1730">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = applyPatternToIncludedText( $text, $pattern ) if( $pattern );</td></tr>
<tr><td class="h">1731</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1731">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = &quot;&lt;literal&gt;\n&quot; . $text . &quot;\n&lt;/literal&gt;&quot; if ( $options-&gt;{literal} );</td></tr>
<tr><td class="h">1732</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} catch Error::Simple with {</td></tr>
<tr><td class="h">1733</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1733">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $e = shift;</td></tr>
<tr><td class="h">1734</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;_includeWarning( $warn, &#39;geturl_failed&#39;, $url );</td></tr>
<tr><td class="h">1735</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1736</td><td colspan="6"></td></tr><tr><td class="h">1737</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1738</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1739</td><td colspan="6"></td></tr><tr><td class="h">1740</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">1741</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: this is _not_ a tag handler in the sense of other builtin tags,</td></tr>
<tr><td class="h">1742</td><td></td><td></td><td></td><td></td><td></td><td class="s"># because it requires far more context information (the text of the topic)</td></tr>
<tr><td class="h">1743</td><td></td><td></td><td></td><td></td><td></td><td class="s"># than any handler.</td></tr>
<tr><td class="h">1744</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: as a tag handler that also semi-renders the topic to extract the</td></tr>
<tr><td class="h">1745</td><td></td><td></td><td></td><td></td><td></td><td class="s"># headings, this handler would be much better as a preRenderingHandler in</td></tr>
<tr><td class="h">1746</td><td></td><td></td><td></td><td></td><td></td><td class="s"># a plugin (where head, script and verbatim sections are already protected)</td></tr>
<tr><td class="h">1747</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">1748</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $text  : ref to the text of the current topic</td></tr>
<tr><td class="h">1749</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $topic : the topic we are in</td></tr>
<tr><td class="h">1750</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $web   : the web we are in</td></tr>
<tr><td class="h">1751</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $args  : &#39;Topic&#39; [web=&#39;Web&#39;] [depth=&#39;N&#39;]</td></tr>
<tr><td class="h">1752</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Return value: $tableOfContents</td></tr>
<tr><td class="h">1753</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Handles %&lt;nop&gt;TOC{...}% syntax.  Creates a table of contents</td></tr>
<tr><td class="h">1754</td><td></td><td></td><td></td><td></td><td></td><td class="s"># using TWiki bulleted</td></tr>
<tr><td class="h">1755</td><td></td><td></td><td></td><td></td><td></td><td class="s"># list markup, linked to the section headings of a topic. A section heading is</td></tr>
<tr><td class="h">1756</td><td></td><td></td><td></td><td></td><td></td><td class="s"># entered in one of the following forms:</td></tr>
<tr><td class="h">1757</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $headingPatternSp : \t++... spaces section heading</td></tr>
<tr><td class="h">1758</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $headingPatternDa : ---++... dashes section heading</td></tr>
<tr><td class="h">1759</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    * $headingPatternHt : &amp;lt;h[1-6]&gt; HTML section heading &amp;lt;/h[1-6]&gt;</td></tr>
<tr><td class="h">1760</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TOC {</td></tr>
<tr><td class="h">1761</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1761">1</a></div></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $text, $defaultTopic, $defaultWeb, $args ) = @_;</td></tr>
<tr><td class="h">1762</td><td colspan="6"></td></tr><tr><td class="h">1763</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $params = new TWiki::Attrs( $args );</td></tr>
<tr><td class="h">1764</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# get the topic name attribute</td></tr>
<tr><td class="h">1765</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1765">33</a></div></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = $params-&gt;{_DEFAULT} || $defaultTopic;</td></tr>
<tr><td class="h">1766</td><td colspan="6"></td></tr><tr><td class="h">1767</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# get the web name attribute</td></tr>
<tr><td class="h">1768</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$defaultWeb =~ s#/#.#g;</td></tr>
<tr><td class="h">1769</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1769">33</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $params-&gt;{web} || $defaultWeb;</td></tr>
<tr><td class="h">1770</td><td colspan="6"></td></tr><tr><td class="h">1771</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1771">33</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $isSameTopic = $web eq $defaultWeb  &amp;&amp;  $topic eq $defaultTopic;</td></tr>
<tr><td class="h">1772</td><td colspan="6"></td></tr><tr><td class="h">1773</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s#/#\.#g;</td></tr>
<tr><td class="h">1774</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $webPath = $web;</td></tr>
<tr><td class="h">1775</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$webPath =~ s/\./\//g;</td></tr>
<tr><td class="h">1776</td><td colspan="6"></td></tr><tr><td class="h">1777</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# get the depth limit attribute</td></tr>
<tr><td class="h">1778</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1778">50</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $depth = $params-&gt;{depth} || 6;</td></tr>
<tr><td class="h">1779</td><td colspan="6"></td></tr><tr><td class="h">1780</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# get the title attribute</td></tr>
<tr><td class="h">1781</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1781">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $title = $params-&gt;{title} || &#39;&#39;;</td></tr>
<tr><td class="h">1782</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1782">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$title = CGI::span( { class =&gt; &#39;twikiTocTitle&#39; }, $title ) if( $title );</td></tr>
<tr><td class="h">1783</td><td colspan="6"></td></tr><tr><td class="h">1784</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1784">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1784">33</a></div></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $web ne $defaultWeb || $topic ne $defaultTopic ) {</td></tr>
<tr><td class="h">1785</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1785">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{security}-&gt;checkAccessPermission</td></tr>
<tr><td class="h">1786</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &#39;view&#39;, $this-&gt;{user}, undef, undef, $topic, $web ) ) {</td></tr>
<tr><td class="h">1787</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;inlineAlert( &#39;alerts&#39;, &#39;access_denied&#39;,</td></tr>
<tr><td class="h">1788</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web, $topic );</td></tr>
<tr><td class="h">1789</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1790</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $meta;</td></tr>
<tr><td class="h">1791</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $meta, $text ) =</td></tr>
<tr><td class="h">1792</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{store}-&gt;readTopic( $this-&gt;{user}, $web, $topic );</td></tr>
<tr><td class="h">1793</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1794</td><td colspan="6"></td></tr><tr><td class="h">1795</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $insidePre = 0;</td></tr>
<tr><td class="h">1796</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $insideVerbatim = 0;</td></tr>
<tr><td class="h">1797</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $highest = 99;</td></tr>
<tr><td class="h">1798</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result  = &#39;&#39;;</td></tr>
<tr><td class="h">1799</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $verbatim = {};</td></tr>
<tr><td class="h">1800</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{renderer}-&gt;takeOutBlocks( $text, &#39;verbatim&#39;,</td></tr>
<tr><td class="h">1801</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$verbatim);</td></tr>
<tr><td class="h">1802</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{renderer}-&gt;takeOutBlocks( $text, &#39;pre&#39;,</td></tr>
<tr><td class="h">1803</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$verbatim);</td></tr>
<tr><td class="h">1804</td><td colspan="6"></td></tr><tr><td class="h">1805</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Find URL parameters</td></tr>
<tr><td class="h">1806</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $query = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">1807</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @qparams = ();</td></tr>
<tr><td class="h">1808</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $name ( $query-&gt;param ) {</td></tr>
<tr><td class="h">1809</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1809">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if ($name eq &#39;keywords&#39;);</td></tr>
<tr><td class="h">1810</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1810">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if ($name eq &#39;topic&#39;);</td></tr>
<tr><td class="h">1811</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1811">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if ($name eq &#39;text&#39;);      </td></tr>
<tr><td class="h">1812</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @qparams, $name =&gt; $query-&gt;param($name);</td></tr>
<tr><td class="h">1813</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1814</td><td colspan="6"></td></tr><tr><td class="h">1815</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: this handling of &lt;pre&gt; is archaic.</td></tr>
<tr><td class="h">1816</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: use forEachLine</td></tr>
<tr><td class="h">1817</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>316</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $line ( split( /\r?\n/, $text ) ) {</td></tr>
<tr><td class="h">1818</td><td><div class="c3">470</div></td><td></td><td></td><td></td><td><div>1129</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $level;</td></tr>
<tr><td class="h">1819</td><td><div class="c3">470</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1819">100</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1819">50</a></div></td><td></td><td></td><td><div>3062</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ m/$regex{headerPatternDa}/o ) {</td></tr>
<tr><td class="h">1820</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>197</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = $2;</td></tr>
<tr><td class="h">1821</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>178</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$level = length $1;</td></tr>
<tr><td class="h">1822</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $line =~ m/$regex{headerPatternHt}/io ) {</td></tr>
<tr><td class="h">1823</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = $2;</td></tr>
<tr><td class="h">1824</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$level = $1;</td></tr>
<tr><td class="h">1825</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1826</td><td><div class="c3">410</div></td><td></td><td></td><td></td><td><div>1378</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1827</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1828</td><td colspan="6"></td></tr><tr><td class="h">1829</td><td><div class="c3">60</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1829">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1829">33</a></div></td><td></td><td><div>576</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $line &amp;&amp; $level &lt;= $depth ) {</td></tr>
<tr><td class="h">1830</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# cut TOC exclude &#39;---+ heading !! exclude this bit&#39;</td></tr>
<tr><td class="h">1831</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>410</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\s*$regex{headerPatternNoTOC}.+$//go;</td></tr>
<tr><td class="h">1832</td><td><div class="c3">60</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1832">100</a></div></td><td></td><td></td><td><div>291</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $line;</td></tr>
<tr><td class="h">1833</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>117</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $anchor = $this-&gt;{renderer}-&gt;makeAnchorName( $line );</td></tr>
<tr><td class="h">1834</td><td><div class="c3">23</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1834">100</a></div></td><td></td><td></td><td><div>103</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$highest = $level if( $level &lt; $highest );</td></tr>
<tr><td class="h">1835</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tabs = &quot;\t&quot; x $level;</td></tr>
<tr><td class="h">1836</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Remove *bold*, _italic_ and =fixed= formatting</td></tr>
<tr><td class="h">1837</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>70</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/(^|[\s\(])\*([^\s]+?|[^\s].*?[^\s])\*($|[\s\,\.\;\:\!\?\)])/$1$2$3/g;</td></tr>
<tr><td class="h">1838</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/(^|[\s\(])_+([^\s]+?|[^\s].*?[^\s])_+($|[\s\,\.\;\:\!\?\)])/$1$2$3/g;</td></tr>
<tr><td class="h">1839</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>65</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/(^|[\s\(])=+([^\s]+?|[^\s].*?[^\s])=+($|[\s\,\.\;\:\!\?\)])/$1$2$3/g;</td></tr>
<tr><td class="h">1840</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prevent WikiLinks</td></tr>
<tr><td class="h">1841</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\[\[.*?\]\[(.*?)\]\]/$1/g;  # &#39;[[...][...]]&#39;</td></tr>
<tr><td class="h">1842</td><td><div class="c3">23</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>58</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\[\[(.*?)\]\]/$1/ge;        # &#39;[[...]]&#39;</td></tr>
<tr><td class="h">1843</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>163</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/([\s\(])($regex{webNameRegex})\.($regex{wikiWordRegex})/$1&lt;nop&gt;$3/go;  # &#39;Web.TopicName&#39;</td></tr>
<tr><td class="h">1844</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>138</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/([\s\(])($regex{wikiWordRegex})/$1&lt;nop&gt;$2/go;  # &#39;TopicName&#39;</td></tr>
<tr><td class="h">1845</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>144</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/([\s\(])($regex{abbrevRegex})/$1&lt;nop&gt;$2/go;    # &#39;TLA&#39;</td></tr>
<tr><td class="h">1846</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>107</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/([\s\-\*\(])([$regex{mixedAlphaNum}]+\:)/$1&lt;nop&gt;$2/go; # &#39;Site:page&#39; Interwiki link</td></tr>
<tr><td class="h">1847</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prevent manual links</td></tr>
<tr><td class="h">1848</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>65</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/&lt;[\/]?a\b[^&gt;]*&gt;//gi;</td></tr>
<tr><td class="h">1849</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# create linked bullet item, using a relative link to anchor</td></tr>
<tr><td class="h">1850</td><td><div class="c3">23</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1850">50</a></div></td><td></td><td></td><td><div>108</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $target = $isSameTopic ?</td></tr>
<tr><td class="h">1851</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_make_params(0, &#39;#&#39;=&gt;$anchor,@qparams) :</td></tr>
<tr><td class="h">1852</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;getScriptUrl(0,&#39;view&#39;,$web,$topic,&#39;#&#39;=&gt;$anchor,@qparams);</td></tr>
<tr><td class="h">1853</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>136</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = $tabs.&#39;* &#39; .  CGI::a({href=&gt;$target},$line);</td></tr>
<tr><td class="h">1854</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>125</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= &quot;\n&quot;.$line;</td></tr>
<tr><td class="h">1855</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1856</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1857</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1857">50</a></div></td><td></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $result ) {</td></tr>
<tr><td class="h">1858</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1858">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $highest &gt; 1 ) {</td></tr>
<tr><td class="h">1859</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# left shift TOC</td></tr>
<tr><td class="h">1860</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$highest--;</td></tr>
<tr><td class="h">1861</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result =~ s/^\t{$highest}//gm;</td></tr>
<tr><td class="h">1862</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1863</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return CGI::div( { class=&gt;&#39;twikiToc&#39; }, &quot;$title$result\n&quot; );</td></tr>
<tr><td class="h">1864</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1865</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">1866</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1867</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1868</td><td colspan="6"></td></tr><tr><td class="h">1869 - 1877</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod inlineAlert($template, $def, ... ) -&gt; $string

Format an error for inline inclusion in rendered output. The message string
is obtained from the template &#39;oops&#39;.$template, and the DEF $def is
selected. The parameters (...) are used to populate %PARAM1%..%PARAMn%

=cut</pre></td></tr>
<tr><td class="h">1878</td><td colspan="6"></td></tr><tr><td class="h">1879</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub inlineAlert {</td></tr>
<tr><td class="h">1880</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1880">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">1881</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $template = shift;</td></tr>
<tr><td class="h">1882</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $def = shift;</td></tr>
<tr><td class="h">1883</td><td colspan="6"></td></tr><tr><td class="h">1884</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = $this-&gt;{templates}-&gt;readTemplate( &#39;oops&#39;.$template,</td></tr>
<tr><td class="h">1885</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;getSkin() );</td></tr>
<tr><td class="h">1886</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1886">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $text ) {</td></tr>
<tr><td class="h">1887</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $blah = $this-&gt;{templates}-&gt;expandTemplate( $def );</td></tr>
<tr><td class="h">1888</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%INSTANTIATE%/$blah/;</td></tr>
<tr><td class="h">1889</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# web and topic can be anything; they are not used</td></tr>
<tr><td class="h">1890</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;handleCommonTags( $text, $this-&gt;{webName},</td></tr>
<tr><td class="h">1891</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topicName} );</td></tr>
<tr><td class="h">1892</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $n = 1;</td></tr>
<tr><td class="h">1893</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while( defined( my $param = shift )) {</td></tr>
<tr><td class="h">1894</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%PARAM$n%/$param/g;</td></tr>
<tr><td class="h">1895</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$n++;</td></tr>
<tr><td class="h">1896</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1897</td><td colspan="6"></td></tr><tr><td class="h">1898</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1899</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = CGI::h1(&#39;TWiki Installation Error&#39;)</td></tr>
<tr><td class="h">1900</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &#39;Template &quot;&#39;.$template.&#39;&quot; not found.&#39;.CGI::p()</td></tr>
<tr><td class="h">1901</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &#39;Check the configuration setting for {TemplateDir}&#39;;</td></tr>
<tr><td class="h">1902</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1903</td><td colspan="6"></td></tr><tr><td class="h">1904</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1905</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1906</td><td colspan="6"></td></tr><tr><td class="h">1907 - 1928</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod parseSections($text) -&gt; ($string,$sectionlistref)

Generic parser for sections within a topic. Sections are delimited
by STARTSECTION and ENDSECTION, which may be nested, overlapped or
otherwise abused. The parser builds an array of sections, which is
ordered by the order of the STARTSECTION within the topic. It also
removes all the SECTION tags from the text, and returns the text
and the array of sections.

Each section is a =TWiki::Attrs= object, which contains the attributes
{type, name, start, end}
where start and end are character offsets in the
string *after all section tags have been removed*. All sections
are required to be uniquely named; if a section is unnamed, it
will be given a generated name. Sections may overlap or nest.

See test/unit/Fn_SECTION.pm for detailed testcases that
round out the spec.

=cut</pre></td></tr>
<tr><td class="h">1929</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub parseSections {</td></tr>
<tr><td class="h">1930</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#my( $text _ = @_;</td></tr>
<tr><td class="h">1931</td><td><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L1931">6</a></div></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %sections;</td></tr>
<tr><td class="h">1932</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list = ();</td></tr>
<tr><td class="h">1933</td><td colspan="6"></td></tr><tr><td class="h">1934</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $seq = 0;</td></tr>
<tr><td class="h">1935</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ntext = &#39;&#39;;</td></tr>
<tr><td class="h">1936</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $offset = 0;</td></tr>
<tr><td class="h">1937</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $bit (split(/(%(?:START|END)SECTION(?:{.*?})?%)/, $_[0] )) {</td></tr>
<tr><td class="h">1938</td><td><div class="c3">6</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1938">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1938">50</a></div></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $bit =~ /^%STARTSECTION(?:{(.*)})?%$/) {</td></tr>
<tr><td class="h">1939</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $attrs = new TWiki::Attrs( $1 );</td></tr>
<tr><td class="h">1940</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1940">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{type} ||= &#39;section&#39;;</td></tr>
<tr><td class="h">1941</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1941">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{name} = $attrs-&gt;{_DEFAULT} || $attrs-&gt;{name} ||</td></tr>
<tr><td class="h">1942</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;_SECTION&#39;.$seq++;</td></tr>
<tr><td class="h">1943</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $attrs-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">1944</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $id = $attrs-&gt;{type}.&#39;:&#39;.$attrs-&gt;{name};</td></tr>
<tr><td class="h">1945</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1945">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $sections{$id} ) {</td></tr>
<tr><td class="h">1946</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# error, this named section already defined, ignore</td></tr>
<tr><td class="h">1947</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1948</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1949</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# close open unnamed sections of the same type</td></tr>
<tr><td class="h">1950</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $s ( @list ) {</td></tr>
<tr><td class="h">1951</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1951">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1951">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $s-&gt;{end} &lt; 0 &amp;&amp; $s-&gt;{type} eq $attrs-&gt;{type} &amp;&amp;</td></tr>
<tr><td class="h">1952</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s-&gt;{name} =~ /^_SECTION\d+$/ ) {</td></tr>
<tr><td class="h">1953</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s-&gt;{end} = $offset;</td></tr>
<tr><td class="h">1954</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1955</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1956</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{start} = $offset;</td></tr>
<tr><td class="h">1957</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{end} = -1; # open section</td></tr>
<tr><td class="h">1958</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sections{$id} = $attrs;</td></tr>
<tr><td class="h">1959</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @list, $attrs );</td></tr>
<tr><td class="h">1960</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $bit =~ /^%ENDSECTION(?:{(.*)})?%$/ ) {</td></tr>
<tr><td class="h">1961</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $attrs = new TWiki::Attrs( $1 );</td></tr>
<tr><td class="h">1962</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1962">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{type} ||= &#39;section&#39;;</td></tr>
<tr><td class="h">1963</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1963">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{name} = $attrs-&gt;{_DEFAULT} || $attrs-&gt;{name} || &#39;&#39;;</td></tr>
<tr><td class="h">1964</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $attrs-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">1965</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1965">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $attrs-&gt;{name} ) {</td></tr>
<tr><td class="h">1966</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# find the last open unnamed section of this type</td></tr>
<tr><td class="h">1967</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $s ( reverse @list ) {</td></tr>
<tr><td class="h">1968</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1968">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1968">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $s-&gt;{end} == -1 &amp;&amp;</td></tr>
<tr><td class="h">1969</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s-&gt;{type} eq $attrs-&gt;{type} &amp;&amp;</td></tr>
<tr><td class="h">1970</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s-&gt;{name} =~ /^_SECTION\d+$/ ) {</td></tr>
<tr><td class="h">1971</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs-&gt;{name} = $s-&gt;{name};</td></tr>
<tr><td class="h">1972</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last;</td></tr>
<tr><td class="h">1973</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1974</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1975</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ignore it if no matching START found</td></tr>
<tr><td class="h">1976</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1976">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $attrs-&gt;{name};</td></tr>
<tr><td class="h">1977</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1978</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $id = $attrs-&gt;{type}.&#39;:&#39;.$attrs-&gt;{name};</td></tr>
<tr><td class="h">1979</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1979">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L1979">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( !$sections{$id} || $sections{$id}-&gt;{end} &gt;= 0 ) {</td></tr>
<tr><td class="h">1980</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# error, no such open section, ignore</td></tr>
<tr><td class="h">1981</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1982</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1983</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sections{$id}-&gt;{end} = $offset;</td></tr>
<tr><td class="h">1984</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1985</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ntext .= $bit;</td></tr>
<tr><td class="h">1986</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$offset = length( $ntext );</td></tr>
<tr><td class="h">1987</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1988</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1989</td><td colspan="6"></td></tr><tr><td class="h">1990</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# close open sections</td></tr>
<tr><td class="h">1991</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $s ( @list ) {</td></tr>
<tr><td class="h">1992</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L1992">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s-&gt;{end} = $offset if $s-&gt;{end} &lt; 0;</td></tr>
<tr><td class="h">1993</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1994</td><td colspan="6"></td></tr><tr><td class="h">1995</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return( $ntext, \@list );</td></tr>
<tr><td class="h">1996</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1997</td><td colspan="6"></td></tr><tr><td class="h">1998 - 2009</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod expandVariablesOnTopicCreation ( $text, $user ) -&gt; $text

   * =$text= - text to expand
   * =$user= - reference to user object. This is the user expanded in e.g. %USERNAME. Optional, defaults to logged-in user.
Expand limited set of variables during topic creation. These are variables
expected in templates that must be statically expanded in new content.

# SMELL: no plugin handler

=cut</pre></td></tr>
<tr><td class="h">2010</td><td colspan="6"></td></tr><tr><td class="h">2011</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub expandVariablesOnTopicCreation {</td></tr>
<tr><td class="h">2012</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2012">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $text, $user ) = @_;</td></tr>
<tr><td class="h">2013</td><td colspan="6"></td></tr><tr><td class="h">2014</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">2015</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2015">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$user ||= $this-&gt;{user};</td></tr>
<tr><td class="h">2016</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($user-&gt;isa( &#39;TWiki::User&#39;)) if DEBUG;</td></tr>
<tr><td class="h">2017</td><td colspan="6"></td></tr><tr><td class="h">2018</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Chop out templateonly sections</td></tr>
<tr><td class="h">2019</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $ntext, $sections ) = parseSections( $text );</td></tr>
<tr><td class="h">2020</td><td colspan="6"></td></tr><tr><td class="h">2021</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2021">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( scalar( @$sections )) {</td></tr>
<tr><td class="h">2022</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note that if named templateonly sections overlap, the behaviour is undefined.</td></tr>
<tr><td class="h">2023</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $s ( reverse @$sections ) {</td></tr>
<tr><td class="h">2024</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2024">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $s-&gt;{type} eq &#39;templateonly&#39; ) {</td></tr>
<tr><td class="h">2025</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ntext = substr($ntext, 0, $s-&gt;{start}).</td></tr>
<tr><td class="h">2026</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substr($ntext, $s-&gt;{end}, length($ntext));</td></tr>
<tr><td class="h">2027</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2028</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# put back non-templateonly sections</td></tr>
<tr><td class="h">2029</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $start = $s-&gt;remove(&#39;start&#39;);</td></tr>
<tr><td class="h">2030</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $end = $s-&gt;remove(&#39;end&#39;);</td></tr>
<tr><td class="h">2031</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ntext = substr($ntext, 0, $start).</td></tr>
<tr><td class="h">2032</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;%STARTSECTION{&#39;.$s-&gt;stringify().&#39;}%&#39;.</td></tr>
<tr><td class="h">2033</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substr($ntext, $start, $end - $start).</td></tr>
<tr><td class="h">2034</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;%ENDSECTION{&#39;.$s-&gt;stringify().&#39;}%&#39;.</td></tr>
<tr><td class="h">2035</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substr($ntext, $end, length($ntext));</td></tr>
<tr><td class="h">2036</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2037</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2038</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $ntext;</td></tr>
<tr><td class="h">2039</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2040</td><td colspan="6"></td></tr><tr><td class="h">2041</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Make sure func works, for registered tag handlers</td></tr>
<tr><td class="h">2042</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::Plugins::SESSION = $this;</td></tr>
<tr><td class="h">2043</td><td colspan="6"></td></tr><tr><td class="h">2044</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Note: it may look dangerous to override the user this way, but</td></tr>
<tr><td class="h">2045</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# it&#39;s actually quite safe, because only a subset of tags are</td></tr>
<tr><td class="h">2046</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# expanded during topic creation. if the set of tags expanded is</td></tr>
<tr><td class="h">2047</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# extended, then the impact has to be considered.</td></tr>
<tr><td class="h">2048</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $safe = $this-&gt;{user};</td></tr>
<tr><td class="h">2049</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{user} = $user;</td></tr>
<tr><td class="h">2050</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;_processTags( $text, \&amp;_expandTagOnTopicCreation, 16 );</td></tr>
<tr><td class="h">2051</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# kill markers used to prevent variable expansion</td></tr>
<tr><td class="h">2052</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%NOP%//g;</td></tr>
<tr><td class="h">2053</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{user} = $safe;</td></tr>
<tr><td class="h">2054</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2055</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2056</td><td colspan="6"></td></tr><tr><td class="h">2057 - 2086</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod entityEncode( $text, $extras ) -&gt; $encodedText

Escape special characters to HTML numeric entities. This is *not* a generic
encoding, it is tuned specifically for use in TWiki.

HTML4.0 spec:
&quot;Certain characters in HTML are reserved for use as markup and must be
escaped to appear literally. The &quot;&amp;lt;&quot; character may be represented with
an &lt;em&gt;entity&lt;/em&gt;, &lt;strong class=html&gt;&amp;amp;lt;&lt;/strong&gt;. Similarly, &quot;&amp;gt;&quot;
is escaped as &lt;strong class=html&gt;&amp;amp;gt;&lt;/strong&gt;, and &quot;&amp;amp;&quot; is escaped
as &lt;strong class=html&gt;&amp;amp;amp;&lt;/strong&gt;. If an attribute value contains a
double quotation mark and is delimited by double quotation marks, then the
quote should be escaped as &lt;strong class=html&gt;&amp;amp;quot;&lt;/strong&gt;.&lt;/p&gt;

Other entities exist for special characters that cannot easily be entered
with some keyboards...&quot;

This method encodes HTML special and any non-printable ascii
characters (except for \n and \r) using numeric entities.

FURTHER this method also encodes characters that are special in TWiki
meta-language.

$extras is an optional param that may be used to include *additional*
characters in the set of encoded characters. It should be a string
containing the additional chars.

=cut</pre></td></tr>
<tr><td class="h">2087</td><td colspan="6"></td></tr><tr><td class="h">2088</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entityEncode {</td></tr>
<tr><td class="h">2089</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2089">2</a></div></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $text, $extra) = @_;</td></tr>
<tr><td class="h">2090</td><td><div class="c3">2</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2090">50</a></div></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$extra ||= &#39;&#39;;</td></tr>
<tr><td class="h">2091</td><td colspan="6"></td></tr><tr><td class="h">2092</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# encode all non-printable 7-bit chars (&lt; \x1f),</td></tr>
<tr><td class="h">2093</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# except \n (\xa) and \r (\xd)</td></tr>
<tr><td class="h">2094</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# encode HTML special characters &#39;&gt;&#39;, &#39;&lt;&#39;, &#39;&amp;&#39;, &#39;&#39;&#39; and &#39;&quot;&#39;.</td></tr>
<tr><td class="h">2095</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# encode TML special characters &#39;%&#39;, &#39;|&#39;, &#39;[&#39;, &#39;]&#39;, &#39;@&#39;, &#39;_&#39;,</td></tr>
<tr><td class="h">2096</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;*&#39;, and &#39;=&#39;</td></tr>
<tr><td class="h">2097</td><td><div class="c3">2</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>19</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/([[\x01-\x09\x0b\x0c\x0e-\x1f&quot;%&amp;&#39;*&lt;=&gt;@[_\|$extra])/&#39;&amp;#&#39;.ord($1).&#39;;&#39;/ge;</td></tr>
<tr><td class="h">2098</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2099</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2100</td><td colspan="6"></td></tr><tr><td class="h">2101 - 2108</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod entityDecode ( $encodedText ) -&gt; $text

Decodes all numeric entities (e.g. &amp;amp;#123;). _Does not_ decode
named entities such as &amp;amp;amp; (use HTML::Entities for that)

=cut</pre></td></tr>
<tr><td class="h">2109</td><td colspan="6"></td></tr><tr><td class="h">2110</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entityDecode {</td></tr>
<tr><td class="h">2111</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2111">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = shift;</td></tr>
<tr><td class="h">2112</td><td colspan="6"></td></tr><tr><td class="h">2113</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&amp;#(\d+);/chr($1)/ge;</td></tr>
<tr><td class="h">2114</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2115</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2116</td><td colspan="6"></td></tr><tr><td class="h">2117 - 2140</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod urlEncode( $string ) -&gt; encoded string

Encode by converting characters that are illegal in URLs to
their %NN equivalents. This method is used for encoding
strings that must be embedded _verbatim_ in URLs; it cannot
be applied to URLs themselves, as it escapes reserved
characters such as = and ?.

RFC 1738, Dec. &#39;94:
&lt;verbatim&gt;&gt;
...Only alphanumerics [0-9a-zA-Z], the special
characters $-_.+!*&#39;(), and reserved characters used for their
reserved purposes may be used unencoded within a URL.
&lt;/verbatim&gt;
Reserved characters are $&amp;+,/:;=?@ - these are _also_ encoded by
this method.

SMELL: For non-ISO-8859-1 $TWiki::cfg{Site}{CharSet}, need to convert to
UTF-8 before URL encoding. This encoding only supports 8-bit
character codes.

=cut</pre></td></tr>
<tr><td class="h">2141</td><td colspan="6"></td></tr><tr><td class="h">2142</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub urlEncode {</td></tr>
<tr><td class="h">2143</td><td><div class="c3">79</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2143">79</a></div></td><td><div>263</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = shift;</td></tr>
<tr><td class="h">2144</td><td colspan="6"></td></tr><tr><td class="h">2145</td><td><div class="c3">79</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>267</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/([^0-9a-zA-Z-_.:~!*&#39;()\/%])/&#39;%&#39;.sprintf(&#39;%02x&#39;,ord($1))/ge;</td></tr>
<tr><td class="h">2146</td><td colspan="6"></td></tr><tr><td class="h">2147</td><td><div class="c3">79</div></td><td></td><td></td><td></td><td><div>321</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2148</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2149</td><td colspan="6"></td></tr><tr><td class="h">2150 - 2156</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod urlDecode( $string ) -&gt; decoded string

Reverses the encoding done in urlEncode.

=cut</pre></td></tr>
<tr><td class="h">2157</td><td colspan="6"></td></tr><tr><td class="h">2158</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub urlDecode {</td></tr>
<tr><td class="h">2159</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2159">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = shift;</td></tr>
<tr><td class="h">2160</td><td colspan="6"></td></tr><tr><td class="h">2161</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%([\da-f]{2})/chr(hex($1))/gei;</td></tr>
<tr><td class="h">2162</td><td colspan="6"></td></tr><tr><td class="h">2163</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2164</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2165</td><td colspan="6"></td></tr><tr><td class="h">2166 - 2178</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod isTrue( $value, $default ) -&gt; $boolean

Returns 1 if =$value= is true, and 0 otherwise. &quot;true&quot; means set to
something with a Perl true value, with the special cases that &quot;off&quot;,
&quot;false&quot; and &quot;no&quot; (case insensitive) are forced to false. Leading and
trailing spaces in =$value= are ignored.

If the value is undef, then =$default= is returned. If =$default= is
not specified it is taken as 0.

=cut</pre></td></tr>
<tr><td class="h">2179</td><td colspan="6"></td></tr><tr><td class="h">2180</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub isTrue {</td></tr>
<tr><td class="h">2181</td><td><div class="c3">12</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2181">12</a></div></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $value, $default ) = @_;</td></tr>
<tr><td class="h">2182</td><td colspan="6"></td></tr><tr><td class="h">2183</td><td><div class="c3">12</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2183">50</a></div></td><td></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$default ||= 0;</td></tr>
<tr><td class="h">2184</td><td colspan="6"></td></tr><tr><td class="h">2185</td><td><div class="c3">12</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2185">100</a></div></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $default unless defined( $value );</td></tr>
<tr><td class="h">2186</td><td colspan="6"></td></tr><tr><td class="h">2187</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>106</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/^\s*(.*?)\s*$/$1/gi;</td></tr>
<tr><td class="h">2188</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/off//gi;</td></tr>
<tr><td class="h">2189</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/no//gi;</td></tr>
<tr><td class="h">2190</td><td><div class="c3">10</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2190">100</a></div></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $value ) ? 1 : 0;</td></tr>
<tr><td class="h">2191</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2192</td><td colspan="6"></td></tr><tr><td class="h">2193 - 2200</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod spaceOutWikiWord( $word, $sep ) -&gt; $string

Spaces out a wiki word by inserting a string (default: one space) between each word component.
With parameter $sep any string may be used as separator between the word components; if $sep is undefined it defaults to a space.

=cut</pre></td></tr>
<tr><td class="h">2201</td><td colspan="6"></td></tr><tr><td class="h">2202</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub spaceOutWikiWord {</td></tr>
<tr><td class="h">2203</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2203">50</a></div></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2203">1</a></div></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $word = shift || &#39;&#39;;</td></tr>
<tr><td class="h">2204</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2204">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sep = shift || &#39; &#39;;</td></tr>
<tr><td class="h">2205</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$word =~ s/([$regex{lowerAlpha}])([$regex{upperAlpha}$regex{numeric}]+)/$1$sep$2/go;</td></tr>
<tr><td class="h">2206</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$word =~ s/([$regex{numeric}])([$regex{upperAlpha}])/$1$sep$2/go;</td></tr>
<tr><td class="h">2207</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $word;</td></tr>
<tr><td class="h">2208</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2209</td><td colspan="6"></td></tr><tr><td class="h">2210</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Expands variables by replacing the variables with their</td></tr>
<tr><td class="h">2211</td><td></td><td></td><td></td><td></td><td></td><td class="s"># values. Some example variables: %&lt;nop&gt;TOPIC%, %&lt;nop&gt;SCRIPTURL%,</td></tr>
<tr><td class="h">2212</td><td></td><td></td><td></td><td></td><td></td><td class="s"># %&lt;nop&gt;WIKINAME%, etc.</td></tr>
<tr><td class="h">2213</td><td></td><td></td><td></td><td></td><td></td><td class="s"># $web and $incs are passed in for recursive include expansion. They can</td></tr>
<tr><td class="h">2214</td><td></td><td></td><td></td><td></td><td></td><td class="s"># safely be undef.</td></tr>
<tr><td class="h">2215</td><td></td><td></td><td></td><td></td><td></td><td class="s"># The rules for tag expansion are:</td></tr>
<tr><td class="h">2216</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    1 Tags are expanded left to right, in the order they are encountered.</td></tr>
<tr><td class="h">2217</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    1 Tags are recursively expanded as soon as they are encountered - the algorithm is inherently single-pass</td></tr>
<tr><td class="h">2218</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    1 A tag is not &quot;encountered&quot; until the matching }% has been seen, by which time all tags in parameters will have been expanded</td></tr>
<tr><td class="h">2219</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    1 Tag expansions that create new tags recursively are limited to a set number of hierarchical levels of expansion</td></tr>
<tr><td class="h">2220</td><td></td><td></td><td></td><td></td><td></td><td class="s"># </td></tr>
<tr><td class="h">2221</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Formerly known as handleInternalTags, but renamed when it was rewritten</td></tr>
<tr><td class="h">2222</td><td></td><td></td><td></td><td></td><td></td><td class="s"># because the old name clashes with the namespace of handlers.</td></tr>
<tr><td class="h">2223</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _expandAllTags {</td></tr>
<tr><td class="h">2224</td><td><div class="c3">61</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2224">61</a></div></td><td><div>221</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">2225</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>228</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = shift; # reference</td></tr>
<tr><td class="h">2226</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>222</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $topic, $web ) = @_;</td></tr>
<tr><td class="h">2227</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>198</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s#\.#/#go;</td></tr>
<tr><td class="h">2228</td><td colspan="6"></td></tr><tr><td class="h">2229</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# push current context</td></tr>
<tr><td class="h">2230</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>244</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memTopic = $this-&gt;{SESSION_TAGS}{TOPIC};</td></tr>
<tr><td class="h">2231</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>259</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memWeb   = $this-&gt;{SESSION_TAGS}{WEB};</td></tr>
<tr><td class="h">2232</td><td colspan="6"></td></tr><tr><td class="h">2233</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>241</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{TOPIC}   = $topic;</td></tr>
<tr><td class="h">2234</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>234</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{WEB}     = $web;</td></tr>
<tr><td class="h">2235</td><td colspan="6"></td></tr><tr><td class="h">2236</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Escape &#39; !%VARIABLE%&#39;</td></tr>
<tr><td class="h">2237</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>484</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$text =~ s/(?&lt;=\s)!%($regex{tagNameRegex})/&amp;#37;$1/g;</td></tr>
<tr><td class="h">2238</td><td colspan="6"></td></tr><tr><td class="h">2239</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Make sure func works, for registered tag handlers</td></tr>
<tr><td class="h">2240</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>185</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::Plugins::SESSION = $this;</td></tr>
<tr><td class="h">2241</td><td colspan="6"></td></tr><tr><td class="h">2242</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# NOTE TO DEBUGGERS</td></tr>
<tr><td class="h">2243</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The depth parameter in the following call controls the maximum number</td></tr>
<tr><td class="h">2244</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# of levels of expansion. If it is set to 1 then only tags in the</td></tr>
<tr><td class="h">2245</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# topic will be expanded; tags that they in turn generate will be</td></tr>
<tr><td class="h">2246</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# left unexpanded. If it is set to 2 then the expansion will stop after</td></tr>
<tr><td class="h">2247</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the first recursive inclusion, and so on. This is incredible useful</td></tr>
<tr><td class="h">2248</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# when debugging. The default is set to 16</td></tr>
<tr><td class="h">2249</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# to match the original limit on search expansion, though this of</td></tr>
<tr><td class="h">2250</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# course applies to _all_ tags and not just search.</td></tr>
<tr><td class="h">2251</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>333</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$text = $this-&gt;_processTags( $$text, \&amp;_expandTagOnTopicRendering,</td></tr>
<tr><td class="h">2252</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16, @_ );</td></tr>
<tr><td class="h">2253</td><td colspan="6"></td></tr><tr><td class="h">2254</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# restore previous context</td></tr>
<tr><td class="h">2255</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>281</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{TOPIC}   = $memTopic;</td></tr>
<tr><td class="h">2256</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>263</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{WEB}     = $memWeb;</td></tr>
<tr><td class="h">2257</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2258</td><td colspan="6"></td></tr><tr><td class="h">2259</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Process TWiki %TAGS{}% by parsing the input tokenised into</td></tr>
<tr><td class="h">2260</td><td></td><td></td><td></td><td></td><td></td><td class="s"># % separated sections. The parser is a simple stack-based parse,</td></tr>
<tr><td class="h">2261</td><td></td><td></td><td></td><td></td><td></td><td class="s"># sufficient to ensure nesting of tags is correct, but no more</td></tr>
<tr><td class="h">2262</td><td></td><td></td><td></td><td></td><td></td><td class="s"># than that.</td></tr>
<tr><td class="h">2263</td><td></td><td></td><td></td><td></td><td></td><td class="s"># $depth limits the number of recursive expansion steps that</td></tr>
<tr><td class="h">2264</td><td></td><td></td><td></td><td></td><td></td><td class="s"># can be performed on expanded tags.</td></tr>
<tr><td class="h">2265</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _processTags {</td></tr>
<tr><td class="h">2266</td><td><div class="c3">372</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2266">372</a></div></td><td><div>1158</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">2267</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1240</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = shift;</td></tr>
<tr><td class="h">2268</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1099</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tagf = shift;</td></tr>
<tr><td class="h">2269</td><td colspan="6"></td></tr><tr><td class="h">2270</td><td><div class="c3">372</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2270">50</a></div></td><td></td><td></td><td><div>1611</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless defined( $text );</td></tr>
<tr><td class="h">2271</td><td colspan="6"></td></tr><tr><td class="h">2272</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1116</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $depth = shift;</td></tr>
<tr><td class="h">2273</td><td colspan="6"></td></tr><tr><td class="h">2274</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# my( $topic, $web ) = @_;</td></tr>
<tr><td class="h">2275</td><td colspan="6"></td></tr><tr><td class="h">2276</td><td><div class="c3">372</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2276">50</a></div></td><td></td><td></td><td><div>1544</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ( $depth ) {</td></tr>
<tr><td class="h">2277</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mess = &quot;Max recursive depth reached: $text&quot;;</td></tr>
<tr><td class="h">2278</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;writeWarning( $mess );</td></tr>
<tr><td class="h">2279</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# prevent recursive expansion that just has been detected</td></tr>
<tr><td class="h">2280</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# from happening in the error message</td></tr>
<tr><td class="h">2281</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%(.*?)%/$1/go;</td></tr>
<tr><td class="h">2282</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2283</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2284</td><td colspan="6"></td></tr><tr><td class="h">2285</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1209</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $verbatim = {};</td></tr>
<tr><td class="h">2286</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1929</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{renderer}-&gt;takeOutBlocks( $text, &#39;verbatim&#39;,</td></tr>
<tr><td class="h">2287</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$verbatim);</td></tr>
<tr><td class="h">2288</td><td colspan="6"></td></tr><tr><td class="h">2289</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# See Item1442</td></tr>
<tr><td class="h">2290</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#my $percent = ($TranslationToken x 3).&#39;%&#39;.($TranslationToken x 3);</td></tr>
<tr><td class="h">2291</td><td colspan="6"></td></tr><tr><td class="h">2292</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>3559</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @queue = split( /(%)/, $text );</td></tr>
<tr><td class="h">2293</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1163</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @stack;</td></tr>
<tr><td class="h">2294</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1137</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $stackTop = &#39;&#39;; # the top stack entry. Done this way instead of</td></tr>
<tr><td class="h">2295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# referring to the top of the stack for efficiency. This var</td></tr>
<tr><td class="h">2296</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# should be considered to be $stack[$#stack]</td></tr>
<tr><td class="h">2297</td><td colspan="6"></td></tr><tr><td class="h">2298</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#my $tell = 1; # uncomment all tell lines set this to 1 to print debugging</td></tr>
<tr><td class="h">2299</td><td colspan="6"></td></tr><tr><td class="h">2300</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1725</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ( scalar( @queue )) {</td></tr>
<tr><td class="h">2301</td><td><div class="c3">2400</div></td><td></td><td></td><td></td><td><div>7759</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $token = shift( @queue );</td></tr>
<tr><td class="h">2302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &#39; &#39; x $tell,&quot;PROCESSING $token \n&quot; if $tell;</td></tr>
<tr><td class="h">2303</td><td colspan="6"></td></tr><tr><td class="h">2304</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# each % sign either closes an existing stacked context, or</td></tr>
<tr><td class="h">2305</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# opens a new context.</td></tr>
<tr><td class="h">2306</td><td><div class="c3">2400</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2306">100</a></div></td><td></td><td></td><td><div>9823</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $token eq &#39;%&#39; ) {</td></tr>
<tr><td class="h">2307</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &#39; &#39; x $tell,&quot;CONSIDER $stackTop\n&quot; if $tell;</td></tr>
<tr><td class="h">2308</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# If this is a closing }%, try to rejoin the previous</td></tr>
<tr><td class="h">2309</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# tokens until we get to a valid tag construct. This is</td></tr>
<tr><td class="h">2310</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# a bit of a hack, but it&#39;s hard to think of a better</td></tr>
<tr><td class="h">2311</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# way to do this without a full parse that takes % signs</td></tr>
<tr><td class="h">2312</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in tag parameters into account.</td></tr>
<tr><td class="h">2313</td><td><div class="c3">1037</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2313">100</a></div></td><td></td><td></td><td><div>5171</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $stackTop =~ /}$/s ) {</td></tr>
<tr><td class="h">2314</td><td><div class="c3">326</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2314">67</a></div></td><td></td><td><div>4462</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ( scalar( @stack) &amp;&amp;</td></tr>
<tr><td class="h">2315</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop !~ /^%($regex{tagNameRegex}){.*}$/so ) {</td></tr>
<tr><td class="h">2316</td><td><div class="c3">172</div></td><td></td><td></td><td></td><td><div>609</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $top = $stackTop;</td></tr>
<tr><td class="h">2317</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &#39; &#39; x $tell,&quot;COLLAPSE $top \n&quot; if $tell;</td></tr>
<tr><td class="h">2318</td><td><div class="c3">172</div></td><td></td><td></td><td></td><td><div>2445</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop = pop( @stack ) . $top;</td></tr>
<tr><td class="h">2319</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2320</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2321</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# /s so you can have newlines in parameters</td></tr>
<tr><td class="h">2322</td><td><div class="c3">1037</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2322">100</a></div></td><td></td><td></td><td><div>7081</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $stackTop =~ m/^%(($regex{tagNameRegex})(?:{(.*)})?)$/so ) {</td></tr>
<tr><td class="h">2323</td><td><div class="c3">515</div></td><td></td><td></td><td></td><td><div>2648</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $expr, $tag, $args ) = ( $1, $2, $3 );</td></tr>
<tr><td class="h">2324</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &#39; &#39; x $tell,&quot;POP $tag\n&quot; if $tell;</td></tr>
<tr><td class="h">2325</td><td><div class="c3">515</div></td><td></td><td></td><td></td><td><div>2171</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $e = &amp;$tagf( $this, $tag, $args, @_ );</td></tr>
<tr><td class="h">2326</td><td colspan="6"></td></tr><tr><td class="h">2327</td><td><div class="c3">515</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2327">100</a></div></td><td></td><td></td><td><div>1994</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( defined( $e )) {</td></tr>
<tr><td class="h">2328</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &#39; &#39; x $tell--,&quot;EXPANDED $tag -&gt; $e\n&quot; if $tell;</td></tr>
<tr><td class="h">2329</td><td><div class="c3">311</div></td><td></td><td></td><td></td><td><div>1160</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop = pop( @stack );</td></tr>
<tr><td class="h">2330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Recursively expand tags in the expansion of $tag</td></tr>
<tr><td class="h">2331</td><td><div class="c3">311</div></td><td></td><td></td><td></td><td><div>1649</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop .= $this-&gt;_processTags($e, $tagf, $depth-1, @_ );</td></tr>
<tr><td class="h">2332</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { # expansion failed</td></tr>
<tr><td class="h">2333</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &#39; &#39; x $tell++,&quot;EXPAND $tag FAILED\n&quot; if $tell;</td></tr>
<tr><td class="h">2334</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# To handle %NOP</td></tr>
<tr><td class="h">2335</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# correctly, we have to handle the %VAR% case differently</td></tr>
<tr><td class="h">2336</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# to the %VAR{}% case when a variable expansion fails.</td></tr>
<tr><td class="h">2337</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# This is so that recursively define variables e.g.</td></tr>
<tr><td class="h">2338</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# %A%B%D% expand correctly, but at the same time we ensure</td></tr>
<tr><td class="h">2339</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# that a mismatched }% can&#39;t accidentally close a context</td></tr>
<tr><td class="h">2340</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# that was left open when a tag expansion failed.</td></tr>
<tr><td class="h">2341</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# However Cairo didn&#39;t do this, so for compatibility</td></tr>
<tr><td class="h">2342</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we have to accept that %NOP can never be fixed. if it</td></tr>
<tr><td class="h">2343</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# could, then we could uncomment the following:</td></tr>
<tr><td class="h">2344</td><td colspan="6"></td></tr><tr><td class="h">2345</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#if( $stackTop =~ /}$/ ) {</td></tr>
<tr><td class="h">2346</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    # %VAR{...}% case</td></tr>
<tr><td class="h">2347</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    # We need to push the unexpanded expression back</td></tr>
<tr><td class="h">2348</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    # onto the stack, but we don&#39;t want it to match the</td></tr>
<tr><td class="h">2349</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    # tag expression again. So we protect the %&#39;s</td></tr>
<tr><td class="h">2350</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    $stackTop = $percent.$expr.$percent;</td></tr>
<tr><td class="h">2351</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#} else</td></tr>
<tr><td class="h">2352</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">2353</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# %VAR% case.</td></tr>
<tr><td class="h">2354</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# In this case we *do* want to match the tag expression</td></tr>
<tr><td class="h">2355</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# again, as an embedded %VAR% may have expanded to</td></tr>
<tr><td class="h">2356</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# create a valid outer expression. This is directly</td></tr>
<tr><td class="h">2357</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# at odds with the %VAR{...}% case.</td></tr>
<tr><td class="h">2358</td><td><div class="c3">204</div><div class="c3">204</div></td><td></td><td></td><td></td><td><div>519</div><div>828</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @stack, $stackTop );</td></tr>
<tr><td class="h">2359</td><td><div class="c3">204</div></td><td></td><td></td><td></td><td><div>1189</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop = &#39;%&#39;; # open new context</td></tr>
<tr><td class="h">2360</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2361</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2362</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2363</td><td><div class="c3">522</div></td><td></td><td></td><td></td><td><div>2123</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @stack, $stackTop );</td></tr>
<tr><td class="h">2364</td><td><div class="c3">522</div></td><td></td><td></td><td></td><td><div>2747</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop = &#39;%&#39;; # push a new context</td></tr>
<tr><td class="h">2365</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#$tell++ if ( $tell );</td></tr>
<tr><td class="h">2366</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2367</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2368</td><td><div class="c3">1363</div></td><td></td><td></td><td></td><td><div>7222</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop .= $token;</td></tr>
<tr><td class="h">2369</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2371</td><td colspan="6"></td></tr><tr><td class="h">2372</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Run out of input. Gather up everything in the stack.</td></tr>
<tr><td class="h">2373</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1770</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ( scalar( @stack )) {</td></tr>
<tr><td class="h">2374</td><td><div class="c3">243</div></td><td></td><td></td><td></td><td><div>1058</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $expr = $stackTop;</td></tr>
<tr><td class="h">2375</td><td><div class="c3">243</div></td><td></td><td></td><td></td><td><div>779</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop = pop( @stack );</td></tr>
<tr><td class="h">2376</td><td><div class="c3">243</div></td><td></td><td></td><td></td><td><div>1660</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stackTop .= $expr;</td></tr>
<tr><td class="h">2377</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2378</td><td colspan="6"></td></tr><tr><td class="h">2379</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#$stackTop =~ s/$percent/%/go;</td></tr>
<tr><td class="h">2380</td><td colspan="6"></td></tr><tr><td class="h">2381</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>1974</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{renderer}-&gt;putBackBlocks( \$stackTop, $verbatim, &#39;verbatim&#39; );</td></tr>
<tr><td class="h">2382</td><td colspan="6"></td></tr><tr><td class="h">2383</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#print STDERR &quot;FINAL $stackTop\n&quot; if $tell;</td></tr>
<tr><td class="h">2384</td><td colspan="6"></td></tr><tr><td class="h">2385</td><td><div class="c3">372</div></td><td></td><td></td><td></td><td><div>2824</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $stackTop;</td></tr>
<tr><td class="h">2386</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2387</td><td colspan="6"></td></tr><tr><td class="h">2388</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Handle expansion of a tag during topic rendering</td></tr>
<tr><td class="h">2389</td><td></td><td></td><td></td><td></td><td></td><td class="s"># $tag is the tag name</td></tr>
<tr><td class="h">2390</td><td></td><td></td><td></td><td></td><td></td><td class="s"># $args is the bit in the {} (if there are any)</td></tr>
<tr><td class="h">2391</td><td></td><td></td><td></td><td></td><td></td><td class="s"># $topic and $web should be passed for dynamic tags (not needed for</td></tr>
<tr><td class="h">2392</td><td></td><td></td><td></td><td></td><td></td><td class="s"># session or constant tags</td></tr>
<tr><td class="h">2393</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _expandTagOnTopicRendering {</td></tr>
<tr><td class="h">2394</td><td><div class="c3">530</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2394">530</a></div></td><td><div>1611</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">2395</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td><div>1631</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tag = shift;</td></tr>
<tr><td class="h">2396</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td><div>1582</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $args = shift;</td></tr>
<tr><td class="h">2397</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# my( $topic, $web ) = @_;</td></tr>
<tr><td class="h">2398</td><td colspan="6"></td></tr><tr><td class="h">2399</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td><div>2644</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $e = $this-&gt;{prefs}-&gt;getPreferencesValue( $tag );</td></tr>
<tr><td class="h">2400</td><td><div class="c3">530</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2400">100</a></div></td><td></td><td></td><td><div>2388</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( defined( $e )) {</td></tr>
<tr><td class="h">2401</td><td><div class="c3">492</div></td><td></td><td></td><td></td><td><div>1832</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e = $this-&gt;{SESSION_TAGS}{$tag};</td></tr>
<tr><td class="h">2402</td><td><div class="c3">492</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2402">100</a></div></td><td></td><td></td><td><div>2091</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( defined( $e )) {</td></tr>
<tr><td class="h">2403</td><td><div class="c3">426</div></td><td></td><td></td><td></td><td><div>1528</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e = $constantTags{$tag};</td></tr>
<tr><td class="h">2404</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2405</td><td><div class="c3">492</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2405">100</a></div></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2405">100</a></div></td><td></td><td><div>4778</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( !defined( $e ) &amp;&amp; defined( $functionTags{$tag} )) {</td></tr>
<tr><td class="h">2406</td><td><div class="c3">165</div><div class="c3">165</div></td><td></td><td></td><td></td><td><div>1070</div><div>843</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$e = &amp;{$functionTags{$tag}}</td></tr>
<tr><td class="h">2407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $this, new TWiki::Attrs(</td></tr>
<tr><td class="h">2408</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args, $contextFreeSyntax{$tag} ), @_ );</td></tr>
<tr><td class="h">2409</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2411</td><td><div class="c3">530</div></td><td></td><td></td><td></td><td><div>2221</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $e;</td></tr>
<tr><td class="h">2412</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2413</td><td colspan="6"></td></tr><tr><td class="h">2414</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Handle expansion of a tag during new topic creation. When creating a</td></tr>
<tr><td class="h">2415</td><td></td><td></td><td></td><td></td><td></td><td class="s"># new topic from a template we only expand a subset of the available legal</td></tr>
<tr><td class="h">2416</td><td></td><td></td><td></td><td></td><td></td><td class="s"># tags, and we expand %NOP% differently.</td></tr>
<tr><td class="h">2417</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _expandTagOnTopicCreation {</td></tr>
<tr><td class="h">2418</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2418">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">2419</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# my( $tag, $args, $topic, $web ) = @_;</td></tr>
<tr><td class="h">2420</td><td colspan="6"></td></tr><tr><td class="h">2421</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Required for Cairo compatibility. Ignore %NOP{...}%</td></tr>
<tr><td class="h">2422</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# %NOP% is *not* ignored until all variable expansion is complete,</td></tr>
<tr><td class="h">2423</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# otherwise them inside-out rule would remove it too early e.g.</td></tr>
<tr><td class="h">2424</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# %GM%NOP%TIME -&gt; %GMTIME -&gt; 12:00. So we ignore it here and scrape it</td></tr>
<tr><td class="h">2425</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# out later. We *have* to remove %NOP{...}% because it can foul up</td></tr>
<tr><td class="h">2426</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# brace-matching.</td></tr>
<tr><td class="h">2427</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2427">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2427">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if $_[0] eq &#39;NOP&#39; &amp;&amp; defined $_[1];</td></tr>
<tr><td class="h">2428</td><td colspan="6"></td></tr><tr><td class="h">2429</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Only expand a subset of legal tags. Warning: $this-&gt;{user} may be</td></tr>
<tr><td class="h">2430</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# overridden during this call, when a new user topic is being created.</td></tr>
<tr><td class="h">2431</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# This is what we want to make sure new user templates are populated</td></tr>
<tr><td class="h">2432</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# correctly, but you need to think about this if you extend the set of</td></tr>
<tr><td class="h">2433</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# tags expanded here.</td></tr>
<tr><td class="h">2434</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2434">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $_[0] =~ /^(URLPARAM|DATE|(SERVER|GM)TIME|(USER|WIKI)NAME|WIKIUSERNAME|USERINFO)$/;</td></tr>
<tr><td class="h">2435</td><td colspan="6"></td></tr><tr><td class="h">2436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_expandTagOnTopicRendering( @_ );</td></tr>
<tr><td class="h">2437</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2438</td><td colspan="6"></td></tr><tr><td class="h">2439 - 2460</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod enterContext( $id, $val )

Add the context id $id into the set of active contexts. The $val
can be anything you like, but should always evaluate to boolean
TRUE.

An example of the use of contexts is in the use of tag
expansion. The commonTagsHandler in plugins is called every
time tags need to be expanded, and the context of that expansion
is signalled by the expanding module using a context id. So the
forms module adds the context id &quot;form&quot; before invoking common
tags expansion.

Contexts are not just useful for tag expansion; they are also
relevant when rendering.

Contexts are intended for use mainly by plugins. Core modules can
use $session-&gt;inContext( $id ) to determine if a context is active.

=cut</pre></td></tr>
<tr><td class="h">2461</td><td colspan="6"></td></tr><tr><td class="h">2462</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub enterContext {</td></tr>
<tr><td class="h">2463</td><td><div class="c3">19</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2463">19</a></div></td><td><div>79</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $id, $val ) = @_;</td></tr>
<tr><td class="h">2464</td><td><div class="c3">19</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2464">100</a></div></td><td></td><td><div>97</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$val ||= 1;</td></tr>
<tr><td class="h">2465</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>116</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{context}-&gt;{$id} = $val;</td></tr>
<tr><td class="h">2466</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2467</td><td colspan="6"></td></tr><tr><td class="h">2468 - 2475</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod leaveContext( $id )

Remove the context id $id from the set of active contexts.
(see =enterContext= for more information on contexts)

=cut</pre></td></tr>
<tr><td class="h">2476</td><td colspan="6"></td></tr><tr><td class="h">2477</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub leaveContext {</td></tr>
<tr><td class="h">2478</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2478">4</a></div></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $id ) = @_;</td></tr>
<tr><td class="h">2479</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $res = $this-&gt;{context}-&gt;{$id};</td></tr>
<tr><td class="h">2480</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;delete $this-&gt;{context}-&gt;{$id};</td></tr>
<tr><td class="h">2481</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $res;</td></tr>
<tr><td class="h">2482</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2483</td><td colspan="6"></td></tr><tr><td class="h">2484 - 2491</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod inContext( $id )

Return the value for the given context id
(see =enterContext= for more information on contexts)

=cut</pre></td></tr>
<tr><td class="h">2492</td><td colspan="6"></td></tr><tr><td class="h">2493</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub inContext {</td></tr>
<tr><td class="h">2494</td><td><div class="c3">286</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2494">286</a></div></td><td><div>986</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $id ) = @_;</td></tr>
<tr><td class="h">2495</td><td><div class="c3">286</div></td><td></td><td></td><td></td><td><div>2430</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{context}-&gt;{$id};</td></tr>
<tr><td class="h">2496</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2497</td><td colspan="6"></td></tr><tr><td class="h">2498 - 2506</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod registerTagHandler( $tag, $fnref )

STATIC Add a tag handler to the function tag handlers.
   * =$tag= name of the tag e.g. MYTAG
   * =$fnref= Function to execute. Will be passed ($session, \%params, $web, $topic )

=cut</pre></td></tr>
<tr><td class="h">2507</td><td colspan="6"></td></tr><tr><td class="h">2508</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub registerTagHandler {</td></tr>
<tr><td class="h">2509</td><td><div class="c3">22</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2509">22</a></div></td><td><div>76</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $tag, $fnref, $syntax ) = @_;</td></tr>
<tr><td class="h">2510</td><td><div class="c3">22</div></td><td></td><td></td><td></td><td><div>102</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$functionTags{$tag} = \&amp;$fnref;</td></tr>
<tr><td class="h">2511</td><td><div class="c3">22</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2511">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2511">33</a></div></td><td></td><td><div>147</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $syntax &amp;&amp; $syntax eq &#39;context-free&#39; ) {</td></tr>
<tr><td class="h">2512</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$contextFreeSyntax{$tag} = 1;</td></tr>
<tr><td class="h">2513</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2514</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2515</td><td colspan="6"></td></tr><tr><td class="h">2516 - 2538</td><td colspan="5"></td><td class="s"><pre>=pod=

---++ StaticMethod registerRESTHandler( $subject, $verb, \&amp;fn )

Adds a function to the dispatch table of the REST interface 
for a given subject. See TWikiScripts#rest for more info.

   * =$subject= - The subject under which the function will be registered.
   * =$verb= - The verb under which the function will be registered.
   * =\&amp;fn= - Reference to the function.

The handler function must be of the form:
&lt;verbatim&gt;
sub handler(\%session,$subject,$verb) -&gt; $text
&lt;/verbatim&gt;
where:
   * =\%session= - a reference to the TWiki session object (may be ignored)
   * =$subject= - The invoked subject (may be ignored)
   * =$verb= - The invoked verb (may be ignored)

*Since:* TWiki::Plugins::VERSION 1.1

=cut=</pre></td></tr>
<tr><td class="h">2539</td><td colspan="6"></td></tr><tr><td class="h">2540</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub registerRESTHandler {</td></tr>
<tr><td class="h">2541</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2541">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;my ( $subject, $verb, $fnref) = @_;</td></tr>
<tr><td class="h">2542</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;$restDispatch{$subject}{$verb} = \&amp;$fnref;</td></tr>
<tr><td class="h">2543</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2544</td><td colspan="6"></td></tr><tr><td class="h">2545 - 2554</td><td colspan="5"></td><td class="s"><pre>=pod=

---++ StaticMethod restDispatch( $subject, $verb) =&gt; \&amp;fn

Returns the handler  function associated to the given $subject and $werb,
or undef if none is found.

*Since:* TWiki::Plugins::VERSION 1.1

=cut=</pre></td></tr>
<tr><td class="h">2555</td><td colspan="6"></td></tr><tr><td class="h">2556</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub restDispatch {</td></tr>
<tr><td class="h">2557</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2557">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;my ( $subject, $verb) = @_;</td></tr>
<tr><td class="h">2558</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;my $s=$restDispatch{$subject};</td></tr>
<tr><td class="h">2559</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2559">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;if (defined($s)) {</td></tr>
<tr><td class="h">2560</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $restDispatch{$subject}{$verb};</td></tr>
<tr><td class="h">2561</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2562</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">2563</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2564</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2565</td><td colspan="6"></td></tr><tr><td class="h">2566 - 2576</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod handleCommonTags( $text, $web, $topic ) -&gt; $text

Processes %&lt;nop&gt;VARIABLE%, and %&lt;nop&gt;TOC% syntax; also includes
&#39;commonTagsHandler&#39; plugin hook.

Returns the text of the topic, after file inclusion, variable substitution,
table-of-contents generation, and any plugin changes from commonTagsHandler.

=cut</pre></td></tr>
<tr><td class="h">2577</td><td colspan="6"></td></tr><tr><td class="h">2578</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub handleCommonTags {</td></tr>
<tr><td class="h">2579</td><td><div class="c3">16</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2579">16</a></div></td><td><div>119</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $theWeb, $theTopic ) = @_;</td></tr>
<tr><td class="h">2580</td><td colspan="6"></td></tr><tr><td class="h">2581</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">2582</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($theWeb) if DEBUG;</td></tr>
<tr><td class="h">2583</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($theTopic) if DEBUG;</td></tr>
<tr><td class="h">2584</td><td colspan="6"></td></tr><tr><td class="h">2585</td><td><div class="c3">16</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2585">50</a></div></td><td></td><td></td><td><div>93</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text unless $text;</td></tr>
<tr><td class="h">2586</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $verbatim={};</td></tr>
<tr><td class="h">2587</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Plugin Hook (for cache Plugins only)</td></tr>
<tr><td class="h">2588</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>141</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;beforeCommonTagsHandler( $text, $theTopic, $theWeb );</td></tr>
<tr><td class="h">2589</td><td colspan="6"></td></tr><tr><td class="h">2590</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#use a &quot;global var&quot;, so included topics can extract and putback </td></tr>
<tr><td class="h">2591</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#their verbatim blocks safetly.</td></tr>
<tr><td class="h">2592</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>119</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{renderer}-&gt;takeOutBlocks( $text, &#39;verbatim&#39;,</td></tr>
<tr><td class="h">2593</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$verbatim);</td></tr>
<tr><td class="h">2594</td><td colspan="6"></td></tr><tr><td class="h">2595</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>93</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memW = $this-&gt;{SESSION_TAGS}{INCLUDINGWEB};</td></tr>
<tr><td class="h">2596</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>69</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memT = $this-&gt;{SESSION_TAGS}{INCLUDINGTOPIC};</td></tr>
<tr><td class="h">2597</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGWEB} = $theWeb;</td></tr>
<tr><td class="h">2598</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGTOPIC} = $theTopic;</td></tr>
<tr><td class="h">2599</td><td colspan="6"></td></tr><tr><td class="h">2600</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>85</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_expandAllTags( \$text, $theTopic, $theWeb );</td></tr>
<tr><td class="h">2601</td><td colspan="6"></td></tr><tr><td class="h">2602</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>94</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{renderer}-&gt;takeOutBlocks( $text, &#39;verbatim&#39;,</td></tr>
<tr><td class="h">2603</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$verbatim);</td></tr>
<tr><td class="h">2604</td><td colspan="6"></td></tr><tr><td class="h">2605</td><td colspan="6"></td></tr><tr><td class="h">2606</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Plugin Hook</td></tr>
<tr><td class="h">2607</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>116</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;commonTagsHandler( $text, $theTopic, $theWeb, 0 );</td></tr>
<tr><td class="h">2608</td><td colspan="6"></td></tr><tr><td class="h">2609</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# process tags again because plugin hook may have added more in</td></tr>
<tr><td class="h">2610</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_expandAllTags( \$text, $theTopic, $theWeb );</td></tr>
<tr><td class="h">2611</td><td colspan="6"></td></tr><tr><td class="h">2612</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>67</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGWEB} = $memW;</td></tr>
<tr><td class="h">2613</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>67</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGTOPIC} = $memT;</td></tr>
<tr><td class="h">2614</td><td colspan="6"></td></tr><tr><td class="h">2615</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;Special plugin tag&#39; TOC hack, must be done after all other expansions</td></tr>
<tr><td class="h">2616</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# are complete, and has to reprocess the entire topic.</td></tr>
<tr><td class="h">2617</td><td><div class="c3">16</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>127</div><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%TOC(?:{(.*?)})?%/$this-&gt;_TOC($text, $theTopic, $theWeb, $1)/ge;</td></tr>
<tr><td class="h">2618</td><td colspan="6"></td></tr><tr><td class="h">2619</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Codev.FormattedSearchWithConditionalOutput: remove &lt;nop&gt; lines,</td></tr>
<tr><td class="h">2620</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# possibly introduced by SEARCHes with conditional CALC. This needs</td></tr>
<tr><td class="h">2621</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# to be done after CALC and before table rendering in order to join</td></tr>
<tr><td class="h">2622</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# table rows properly</td></tr>
<tr><td class="h">2623</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>143</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^&lt;nop&gt;\r?\n//gm;</td></tr>
<tr><td class="h">2624</td><td colspan="6"></td></tr><tr><td class="h">2625</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{renderer}-&gt;putBackBlocks( \$text, $verbatim, &#39;verbatim&#39; );</td></tr>
<tr><td class="h">2626</td><td colspan="6"></td></tr><tr><td class="h">2627</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TWiki Plugin Hook (for cache Plugins only)</td></tr>
<tr><td class="h">2628</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>105</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;afterCommonTagsHandler( $text, $theTopic, $theWeb );</td></tr>
<tr><td class="h">2629</td><td colspan="6"></td></tr><tr><td class="h">2630</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>177</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2631</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2632</td><td colspan="6"></td></tr><tr><td class="h">2633 - 2645</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod addToHEAD( $id, $html )

Add =$html= to the HEAD tag of the page currently being generated.

Note that TWiki variables may be used in the HEAD. They will be expanded
according to normal variable expansion rules.

The &#39;id&#39; is used to ensure that multiple adds of the same block of HTML don&#39;t
result in it being added many times.

=cut</pre></td></tr>
<tr><td class="h">2646</td><td colspan="6"></td></tr><tr><td class="h">2647</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub addToHEAD {</td></tr>
<tr><td class="h">2648</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2648">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($this,$tag,$header) = @_;</td></tr>
<tr><td class="h">2649</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">2650</td><td colspan="6"></td></tr><tr><td class="h">2651</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$header = $this-&gt;handleCommonTags( $header, $this-&gt;{webName},</td></tr>
<tr><td class="h">2652</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{topicName} );</td></tr>
<tr><td class="h">2653</td><td colspan="6"></td></tr><tr><td class="h">2654</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{htmlHeaders}{$tag} = $header;</td></tr>
<tr><td class="h">2655</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2656</td><td colspan="6"></td></tr><tr><td class="h">2657 - 2671</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod initialize( $pathInfo, $remoteUser, $topic, $url, $query ) -&gt; ($topicName, $webName, $scriptUrlPath, $userName, $dataDir)

Return value: ( $topicName, $webName, $TWiki::cfg{ScriptUrlPath}, $userName, $TWiki::cfg{DataDir} )

Static method to construct a new singleton session instance.
It creates a new TWiki and sets the Plugins $SESSION variable to
point to it, so that TWiki::Func methods will work.

This method is *DEPRECATED* but is maintained for script compatibility.

Note that $theUrl, if specified, must be identical to $query-&gt;url()

=cut</pre></td></tr>
<tr><td class="h">2672</td><td colspan="6"></td></tr><tr><td class="h">2673</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub initialize {</td></tr>
<tr><td class="h">2674</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2674">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $pathInfo, $theRemoteUser, $topic, $theUrl, $query ) = @_;</td></tr>
<tr><td class="h">2675</td><td colspan="6"></td></tr><tr><td class="h">2676</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2676">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( !$query ) {</td></tr>
<tr><td class="h">2677</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query = new CGI( {} );</td></tr>
<tr><td class="h">2678</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2679</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2679">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $query-&gt;path_info() ne $pathInfo ) {</td></tr>
<tr><td class="h">2680</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;path_info( $pathInfo );</td></tr>
<tr><td class="h">2681</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2682</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2682">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $topic ) {</td></tr>
<tr><td class="h">2683</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query-&gt;param( -name =&gt; &#39;topic&#39;, -value =&gt; &#39;&#39; );</td></tr>
<tr><td class="h">2684</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2685</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# can&#39;t do much if $theUrl is specified and it is inconsistent with</td></tr>
<tr><td class="h">2686</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the query. We are trying to get to all parameters passed in the</td></tr>
<tr><td class="h">2687</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# query.</td></tr>
<tr><td class="h">2688</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2688">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2688">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $theUrl &amp;&amp; $theUrl ne $query-&gt;url()) {</td></tr>
<tr><td class="h">2689</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &#39;Sorry, this version of TWiki does not support the url parameter to TWiki::initialize being different to the url in the query&#39;;</td></tr>
<tr><td class="h">2690</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2691</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = new TWiki( $theRemoteUser, $query );</td></tr>
<tr><td class="h">2692</td><td colspan="6"></td></tr><tr><td class="h">2693</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Force the new session into the plugins context.</td></tr>
<tr><td class="h">2694</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::Plugins::SESSION = $twiki;</td></tr>
<tr><td class="h">2695</td><td colspan="6"></td></tr><tr><td class="h">2696</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ( $twiki-&gt;{topicName}, $twiki-&gt;{webName}, $twiki-&gt;{scriptUrlPath},</td></tr>
<tr><td class="h">2697</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;{userName}, $TWiki::cfg{DataDir} );</td></tr>
<tr><td class="h">2698</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2699</td><td colspan="6"></td></tr><tr><td class="h">2700 - 2711</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod readFile( $filename ) -&gt; $text

Returns the entire contents of the given file, which can be specified in any
format acceptable to the Perl open() function. Fast, but inherently unsafe.

WARNING: Never, ever use this for accessing topics or attachments! Use the
Store API for that. This is for global control files only, and should be
used *only* if there is *absolutely no alternative*.

=cut</pre></td></tr>
<tr><td class="h">2712</td><td colspan="6"></td></tr><tr><td class="h">2713</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub readFile {</td></tr>
<tr><td class="h">2714</td><td><div class="c3">13</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2714">13</a></div></td><td><div>41</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = shift;</td></tr>
<tr><td class="h">2715</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2715">50</a></div></td><td></td><td></td><td><div>171</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;open( IN_FILE, &quot;&lt;$name&quot; ) || return &#39;&#39;;</td></tr>
<tr><td class="h">2716</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td><div>58</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;local $/ = undef;</td></tr>
<tr><td class="h">2717</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td><div>145</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $data = &lt;IN_FILE&gt;;</td></tr>
<tr><td class="h">2718</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td><div>68</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;close( IN_FILE );</td></tr>
<tr><td class="h">2719</td><td><div class="c3">13</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2719">50</a></div></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$data = &#39;&#39; unless( defined( $data ));</td></tr>
<tr><td class="h">2720</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td><div>245</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $data;</td></tr>
<tr><td class="h">2721</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2722</td><td colspan="6"></td></tr><tr><td class="h">2723</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _FORMFIELD {</td></tr>
<tr><td class="h">2724</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2724">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;	</td></tr>
<tr><td class="h">2725</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cgiQuery = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">2726</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2726">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cgiRev = $cgiQuery-&gt;param(&#39;rev&#39;) if( $cgiQuery );</td></tr>
<tr><td class="h">2727</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{rev} = $cgiRev;</td></tr>
<tr><td class="h">2728</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{renderer}-&gt;renderFORMFIELD( $params, $topic, $web );</td></tr>
<tr><td class="h">2729</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2730</td><td colspan="6"></td></tr><tr><td class="h">2731</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TMPLP {</td></tr>
<tr><td class="h">2732</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2732">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">2733</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{templates}-&gt;tmplP( $params );</td></tr>
<tr><td class="h">2734</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2735</td><td colspan="6"></td></tr><tr><td class="h">2736</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _VAR {</td></tr>
<tr><td class="h">2737</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2737">3</a></div></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params, $topic, $inweb ) = @_;</td></tr>
<tr><td class="h">2738</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $key = $params-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">2739</td><td><div class="c3">3</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2739">33</a></div></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $params-&gt;{web} || $inweb;</td></tr>
<tr><td class="h">2740</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# handle %MAINWEB%-type cases</td></tr>
<tr><td class="h">2741</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;( $web, $topic ) = $this-&gt;normalizeWebTopicName( $web, $topic );</td></tr>
<tr><td class="h">2742</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# always return a value, even when the key isn&#39;t defined</td></tr>
<tr><td class="h">2743</td><td><div class="c3">3</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2743">50</a></div></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{prefs}-&gt;getWebPreferencesValue( $key, $web ) || &#39;&#39;;</td></tr>
<tr><td class="h">2744</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2745</td><td colspan="6"></td></tr><tr><td class="h">2746</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _PLUGINVERSION {</td></tr>
<tr><td class="h">2747</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2747">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">2748</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;getPluginVersion( $params-&gt;{_DEFAULT} );</td></tr>
<tr><td class="h">2749</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2750</td><td colspan="6"></td></tr><tr><td class="h">2751</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $ifFactory;</td></tr>
<tr><td class="h">2752</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _IF {</td></tr>
<tr><td class="h">2753</td><td><div class="c3">23</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2753">23</a></div></td><td><div>90</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">2754</td><td colspan="6"></td></tr><tr><td class="h">2755</td><td><div class="c3">23</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2755">100</a></div></td><td></td><td></td><td><div>107</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $ifFactory ) {</td></tr>
<tr><td class="h">2756</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require TWiki::If;</td></tr>
<tr><td class="h">2757</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ifFactory = new TWiki::If();</td></tr>
<tr><td class="h">2758</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2759</td><td colspan="6"></td></tr><tr><td class="h">2760</td><td><div class="c3">23</div></td><td></td><td></td><td></td><td><div>138</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $expr = $ifFactory-&gt;parse( $params-&gt;{_DEFAULT} );</td></tr>
<tr><td class="h">2761</td><td><div class="c3">23</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2761">50</a></div></td><td></td><td></td><td><div>103</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;inlineAlert(</td></tr>
<tr><td class="h">2762</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;alerts&#39;, &#39;generic&#39;, &#39;IF{&#39;, $params-&gt;stringify(), &#39;}:&#39;,</td></tr>
<tr><td class="h">2763</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ifFactory-&gt;{error} ) unless $expr;</td></tr>
<tr><td class="h">2764</td><td colspan="6"></td></tr><tr><td class="h">2765</td><td><div class="c3">23</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2765">100</a></div></td><td></td><td></td><td><div>104</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $expr-&gt;evaluate( $this )) {</td></tr>
<tr><td class="h">2766</td><td><div class="c3">13</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2766">50</a></div></td><td></td><td><div>120</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{then} || &#39;&#39;;</td></tr>
<tr><td class="h">2767</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2768</td><td><div class="c3">10</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2768">100</a></div></td><td></td><td><div>137</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{else} || &#39;&#39;;</td></tr>
<tr><td class="h">2769</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2770</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2771</td><td colspan="6"></td></tr><tr><td class="h">2772</td><td></td><td></td><td></td><td></td><td></td><td class="s"># generate an include warning</td></tr>
<tr><td class="h">2773</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: varying number of parameters idiotic to handle for customized $warn</td></tr>
<tr><td class="h">2774</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _includeWarning {</td></tr>
<tr><td class="h">2775</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2775">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">2776</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $warn = shift;</td></tr>
<tr><td class="h">2777</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $message = shift;</td></tr>
<tr><td class="h">2778</td><td colspan="6"></td></tr><tr><td class="h">2779</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2779">50</a></div><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2779">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $warn eq &#39;on&#39; ) {</td></tr>
<tr><td class="h">2780</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;inlineAlert( &#39;alerts&#39;, $message, @_ );</td></tr>
<tr><td class="h">2781</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( isTrue( $warn )) {</td></tr>
<tr><td class="h">2782</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# different inlineAlerts need different argument counts</td></tr>
<tr><td class="h">2783</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $argument = &#39;&#39;;</td></tr>
<tr><td class="h">2784</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2784">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($message  eq  &#39;topic_not_found&#39;) {</td></tr>
<tr><td class="h">2785</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($web,$topic)  =  @_;</td></tr>
<tr><td class="h">2786</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$argument = &quot;$web.$topic&quot;;</td></tr>
<tr><td class="h">2787</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2788</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">2789</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$argument = shift;</td></tr>
<tr><td class="h">2790</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2791</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2791">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$warn =~ s/\$topic/$argument/go if $argument;</td></tr>
<tr><td class="h">2792</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $warn;</td></tr>
<tr><td class="h">2793</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} # else fail silently</td></tr>
<tr><td class="h">2794</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">2795</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2796</td><td colspan="6"></td></tr><tr><td class="h">2797</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Processes a specific instance %&lt;nop&gt;INCLUDE{...}% syntax.</td></tr>
<tr><td class="h">2798</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns the text to be inserted in place of the INCLUDE command.</td></tr>
<tr><td class="h">2799</td><td></td><td></td><td></td><td></td><td></td><td class="s"># $topic and $web should be for the immediate parent topic in the</td></tr>
<tr><td class="h">2800</td><td></td><td></td><td></td><td></td><td></td><td class="s"># include hierarchy. Works for both URLs and absolute server paths.</td></tr>
<tr><td class="h">2801</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _INCLUDE {</td></tr>
<tr><td class="h">2802</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2802">7</a></div></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $includingTopic, $includingWeb ) = @_;</td></tr>
<tr><td class="h">2803</td><td colspan="6"></td></tr><tr><td class="h">2804</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remember args for the key before mangling the params</td></tr>
<tr><td class="h">2805</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $args = $params-&gt;stringify();</td></tr>
<tr><td class="h">2806</td><td colspan="6"></td></tr><tr><td class="h">2807</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Remove params, so they don&#39;t get expanded in the included page</td></tr>
<tr><td class="h">2808</td><td><div class="c3">7</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2808">50</a></div></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $path = $params-&gt;remove(&#39;_DEFAULT&#39;) || &#39;&#39;;</td></tr>
<tr><td class="h">2809</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pattern = $params-&gt;remove(&#39;pattern&#39;);</td></tr>
<tr><td class="h">2810</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rev = $params-&gt;remove(&#39;rev&#39;);</td></tr>
<tr><td class="h">2811</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $section = $params-&gt;remove(&#39;section&#39;);</td></tr>
<tr><td class="h">2812</td><td><div class="c3">7</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2812">50</a></div></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $raw = $params-&gt;remove(&#39;raw&#39;) || &#39;&#39;;</td></tr>
<tr><td class="h">2813</td><td><div class="c3">7</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2813">67</a></div></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $warn = $params-&gt;remove(&#39;warn&#39;)</td></tr>
<tr><td class="h">2814</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;INCLUDEWARNING&#39; );</td></tr>
<tr><td class="h">2815</td><td colspan="6"></td></tr><tr><td class="h">2816</td><td><div class="c3">7</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2816">50</a></div></td><td></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $path =~ /^https?\:/ ) {</td></tr>
<tr><td class="h">2817</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# include web page</td></tr>
<tr><td class="h">2818</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeUrl(</td></tr>
<tr><td class="h">2819</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path, $pattern, $includingWeb, $includingTopic,</td></tr>
<tr><td class="h">2820</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$raw, $params, $warn );</td></tr>
<tr><td class="h">2821</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2822</td><td colspan="6"></td></tr><tr><td class="h">2823</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>52</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s/$TWiki::cfg{NameFilter}//go;    # zap anything suspicious</td></tr>
<tr><td class="h">2824</td><td><div class="c3">7</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2824">50</a></div></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{DenyDotDotInclude} ) {</td></tr>
<tr><td class="h">2825</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Filter out &#39;..&#39; from filename, this is to</td></tr>
<tr><td class="h">2826</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# prevent includes of &#39;../../file&#39;</td></tr>
<tr><td class="h">2827</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s/\.+/\./g;</td></tr>
<tr><td class="h">2828</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2829</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# danger, could include .htpasswd with relative path</td></tr>
<tr><td class="h">2830</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path =~ s/passwd//gi;    # filter out passwd filename</td></tr>
<tr><td class="h">2831</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2832</td><td colspan="6"></td></tr><tr><td class="h">2833</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# make sure we have something to include. If we don&#39;t do this, then</td></tr>
<tr><td class="h">2834</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# normalizeWebTopicName will default to WebHome. Item2209.</td></tr>
<tr><td class="h">2835</td><td><div class="c3">7</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2835">50</a></div></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $path ) {</td></tr>
<tr><td class="h">2836</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: could do with a different message here, but don&#39;t want to</td></tr>
<tr><td class="h">2837</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# add one right now because translators are already working</td></tr>
<tr><td class="h">2838</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;topic_not_found&#39;, &#39;&quot;&quot;&#39;,&#39;&quot;&quot;&#39; );</td></tr>
<tr><td class="h">2839</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2840</td><td colspan="6"></td></tr><tr><td class="h">2841</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &#39;&#39;;</td></tr>
<tr><td class="h">2842</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = &#39;&#39;;</td></tr>
<tr><td class="h">2843</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $includedWeb;</td></tr>
<tr><td class="h">2844</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $includedTopic = $path;</td></tr>
<tr><td class="h">2845</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$includedTopic =~ s/\.txt$//; # strip optional (undocumented) .txt</td></tr>
<tr><td class="h">2846</td><td colspan="6"></td></tr><tr><td class="h">2847</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($includedWeb, $includedTopic) =</td></tr>
<tr><td class="h">2848</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;normalizeWebTopicName($includingWeb, $includedTopic);</td></tr>
<tr><td class="h">2849</td><td colspan="6"></td></tr><tr><td class="h">2850</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# See Codev.FailedIncludeWarning for the history.</td></tr>
<tr><td class="h">2851</td><td><div class="c3">7</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2851">100</a></div></td><td></td><td></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{store}-&gt;topicExists($includedWeb, $includedTopic)) {</td></tr>
<tr><td class="h">2852</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;topic_not_found&#39;,</td></tr>
<tr><td class="h">2853</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$includedWeb, $includedTopic );</td></tr>
<tr><td class="h">2854</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2855</td><td colspan="6"></td></tr><tr><td class="h">2856</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# prevent recursive includes. Note that the inclusion of a topic into</td></tr>
<tr><td class="h">2857</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# itself is not blocked; however subsequent attempts to include the</td></tr>
<tr><td class="h">2858</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# topic will fail. There is a hard block of 99 on any recursive include.</td></tr>
<tr><td class="h">2859</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $key = $includingWeb.&#39;.&#39;.$includingTopic;</td></tr>
<tr><td class="h">2860</td><td><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td></td><td><div>20</div><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $count = grep( $key, keys %{$this-&gt;{includes}});</td></tr>
<tr><td class="h">2861</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$key .= $args;</td></tr>
<tr><td class="h">2862</td><td><div class="c3">6</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2862">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2862">33</a></div></td><td></td><td><div>71</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{includes}-&gt;{$key} || $count &gt; 99) {</td></tr>
<tr><td class="h">2863</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_includeWarning( $warn, &#39;already_included&#39;,</td></tr>
<tr><td class="h">2864</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;$includedWeb.$includedTopic&quot;, &#39;&#39; );</td></tr>
<tr><td class="h">2865</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2866</td><td colspan="6"></td></tr><tr><td class="h">2867</td><td><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td></td><td><div>18</div><div>67</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %saveTags = %{$this-&gt;{SESSION_TAGS}};</td></tr>
<tr><td class="h">2868</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $prefsMark = $this-&gt;{prefs}-&gt;mark();</td></tr>
<tr><td class="h">2869</td><td colspan="6"></td></tr><tr><td class="h">2870</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{includes}-&gt;{$key} = 1;</td></tr>
<tr><td class="h">2871</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGWEB} = $includingWeb;</td></tr>
<tr><td class="h">2872</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{INCLUDINGTOPIC} = $includingTopic;</td></tr>
<tr><td class="h">2873</td><td colspan="6"></td></tr><tr><td class="h">2874</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# copy params into session tags</td></tr>
<tr><td class="h">2875</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $k ( keys %$params ) {</td></tr>
<tr><td class="h">2876</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{SESSION_TAGS}{$k} = $params-&gt;{$k};</td></tr>
<tr><td class="h">2877</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2878</td><td colspan="6"></td></tr><tr><td class="h">2879</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;( $meta, $text ) =</td></tr>
<tr><td class="h">2880</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{store}-&gt;readTopic( undef, $includedWeb, $includedTopic,</td></tr>
<tr><td class="h">2881</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rev );</td></tr>
<tr><td class="h">2882</td><td colspan="6"></td></tr><tr><td class="h">2883</td><td><div class="c3">6</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2883">50</a></div></td><td></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{security}-&gt;checkAccessPermission(</td></tr>
<tr><td class="h">2884</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;VIEW&#39;, $this-&gt;{user}, $text, $meta, $includedTopic, $includedWeb )) {</td></tr>
<tr><td class="h">2885</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2885">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( isTrue( $warn )) {</td></tr>
<tr><td class="h">2886</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;inlineAlert( &#39;alerts&#39;, &#39;access_denied&#39;,</td></tr>
<tr><td class="h">2887</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;[[$includedWeb.$includedTopic]]&quot; );</td></tr>
<tr><td class="h">2888</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} # else fail silently</td></tr>
<tr><td class="h">2889</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">2890</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2891</td><td colspan="6"></td></tr><tr><td class="h">2892</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remove everything before and after the selected include block</td></tr>
<tr><td class="h">2893</td><td><div class="c3">6</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2893">50</a></div></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( !$section ) {</td></tr>
<tr><td class="h">2894</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/.*?%STARTINCLUDE%//s;</td></tr>
<tr><td class="h">2895</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%STOPINCLUDE%.*//s;</td></tr>
<tr><td class="h">2896</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2897</td><td colspan="6"></td></tr><tr><td class="h">2898</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# handle sections</td></tr>
<tr><td class="h">2899</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $ntext, $sections ) = parseSections( $text );</td></tr>
<tr><td class="h">2900</td><td colspan="6"></td></tr><tr><td class="h">2901</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $interesting = ( defined $section );</td></tr>
<tr><td class="h">2902</td><td><div class="c3">6</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2902">50</a></div></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( scalar( @$sections )) {</td></tr>
<tr><td class="h">2903</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Rebuild the text from the sections</td></tr>
<tr><td class="h">2904</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = &#39;&#39;;</td></tr>
<tr><td class="h">2905</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $s ( @$sections ) {</td></tr>
<tr><td class="h">2906</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2906">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2906">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2906">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2906">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $section &amp;&amp; $s-&gt;{type} eq &#39;section&#39; &amp;&amp;</td></tr>
<tr><td class="h">2907</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s-&gt;{name} eq $section) {</td></tr>
<tr><td class="h">2908</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text .= substr( $ntext, $s-&gt;{start}, $s-&gt;{end}-$s-&gt;{start} );</td></tr>
<tr><td class="h">2909</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$interesting = 1;</td></tr>
<tr><td class="h">2910</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last;</td></tr>
<tr><td class="h">2911</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $s-&gt;{type} eq &#39;include&#39; &amp;&amp; !$section ) {</td></tr>
<tr><td class="h">2912</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text .= substr( $ntext, $s-&gt;{start}, $s-&gt;{end}-$s-&gt;{start} );</td></tr>
<tr><td class="h">2913</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$interesting = 1;</td></tr>
<tr><td class="h">2914</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2915</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2916</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2917</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If there were no interesting sections, restore the whole text</td></tr>
<tr><td class="h">2918</td><td><div class="c3">6</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2918">50</a></div></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $ntext unless $interesting;</td></tr>
<tr><td class="h">2919</td><td colspan="6"></td></tr><tr><td class="h">2920</td><td><div class="c3">6</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2920">50</a></div></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = applyPatternToIncludedText( $text, $pattern ) if( $pattern );</td></tr>
<tr><td class="h">2921</td><td colspan="6"></td></tr><tr><td class="h">2922</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_expandAllTags( \$text, $includedTopic, $includedWeb );</td></tr>
<tr><td class="h">2923</td><td colspan="6"></td></tr><tr><td class="h">2924</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 4th parameter tells plugin that its called for an included file</td></tr>
<tr><td class="h">2925</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{plugins}-&gt;commonTagsHandler( $text, $includedTopic,</td></tr>
<tr><td class="h">2926</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$includedWeb, 1 );</td></tr>
<tr><td class="h">2927</td><td colspan="6"></td></tr><tr><td class="h">2928</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# We have to expand tags again, because a plugin may have inserted additional</td></tr>
<tr><td class="h">2929</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# tags.</td></tr>
<tr><td class="h">2930</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_expandAllTags( \$text, $includedTopic, $includedWeb );</td></tr>
<tr><td class="h">2931</td><td colspan="6"></td></tr><tr><td class="h">2932</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If needed, fix all &#39;TopicNames&#39; to &#39;Web.TopicNames&#39; to get the</td></tr>
<tr><td class="h">2933</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# right context so that links continue to work properly</td></tr>
<tr><td class="h">2934</td><td><div class="c3">6</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2934">50</a></div></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $includedWeb ne $includingWeb ) {</td></tr>
<tr><td class="h">2935</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $removed = {};</td></tr>
<tr><td class="h">2936</td><td colspan="6"></td></tr><tr><td class="h">2937</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Must handle explicit [[]] before noautolink</td></tr>
<tr><td class="h">2938</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &#39;[[TopicName]]&#39; to &#39;[[Web.TopicName][TopicName]]&#39;</td></tr>
<tr><td class="h">2939</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[([^\]]+)\]\]/&amp;_fixIncludeLink( $includedWeb, $1 )/geo;</td></tr>
<tr><td class="h">2940</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &#39;[[TopicName][...]]&#39; to &#39;[[Web.TopicName][...]]&#39;</td></tr>
<tr><td class="h">2941</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[([^\]]+)\]\[([^\]]+)\]\]/&amp;_fixIncludeLink( $includedWeb, $1, $2 )/geo;</td></tr>
<tr><td class="h">2942</td><td colspan="6"></td></tr><tr><td class="h">2943</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2943">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( TWiki::isTrue( $this-&gt;{prefs}-&gt;getPreferencesValue(&#39;NOAUTOLINK&#39;)) ) {</td></tr>
<tr><td class="h">2944</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Handle WikiWords</td></tr>
<tr><td class="h">2945</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{renderer}-&gt;takeOutBlocks( $text, &#39;noautolink&#39;, $removed );</td></tr>
<tr><td class="h">2946</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2947</td><td colspan="6"></td></tr><tr><td class="h">2948</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &#39;TopicName&#39; to &#39;Web.TopicName&#39;</td></tr>
<tr><td class="h">2949</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(^|[\s(])($regex{webNameRegex}\.$regex{wikiWordRegex})/$1$TranslationToken$2/go;</td></tr>
<tr><td class="h">2950</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(^|[\s(])($regex{wikiWordRegex})/$1$includedWeb\.$2/go;</td></tr>
<tr><td class="h">2951</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(^|[\s(])$TranslationToken/$1/go;</td></tr>
<tr><td class="h">2952</td><td colspan="6"></td></tr><tr><td class="h">2953</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{renderer}-&gt;putBackBlocks( \$text, $removed, &#39;noautolink&#39; );</td></tr>
<tr><td class="h">2954</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2955</td><td colspan="6"></td></tr><tr><td class="h">2956</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# handle tags again because of plugin hook</td></tr>
<tr><td class="h">2957</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_expandAllTags( \$text, $includedTopic, $includedWeb );</td></tr>
<tr><td class="h">2958</td><td colspan="6"></td></tr><tr><td class="h">2959</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# restore the tags</td></tr>
<tr><td class="h">2960</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;delete $this-&gt;{includes}-&gt;{$key};</td></tr>
<tr><td class="h">2961</td><td><div class="c3">6</div><div class="c3">6</div></td><td></td><td></td><td></td><td><div>37</div><div>86</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;%{$this-&gt;{SESSION_TAGS}} = %saveTags;</td></tr>
<tr><td class="h">2962</td><td colspan="6"></td></tr><tr><td class="h">2963</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs}-&gt;restore( $prefsMark );</td></tr>
<tr><td class="h">2964</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^[\r\n]+/\n/;</td></tr>
<tr><td class="h">2965</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>56</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/[\r\n]+$/\n/;</td></tr>
<tr><td class="h">2966</td><td colspan="6"></td></tr><tr><td class="h">2967</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>74</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2968</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2969</td><td colspan="6"></td></tr><tr><td class="h">2970</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _HTTP {</td></tr>
<tr><td class="h">2971</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2971">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">2972</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $res;</td></tr>
<tr><td class="h">2973</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2973">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $params-&gt;{_DEFAULT} ) {</td></tr>
<tr><td class="h">2974</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res = $this-&gt;{cgiQuery}-&gt;http( $params-&gt;{_DEFAULT} );</td></tr>
<tr><td class="h">2975</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2976</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2976">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$res = &#39;&#39; unless defined( $res );</td></tr>
<tr><td class="h">2977</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $res;</td></tr>
<tr><td class="h">2978</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2979</td><td colspan="6"></td></tr><tr><td class="h">2980</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _HTTPS {</td></tr>
<tr><td class="h">2981</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2981">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">2982</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $res;</td></tr>
<tr><td class="h">2983</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2983">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $params-&gt;{_DEFAULT} ) {</td></tr>
<tr><td class="h">2984</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res = $this-&gt;{cgiQuery}-&gt;https( $params-&gt;{_DEFAULT} );</td></tr>
<tr><td class="h">2985</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2986</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L2986">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$res = &#39;&#39; unless defined( $res );</td></tr>
<tr><td class="h">2987</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $res;</td></tr>
<tr><td class="h">2988</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2989</td><td colspan="6"></td></tr><tr><td class="h">2990</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %ENV%</td></tr>
<tr><td class="h">2991</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">2992</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _HTTP_HOST_deprecated {</td></tr>
<tr><td class="h">2993</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2993">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2993">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ENV{HTTP_HOST} || &#39;&#39;;</td></tr>
<tr><td class="h">2994</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2995</td><td colspan="6"></td></tr><tr><td class="h">2996</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %ENV%</td></tr>
<tr><td class="h">2997</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">2998</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _REMOTE_ADDR_deprecated {</td></tr>
<tr><td class="h">2999</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L2999">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L2999">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ENV{REMOTE_ADDR} || &#39;&#39;;</td></tr>
<tr><td class="h">3000</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3001</td><td colspan="6"></td></tr><tr><td class="h">3002</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %ENV%</td></tr>
<tr><td class="h">3003</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">3004</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _REMOTE_PORT_deprecated {</td></tr>
<tr><td class="h">3005</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3005">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3005">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ENV{REMOTE_PORT} || &#39;&#39;;</td></tr>
<tr><td class="h">3006</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3007</td><td colspan="6"></td></tr><tr><td class="h">3008</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %ENV%</td></tr>
<tr><td class="h">3009</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">3010</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _REMOTE_USER_deprecated {</td></tr>
<tr><td class="h">3011</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3011">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3011">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ENV{REMOTE_USER} || &#39;&#39;;</td></tr>
<tr><td class="h">3012</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3013</td><td colspan="6"></td></tr><tr><td class="h">3014</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Only does simple search for topicmoved at present, can be expanded when required</td></tr>
<tr><td class="h">3015</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: this violates encapsulation of Store and Meta, by exporting</td></tr>
<tr><td class="h">3016</td><td></td><td></td><td></td><td></td><td></td><td class="s"># the assumption that meta-data is stored embedded inside topic</td></tr>
<tr><td class="h">3017</td><td></td><td></td><td></td><td></td><td></td><td class="s"># text.</td></tr>
<tr><td class="h">3018</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _METASEARCH {</td></tr>
<tr><td class="h">3019</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3019">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3020</td><td colspan="6"></td></tr><tr><td class="h">3021</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{store}-&gt;searchMetaData( $params );</td></tr>
<tr><td class="h">3022</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3023</td><td colspan="6"></td></tr><tr><td class="h">3024</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _DATE {</td></tr>
<tr><td class="h">3025</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3025">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">3026</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return TWiki::Time::formatTime(time(), &#39;$day $mon $year&#39;, &#39;gmtime&#39;);</td></tr>
<tr><td class="h">3027</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3028</td><td colspan="6"></td></tr><tr><td class="h">3029</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _GMTIME {</td></tr>
<tr><td class="h">3030</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3030">5</a></div></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3031</td><td><div class="c3">5</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3031">50</a></div></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return TWiki::Time::formatTime( time(), $params-&gt;{_DEFAULT} || &#39;&#39;, &#39;gmtime&#39; );</td></tr>
<tr><td class="h">3032</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3033</td><td colspan="6"></td></tr><tr><td class="h">3034</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SERVERTIME {</td></tr>
<tr><td class="h">3035</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3035">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3036</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3036">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return TWiki::Time::formatTime( time(), $params-&gt;{_DEFAULT} || &#39;&#39;, &#39;servertime&#39; );</td></tr>
<tr><td class="h">3037</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3038</td><td colspan="6"></td></tr><tr><td class="h">3039</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _DISPLAYTIME {</td></tr>
<tr><td class="h">3040</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3040">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3041</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3041">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return TWiki::Time::formatTime( time(), $params-&gt;{_DEFAULT} || &#39;&#39;, $TWiki::cfg{DisplayTimeValues} );</td></tr>
<tr><td class="h">3042</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3043</td><td colspan="6"></td></tr><tr><td class="h">3044</td><td></td><td></td><td></td><td></td><td></td><td class="s">#| $web | web and  |</td></tr>
<tr><td class="h">3045</td><td></td><td></td><td></td><td></td><td></td><td class="s">#| $topic | topic to display the name for |</td></tr>
<tr><td class="h">3046</td><td></td><td></td><td></td><td></td><td></td><td class="s">#| $formatString | twiki format string (like in search) |</td></tr>
<tr><td class="h">3047</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _REVINFO {</td></tr>
<tr><td class="h">3048</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3048">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $theTopic, $theWeb ) = @_;</td></tr>
<tr><td class="h">3049</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3049">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = $params-&gt;{_DEFAULT} || $params-&gt;{format};</td></tr>
<tr><td class="h">3050</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3050">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web    = $params-&gt;{web} || $theWeb;</td></tr>
<tr><td class="h">3051</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3051">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic  = $params-&gt;{topic} || $theTopic;</td></tr>
<tr><td class="h">3052</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cgiQuery = $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">3053</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cgiRev = &#39;&#39;;</td></tr>
<tr><td class="h">3054</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3054">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cgiRev = $cgiQuery-&gt;param(&#39;rev&#39;) if( $cgiQuery );</td></tr>
<tr><td class="h">3055</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3055">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rev = $cgiRev || $params-&gt;{rev} || &#39;&#39;;</td></tr>
<tr><td class="h">3056</td><td colspan="6"></td></tr><tr><td class="h">3057</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{renderer}-&gt;renderRevisionInfo( $web, $topic, undef,</td></tr>
<tr><td class="h">3058</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rev, $format );</td></tr>
<tr><td class="h">3059</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3060</td><td colspan="6"></td></tr><tr><td class="h">3061</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ENCODE {</td></tr>
<tr><td class="h">3062</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3062">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3063</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3063">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $type = $params-&gt;{type} || &#39;&#39;;</td></tr>
<tr><td class="h">3064</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3064">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = $params-&gt;{_DEFAULT} || &#39;&#39;;</td></tr>
<tr><td class="h">3065</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3065">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3065">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3065">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $type =~ /^entit(y|ies)$/i ) {</td></tr>
<tr><td class="h">3066</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return entityEncode( $text );</td></tr>
<tr><td class="h">3067</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $type =~ /^html$/i ) {</td></tr>
<tr><td class="h">3068</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return entityEncode( $text, &quot;\n\r&quot; );</td></tr>
<tr><td class="h">3069</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $type =~ /^quotes?$/i ) {</td></tr>
<tr><td class="h">3070</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\&quot;/\\&quot;/go;    # escape quotes with backslash (Bugs:Item3383 fix)</td></tr>
<tr><td class="h">3071</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">3072</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3073</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\r*\n\r*/&lt;br \/&gt;/; # Legacy.</td></tr>
<tr><td class="h">3074</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return urlEncode( $text );</td></tr>
<tr><td class="h">3075</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3076</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3077</td><td colspan="6"></td></tr><tr><td class="h">3078</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ENV {</td></tr>
<tr><td class="h">3079</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3079">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $params) = @_;</td></tr>
<tr><td class="h">3080</td><td colspan="6"></td></tr><tr><td class="h">3081</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3081">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3081">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $params-&gt;{_DEFAULT} &amp;&amp;</td></tr>
<tr><td class="h">3082</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defined $TWiki::cfg{AccessibleENV} &amp;&amp;</td></tr>
<tr><td class="h">3083</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{_DEFAULT} =~ /$TWiki::cfg{AccessibleENV}/o;</td></tr>
<tr><td class="h">3084</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $val = $ENV{$params-&gt;{_DEFAULT}};</td></tr>
<tr><td class="h">3085</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3085">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;not set&#39; unless defined $val;</td></tr>
<tr><td class="h">3086</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $val;</td></tr>
<tr><td class="h">3087</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3088</td><td colspan="6"></td></tr><tr><td class="h">3089</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SEARCH {</td></tr>
<tr><td class="h">3090</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3090">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3091</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# pass on all attrs, and add some more</td></tr>
<tr><td class="h">3092</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#$params-&gt;{_callback} = undef;</td></tr>
<tr><td class="h">3093</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{inline} = 1;</td></tr>
<tr><td class="h">3094</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{baseweb} = $web;</td></tr>
<tr><td class="h">3095</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{basetopic} = $topic;</td></tr>
<tr><td class="h">3096</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3096">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{search} = $params-&gt;{_DEFAULT} if( $params-&gt;{_DEFAULT} );</td></tr>
<tr><td class="h">3097</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3097">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{type} = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;SEARCHVARDEFAULTTYPE&#39; ) unless( $params-&gt;{type} );</td></tr>
<tr><td class="h">3098</td><td colspan="6"></td></tr><tr><td class="h">3099</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $s = $this-&gt;{search}-&gt;searchWeb( %$params );</td></tr>
<tr><td class="h">3100</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $s;</td></tr>
<tr><td class="h">3101</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3102</td><td colspan="6"></td></tr><tr><td class="h">3103</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _WEBLIST {</td></tr>
<tr><td class="h">3104</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3104">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3105</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3105">33</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = $params-&gt;{_DEFAULT} || $params-&gt;{&#39;format&#39;} || &#39;$name&#39;;</td></tr>
<tr><td class="h">3106</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3106">50</a></div></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$format ||= &#39;$name&#39;;</td></tr>
<tr><td class="h">3107</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3107">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $separator = $params-&gt;{separator} || &quot;\n&quot;;</td></tr>
<tr><td class="h">3108</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$separator =~ s/\$n/\n/;</td></tr>
<tr><td class="h">3109</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3109">50</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $params-&gt;{web} || &#39;&#39;;</td></tr>
<tr><td class="h">3110</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3110">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $webs = $params-&gt;{webs} || &#39;public&#39;;</td></tr>
<tr><td class="h">3111</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3111">50</a></div></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $selection = $params-&gt;{selection} || &#39;&#39;;</td></tr>
<tr><td class="h">3112</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$selection =~ s/\,/ /g;</td></tr>
<tr><td class="h">3113</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$selection = &quot; $selection &quot;;</td></tr>
<tr><td class="h">3114</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3114">50</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $marker = $params-&gt;{marker} || &#39;selected=&quot;selected&quot;&#39;;</td></tr>
<tr><td class="h">3115</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s#\.#/#go;</td></tr>
<tr><td class="h">3116</td><td colspan="6"></td></tr><tr><td class="h">3117</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list = ();</td></tr>
<tr><td class="h">3118</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @webslist = split( /,\s*/, $webs );</td></tr>
<tr><td class="h">3119</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $aweb ( @webslist ) {</td></tr>
<tr><td class="h">3120</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3120">50</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3120">0</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $aweb eq &#39;public&#39; ) {</td></tr>
<tr><td class="h">3121</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @list, $this-&gt;{store}-&gt;getListOfWebs( &#39;user,public,allowed&#39; ) );</td></tr>
<tr><td class="h">3122</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $aweb eq &#39;webtemplate&#39; ) {</td></tr>
<tr><td class="h">3123</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @list, $this-&gt;{store}-&gt;getListOfWebs( &#39;template,allowed&#39; ));</td></tr>
<tr><td class="h">3124</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else{</td></tr>
<tr><td class="h">3125</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3125">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @list, $aweb ) if( $this-&gt;{store}-&gt;webExists( $aweb ) );</td></tr>
<tr><td class="h">3126</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3127</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3128</td><td colspan="6"></td></tr><tr><td class="h">3129</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @items;</td></tr>
<tr><td class="h">3130</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $indent = CGI::span({class=&gt;&#39;twikiWebIndent&#39;},&#39;&#39;);</td></tr>
<tr><td class="h">3131</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $item ( @list ) {</td></tr>
<tr><td class="h">3132</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $line = $format;</td></tr>
<tr><td class="h">3133</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$web\b/$web/g;</td></tr>
<tr><td class="h">3134</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$name\b/$item/g;</td></tr>
<tr><td class="h">3135</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$qname/&quot;$item&quot;/g;</td></tr>
<tr><td class="h">3136</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $indenteditem = $item;</td></tr>
<tr><td class="h">3137</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$indenteditem =~ s#/$##g;</td></tr>
<tr><td class="h">3138</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$indenteditem =~ s#\w+/#$indent#g;</td></tr>
<tr><td class="h">3139</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$indentedname/$indenteditem/g;</td></tr>
<tr><td class="h">3140</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3140">50</a></div></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mark = ( $selection =~ / \Q$item\E / ) ? $marker : &#39;&#39;;</td></tr>
<tr><td class="h">3141</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$marker/$mark/g;</td></tr>
<tr><td class="h">3142</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@items, $line);</td></tr>
<tr><td class="h">3143</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3144</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return join( $separator, @items);</td></tr>
<tr><td class="h">3145</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3146</td><td colspan="6"></td></tr><tr><td class="h">3147</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TOPICLIST {</td></tr>
<tr><td class="h">3148</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3148">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3149</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3149">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = $params-&gt;{_DEFAULT} || $params-&gt;{&#39;format&#39;} || &#39;$name&#39;;</td></tr>
<tr><td class="h">3150</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3150">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$format ||= &#39;$name&#39;;</td></tr>
<tr><td class="h">3151</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3151">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $separator = $params-&gt;{separator} || &quot;\n&quot;;</td></tr>
<tr><td class="h">3152</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$separator =~ s/\$n/\n/;</td></tr>
<tr><td class="h">3153</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3153">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $params-&gt;{web} || $this-&gt;{webName};</td></tr>
<tr><td class="h">3154</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3154">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $selection = $params-&gt;{selection} || &#39;&#39;;</td></tr>
<tr><td class="h">3155</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$selection =~ s/\,/ /g;</td></tr>
<tr><td class="h">3156</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$selection = &quot; $selection &quot;;</td></tr>
<tr><td class="h">3157</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3157">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $marker = $params-&gt;{marker} || &#39;selected=&quot;selected&quot;&#39;;</td></tr>
<tr><td class="h">3158</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s#\.#/#go;</td></tr>
<tr><td class="h">3159</td><td colspan="6"></td></tr><tr><td class="h">3160</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3160">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3160">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if</td></tr>
<tr><td class="h">3161</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web ne $this-&gt;{webName} &amp;&amp;</td></tr>
<tr><td class="h">3162</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs}-&gt;getWebPreferencesValue( &#39;NOSEARCHALL&#39;, $web );</td></tr>
<tr><td class="h">3163</td><td colspan="6"></td></tr><tr><td class="h">3164</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @items;</td></tr>
<tr><td class="h">3165</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $item ( $this-&gt;{store}-&gt;getTopicNames( $web ) ) {</td></tr>
<tr><td class="h">3166</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $line = $format;</td></tr>
<tr><td class="h">3167</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$web\b/$web/g;</td></tr>
<tr><td class="h">3168</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$name\b/$item/g;</td></tr>
<tr><td class="h">3169</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$qname/&quot;$item&quot;/g;</td></tr>
<tr><td class="h">3170</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3170">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mark = ( $selection =~ / \Q$item\E / ) ? $marker : &#39;&#39;;</td></tr>
<tr><td class="h">3171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/\$marker/$mark/g;</td></tr>
<tr><td class="h">3172</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @items, $line );</td></tr>
<tr><td class="h">3173</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3174</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return join( $separator, @items );</td></tr>
<tr><td class="h">3175</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3176</td><td colspan="6"></td></tr><tr><td class="h">3177</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _QUERYSTRING {</td></tr>
<tr><td class="h">3178</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3178">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">3179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{cgiQuery}-&gt;query_string();</td></tr>
<tr><td class="h">3180</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3181</td><td colspan="6"></td></tr><tr><td class="h">3182</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _QUERYPARAMS {</td></tr>
<tr><td class="h">3183</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3183">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3184</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3184">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $this-&gt;{cgiQuery};</td></tr>
<tr><td class="h">3185</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3185">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = defined $params-&gt;{format} ? $params-&gt;{format} : &#39;$name=$value&#39;;</td></tr>
<tr><td class="h">3186</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3186">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $separator = defined $params-&gt;{separator} ? $params-&gt;{separator} : &quot;\n&quot;;</td></tr>
<tr><td class="h">3187</td><td colspan="6"></td></tr><tr><td class="h">3188</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list;</td></tr>
<tr><td class="h">3189</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $name ( $this-&gt;{cgiQuery}-&gt;param() ) {</td></tr>
<tr><td class="h">3190</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Issues multi-valued parameters as separate hiddens</td></tr>
<tr><td class="h">3191</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $value = $this-&gt;{cgiQuery}-&gt;param( $name );</td></tr>
<tr><td class="h">3192</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $entry = $format;</td></tr>
<tr><td class="h">3193</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry =~ s/\$name/$name/g;</td></tr>
<tr><td class="h">3194</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$entry =~ s/\$value/$value/;</td></tr>
<tr><td class="h">3195</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@list, $entry);</td></tr>
<tr><td class="h">3196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3197</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return expandStandardEscapes(join($separator, @list));</td></tr>
<tr><td class="h">3198</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3199</td><td colspan="6"></td></tr><tr><td class="h">3200 - 3214</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod expandStandardEscapes($str) -&gt; $unescapedStr

Expands standard escapes used in parameter values to block evaluation. The following escapes
are handled:

| *Escape:* | *Expands To:* |
| =$n= or =$n()= | New line. Use =$n()= if followed by alphanumeric character, e.g. write =Foo$n()Bar= instead of =Foo$nBar= |
| =$nop= or =$nop()= | Is a &quot;no operation&quot;. |
| =$quot= | Double quote (=&quot;=) |
| =$percnt= | Percent sign (=%=) |
| =$dollar= | Dollar sign (=$=) |

=cut</pre></td></tr>
<tr><td class="h">3215</td><td colspan="6"></td></tr><tr><td class="h">3216</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub expandStandardEscapes {</td></tr>
<tr><td class="h">3217</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3217">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = shift;</td></tr>
<tr><td class="h">3218</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$n\(\)/\n/gos;         # expand &#39;$n()&#39; to new line</td></tr>
<tr><td class="h">3219</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$n([^$regex{mixedAlpha}]|$)/\n$1/gos; # expand &#39;$n&#39; to new line</td></tr>
<tr><td class="h">3220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$nop(\(\))?//gos;      # remove filler, useful for nested search</td></tr>
<tr><td class="h">3221</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$quot(\(\))?/\&quot;/gos;   # expand double quote</td></tr>
<tr><td class="h">3222</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$percnt(\(\))?/\%/gos; # expand percent</td></tr>
<tr><td class="h">3223</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$dollar(\(\))?/\$/gos; # expand dollar</td></tr>
<tr><td class="h">3224</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">3225</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3226</td><td colspan="6"></td></tr><tr><td class="h">3227</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _URLPARAM {</td></tr>
<tr><td class="h">3228</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3228">2</a></div></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3229</td><td><div class="c3">2</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3229">50</a></div></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $param     = $params-&gt;{_DEFAULT} || &#39;&#39;;</td></tr>
<tr><td class="h">3230</td><td><div class="c3">2</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3230">50</a></div></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $newLine   = $params-&gt;{newline} || &#39;&#39;;</td></tr>
<tr><td class="h">3231</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $encode    = $params-&gt;{encode};</td></tr>
<tr><td class="h">3232</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $multiple  = $params-&gt;{multiple};</td></tr>
<tr><td class="h">3233</td><td><div class="c3">2</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3233">50</a></div></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $separator = $params-&gt;{separator} || &quot;\n&quot;;</td></tr>
<tr><td class="h">3234</td><td colspan="6"></td></tr><tr><td class="h">3235</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $value = &#39;&#39;;</td></tr>
<tr><td class="h">3236</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3236">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{cgiQuery} ) {</td></tr>
<tr><td class="h">3237</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3237">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( TWiki::isTrue( $multiple )) {</td></tr>
<tr><td class="h">3238</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @valueArray = $this-&gt;{cgiQuery}-&gt;param( $param );</td></tr>
<tr><td class="h">3239</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3239">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( @valueArray ) {</td></tr>
<tr><td class="h">3240</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# join multiple values properly</td></tr>
<tr><td class="h">3241</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3241">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $multiple =~ m/^on$/i ) {</td></tr>
<tr><td class="h">3242</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $item = &#39;&#39;;</td></tr>
<tr><td class="h">3243</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@valueArray = map {</td></tr>
<tr><td class="h">3244</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item = $_;</td></tr>
<tr><td class="h">3245</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_ = $multiple;</td></tr>
<tr><td class="h">3246</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3246">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_ .= $item unless( s/\$item/$item/go );</td></tr>
<tr><td class="h">3247</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_</td></tr>
<tr><td class="h">3248</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} @valueArray;</td></tr>
<tr><td class="h">3249</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3250</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = join ( $separator, @valueArray );</td></tr>
<tr><td class="h">3251</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3252</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3253</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = $this-&gt;{cgiQuery}-&gt;param( $param );</td></tr>
<tr><td class="h">3254</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3254">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = &#39;&#39; unless( defined $value );</td></tr>
<tr><td class="h">3255</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3256</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3257</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3257">50</a></div></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\r?\n/$newLine/go if( $newLine );</td></tr>
<tr><td class="h">3258</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3258">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $encode ) {</td></tr>
<tr><td class="h">3259</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3259">50</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3259">0</a></div></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $encode =~ /^entit(y|ies)$/i ) {</td></tr>
<tr><td class="h">3260</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = entityEncode( $value );</td></tr>
<tr><td class="h">3261</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $encode =~ /^quotes?$/i ) {</td></tr>
<tr><td class="h">3262</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\&quot;/\\&quot;/go;    # escape quotes with backslash (Bugs:Item3383 fix)</td></tr>
<tr><td class="h">3263</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3264</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\r*\n\r*/&lt;br \/&gt;/; # Legacy</td></tr>
<tr><td class="h">3265</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = urlEncode( $value );</td></tr>
<tr><td class="h">3266</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3267</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3268</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3268">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $value ) {</td></tr>
<tr><td class="h">3269</td><td><div class="c3">2</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3269">50</a></div></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = $params-&gt;{default} || &#39;&#39;;</td></tr>
<tr><td class="h">3270</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3271</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $value;</td></tr>
<tr><td class="h">3272</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3273</td><td colspan="6"></td></tr><tr><td class="h">3274</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine was introduced to URL encode Mozilla UTF-8 POST URLs in the</td></tr>
<tr><td class="h">3275</td><td></td><td></td><td></td><td></td><td></td><td class="s"># TWiki Feb2003 release - encoding is no longer needed since UTF-URLs are now</td></tr>
<tr><td class="h">3276</td><td></td><td></td><td></td><td></td><td></td><td class="s"># directly supported, but it is provided for backward compatibility with</td></tr>
<tr><td class="h">3277</td><td></td><td></td><td></td><td></td><td></td><td class="s"># skins that may still be using the deprecated %INTURLENCODE%.</td></tr>
<tr><td class="h">3278</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _INTURLENCODE {</td></tr>
<tr><td class="h">3279</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3279">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3280</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Just strip double quotes, no URL encoding - Mozilla UTF-8 URLs</td></tr>
<tr><td class="h">3281</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# directly supported now</td></tr>
<tr><td class="h">3282</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3282">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{_DEFAULT} || &#39;&#39;;</td></tr>
<tr><td class="h">3283</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3284</td><td colspan="6"></td></tr><tr><td class="h">3285</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine is deprecated as of DakarRelease,</td></tr>
<tr><td class="h">3286</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and is maintained only for backward compatibility.</td></tr>
<tr><td class="h">3287</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Spacing of WikiWords is now done with %SPACEOUT%</td></tr>
<tr><td class="h">3288</td><td></td><td></td><td></td><td></td><td></td><td class="s"># (and the private routine _SPACEOUT).</td></tr>
<tr><td class="h">3289</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Move to compatibility module in TWiki5</td></tr>
<tr><td class="h">3290</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SPACEDTOPIC_deprecated {</td></tr>
<tr><td class="h">3291</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3291">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $theTopic ) = @_;</td></tr>
<tr><td class="h">3292</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = spaceOutWikiWord( $theTopic );</td></tr>
<tr><td class="h">3293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$topic =~ s/ / */g;</td></tr>
<tr><td class="h">3294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return urlEncode( $topic );</td></tr>
<tr><td class="h">3295</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3296</td><td colspan="6"></td></tr><tr><td class="h">3297</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SPACEOUT {</td></tr>
<tr><td class="h">3298</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3298">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3299</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $spaceOutTopic = $params-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">3300</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sep = $params-&gt;{&#39;separator&#39;};</td></tr>
<tr><td class="h">3301</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$spaceOutTopic = spaceOutWikiWord( $spaceOutTopic, $sep );</td></tr>
<tr><td class="h">3302</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $spaceOutTopic;</td></tr>
<tr><td class="h">3303</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3304</td><td colspan="6"></td></tr><tr><td class="h">3305</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ICON {</td></tr>
<tr><td class="h">3306</td><td><div class="c3">9</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3306">9</a></div></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3307</td><td><div class="c3">9</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3307">50</a></div></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = $params-&gt;{_DEFAULT} || &#39;&#39;;</td></tr>
<tr><td class="h">3308</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Try to map the file name to see if there is a matching filetype image</td></tr>
<tr><td class="h">3309</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If no mapping could be found, use the file name that was passed</td></tr>
<tr><td class="h">3310</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $iconFileName = $this-&gt;mapToIconFileName( $file, $file );</td></tr>
<tr><td class="h">3311</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return CGI::img( { src =&gt; $this-&gt;getIconUrl( 0, $iconFileName ),</td></tr>
<tr><td class="h">3312</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width =&gt; 16, height=&gt;16,</td></tr>
<tr><td class="h">3313</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;align =&gt; &#39;top&#39;, alt =&gt; $iconFileName, border =&gt; 0 });</td></tr>
<tr><td class="h">3314</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3315</td><td colspan="6"></td></tr><tr><td class="h">3316</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ICONURL {</td></tr>
<tr><td class="h">3317</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3317">4</a></div></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3318</td><td><div class="c3">4</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3318">50</a></div></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = ( $params-&gt;{_DEFAULT} || &#39;&#39; );</td></tr>
<tr><td class="h">3319</td><td colspan="6"></td></tr><tr><td class="h">3320</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getIconUrl( 1, $file );</td></tr>
<tr><td class="h">3321</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3322</td><td colspan="6"></td></tr><tr><td class="h">3323</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ICONURLPATH {</td></tr>
<tr><td class="h">3324</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3324">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3325</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3325">50</a></div></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $file = ( $params-&gt;{_DEFAULT} || &#39;&#39; );</td></tr>
<tr><td class="h">3326</td><td colspan="6"></td></tr><tr><td class="h">3327</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getIconUrl( 0, $file );</td></tr>
<tr><td class="h">3328</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3329</td><td colspan="6"></td></tr><tr><td class="h">3330</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _RELATIVETOPICPATH {</td></tr>
<tr><td class="h">3331</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3331">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $theTopic, $web ) = @_;</td></tr>
<tr><td class="h">3332</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = $params-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">3333</td><td colspan="6"></td></tr><tr><td class="h">3334</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3334">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $topic;</td></tr>
<tr><td class="h">3335</td><td colspan="6"></td></tr><tr><td class="h">3336</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $theRelativePath;</td></tr>
<tr><td class="h">3337</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if there is no dot in $topic, no web has been specified</td></tr>
<tr><td class="h">3338</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3338">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( index( $topic, &#39;.&#39; ) == -1 ) {</td></tr>
<tr><td class="h">3339</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# add local web</td></tr>
<tr><td class="h">3340</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theRelativePath = $web . &#39;/&#39; . $topic;</td></tr>
<tr><td class="h">3341</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3342</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theRelativePath = $topic; #including dot</td></tr>
<tr><td class="h">3343</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3344</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# replace dot by slash is not necessary; TWiki.MyTopic is a valid url</td></tr>
<tr><td class="h">3345</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# add ../ if not already present to make a relative file reference</td></tr>
<tr><td class="h">3346</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3346">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $theRelativePath !~ m!^../! ) {</td></tr>
<tr><td class="h">3347</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theRelativePath = &quot;../$theRelativePath&quot;;</td></tr>
<tr><td class="h">3348</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3349</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $theRelativePath;</td></tr>
<tr><td class="h">3350</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3351</td><td colspan="6"></td></tr><tr><td class="h">3352</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ATTACHURLPATH {</td></tr>
<tr><td class="h">3353</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3353">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3354</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getPubUrl(0, $web, $topic);</td></tr>
<tr><td class="h">3355</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3356</td><td colspan="6"></td></tr><tr><td class="h">3357</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ATTACHURL {</td></tr>
<tr><td class="h">3358</td><td><div class="c3">10</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3358">10</a></div></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3359</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>41</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getPubUrl(1, $web, $topic);</td></tr>
<tr><td class="h">3360</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3361</td><td colspan="6"></td></tr><tr><td class="h">3362</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _LANGUAGE {</td></tr>
<tr><td class="h">3363</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3363">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">3364</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{i18n}-&gt;language();</td></tr>
<tr><td class="h">3365</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3366</td><td colspan="6"></td></tr><tr><td class="h">3367</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _LANGUAGES {</td></tr>
<tr><td class="h">3368</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3368">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this , $params ) = @_;</td></tr>
<tr><td class="h">3369</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3369">50</a></div></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = $params-&gt;{format} || &quot;   * \$langname&quot;;</td></tr>
<tr><td class="h">3370</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3370">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $separator = $params-&gt;{separator} || &quot;\n&quot;;</td></tr>
<tr><td class="h">3371</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$separator =~ s/\\n/\n/g;</td></tr>
<tr><td class="h">3372</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3372">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $selection = $params-&gt;{selection} || &#39;&#39;;</td></tr>
<tr><td class="h">3373</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$selection =~ s/\,/ /g;</td></tr>
<tr><td class="h">3374</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$selection = &quot; $selection &quot;;</td></tr>
<tr><td class="h">3375</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3375">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $marker = $params-&gt;{marker} || &#39;selected=&quot;selected&quot;&#39;;</td></tr>
<tr><td class="h">3376</td><td colspan="6"></td></tr><tr><td class="h">3377</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# $languages is a hash reference:</td></tr>
<tr><td class="h">3378</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $languages = $this-&gt;{i18n}-&gt;enabled_languages();</td></tr>
<tr><td class="h">3379</td><td colspan="6"></td></tr><tr><td class="h">3380</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @tags = sort(keys(%{$languages}));</td></tr>
<tr><td class="h">3381</td><td colspan="6"></td></tr><tr><td class="h">3382</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = &#39;&#39;;</td></tr>
<tr><td class="h">3383</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $i = 0; </td></tr>
<tr><td class="h">3384</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $lang (@tags) {</td></tr>
<tr><td class="h">3385</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $item = $format;</td></tr>
<tr><td class="h">3386</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $name = ${$languages}{$lang};</td></tr>
<tr><td class="h">3387</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item =~ s/\$langname/$name/g;</td></tr>
<tr><td class="h">3388</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item =~ s/\$langtag/$lang/g;</td></tr>
<tr><td class="h">3389</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3389">50</a></div></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mark = ( $selection =~ / \Q$lang\E / ) ? $marker : &#39;&#39;;</td></tr>
<tr><td class="h">3390</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$item =~ s/\$marker/$mark/g;</td></tr>
<tr><td class="h">3391</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3391">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= $separator if $i;</td></tr>
<tr><td class="h">3392</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= $item;</td></tr>
<tr><td class="h">3393</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i++;</td></tr>
<tr><td class="h">3394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3395</td><td colspan="6"></td></tr><tr><td class="h">3396</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $result;</td></tr>
<tr><td class="h">3397</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3398</td><td colspan="6"></td></tr><tr><td class="h">3399</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _MAKETEXT {</td></tr>
<tr><td class="h">3400</td><td><div class="c3">41</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3400">41</a></div></td><td><div>153</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $params ) = @_;</td></tr>
<tr><td class="h">3401</td><td colspan="6"></td></tr><tr><td class="h">3402</td><td><div class="c3">41</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3402">33</a></div></td><td></td><td><div>294</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $str = $params-&gt;{_DEFAULT} || $params-&gt;{string} || &quot;&quot;;</td></tr>
<tr><td class="h">3403</td><td><div class="c3">41</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3403">50</a></div></td><td></td><td></td><td><div>172</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&quot; unless $str;</td></tr>
<tr><td class="h">3404</td><td colspan="6"></td></tr><tr><td class="h">3405</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# escape everything:</td></tr>
<tr><td class="h">3406</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>139</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/\[/~[/g;</td></tr>
<tr><td class="h">3407</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>129</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/\]/~]/g;</td></tr>
<tr><td class="h">3408</td><td colspan="6"></td></tr><tr><td class="h">3409</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# restore already escaped stuff:</td></tr>
<tr><td class="h">3410</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>125</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/~~\[/~[/g;</td></tr>
<tr><td class="h">3411</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>115</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/~~\]/~]/g;</td></tr>
<tr><td class="h">3412</td><td colspan="6"></td></tr><tr><td class="h">3413</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# unescape parameters and calculate highest parameter number:</td></tr>
<tr><td class="h">3414</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>114</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $max = 0;</td></tr>
<tr><td class="h">3415</td><td><div class="c3">41</div><div class="c3">6</div><div class="c3">6</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3415">50</a></div></td><td></td><td></td><td><div>132</div><div>50</div><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/~\[(\_(\d+))~\]/ $max = $2 if ($2 &gt; $max); &quot;[$1]&quot;/ge;</td></tr>
<tr><td class="h">3416</td><td><div class="c3">41</div><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3416">0</a></div></td><td></td><td></td><td><div>120</div><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/~\[(\*,\_(\d+),[^,]+(,([^,]+))?)~\]/ $max = $2 if ($2 &gt; $max); &quot;[$1]&quot;/ge;</td></tr>
<tr><td class="h">3417</td><td colspan="6"></td></tr><tr><td class="h">3418</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# get the args to be interpolated.</td></tr>
<tr><td class="h">3419</td><td><div class="c3">41</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3419">100</a></div></td><td></td><td><div>342</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $argsStr = $params-&gt;{args} || &quot;&quot;;</td></tr>
<tr><td class="h">3420</td><td colspan="6"></td></tr><tr><td class="h">3421</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>196</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @args = split (/\s*,\s*/, $argsStr) ;</td></tr>
<tr><td class="h">3422</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# fill omitted args with zeros</td></tr>
<tr><td class="h">3423</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>214</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ((scalar @args) &lt; $max) {</td></tr>
<tr><td class="h">3424</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@args, 0);</td></tr>
<tr><td class="h">3425</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3426</td><td colspan="6"></td></tr><tr><td class="h">3427</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do the magic:</td></tr>
<tr><td class="h">3428</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>256</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result  =  $this-&gt;{i18n}-&gt;maketext($str, @args);</td></tr>
<tr><td class="h">3429</td><td colspan="6"></td></tr><tr><td class="h">3430</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# replace accesskeys:</td></tr>
<tr><td class="h">3431</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>217</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$result =~ s#(^|[^&amp;])&amp;([a-zA-Z])#$1&lt;span class=&#39;twikiAccessKey&#39;&gt;$2&lt;/span&gt;#g;</td></tr>
<tr><td class="h">3432</td><td colspan="6"></td></tr><tr><td class="h">3433</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# replace escaped amperstands:</td></tr>
<tr><td class="h">3434</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>127</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$result =~ s/&amp;&amp;/\&amp;/g;</td></tr>
<tr><td class="h">3435</td><td colspan="6"></td></tr><tr><td class="h">3436</td><td><div class="c3">41</div></td><td></td><td></td><td></td><td><div>175</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $result;</td></tr>
<tr><td class="h">3437</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3438</td><td colspan="6"></td></tr><tr><td class="h">3439</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SCRIPTNAME {</td></tr>
<tr><td class="h">3440</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#my ( $this, $params, $theTopic, $theWeb ) = @_;</td></tr>
<tr><td class="h">3441</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# try SCRIPT_FILENAME</td></tr>
<tr><td class="h">3442</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3442">1</a></div></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $value = $ENV{SCRIPT_FILENAME};</td></tr>
<tr><td class="h">3443</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3443">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $value ) {</td></tr>
<tr><td class="h">3444</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s!.*/([^/]+)$!$1!o;</td></tr>
<tr><td class="h">3445</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $value;</td></tr>
<tr><td class="h">3446</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3447</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# try SCRIPT_URL (won&#39;t work with url rewriting)</td></tr>
<tr><td class="h">3448</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value = $ENV{SCRIPT_URL};</td></tr>
<tr><td class="h">3449</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3449">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $value ) {</td></tr>
<tr><td class="h">3450</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# e.g. &#39;/cgi-bin/view.cgi/TWiki/WebHome&#39;</td></tr>
<tr><td class="h">3451</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# cut URL path to get &#39;view.cgi/TWiki/WebHome&#39;</td></tr>
<tr><td class="h">3452</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s|^$TWiki::cfg{ScriptUrlPath}/?||o;</td></tr>
<tr><td class="h">3453</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# cut extended path to get &#39;view.cgi&#39;</td></tr>
<tr><td class="h">3454</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s|/.*$||;</td></tr>
<tr><td class="h">3455</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $value;</td></tr>
<tr><td class="h">3456</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3457</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# no joy</td></tr>
<tr><td class="h">3458</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">3459</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3460</td><td colspan="6"></td></tr><tr><td class="h">3461</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SCRIPTURL {</td></tr>
<tr><td class="h">3462</td><td><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3462">6</a></div></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3463</td><td><div class="c3">6</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3463">100</a></div></td><td></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $script = $params-&gt;{_DEFAULT} || &#39;&#39;;</td></tr>
<tr><td class="h">3464</td><td colspan="6"></td></tr><tr><td class="h">3465</td><td><div class="c3">6</div></td><td></td><td></td><td></td><td><div>32</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getScriptUrl( 1, $script );</td></tr>
<tr><td class="h">3466</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3467</td><td colspan="6"></td></tr><tr><td class="h">3468</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SCRIPTURLPATH {</td></tr>
<tr><td class="h">3469</td><td><div class="c3">20</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3469">20</a></div></td><td><div>90</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3470</td><td><div class="c3">20</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3470">50</a></div></td><td></td><td><div>103</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $script = $params-&gt;{_DEFAULT} || &#39;&#39;;</td></tr>
<tr><td class="h">3471</td><td colspan="6"></td></tr><tr><td class="h">3472</td><td><div class="c3">20</div></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getScriptUrl( 0, $script );</td></tr>
<tr><td class="h">3473</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3474</td><td colspan="6"></td></tr><tr><td class="h">3475</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _PUBURL {</td></tr>
<tr><td class="h">3476</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3476">1</a></div></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">3477</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getPubUrl(1);</td></tr>
<tr><td class="h">3478</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3479</td><td colspan="6"></td></tr><tr><td class="h">3480</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _PUBURLPATH {</td></tr>
<tr><td class="h">3481</td><td><div class="c3">15</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3481">15</a></div></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">3482</td><td><div class="c3">15</div></td><td></td><td></td><td></td><td><div>70</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getPubUrl(0);</td></tr>
<tr><td class="h">3483</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3484</td><td colspan="6"></td></tr><tr><td class="h">3485</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ALLVARIABLES {</td></tr>
<tr><td class="h">3486</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3486">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return shift-&gt;{prefs}-&gt;stringify();</td></tr>
<tr><td class="h">3487</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3488</td><td colspan="6"></td></tr><tr><td class="h">3489</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _META {</td></tr>
<tr><td class="h">3490</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3490">4</a></div></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3491</td><td colspan="6"></td></tr><tr><td class="h">3492</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta  = $this-&gt;inContext( &#39;can_render_meta&#39; );</td></tr>
<tr><td class="h">3493</td><td colspan="6"></td></tr><tr><td class="h">3494</td><td><div class="c3">4</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3494">50</a></div></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $meta;</td></tr>
<tr><td class="h">3495</td><td colspan="6"></td></tr><tr><td class="h">3496</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $option = $params-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">3497</td><td colspan="6"></td></tr><tr><td class="h">3498</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3498">100</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3498">50</a></div><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3498">100</a></div><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3498">100</a></div><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3498">50</a></div></td><td></td><td></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $option eq &#39;form&#39; ) {</td></tr>
<tr><td class="h">3499</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# META:FORM and META:FIELD</td></tr>
<tr><td class="h">3500</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return TWiki::Form::renderForDisplay( $this-&gt;{templates}, $meta );</td></tr>
<tr><td class="h">3501</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $option eq &#39;formfield&#39; ) {</td></tr>
<tr><td class="h">3502</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# a formfield from within topic text</td></tr>
<tr><td class="h">3503</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{renderer}-&gt;renderFormField( $meta, $params );</td></tr>
<tr><td class="h">3504</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $option eq &#39;attachments&#39; ) {</td></tr>
<tr><td class="h">3505</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# renders attachment tables</td></tr>
<tr><td class="h">3506</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{attach}-&gt;renderMetaData( $web, $topic, $meta, $params );</td></tr>
<tr><td class="h">3507</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $option eq &#39;moved&#39; ) {</td></tr>
<tr><td class="h">3508</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{renderer}-&gt;renderMoved( $web, $topic, $meta, $params );</td></tr>
<tr><td class="h">3509</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $option eq &#39;parent&#39; ) {</td></tr>
<tr><td class="h">3510</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{renderer}-&gt;renderParent( $web, $topic, $meta, $params );</td></tr>
<tr><td class="h">3511</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3512</td><td colspan="6"></td></tr><tr><td class="h">3513</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">3514</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3515</td><td colspan="6"></td></tr><tr><td class="h">3516</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Remove NOP tag in template topics but show content. Used in template</td></tr>
<tr><td class="h">3517</td><td></td><td></td><td></td><td></td><td></td><td class="s"># _topics_ (not templates, per se, but topics used as templates for new</td></tr>
<tr><td class="h">3518</td><td></td><td></td><td></td><td></td><td></td><td class="s"># topics)</td></tr>
<tr><td class="h">3519</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _NOP {</td></tr>
<tr><td class="h">3520</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3520">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">3521</td><td colspan="6"></td></tr><tr><td class="h">3522</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3522">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;nop&gt;&#39; unless $params-&gt;{_RAW};</td></tr>
<tr><td class="h">3523</td><td colspan="6"></td></tr><tr><td class="h">3524</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{_RAW};</td></tr>
<tr><td class="h">3525</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3526</td><td colspan="6"></td></tr><tr><td class="h">3527</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Shortcut to %TMPL:P{&quot;sep&quot;}%</td></tr>
<tr><td class="h">3528</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SEP {</td></tr>
<tr><td class="h">3529</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3529">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">3530</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{templates}-&gt;expandTemplate(&#39;sep&#39;);</td></tr>
<tr><td class="h">3531</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3532</td><td colspan="6"></td></tr><tr><td class="h">3533</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %USERINFO%</td></tr>
<tr><td class="h">3534</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">3535</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _WIKINAME_deprecated {</td></tr>
<tr><td class="h">3536</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3536">4</a></div></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3537</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">3538</td><td colspan="6"></td></tr><tr><td class="h">3539</td><td><div class="c3">4</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3539">50</a></div></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{format} = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;WIKINAME&#39; ) ||</td></tr>
<tr><td class="h">3540</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;$wikiname&#39;;</td></tr>
<tr><td class="h">3541</td><td colspan="6"></td></tr><tr><td class="h">3542</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_USERINFO($params);</td></tr>
<tr><td class="h">3543</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3544</td><td colspan="6"></td></tr><tr><td class="h">3545</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %USERINFO%</td></tr>
<tr><td class="h">3546</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">3547</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _USERNAME_deprecated {</td></tr>
<tr><td class="h">3548</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3548">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3549</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">3550</td><td colspan="6"></td></tr><tr><td class="h">3551</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3551">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{format} = $this-&gt;{prefs}-&gt;getPreferencesValue( &#39;USERNAME&#39; ) ||</td></tr>
<tr><td class="h">3552</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;$username&#39;;</td></tr>
<tr><td class="h">3553</td><td colspan="6"></td></tr><tr><td class="h">3554</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_USERINFO($params);</td></tr>
<tr><td class="h">3555</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3556</td><td colspan="6"></td></tr><tr><td class="h">3557</td><td></td><td></td><td></td><td></td><td></td><td class="s">#deprecated functionality, now implemented using %USERINFO%</td></tr>
<tr><td class="h">3558</td><td></td><td></td><td></td><td></td><td></td><td class="s">#move to compatibility plugin in TWiki5</td></tr>
<tr><td class="h">3559</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _WIKIUSERNAME_deprecated {</td></tr>
<tr><td class="h">3560</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3560">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3561</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">3562</td><td colspan="6"></td></tr><tr><td class="h">3563</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3563">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{format} =</td></tr>
<tr><td class="h">3564</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{prefs}-&gt;getPreferencesValue( &#39;WIKIUSERNAME&#39; ) ||</td></tr>
<tr><td class="h">3565</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;$wikiusername&#39;;</td></tr>
<tr><td class="h">3566</td><td colspan="6"></td></tr><tr><td class="h">3567</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_USERINFO($params);</td></tr>
<tr><td class="h">3568</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3569</td><td colspan="6"></td></tr><tr><td class="h">3570</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _USERINFO {</td></tr>
<tr><td class="h">3571</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3571">5</a></div></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3572</td><td><div class="c3">5</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3572">50</a></div></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = $params-&gt;{format} || &#39;$username, $wikiusername, $emails&#39;;</td></tr>
<tr><td class="h">3573</td><td><div class="c3">5</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3573">50</a></div></td><td></td><td><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $userDebug = $params-&gt;{&#39;userdebug&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">3574</td><td colspan="6"></td></tr><tr><td class="h">3575</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = $this-&gt;{user};</td></tr>
<tr><td class="h">3576</td><td><div class="c3">5</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3576">50</a></div></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $params-&gt;{_DEFAULT} ) {</td></tr>
<tr><td class="h">3577</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user = $this-&gt;{users}-&gt;findUser( $params-&gt;{_DEFAULT}, undef, 1 );</td></tr>
<tr><td class="h">3578</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3578">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if !$user;</td></tr>
<tr><td class="h">3579</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3579">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3579">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if( $TWiki::cfg{AntiSpam}{HideUserDetails} &amp;&amp;</td></tr>
<tr><td class="h">3580</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!$this-&gt;{user}-&gt;isAdmin() &amp;&amp;</td></tr>
<tr><td class="h">3581</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user != $this-&gt;{user} );</td></tr>
<tr><td class="h">3582</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3583</td><td colspan="6"></td></tr><tr><td class="h">3584</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $info = $format;</td></tr>
<tr><td class="h">3585</td><td colspan="6"></td></tr><tr><td class="h">3586</td><td><div class="c3">5</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3586">50</a></div></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($info =~ /\$username/) {</td></tr>
<tr><td class="h">3587</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $username = $user-&gt;login();</td></tr>
<tr><td class="h">3588</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$info =~ s/\$username/$username/g;</td></tr>
<tr><td class="h">3589</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3590</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3590">100</a></div></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($info =~ /\$wikiname/) {</td></tr>
<tr><td class="h">3591</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $wikiname = $user-&gt;wikiName();</td></tr>
<tr><td class="h">3592</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$info =~ s/\$wikiname/$wikiname/g;</td></tr>
<tr><td class="h">3593</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3594</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3594">100</a></div></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($info =~ /\$wikiusername/) {</td></tr>
<tr><td class="h">3595</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $wikiusername = $user-&gt;webDotWikiName();</td></tr>
<tr><td class="h">3596</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$info =~ s/\$wikiusername/$wikiusername/g;</td></tr>
<tr><td class="h">3597</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3598</td><td><div class="c3">5</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3598">50</a></div></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($info =~ /\$emails/) {</td></tr>
<tr><td class="h">3599</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $emails = join(&#39;, &#39;, $user-&gt;emails());</td></tr>
<tr><td class="h">3600</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$info =~ s/\$emails/$emails/g;</td></tr>
<tr><td class="h">3601</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3602</td><td><div class="c3">5</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3602">50</a></div></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($info =~ /\$groups/) {</td></tr>
<tr><td class="h">3603</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @groupNames = map {$_-&gt;webDotWikiName();} $user-&gt;getGroups();</td></tr>
<tr><td class="h">3604</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $groups = join(&#39;, &#39;, @groupNames);</td></tr>
<tr><td class="h">3605</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3605">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$groups .= &#39; isAdmin()&#39; if $user-&gt;isAdmin();</td></tr>
<tr><td class="h">3606</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$info =~ s/\$groups/$groups/g;</td></tr>
<tr><td class="h">3607</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3608</td><td colspan="6"></td></tr><tr><td class="h">3609</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#don&#39;t give out userlists to non-admins</td></tr>
<tr><td class="h">3610</td><td><div class="c3">5</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-pm--branch.html#L3610">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--condition.html#L3610">33</a></div></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($userDebug ne &#39;&#39; &amp;&amp; $user-&gt;isAdmin()) {</td></tr>
<tr><td class="h">3611</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $users = &#39;&#39;;</td></tr>
<tr><td class="h">3612</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$users .= &quot;\n\nLoaded Users: &quot;.join(&quot; \n&quot;, map {$_-&gt;webDotWikiName()} @{$this-&gt;{users}-&gt;getAllLoadedUsers()});</td></tr>
<tr><td class="h">3613</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$users .= &quot;\n\nALL Users: &quot;.join(&quot; \n&quot;, map {$_-&gt;webDotWikiName()} @{$this-&gt;{users}-&gt;getAllUsers()});</td></tr>
<tr><td class="h">3614</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$info .=  $users;</td></tr>
<tr><td class="h">3615</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3616</td><td colspan="6"></td></tr><tr><td class="h">3617</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $info;</td></tr>
<tr><td class="h">3618</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3619</td><td colspan="6"></td></tr><tr><td class="h">3620</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _GROUPS {</td></tr>
<tr><td class="h">3621</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-pm--subroutine.html#L3621">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params ) = @_;</td></tr>
<tr><td class="h">3622</td><td colspan="6"></td></tr><tr><td class="h">3623</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @groupNames = map {</td></tr>
<tr><td class="h">3624</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;| [[&#39;.$_-&gt;webDotWikiName().  &#39;][&#39;.$_-&gt;wikiName().&#39;]] |&#39;.</td></tr>
<tr><td class="h">3625</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;join(&#39;, &#39;, map {</td></tr>
<tr><td class="h">3626</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;[[&#39;.$_-&gt;webDotWikiName().&#39;][&#39;.$_-&gt;wikiName().&#39;]]&#39;</td></tr>
<tr><td class="h">3627</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} @{$_-&gt;groupMembers()}). &#39; |&#39;;</td></tr>
<tr><td class="h">3628</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} sort {$a-&gt;wikiName() cmp $b-&gt;wikiName()} @{$this-&gt;{users}-&gt;getAllGroups()};</td></tr>
<tr><td class="h">3629</td><td colspan="6"></td></tr><tr><td class="h">3630</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;| *Group* | *Members* |&#39;.&quot;\n&quot;.join(&quot;\n&quot;, @groupNames);</td></tr>
<tr><td class="h">3631</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3632</td><td colspan="6"></td></tr><tr><td class="h">3633</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
