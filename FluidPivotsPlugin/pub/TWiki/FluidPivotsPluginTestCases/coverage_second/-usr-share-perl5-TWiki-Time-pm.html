<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Time.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Time.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">24.3%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Module of TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2002 John Talintyre, john.talintyre@btinternet.com</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2002-2007 Peter Thoeny, peter@thoeny.org</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and TWiki Contributors. All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">20</td><td colspan="6"></td></tr><tr><td class="h">21 - 27</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TWiki::Time

Time handling functions.

=cut</pre></td></tr>
<tr><td class="h">28</td><td colspan="6"></td></tr><tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Time;</td></tr>
<tr><td class="h">30</td><td colspan="6"></td></tr><tr><td class="h">31</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L31">1</a></div></td><td><div>6</div><div>2</div><div>6</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">32</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L32">1</a></div></td><td><div>11</div><div>3</div><div>16</div></td><td class="s">use Time::Local;</td></tr>
<tr><td class="h">33</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L33">1</a></div></td><td><div>7</div><div>3</div><div>8</div></td><td class="s">use TWiki;</td></tr>
<tr><td class="h">34</td><td colspan="6"></td></tr><tr><td class="h">35</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Constants</td></tr>
<tr><td class="h">36</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L36">1</a></div></td><td><div>6</div><div>2</div><div>4</div></td><td class="s">use vars qw( @ISOMONTH @WEEKDAY @MONTHLENS %MON2NUM );</td></tr>
<tr><td class="h">37</td><td colspan="6"></td></tr><tr><td class="h">38</td><td></td><td></td><td></td><td></td><td></td><td class="s">@ISOMONTH =</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;( &#39;Jan&#39;, &#39;Feb&#39;, &#39;Mar&#39;, &#39;Apr&#39;, &#39;May&#39;, &#39;Jun&#39;,</td></tr>
<tr><td class="h">40</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&#39;Jul&#39;, &#39;Aug&#39;, &#39;Sep&#39;, &#39;Oct&#39;, &#39;Nov&#39;, &#39;Dec&#39; );</td></tr>
<tr><td class="h">41</td><td colspan="6"></td></tr><tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td class="s"># SMELL: does not account for leap years</td></tr>
<tr><td class="h">43</td><td></td><td></td><td></td><td></td><td></td><td class="s">@MONTHLENS = ( 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 );</td></tr>
<tr><td class="h">44</td><td colspan="6"></td></tr><tr><td class="h">45</td><td></td><td></td><td></td><td></td><td></td><td class="s">@WEEKDAY =</td></tr>
<tr><td class="h">46</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;( &#39;Sun&#39;, &#39;Mon&#39;, &#39;Tue&#39;, &#39;Wed&#39;, &#39;Thu&#39;, &#39;Fri&#39;, &#39;Sat&#39;, &#39;Sun&#39; );</td></tr>
<tr><td class="h">47</td><td colspan="6"></td></tr><tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td class="s">%MON2NUM =</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;(</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;jan =&gt; 0,</td></tr>
<tr><td class="h">51</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;feb =&gt; 1,</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;mar =&gt; 2,</td></tr>
<tr><td class="h">53</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;apr =&gt; 3,</td></tr>
<tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;may =&gt; 4,</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;jun =&gt; 5,</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;jul =&gt; 6,</td></tr>
<tr><td class="h">57</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;aug =&gt; 7,</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;sep =&gt; 8,</td></tr>
<tr><td class="h">59</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;oct =&gt; 9,</td></tr>
<tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;nov =&gt; 10,</td></tr>
<tr><td class="h">61</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;dec =&gt; 11</td></tr>
<tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;);</td></tr>
<tr><td class="h">63</td><td colspan="6"></td></tr><tr><td class="h">64 - 87</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod parseTime( $szDate, $defaultLocal ) -&gt; $iSecs

Convert string date/time string to seconds since epoch (1970-01-01T00:00:00Z).
   * =$sDate= - date/time string

Handles the following formats:
   * 31 Dec 2001 - 23:59
   * 2001/12/31 23:59:59
   * 2001.12.31.23.59.59
   * 2001/12/31 23:59
   * 2001.12.31.23.59
   * 2001-12-31T23:59:59
ISO dates may have a timezone specifier, either Z or a signed difference
in hh:mm format. For example:
   * 2001-12-31T23:59:59+01:00
   * 2001-12-31T23:59Z
The default timezone is Z, unless $defaultLocal is true in which case
the local timezone will be assumed.

If the date format was not recognised, will return 0.

=cut</pre></td></tr>
<tr><td class="h">88</td><td colspan="6"></td></tr><tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub parseTime {</td></tr>
<tr><td class="h">90</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L90">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $date, $defaultLocal ) = @_;</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# NOTE: This routine *will break* if input is not one of below formats!</td></tr>
<tr><td class="h">92</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tzadj = 0; # Zulu</td></tr>
<tr><td class="h">93</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L93">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($defaultLocal) {</td></tr>
<tr><td class="h">94</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Local time at midnight on the epoch gives us minus the </td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# local difference. e.g. CST is GMT + 1, so midnight Jan 1 1970 CST</td></tr>
<tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is -01:00Z</td></tr>
<tr><td class="h">97</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tzadj = -timelocal(0, 0, 0, 1, 0, 70);</td></tr>
<tr><td class="h">98</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">99</td><td colspan="6"></td></tr><tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# try &quot;31 Dec 2001 - 23:59&quot;  (TWiki date)</td></tr>
<tr><td class="h">101</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L101">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($date =~ /(\d+)\s+([a-z]{3})\s+(\d+)[-\s]+(\d+):(\d+)/i) {</td></tr>
<tr><td class="h">102</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $year = $3;</td></tr>
<tr><td class="h">103</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L103">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$year -= 1900 if( $year &gt; 1900 );</td></tr>
<tr><td class="h">104</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return timegm( 0, $5, $4, $1, $MON2NUM{lc($2)}, $year ) - $tzadj;</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">106</td><td colspan="6"></td></tr><tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# try &quot;2001/12/31 23:59:59&quot; or &quot;2001.12.31.23.59.59&quot; (RCS date)</td></tr>
<tr><td class="h">108</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L108">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($date =~ m!(\d+)[./](\d+)[./](\d+)[.\s]+(\d+)[.:](\d+)[.:](\d+)!) {</td></tr>
<tr><td class="h">109</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $year = $1;</td></tr>
<tr><td class="h">110</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L110">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$year -= 1900 if( $year &gt; 1900 );</td></tr>
<tr><td class="h">111</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return timegm( $6, $5, $4, $3, $2-1, $year ) - $tzadj;</td></tr>
<tr><td class="h">112</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">113</td><td colspan="6"></td></tr><tr><td class="h">114</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# try &quot;2001/12/31 23:59&quot; or &quot;2001.12.31.23.59&quot; (RCS short date)</td></tr>
<tr><td class="h">115</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L115">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($date =~ m!(\d+)[./](\d+)[./](\d+)[.\s]+(\d+)[.:](\d+)!) {</td></tr>
<tr><td class="h">116</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $year = $1;</td></tr>
<tr><td class="h">117</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L117">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$year -= 1900 if( $year &gt; 1900 );</td></tr>
<tr><td class="h">118</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return timegm( 0, $5, $4, $3, $2-1, $year ) - $tzadj;</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">120</td><td colspan="6"></td></tr><tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# ISO date</td></tr>
<tr><td class="h">122</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L122">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($date =~ /(\d\d\d\d)(?:-(\d\d)(?:-(\d\d))?)?(?:T(\d\d)(?::(\d\d)(?::(\d\d(?:\.\d+)?))?)?)?(Z|[-+]\d\d(?::\d\d)?)?/ ) {</td></tr>
<tr><td class="h">123</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L123">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L123">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L123">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L123">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L123">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L123">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($Y, $M, $D, $h, $m, $s, $tz) =</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($1, $2||1, $3||1, $4||0, $5||0, $6||0, $7||&#39;&#39;);</td></tr>
<tr><td class="h">125</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$M--;</td></tr>
<tr><td class="h">126</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L126">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$Y -= 1900 if( $Y &gt; 1900 );</td></tr>
<tr><td class="h">127</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L127">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L127">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($tz eq &#39;Z&#39;) {</td></tr>
<tr><td class="h">128</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tzadj = 0; # Zulu</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($tz =~ /([-+])(\d\d)(?::(\d\d))?/) {</td></tr>
<tr><td class="h">130</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L130">0</a></div><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L130">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tzadj = ($1||&#39;&#39;).((($2 * 60) + ($3||0)) * 60);</td></tr>
<tr><td class="h">131</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tzadj -= 0;</td></tr>
<tr><td class="h">132</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">133</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return timegm( $s, $m, $h, $D, $M, $Y ) - $tzadj;</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">135</td><td colspan="6"></td></tr><tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# give up, return start of epoch (01 Jan 1970 GMT)</td></tr>
<tr><td class="h">137</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">138</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">139</td><td colspan="6"></td></tr><tr><td class="h">140 - 164</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod formatTime ($epochSeconds, $formatString, $outputTimeZone) -&gt; $value

   * =$epochSeconds= epochSecs GMT
   * =$formatString= twiki time date format, default =$day $month $year - $hour:$min=
   * =$outputTimeZone= timezone to display, =gmtime= or =servertime=, default is whatever is set in $TWiki::cfg{DisplayTimeValues}
=$formatString= supports:
   | $seconds | secs |
   | $minutes | mins |
   | $hours | hours |
   | $day | date |
   | $wday | weekday name |
   | $dow | day number (0 = Sunday) |
   | $week | week number |
   | $month | month name |
   | $mo | month number |
   | $year | 4-digit year |
   | $ye | 2-digit year |
   | $http | ful HTTP header format date/time |
   | $email | full email format date/time |
   | $rcs | full RCS format date/time |
   | $epoch | seconds since 1st January 1970 |

=cut</pre></td></tr>
<tr><td class="h">165</td><td colspan="6"></td></tr><tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td class="s"># previous known as TWiki::formatTime</td></tr>
<tr><td class="h">167</td><td colspan="6"></td></tr><tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub formatTime  {</td></tr>
<tr><td class="h">169</td><td><div class="c3">10</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L169">10</a></div></td><td><div>45</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($epochSeconds, $formatString, $outputTimeZone) = @_;</td></tr>
<tr><td class="h">170</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $value = $epochSeconds;</td></tr>
<tr><td class="h">171</td><td colspan="6"></td></tr><tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# use default TWiki format &quot;31 Dec 1999 - 23:59&quot; unless specified</td></tr>
<tr><td class="h">173</td><td><div class="c3">10</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L173">100</a></div></td><td></td><td><div>53</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$formatString ||= &#39;$day $month $year - $hour:$min&#39;;</td></tr>
<tr><td class="h">174</td><td><div class="c3">10</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Time-pm--condition.html#L174">100</a></div></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$outputTimeZone ||= $TWiki::cfg{DisplayTimeValues};</td></tr>
<tr><td class="h">175</td><td colspan="6"></td></tr><tr><td class="h">176</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $sec, $min, $hour, $day, $mon, $year, $wday);</td></tr>
<tr><td class="h">177</td><td><div class="c3">10</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L177">100</a></div></td><td></td><td></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $outputTimeZone eq &#39;servertime&#39; ) {</td></tr>
<tr><td class="h">178</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $sec, $min, $hour, $day, $mon, $year, $wday ) =</td></tr>
<tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localtime( $epochSeconds );</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">181</td><td><div class="c3">8</div></td><td></td><td></td><td></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $sec, $min, $hour, $day, $mon, $year, $wday ) =</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gmtime( $epochSeconds );</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">184</td><td colspan="6"></td></tr><tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#standard twiki date time formats</td></tr>
<tr><td class="h">186</td><td><div class="c3">10</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L186">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L186">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L186">50</a></div></td><td></td><td></td><td><div>106</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $formatString =~ /rcs/i ) {</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# RCS format, example: &quot;2001/12/31 23:59:59&quot;</td></tr>
<tr><td class="h">188</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formatString = &#39;$year/$mo/$day $hour:$min:$sec&#39;;</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $formatString =~ /http|email/i ) {</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# HTTP header format, e.g. &quot;Thu, 23 Jul 1998 07:21:56 EST&quot;</td></tr>
<tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# - based on RFC 2616/1123 and HTTP::Date; also used</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# by TWiki::Net for Date header in emails.</td></tr>
<tr><td class="h">193</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formatString = &#39;$wday, $day $month $year $hour:$min:$sec $tz&#39;;</td></tr>
<tr><td class="h">194</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $formatString =~ /iso/i ) {</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ISO Format, see spec at http://www.w3.org/TR/NOTE-datetime</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# e.g. &quot;2002-12-31T19:30:12Z&quot;</td></tr>
<tr><td class="h">197</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formatString = &#39;$year-$mo-$dayT$hour:$min:$sec&#39;;</td></tr>
<tr><td class="h">198</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L198">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $outputTimeZone eq &#39;gmtime&#39; ) {</td></tr>
<tr><td class="h">199</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formatString = $formatString.&#39;Z&#39;;</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#TODO:            $formatString = $formatString.  # TZD  = time zone designator (Z or +hh:mm or -hh:mm) </td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">204</td><td colspan="6"></td></tr><tr><td class="h">205</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value = $formatString;</td></tr>
<tr><td class="h">206</td><td><div class="c3">10</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>35</div><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$seco?n?d?s?/sprintf(&#39;%.2u&#39;,$sec)/gei;</td></tr>
<tr><td class="h">207</td><td><div class="c3">10</div><div class="c3">3</div></td><td></td><td></td><td></td><td><div>35</div><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$minu?t?e?s?/sprintf(&#39;%.2u&#39;,$min)/gei;</td></tr>
<tr><td class="h">208</td><td><div class="c3">10</div><div class="c3">3</div></td><td></td><td></td><td></td><td><div>38</div><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$hour?s?/sprintf(&#39;%.2u&#39;,$hour)/gei;</td></tr>
<tr><td class="h">209</td><td><div class="c3">10</div><div class="c3">3</div></td><td></td><td></td><td></td><td><div>34</div><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$day/sprintf(&#39;%.2u&#39;,$day)/gei;</td></tr>
<tr><td class="h">210</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$wday/$WEEKDAY[$wday]/gi;</td></tr>
<tr><td class="h">211</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$dow/$wday/gi;</td></tr>
<tr><td class="h">212</td><td><div class="c3">10</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>30</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$week/_weekNumber($day,$mon,$year,$wday)/egi;</td></tr>
<tr><td class="h">213</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$mont?h?/$ISOMONTH[$mon]/gi;</td></tr>
<tr><td class="h">214</td><td><div class="c3">10</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>32</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$mo/sprintf(&#39;%.2u&#39;,$mon+1)/gei;</td></tr>
<tr><td class="h">215</td><td><div class="c3">10</div><div class="c3">5</div></td><td></td><td></td><td></td><td><div>35</div><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$year?/sprintf(&#39;%.4u&#39;,$year+1900)/gei;</td></tr>
<tr><td class="h">216</td><td><div class="c3">10</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>31</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$ye/sprintf(&#39;%.2u&#39;,$year%100)/gei;</td></tr>
<tr><td class="h">217</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$epoch/$epochSeconds/gi;</td></tr>
<tr><td class="h">218</td><td colspan="6"></td></tr><tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: how do we get the different timezone strings (and when</td></tr>
<tr><td class="h">220</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we add usertime, then what?)</td></tr>
<tr><td class="h">221</td><td><div class="c3">10</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L221">100</a></div></td><td></td><td></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tz_str = ( $outputTimeZone eq &#39;servertime&#39; ) ? &#39;Local&#39; : &#39;GMT&#39;;</td></tr>
<tr><td class="h">222</td><td><div class="c3">10</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>28</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$tz/$tz_str/geoi;</td></tr>
<tr><td class="h">223</td><td colspan="6"></td></tr><tr><td class="h">224</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td><div>48</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $value;</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">226</td><td colspan="6"></td></tr><tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _weekNumber {</td></tr>
<tr><td class="h">228</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L228">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $day, $mon, $year, $wday ) = @_;</td></tr>
<tr><td class="h">229</td><td colspan="6"></td></tr><tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# calculate the calendar week (ISO 8601)</td></tr>
<tr><td class="h">231</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $nextThursday = timegm(0, 0, 0, $day, $mon, $year) +</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3 - ($wday + 6) % 7) * 24 * 60 * 60; # nearest thursday</td></tr>
<tr><td class="h">233</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $firstFourth = timegm(0, 0, 0, 4, 0, $year); # january, 4th</td></tr>
<tr><td class="h">234</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return sprintf(&#39;%.0f&#39;, ($nextThursday - $firstFourth) / ( 7 * 86400 )) + 1;</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">236</td><td colspan="6"></td></tr><tr><td class="h">237 - 244</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod formatDelta( $s ) -&gt; $string

Format a time in seconds as a string. For example,
&quot;1 day, 3 hours, 2 minutes, 6 seconds&quot;

=cut</pre></td></tr>
<tr><td class="h">245</td><td colspan="6"></td></tr><tr><td class="h">246</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub formatDelta {</td></tr>
<tr><td class="h">247</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L247">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $secs = shift;</td></tr>
<tr><td class="h">248</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $language = shift;</td></tr>
<tr><td class="h">249</td><td colspan="6"></td></tr><tr><td class="h">250</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rem = $secs % (60 * 60 * 24);</td></tr>
<tr><td class="h">251</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $days = ($secs - $rem) / (60 * 60 * 24);</td></tr>
<tr><td class="h">252</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$secs = $rem;</td></tr>
<tr><td class="h">253</td><td colspan="6"></td></tr><tr><td class="h">254</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$rem = $secs % (60 * 60);</td></tr>
<tr><td class="h">255</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $hours = ($secs - $rem) / (60 * 60);</td></tr>
<tr><td class="h">256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$secs = $rem;</td></tr>
<tr><td class="h">257</td><td colspan="6"></td></tr><tr><td class="h">258</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$rem = $secs % 60;</td></tr>
<tr><td class="h">259</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $mins = ($secs - $rem) / 60;</td></tr>
<tr><td class="h">260</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$secs = $rem;</td></tr>
<tr><td class="h">261</td><td colspan="6"></td></tr><tr><td class="h">262</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $str = &#39;&#39;;</td></tr>
<tr><td class="h">263</td><td colspan="6"></td></tr><tr><td class="h">264</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L264">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($language) {</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#format as in user&#39;s language</td></tr>
<tr><td class="h">266</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L266">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $days ) {</td></tr>
<tr><td class="h">267</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $language-&gt;maketext(&#39;[*,_1,day] &#39;, $days);</td></tr>
<tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">269</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L269">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $hours ) {</td></tr>
<tr><td class="h">270</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $language-&gt;maketext(&#39;[*,_1,hour] &#39;, $hours);</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">272</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L272">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $mins ) {</td></tr>
<tr><td class="h">273</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $language-&gt;maketext(&#39;[*,_1,minute] &#39;, $mins);</td></tr>
<tr><td class="h">274</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">275</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L275">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $secs ) {</td></tr>
<tr><td class="h">276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $language-&gt;maketext(&#39;[*,_1,second] &#39;, $secs);</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">279</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#original code, harcoded English (BAD)</td></tr>
<tr><td class="h">280</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L280">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $days ) {</td></tr>
<tr><td class="h">281</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L281">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $days . &#39; day&#39; .( $days &gt; 1 ? &#39;s &#39; : &#39; &#39; );</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">283</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L283">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $hours ) {</td></tr>
<tr><td class="h">284</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L284">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $hours . &#39; hour&#39; .( $hours &gt; 1 ? &#39;s &#39; : &#39; &#39; );</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">286</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L286">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $mins ) {</td></tr>
<tr><td class="h">287</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L287">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $mins . &#39; minute&#39; .( $mins &gt; 1 ? &#39;s &#39; : &#39; &#39; );</td></tr>
<tr><td class="h">288</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">289</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L289">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $secs ) {</td></tr>
<tr><td class="h">290</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L290">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$str .= $secs . &#39; second&#39; .( $secs &gt; 1 ? &#39;s &#39; : &#39; &#39; );</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s/\s+$//;</td></tr>
<tr><td class="h">294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $str;</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">296</td><td colspan="6"></td></tr><tr><td class="h">297 - 340</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod parseInterval( $szInterval ) -&gt; [$iSecs, $iSecs]

Convert string representing a time interval to a pair of integers
representing the amount of seconds since epoch for the start and end
extremes of the time interval.

   * =$szInterval= - time interval string

in yacc syntax, grammar and actions:
&lt;verbatim&gt;
interval ::= date                 { $$.start = fillStart($1); $$.end = fillEnd($1); }
         | date &#39;/&#39; date          { $$.start = fillStart($1); $$.end = fillEnd($3); }
         | &#39;P&#39; duration &#39;/&#39; date  { $$.start = fillEnd($4)-$2; $$.end = fillEnd($4); }
         | date &#39;/&#39; &#39;P&#39; duration  { $$.start = fillStart($1); $$.end = fillStart($1)+$4; }
         ;
&lt;/verbatim&gt;
an =interval= may be followed by a timezone specification string (this is not supported yet).

=duration= has the form (regular expression):
&lt;verbatim&gt;
   P(&lt;number&gt;&lt;nameOfDuration&gt;)+
&lt;/verbatim&gt;

nameOfDuration may be one of:
   * y(year), m(month), w(week), d(day), h(hour), M(minute), S(second)

=date= follows ISO8601 and must include hypens.  (any amount of trailing
       elements may be omitted and will be filled in differently on the
       differents ends of the interval as to include the longest possible
       interval):

   * 2001-01-01T00:00:00
   * 2001-12-31T23:59:59

timezone is optional. Default is local time.

If the format is not recognised, will return empty interval [0,0].

TODO: timezone
      testing, especially on non valid strings

=cut</pre></td></tr>
<tr><td class="h">341</td><td colspan="6"></td></tr><tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub parseInterval{</td></tr>
<tr><td class="h">343</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Time-pm--subroutine.html#L343">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($theInterval) = @_;</td></tr>
<tr><td class="h">344</td><td colspan="6"></td></tr><tr><td class="h">345</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @lt = localtime();</td></tr>
<tr><td class="h">346</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $today = sprintf(&#39;%04d-%02d-%02d&#39;,$lt[5]+1900, $lt[4]+1, $lt[3]);</td></tr>
<tr><td class="h">347</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $now = $today . sprintf(&#39;T%02d:%02d:%02d&#39;,$lt[2], $lt[1], $lt[0]);</td></tr>
<tr><td class="h">348</td><td colspan="6"></td></tr><tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# replace $now and $today shortcuts</td></tr>
<tr><td class="h">350</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theInterval =~ s/\$today/$today/g;</td></tr>
<tr><td class="h">351</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theInterval =~ s/\$now/$now/g;</td></tr>
<tr><td class="h">352</td><td colspan="6"></td></tr><tr><td class="h">353</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if $theDate does not contain a &#39;/&#39;: force it to do so.</td></tr>
<tr><td class="h">354</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L354">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theInterval = $theInterval.&#39;/&#39;.$theInterval unless ($theInterval =~ /\// );</td></tr>
<tr><td class="h">355</td><td colspan="6"></td></tr><tr><td class="h">356</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @ends = split(/\//, $theInterval);</td></tr>
<tr><td class="h">357</td><td colspan="6"></td></tr><tr><td class="h">358</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# first translate dates into seconds from epoch,</td></tr>
<tr><td class="h">359</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# in the second loop we will examine interval durations.</td></tr>
<tr><td class="h">360</td><td colspan="6"></td></tr><tr><td class="h">361</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $i (0,1) {</td></tr>
<tr><td class="h">362</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   if not a period of time:</td></tr>
<tr><td class="h">363</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L363">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if ($ends[$i] =~ /^P/);</td></tr>
<tr><td class="h">364</td><td colspan="6"></td></tr><tr><td class="h">365</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   TODO assert(must include the year)</td></tr>
<tr><td class="h">366</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L366">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($i) {</td></tr>
<tr><td class="h">367</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fillEnd</td></tr>
<tr><td class="h">368</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#     if ending point, complete with parts from &quot;-12-31T23:59:60&quot;</td></tr>
<tr><td class="h">369</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#     if completing ending point, check last day of month</td></tr>
<tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# TODO: do we do leap years?</td></tr>
<tr><td class="h">371</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L371">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (length($ends[$i]) == 7){</td></tr>
<tr><td class="h">372</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $month = substr($ends[$i],5);</td></tr>
<tr><td class="h">373</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] .= $MONTHLENS[$month-1];</td></tr>
<tr><td class="h">374</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">375</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] .= substr(&quot;0000-12-31T23:59:59&quot;,length($ends[$i]));</td></tr>
<tr><td class="h">376</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# fillStart</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#     if starting point, complete with parts from &quot;-01-01T00:00:00&quot;</td></tr>
<tr><td class="h">379</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] .= substr(&quot;0000-01-01T00:00:00&quot;,length($ends[$i]));</td></tr>
<tr><td class="h">380</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">381</td><td colspan="6"></td></tr><tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#     convert the string into integer amount of seconds</td></tr>
<tr><td class="h">383</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#     from 1970-01-01T00:00:00.00 UTC</td></tr>
<tr><td class="h">384</td><td colspan="6"></td></tr><tr><td class="h">385</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] = parseTime($ends[$i], 1);</td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">387</td><td colspan="6"></td></tr><tr><td class="h">388</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# now we&#39;re ready to translate interval durations...</td></tr>
<tr><td class="h">389</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# ... we don&#39;t do P&lt;whatever/P&lt;whatever&gt; !!!</td></tr>
<tr><td class="h">390</td><td colspan="6"></td></tr><tr><td class="h">391</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @oper = (&quot;-&quot;,&quot;+&quot;);</td></tr>
<tr><td class="h">392</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if any extreme was a time duration, examine it</td></tr>
<tr><td class="h">393</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $i (0,1) {</td></tr>
<tr><td class="h">394</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Time-pm--branch.html#L394">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless ($ends[$i] =~ /^P/);</td></tr>
<tr><td class="h">395</td><td colspan="6"></td></tr><tr><td class="h">396</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   drop the &#39;P&#39;, substitute each letter with &#39;*&lt;value&gt;+&#39;,</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   where &lt;value&gt; is the amount of seconds represented by</td></tr>
<tr><td class="h">398</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   the unit.  for example: w (week) becomes &#39;*604800+&#39;.</td></tr>
<tr><td class="h">399</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/^P//;</td></tr>
<tr><td class="h">400</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/y/\*31556925\+/gi; # tropical year</td></tr>
<tr><td class="h">401</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/m/\*2592000\+/g;   # 1m = 30 days</td></tr>
<tr><td class="h">402</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/w/\*604800\+/gi;   # 1w = 7 days</td></tr>
<tr><td class="h">403</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/d/\*86400\+/gi;</td></tr>
<tr><td class="h">404</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/h/\*3600\+/gi;</td></tr>
<tr><td class="h">405</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/M/\*60\+/g;        # note: m != M</td></tr>
<tr><td class="h">406</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/S/\*1\+/gi;</td></tr>
<tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   possibly append &#39;0&#39; and evaluate numerically the string.  </td></tr>
<tr><td class="h">408</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] =~ s/\+$/+0/;</td></tr>
<tr><td class="h">409</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $duration = eval($ends[$i]);</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   the value computed, if it specifies the starting point</td></tr>
<tr><td class="h">411</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   in time, must be subtracted from the previously</td></tr>
<tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   computed ending point.  if it specifies the ending</td></tr>
<tr><td class="h">413</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   point, it must be added to the previously computed</td></tr>
<tr><td class="h">414</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   starting point.</td></tr>
<tr><td class="h">415</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ends[$i] = eval($ends[1-$i].$oper[$i].$ends[$i]);</td></tr>
<tr><td class="h">416</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: if the user specified both start and end as a</td></tr>
<tr><td class="h">417</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# time duration, some kind of error must be reported.</td></tr>
<tr><td class="h">418</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">419</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @ends;</td></tr>
<tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">421</td><td colspan="6"></td></tr><tr><td class="h">422</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
