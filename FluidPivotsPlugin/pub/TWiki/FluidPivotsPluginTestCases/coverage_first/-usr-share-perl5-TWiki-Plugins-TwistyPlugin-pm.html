<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Plugins/TwistyPlugin.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Plugins/TwistyPlugin.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">16.6%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Plugin for TWiki Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2005 Rafael Alvarez, soronthar@sourceforge.net</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version.</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s"># GNU General Public License for more details, published at </td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s"># http://www.gnu.org/copyleft/gpl.html</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">16</td><td colspan="6"></td></tr><tr><td class="h">17 - 26</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TwistyPlugin

Convenience plugin for TWiki:Plugins.TwistyContrib.
It has two major features:
   * When active, the Twisty javascript library is included in every topic.
   * Provides a convenience syntax to define twisty areas.

=cut</pre></td></tr>
<tr><td class="h">27</td><td colspan="6"></td></tr><tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Plugins::TwistyPlugin;</td></tr>
<tr><td class="h">29</td><td colspan="6"></td></tr><tr><td class="h">30</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L30">1</a></div></td><td><div>5</div><div>3</div><div>6</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">31</td><td colspan="6"></td></tr><tr><td class="h">32</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">use vars qw( $VERSION $RELEASE $pluginName $debug @modes $doneHeader $twistyCount</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td class="s">$prefMode $prefShowLink $prefHideLink $prefRemember</td></tr>
<tr><td class="h">34</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L34">1</a></div></td><td><div>7</div><div>3</div></td><td class="s">$defaultMode $defaultShowLink $defaultHideLink $defaultRemember $needPostRenderingHandler );</td></tr>
<tr><td class="h">35</td><td colspan="6"></td></tr><tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This should always be $Rev: 12154$ so that TWiki can determine the checked-in</td></tr>
<tr><td class="h">37</td><td></td><td></td><td></td><td></td><td></td><td class="s"># status of the plugin. It is used by the build automation tools, so</td></tr>
<tr><td class="h">38</td><td></td><td></td><td></td><td></td><td></td><td class="s"># you should leave it alone.</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td class="s">$VERSION = &#39;$Rev: 12154$&#39;;</td></tr>
<tr><td class="h">40</td><td colspan="6"></td></tr><tr><td class="h">41</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This is a free-form string you can use to &quot;name&quot; your own plugin version.</td></tr>
<tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td class="s"># It is *not* used by the build automation tools, but is reported as part</td></tr>
<tr><td class="h">43</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the version number in PLUGINDESCRIPTIONS.</td></tr>
<tr><td class="h">44</td><td></td><td></td><td></td><td></td><td></td><td class="s">$RELEASE = &#39;1.2.0&#39;;</td></tr>
<tr><td class="h">45</td><td colspan="6"></td></tr><tr><td class="h">46</td><td></td><td></td><td></td><td></td><td></td><td class="s">$pluginName = &#39;TwistyPlugin&#39;;</td></tr>
<tr><td class="h">47</td><td colspan="6"></td></tr><tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td class="s">#there is no need to document this.</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub initPlugin {</td></tr>
<tr><td class="h">50</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L50">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $topic, $web, $user, $installWeb ) = @_;</td></tr>
<tr><td class="h">51</td><td colspan="6"></td></tr><tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# check for Plugins.pm versions</td></tr>
<tr><td class="h">53</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L53">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::Plugins::VERSION &lt; 1.1 ) {</td></tr>
<tr><td class="h">54</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::writeWarning( &quot;Version mismatch between $pluginName and Plugins.pm&quot; );</td></tr>
<tr><td class="h">55</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">57</td><td colspan="6"></td></tr><tr><td class="h">58</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_setDefaults();</td></tr>
<tr><td class="h">59</td><td colspan="6"></td></tr><tr><td class="h">60</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$debug = TWiki::Func::getPluginPreferencesFlag( &quot;DEBUG&quot; );</td></tr>
<tr><td class="h">61</td><td colspan="6"></td></tr><tr><td class="h">62</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$doneHeader = 0;</td></tr>
<tr><td class="h">63</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$twistyCount = 0;</td></tr>
<tr><td class="h">64</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$needPostRenderingHandler = 0;</td></tr>
<tr><td class="h">65</td><td colspan="6"></td></tr><tr><td class="h">66</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L66">25</a></div></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefMode = TWiki::Func::getPreferencesValue( &#39;TWISTYMODE&#39; ) || TWiki::Func::getPluginPreferencesValue( &#39;TWISTYMODE&#39; ) || $defaultMode;</td></tr>
<tr><td class="h">67</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L67">25</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefShowLink = TWiki::Func::getPreferencesValue( &#39;TWISTYSHOWLINK&#39; ) || TWiki::Func::getPluginPreferencesValue( &#39;TWISTYSHOWLINK&#39; ) || $defaultShowLink;</td></tr>
<tr><td class="h">68</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L68">25</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefHideLink = TWiki::Func::getPreferencesValue( &#39;TWISTYHIDELINK&#39; ) || TWiki::Func::getPluginPreferencesValue( &#39;TWISTYHIDELINK&#39; ) || $defaultHideLink;</td></tr>
<tr><td class="h">69</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L69">25</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$prefRemember = TWiki::Func::getPreferencesValue( &#39;TWISTYREMEMBER&#39; ) || TWiki::Func::getPluginPreferencesValue( &#39;TWISTYREMEMBER&#39; ) || $defaultRemember;</td></tr>
<tr><td class="h">70</td><td colspan="6"></td></tr><tr><td class="h">71</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;TWISTYSHOW&#39;,\&amp;_TWISTYSHOW);</td></tr>
<tr><td class="h">72</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;TWISTYHIDE&#39;,\&amp;_TWISTYHIDE);</td></tr>
<tr><td class="h">73</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;TWISTYBUTTON&#39;,\&amp;_TWISTYBUTTON);</td></tr>
<tr><td class="h">74</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;TWISTY&#39;,\&amp;_TWISTY);</td></tr>
<tr><td class="h">75</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;ENDTWISTY&#39;,\&amp;_ENDTWISTYTOGGLE);</td></tr>
<tr><td class="h">76</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;TWISTYTOGGLE&#39;,\&amp;_TWISTYTOGGLE);</td></tr>
<tr><td class="h">77</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::Func::registerTagHandler(&#39;ENDTWISTYTOGGLE&#39;,\&amp;_ENDTWISTYTOGGLE);</td></tr>
<tr><td class="h">78</td><td colspan="6"></td></tr><tr><td class="h">79</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">81</td><td colspan="6"></td></tr><tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _setDefaults {</td></tr>
<tr><td class="h">83</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L83">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultMode = &#39;span&#39;;</td></tr>
<tr><td class="h">84</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultShowLink = &#39;&#39;;</td></tr>
<tr><td class="h">85</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultHideLink = &#39;&#39;;</td></tr>
<tr><td class="h">86</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultRemember = &#39;&#39;; # do not default to &#39;off&#39; or all cookies will be cleared!</td></tr>
<tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">88</td><td colspan="6"></td></tr><tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _addHeader {</td></tr>
<tr><td class="h">90</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L90">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L90">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $doneHeader;</td></tr>
<tr><td class="h">91</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$doneHeader = 1;</td></tr>
<tr><td class="h">92</td><td colspan="6"></td></tr><tr><td class="h">93</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $header=&lt;&lt;&#39;EOF&#39;; </td></tr>
<tr><td class="h">94</td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;</td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td class="s">@import url(&quot;%PUBURL%/%TWIKIWEB%/TwistyContrib/twist.css&quot;);</td></tr>
<tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;/style&gt;</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&quot;text/javascript&quot; src=&quot;%PUBURL%/%TWIKIWEB%/TWikiJavascripts/twiki.js&quot;&gt;&lt;/script&gt;</td></tr>
<tr><td class="h">98</td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&quot;text/javascript&quot; src=&quot;%PUBURL%/%TWIKIWEB%/BehaviourContrib/behaviour.compressed.js&quot;&gt;&lt;/script&gt;</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&quot;text/javascript&quot; src=&quot;%PUBURL%/%TWIKIWEB%/TwistyContrib/twist.compressed.js&quot;&gt;&lt;/script&gt;</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td class="s">EOF</td></tr>
<tr><td class="h">101</td><td colspan="6"></td></tr><tr><td class="h">102</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;TWiki::Func::addToHEAD(&#39;TWISTYPLUGIN_TWISTY&#39;,$header)</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">104</td><td colspan="6"></td></tr><tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TWISTYSHOW {</td></tr>
<tr><td class="h">106</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L106">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _twistyWrapInSpan(_twistyBtn(@_, &#39;show&#39;));</td></tr>
<tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">108</td><td colspan="6"></td></tr><tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TWISTYHIDE {</td></tr>
<tr><td class="h">110</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L110">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _twistyWrapInSpan(_twistyBtn(@_, &#39;hide&#39;));</td></tr>
<tr><td class="h">111</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">112</td><td colspan="6"></td></tr><tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TWISTYBUTTON {</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L114">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _twistyWrapInSpan(</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_twistyBtn(@_, &#39;show&#39;) . </td></tr>
<tr><td class="h">116</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_twistyBtn(@_, &#39;hide&#39;));</td></tr>
<tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">118</td><td colspan="6"></td></tr><tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TWISTY {</td></tr>
<tr><td class="h">120</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L120">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my($session, $params, $theTopic, $theWeb) = @_;</td></tr>
<tr><td class="h">121</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_addHeader();</td></tr>
<tr><td class="h">122</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twistyCount++;</td></tr>
<tr><td class="h">123</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $id = $params-&gt;{&#39;id&#39;};</td></tr>
<tr><td class="h">124</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L124">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L124">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $id || $id eq &#39;&#39;) {</td></tr>
<tr><td class="h">125</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params-&gt;{&#39;id&#39;} = &#39;twistyId&#39;.$theWeb.$theTopic.$twistyCount;</td></tr>
<tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">127</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L127">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $prefix = $params-&gt;{&#39;prefix&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">128</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L128">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $suffix = $params-&gt;{&#39;suffix&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">129</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $prefix . _TWISTYBUTTON(@_) . $suffix . _TWISTYTOGGLE(@_);</td></tr>
<tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">131</td><td colspan="6"></td></tr><tr><td class="h">132</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _TWISTYTOGGLE {</td></tr>
<tr><td class="h">133</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L133">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my($session, $params, $theTopic, $theWeb) = @_;</td></tr>
<tr><td class="h">134</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $id = $params-&gt;{&#39;id&#39;};</td></tr>
<tr><td class="h">135</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L135">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L135">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $id || $id eq &#39;&#39;) {</td></tr>
<tr><td class="h">136</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">137</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">138</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $idTag = $id.&#39;toggle&#39;;</td></tr>
<tr><td class="h">139</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L139">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $mode = $params-&gt;{&#39;mode&#39;} || $prefMode;</td></tr>
<tr><td class="h">140</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unshift @modes,$mode;</td></tr>
<tr><td class="h">141</td><td colspan="6"></td></tr><tr><td class="h">142</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $isTrigger = 0;</td></tr>
<tr><td class="h">143</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @propList = _createHtmlProperties($idTag, $params, $isTrigger);</td></tr>
<tr><td class="h">144</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L144">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $props = @propList ? &quot; &quot;.join(&quot; &quot;,@propList) : &#39;&#39;;</td></tr>
<tr><td class="h">145</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $modeTag = &#39;&lt;&#39;.$mode.$props.&#39;&gt;&#39;;</td></tr>
<tr><td class="h">146</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$modeTag .= _createJavascriptTriggerCall($idTag);</td></tr>
<tr><td class="h">147</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _twistyOpenDiv().$modeTag;</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">149</td><td colspan="6"></td></tr><tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _ENDTWISTYTOGGLE {</td></tr>
<tr><td class="h">151</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L151">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my($session, $params, $theTopic, $theWeb) = @_;</td></tr>
<tr><td class="h">152</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $mode = shift @modes;</td></tr>
<tr><td class="h">153</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L153">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $modeTag = ($mode ne &#39;&#39;) ? &#39;&lt;/&#39;.$mode.&#39;&gt;&#39; : &#39;&#39;;</td></tr>
<tr><td class="h">154</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $modeTag._twistyCloseDiv();</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">156</td><td colspan="6"></td></tr><tr><td class="h">157 - 162</td><td colspan="5"></td><td class="s"><pre>=pod

Removes _TWISTYSCRIPT tags written in the topic text, so users cannot use this
construct to write Javascript even if {AllowInlineScript} has been set to false.

=cut</pre></td></tr>
<tr><td class="h">163</td><td colspan="6"></td></tr><tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub beforeCommonTagsHandler {</td></tr>
<tr><td class="h">165</td><td colspan="6"></td></tr><tr><td class="h">166</td><td><div class="c3">16</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L166">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L166">16</a></div></td><td><div>77</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $needPostRenderingHandler; # don&#39;t remove _TWISTYSCRIPT too early</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# see Item3159</td></tr>
<tr><td class="h">168</td><td colspan="6"></td></tr><tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do not uncomment, use $_[0], $_[1]... instead</td></tr>
<tr><td class="h">170</td><td><div class="c3">16</div></td><td></td><td></td><td></td><td><div>126</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$_[0] =~ s/\%_TWISTYSCRIPT{\&quot;(.*?)\&quot;}\%/$1/g;</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">172</td><td colspan="6"></td></tr><tr><td class="h">173 - 177</td><td colspan="5"></td><td class="s"><pre>=pod

Convert the semi-variable tag to JavaScript.

=cut</pre></td></tr>
<tr><td class="h">178</td><td colspan="6"></td></tr><tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub postRenderingHandler {</td></tr>
<tr><td class="h">180</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do not uncomment, use $_[0], $_[1]... instead</td></tr>
<tr><td class="h">181</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L181">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L181">3</a></div></td><td><div>122</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($_[0] =~ s/\%_TWISTYSCRIPT{\&quot;(.*?)\&quot;}\%/&lt;script type=&quot;text\/javascript\&quot;\&gt;$1&lt;\/script&gt;/g) {</td></tr>
<tr><td class="h">182</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$needPostRenderingHandler = 0;</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">185</td><td colspan="6"></td></tr><tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyBtn {</td></tr>
<tr><td class="h">187</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L187">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my($session, $params, $theTopic, $theWeb, $theState) = @_;</td></tr>
<tr><td class="h">188</td><td colspan="6"></td></tr><tr><td class="h">189</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_addHeader();</td></tr>
<tr><td class="h">190</td><td colspan="6"></td></tr><tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# not used yet:</td></tr>
<tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#my $triangle_right = &#39;&amp;#9658;&#39;;</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#my $triangle_down = &#39;&amp;#9660;&#39;;</td></tr>
<tr><td class="h">194</td><td colspan="6"></td></tr><tr><td class="h">195</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $id = $params-&gt;{&#39;id&#39;};</td></tr>
<tr><td class="h">196</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L196">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L196">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $id || $id eq &#39;&#39;) {</td></tr>
<tr><td class="h">197</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">199</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L199">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L199">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $idTag = $id.$theState if ( $theState) || &#39;&#39;;</td></tr>
<tr><td class="h">200</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L200">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $defaultLink = ( $theState eq &#39;show&#39; ) ? $prefShowLink : $prefHideLink;</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# link=&quot;&quot; takes precedence over showlink=&quot;&quot; and hidelink=&quot;&quot;</td></tr>
<tr><td class="h">202</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $link = $params-&gt;{&#39;link&#39;};</td></tr>
<tr><td class="h">203</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L203">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $link) {</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if &#39;link&#39; is not set, try &#39;showlink&#39; / &#39;hidelink&#39;</td></tr>
<tr><td class="h">205</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$link = $params-&gt;{$theState.&#39;link&#39;};</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">207</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L207">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!defined $link) {</td></tr>
<tr><td class="h">208</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L208">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$link = $defaultLink || &#39;&#39;;</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">210</td><td colspan="6"></td></tr><tr><td class="h">211</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L211">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $img = $params-&gt;{$theState.&#39;img&#39;} || $params-&gt;{&#39;img&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">212</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L212">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $imgright = $params-&gt;{$theState.&#39;imgright&#39;} || $params-&gt;{&#39;imgright&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">213</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L213">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $imgleft = $params-&gt;{$theState.&#39;imgleft&#39;} || $params-&gt;{&#39;imgleft&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">214</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$img =~ s/[&#39;\&quot;]//go;</td></tr>
<tr><td class="h">215</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$imgright =~ s/[&#39;\&quot;]//go;</td></tr>
<tr><td class="h">216</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$imgleft =~ s/[&#39;\&quot;]//go;</td></tr>
<tr><td class="h">217</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L217">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $imgTag = ($img ne &#39;&#39;) ? &#39;&lt;img src=&quot;&#39;.$img.&#39;&quot; border=&quot;0&quot; alt=&quot;&quot; /&gt;&#39; : &#39;&#39;;</td></tr>
<tr><td class="h">218</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L218">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $imgRightTag = ($imgright ne &#39;&#39;) ? &#39;&lt;img src=&quot;&#39;.$imgright.&#39;&quot; border=&quot;0&quot; alt=&quot;&quot; /&gt;&#39; : &#39;&#39;;</td></tr>
<tr><td class="h">219</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L219">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $imgLeftTag = ($imgleft ne &#39;&#39;) ? &#39;&lt;img src=&quot;&#39;.$imgleft.&#39;&quot; border=&quot;0&quot; alt=&quot;&quot; /&gt;&#39; : &#39;&#39;;        </td></tr>
<tr><td class="h">220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $imgLinkTag = &#39;&lt;a href=&quot;#&quot;&gt;&#39;.$imgLeftTag.&#39;&lt;span class=&quot;twikiLinkLabel&quot;&gt;&#39;.$link.&#39;&lt;/span&gt;&#39;.$imgTag.$imgRightTag.&#39;&lt;/a&gt;&#39;;</td></tr>
<tr><td class="h">221</td><td colspan="6"></td></tr><tr><td class="h">222</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $isTrigger = 1;</td></tr>
<tr><td class="h">223</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $props = &#39;&#39;;</td></tr>
<tr><td class="h">224</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L224">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L224">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($idTag &amp;&amp; $params) {</td></tr>
<tr><td class="h">225</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @propList = _createHtmlProperties($idTag, $params, $isTrigger);</td></tr>
<tr><td class="h">226</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L226">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$props = @propList ? &quot; &quot;.join(&quot; &quot;,@propList) : &#39;&#39;;</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">228</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $triggerTag = &#39;&lt;span&#39;.$props.&#39;&gt;&#39;.$imgLinkTag.&#39;&lt;/span&gt;&#39;;</td></tr>
<tr><td class="h">229</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$triggerTag .= _createJavascriptTriggerCall($idTag);</td></tr>
<tr><td class="h">230</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $triggerTag;</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">232</td><td colspan="6"></td></tr><tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _createHtmlProperties {</td></tr>
<tr><td class="h">234</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L234">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my($idTag, $params, $isTrigger) = @_;</td></tr>
<tr><td class="h">235</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L235">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $class = $params-&gt;{&#39;class&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">236</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L236">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $start = $params-&gt;{start} || &#39;&#39;;</td></tr>
<tr><td class="h">237</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $startHide = ($start eq &#39;hide&#39;);</td></tr>
<tr><td class="h">238</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $startShow = ($start eq &#39;show&#39;);</td></tr>
<tr><td class="h">239</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L239">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $firststart = $params-&gt;{&#39;firststart&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">240</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $firstStartHide = ($firststart eq &#39;hide&#39;);</td></tr>
<tr><td class="h">241</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $firstStartShow = ($firststart eq &#39;show&#39;);</td></tr>
<tr><td class="h">242</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L242">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remember = $params-&gt;{&#39;remember&#39;} || $prefRemember;</td></tr>
<tr><td class="h">243</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L243">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $noscript = $params-&gt;{&#39;noscript&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">244</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $noscriptHide = ($noscript eq &#39;hide&#39;);</td></tr>
<tr><td class="h">245</td><td colspan="6"></td></tr><tr><td class="h">246</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @classList = ();</td></tr>
<tr><td class="h">247</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L247">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--condition.html#L247">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, $class) if $class &amp;&amp; !$isTrigger;</td></tr>
<tr><td class="h">248</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L248">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyRememberSetting&#39;) if ($remember eq &#39;on&#39;);</td></tr>
<tr><td class="h">249</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L249">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyForgetSetting&#39;) if ($remember eq &#39;off&#39;);</td></tr>
<tr><td class="h">250</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L250">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyStartHide&#39;) if $startHide;</td></tr>
<tr><td class="h">251</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L251">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyStartShow&#39;) if $startShow;</td></tr>
<tr><td class="h">252</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L252">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyFirstStartHide&#39;) if $firstStartHide;</td></tr>
<tr><td class="h">253</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L253">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyFirstStartShow&#39;) if $firstStartShow;</td></tr>
<tr><td class="h">254</td><td colspan="6"></td></tr><tr><td class="h">255</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L255">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($isTrigger) {</td></tr>
<tr><td class="h">256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyTrigger&#39;);</td></tr>
<tr><td class="h">257</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyMakeVisible&#39;);</td></tr>
<tr><td class="h">258</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">259</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L259">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!$isTrigger) {</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# content</td></tr>
<tr><td class="h">261</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyContent&#39;);</td></tr>
<tr><td class="h">262</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L262">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyMakeHidden&#39;) if !$noscriptHide; # don&#39;t set hidden directly but make it hidden with javascript, no browser without script will be able to see content</td></tr>
<tr><td class="h">263</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--branch.html#L263">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push (@classList, &#39;twistyMakeVisible&#39;) if $noscriptHide;</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">265</td><td colspan="6"></td></tr><tr><td class="h">266</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @propList = ();</td></tr>
<tr><td class="h">267</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@propList, &#39;id=&quot;&#39;.$idTag.&#39;&quot;&#39;);</td></tr>
<tr><td class="h">268</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push (@propList, &#39;class=&quot;&#39;.join(&quot; &quot;,@classList).&#39;&quot;&#39;);</td></tr>
<tr><td class="h">269</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @propList;</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">271</td><td colspan="6"></td></tr><tr><td class="h">272 - 276</td><td colspan="5"></td><td class="s"><pre>=pod
If we write a JavaScript tag here, it will be removed at render time in 
Render.getRenderedVersion if configure option AllowInlineScript is not set.
So we create a semi-variable tag here and convert it to a JavaScript tag in #postRenderingHandler.
=cut</pre></td></tr>
<tr><td class="h">277</td><td colspan="6"></td></tr><tr><td class="h">278</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _createJavascriptTriggerCall {</td></tr>
<tr><td class="h">279</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L279">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my($idTag) = @_;</td></tr>
<tr><td class="h">280</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$needPostRenderingHandler = 1; # notifies postRenderingHandler and beforeCommonTagsHandler</td></tr>
<tr><td class="h">281</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;%_TWISTYSCRIPT{&quot;TWiki.TwistyPlugin.init(&quot;&#39;.$idTag.&#39;&quot;);&quot;}%&#39;;</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">283</td><td colspan="6"></td></tr><tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyWrapInDiv {</td></tr>
<tr><td class="h">285</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L285">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my($text) = @_;</td></tr>
<tr><td class="h">286</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _twistyOpenDiv().$text._twistyCloseDiv();</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">288</td><td colspan="6"></td></tr><tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyOpenDiv {</td></tr>
<tr><td class="h">290</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L290">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;div class=&quot;twistyPlugin&quot; style=&quot;display:inline;&quot;&gt;&#39;;</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">292</td><td colspan="6"></td></tr><tr><td class="h">293</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyCloseDiv {</td></tr>
<tr><td class="h">294</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L294">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;/div&gt;&lt;!-- END twistyPlugin--&gt;&#39;;</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">296</td><td colspan="6"></td></tr><tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyWrapInSpan {</td></tr>
<tr><td class="h">298</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L298">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my($text) = @_;</td></tr>
<tr><td class="h">299</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _twistyOpenSpan().$text._twistyCloseSpan();</td></tr>
<tr><td class="h">300</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">301</td><td colspan="6"></td></tr><tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyOpenSpan {</td></tr>
<tr><td class="h">303</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L303">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;span class=&quot;twistyPlugin&quot;&gt;&#39;;</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">305</td><td colspan="6"></td></tr><tr><td class="h">306</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _twistyCloseSpan {</td></tr>
<tr><td class="h">307</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Plugins-TwistyPlugin-pm--subroutine.html#L307">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;/span&gt;&lt;!-- END twistyPlugin--&gt;&#39;;</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">309</td><td colspan="6"></td></tr><tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
