<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Client.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Client.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">34.8%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Module of TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2005-2007 TWiki Contributors.</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Additional copyrights apply to some or all of the code in this</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># file as follows:</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2000-2003 Andrea Sterbini, a.sterbini@flashnet.it</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2005 Garage Games</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2005 Crawford Currie http://c-dot.co.uk</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2005 Greg Abbas, twiki@abbas.org</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">20</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">26</td><td colspan="6"></td></tr><tr><td class="h">27 - 70</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TWiki::Client

The package is also a Factory for login managers and also the base class
for all login managers.

On it&#39;s own, an object of this class is used when you specify &#39;none&#39; in
the security setup section of
[[%SCRIPTURL{&quot;configure&quot;}%][configure]]. When it is used,
logins are not supported. If you want to authenticate users then you should
consider TemplateLogin or ApacheLogin, which are subclasses of this class.

If you are building a new login manager, then you should write a new subclass
of this class, implementing the methods marked as *VIRTUAL*. There are already
examples in the =lib/TWiki/Client= directory.

The class has extensive tracing, which is enabled by
$TWiki::cfg{Trace}{Client.pm}. The tracing is done in such a way as to
let the perl optimiser optimise out the trace function as a no-op if tracing
is disabled.

Here&#39;s an overview of how it works:

Early in TWiki::new, the login manager is created. The creation of the login manager does two things:
   1 If sessions are in use, it loads CGI::Session but doesn&#39;t initialise the session yet.
   1 Creates the login manager object
Slightly later in TWiki::new, loginManager-&gt;loadSession is called.
   1 Calls loginManager-&gt;getUser to get the username *before* the session is created
      * TWiki::Client::ApacheLogin looks at REMOTE_USER
      * TWiki::Client::TemplateLogin just returns undef
   1 reads the TWIKISID cookie to get the SID (or the TWIKISID parameters in the CGI query if cookies aren&#39;t available, or IP2SID mapping if that&#39;s enabled).
   1 Creates the CGI::Session object, and the session is thereby read.
   1 If the username still isn&#39;t known, reads it from the cookie. Thus TWiki::Client::ApacheLogin overrides the cookie using REMOTE_USER, and TWiki::Client::TemplateLogin *always* uses the session.

Later again in TWiki::new, plugins are given a chance to *override* the username found from the loginManager.

The last step in TWiki::new is to find the user, using whatever user mapping manager is in place.

---++ ObjectData =twiki=

The TWiki object this login manager is attached to.

=cut</pre></td></tr>
<tr><td class="h">71</td><td colspan="6"></td></tr><tr><td class="h">72</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Client;</td></tr>
<tr><td class="h">73</td><td colspan="6"></td></tr><tr><td class="h">74</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L74">1</a></div></td><td><div>5</div><div>3</div><div>6</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">75</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L75">1</a></div></td><td><div>6</div><div>3</div><div>4</div></td><td class="s">use Assert;</td></tr>
<tr><td class="h">76</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L76">1</a></div></td><td><div>6</div><div>3</div><div>5</div></td><td class="s">use Error qw( :try );</td></tr>
<tr><td class="h">77</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L77">1</a></div></td><td><div>7</div><div>3</div><div>5</div></td><td class="s">use TWiki;</td></tr>
<tr><td class="h">78</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L78">1</a></div></td><td><div>6</div><div>3</div><div>10</div></td><td class="s">use TWiki::Sandbox;</td></tr>
<tr><td class="h">79</td><td colspan="6"></td></tr><tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td class="s">BEGIN {</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# suppress stupid warning in CGI::Cookie</td></tr>
<tr><td class="h">82</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L82">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L82">1</a></div></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( exists $ENV{MOD_PERL} ) {</td></tr>
<tr><td class="h">83</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L83">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( !defined( $ENV{MOD_PERL_API_VERSION} )) {</td></tr>
<tr><td class="h">84</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ENV{MOD_PERL_API_VERSION} = 1;</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">88</td><td colspan="6"></td></tr><tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Marker chars</td></tr>
<tr><td class="h">90</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L90">1</a></div></td><td><div>6</div><div>5</div><div>5</div></td><td class="s">use vars qw( $M1 $M2 $M3 );</td></tr>
<tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td class="s">$M1 = chr(5);</td></tr>
<tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td class="s">$M2 = chr(6);</td></tr>
<tr><td class="h">93</td><td></td><td></td><td></td><td></td><td></td><td class="s">$M3 = chr(7);</td></tr>
<tr><td class="h">94</td><td colspan="6"></td></tr><tr><td class="h">95 - 102</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod makeLoginManager( $twiki ) -&gt; $TWiki::Client

Factory method, used to generate a new TWiki::Client object
for the given session.

=cut</pre></td></tr>
<tr><td class="h">103</td><td colspan="6"></td></tr><tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub makeLoginManager {</td></tr>
<tr><td class="h">105</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L105">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = shift;</td></tr>
<tr><td class="h">106</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($twiki-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">107</td><td colspan="6"></td></tr><tr><td class="h">108</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L108">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L108">33</a></div></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseClientSessions} &amp;&amp;</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!$twiki-&gt;inContext( &#39;command_line&#39; )) {</td></tr>
<tr><td class="h">110</td><td colspan="6"></td></tr><tr><td class="h">111</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $use = &#39;use CGI::Session&#39;;</td></tr>
<tr><td class="h">112</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L112">50</a></div></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{Sessions}{UseIPMatching} ) {</td></tr>
<tr><td class="h">113</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$use .= &#39; qw(-ip-match)&#39;;</td></tr>
<tr><td class="h">114</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">115</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$use .= &#39;; use CGI::Cookie&#39;;</td></tr>
<tr><td class="h">116</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L116">1</a></div><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L116">1</a></div></td><td><div>12</div><div>2</div><div>7</div><div>11</div><div>3</div><div>8</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval $use;</td></tr>
<tr><td class="h">117</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L117">50</a></div></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( $@ ) if $@;</td></tr>
<tr><td class="h">118</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L118">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $CGI::Session::VERSION eq &quot;4.10&quot; ) {</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 4.10 is broken; see Item1989</td></tr>
<tr><td class="h">120</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$CGI::Session::NAME = &#39;TWIKISID&#39;;</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">122</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CGI::Session-&gt;name( &#39;TWIKISID&#39; );</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">125</td><td colspan="6"></td></tr><tr><td class="h">126</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $mgr;</td></tr>
<tr><td class="h">127</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L127">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{LoginManager} eq &#39;none&#39; ) {</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# No login manager; just use default behaviours</td></tr>
<tr><td class="h">129</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mgr = new TWiki::Client( $twiki );</td></tr>
<tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">131</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L131">1</a></div></td><td><div>10</div><div>4</div><div>11</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval &#39;use &#39;. $TWiki::cfg{LoginManager};</td></tr>
<tr><td class="h">132</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L132">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw Error::Simple( $@ ) if $@;</td></tr>
<tr><td class="h">133</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mgr = $TWiki::cfg{LoginManager}-&gt;new( $twiki );</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">135</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $mgr;</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">137</td><td colspan="6"></td></tr><tr><td class="h">138</td><td></td><td></td><td></td><td></td><td></td><td class="s"># protected: Construct new client object.</td></tr>
<tr><td class="h">139</td><td colspan="6"></td></tr><tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">141</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L141">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $twiki ) = @_;</td></tr>
<tr><td class="h">142</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = bless( {}, $class );</td></tr>
<tr><td class="h">143</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($twiki-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">144</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{twiki} = $twiki;</td></tr>
<tr><td class="h">145</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;leaveContext( &#39;can_login&#39; );</td></tr>
<tr><td class="h">146</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cookies} = [];</td></tr>
<tr><td class="h">147</td><td><div class="c3">1</div><div class="c3">8</div></td><td></td><td></td><td></td><td><div>14</div><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;map{ $this-&gt;{_authScripts}{$_} = 1; }</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split( /[\s,]+/, $TWiki::cfg{AuthScripts} );</td></tr>
<tr><td class="h">149</td><td colspan="6"></td></tr><tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# register tag handlers and values</td></tr>
<tr><td class="h">151</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::registerTagHandler(&#39;LOGINURL&#39;, \&amp;_LOGINURL);</td></tr>
<tr><td class="h">152</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::registerTagHandler(&#39;LOGIN&#39;, \&amp;_LOGIN);</td></tr>
<tr><td class="h">153</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::registerTagHandler(&#39;LOGOUT&#39;, \&amp;_LOGOUT);</td></tr>
<tr><td class="h">154</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::registerTagHandler(&#39;SESSION_VARIABLE&#39;, \&amp;_SESSION_VARIABLE);</td></tr>
<tr><td class="h">155</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::registerTagHandler(&#39;AUTHENTICATED&#39;, \&amp;_AUTHENTICATED);</td></tr>
<tr><td class="h">156</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;TWiki::registerTagHandler(&#39;CANLOGIN&#39;, \&amp;_CANLOGIN);</td></tr>
<tr><td class="h">157</td><td colspan="6"></td></tr><tr><td class="h">158</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this;</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">160</td><td colspan="6"></td></tr><tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _real_trace {</td></tr>
<tr><td class="h">162</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L162">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $mess ) = @_;</td></tr>
<tr><td class="h">163</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L163">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $id = &#39;Session&#39;.</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($this-&gt;{_cgisession} ? $this-&gt;{_cgisession}-&gt;id() : &#39;unknown&#39;);</td></tr>
<tr><td class="h">165</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L165">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$id .= &#39;(c)&#39; if $this-&gt;{_haveCookie};</td></tr>
<tr><td class="h">166</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;print STDERR &quot;$id: $mess\n&quot;;</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">168</td><td colspan="6"></td></tr><tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td class="s">if( $TWiki::cfg{Trace}{Client} ) {</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;*_trace = \&amp;_real_trace;</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td class="s">} else {</td></tr>
<tr><td class="h">172</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L172">7</a></div></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;*_trace = sub { undef };</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">174</td><td colspan="6"></td></tr><tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td class="s"># read/write IP to SID map, return SID</td></tr>
<tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _IP2SID {</td></tr>
<tr><td class="h">177</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L177">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $sid ) = @_;</td></tr>
<tr><td class="h">178</td><td colspan="6"></td></tr><tr><td class="h">179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ip = $ENV{&#39;REMOTE_ADDR&#39;};</td></tr>
<tr><td class="h">180</td><td colspan="6"></td></tr><tr><td class="h">181</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L181">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $ip; # no IP address, can&#39;t map</td></tr>
<tr><td class="h">182</td><td colspan="6"></td></tr><tr><td class="h">183</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %ips;</td></tr>
<tr><td class="h">184</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L184">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( open( IPMAP, &#39;&lt;&#39;, $TWiki::cfg{WorkingDir}.&#39;/ip2sid&#39; )) {</td></tr>
<tr><td class="h">185</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local $/ = undef;</td></tr>
<tr><td class="h">186</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%ips = map { split( /:/, $_ ) } split( /\r?\n/, &lt;IPMAP&gt; );</td></tr>
<tr><td class="h">187</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(IPMAP);</td></tr>
<tr><td class="h">188</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">189</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L189">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $sid ) {</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# known SID, map the IP addr to it</td></tr>
<tr><td class="h">191</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ips{$ip} = $sid;</td></tr>
<tr><td class="h">192</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L192">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open( IPMAP, &#39;&gt;&#39;, $TWiki::cfg{WorkingDir}.&#39;/ip2sid&#39;) ||</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Failed to open ip2sid map for write. Ask your administrator to make sure that the {Sessions}{Dir} is writable by the webserver user.&quot;;</td></tr>
<tr><td class="h">194</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print IPMAP map { &quot;$_:$ips{$_}\n&quot; } keys %ips;</td></tr>
<tr><td class="h">195</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(IPMAP);</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Return the SID for this IP address</td></tr>
<tr><td class="h">198</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sid = $ips{$ip};</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">200</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $sid;</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">202</td><td colspan="6"></td></tr><tr><td class="h">203 - 215</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod loadSession($defaultUser) -&gt; $login

Get the client session data, using the cookie and/or the request URL.
Set up appropriate session variables in the twiki object and return
the login name.

$defaultUser is a username to use if one is not available from other
sources. The username passed when you create a TWiki instance is
passed in here.

=cut</pre></td></tr>
<tr><td class="h">216</td><td colspan="6"></td></tr><tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub loadSession {</td></tr>
<tr><td class="h">218</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L218">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $defaultUser) = @_;</td></tr>
<tr><td class="h">219</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = $this-&gt;{twiki};</td></tr>
<tr><td class="h">220</td><td colspan="6"></td></tr><tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Try and get the user from the webserver</td></tr>
<tr><td class="h">222</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L222">33</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $authUser = $this-&gt;getUser( $this ) || $defaultUser;</td></tr>
<tr><td class="h">223</td><td colspan="6"></td></tr><tr><td class="h">224</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L224">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $TWiki::cfg{UseClientSessions} ) {</td></tr>
<tr><td class="h">225</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L225">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;userLoggedIn( $authUser ) if $authUser;</td></tr>
<tr><td class="h">226</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $authUser;</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">228</td><td colspan="6"></td></tr><tr><td class="h">229</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L229">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $authUser if $twiki-&gt;inContext( &#39;command_line&#39; );</td></tr>
<tr><td class="h">230</td><td colspan="6"></td></tr><tr><td class="h">231</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $query = $twiki-&gt;{cgiQuery};</td></tr>
<tr><td class="h">232</td><td colspan="6"></td></tr><tr><td class="h">233</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_haveCookie} = $query-&gt;raw_cookie();</td></tr>
<tr><td class="h">234</td><td colspan="6"></td></tr><tr><td class="h">235</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;URL &quot;.$query-&gt;url());</td></tr>
<tr><td class="h">236</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L236">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{_haveCookie} ) {</td></tr>
<tr><td class="h">237</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Cookie &quot;.$this-&gt;{_haveCookie});</td></tr>
<tr><td class="h">238</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">239</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;No cookie &quot;);</td></tr>
<tr><td class="h">240</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">241</td><td colspan="6"></td></tr><tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Item3568: CGI::Session from 4.0 already does the -d and creates the</td></tr>
<tr><td class="h">243</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# sessions directory if it does not exist. For performance reasons we</td></tr>
<tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# only test for and create session file directory for older CGI::Session</td></tr>
<tr><td class="h">245</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L245">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $CGI::Session::VERSION &lt; 4.0 ) {</td></tr>
<tr><td class="h">246</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L246">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( -d $TWiki::cfg{TempfileDir} ) {</td></tr>
<tr><td class="h">247</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L247">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ( mkdir($TWiki::cfg{TempfileDir}) ) {</td></tr>
<tr><td class="h">248</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Could not create $TWiki::cfg{TempfileDir} for session files&quot;;</td></tr>
<tr><td class="h">249</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">250</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">251</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">252</td><td colspan="6"></td></tr><tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# First, see if there is a cookied session, creating a new session</td></tr>
<tr><td class="h">254</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if necessary.</td></tr>
<tr><td class="h">255</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L255">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{Sessions}{MapIP2SID} ) {</td></tr>
<tr><td class="h">256</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# map the end user IP address to SID</td></tr>
<tr><td class="h">257</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sid = _IP2SID();</td></tr>
<tr><td class="h">258</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L258">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $sid ) {</td></tr>
<tr><td class="h">259</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession} = CGI::Session-&gt;new(</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef, $sid, { Directory =&gt; $TWiki::cfg{TempfileDir} } );</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">262</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession} = CGI::Session-&gt;new(</td></tr>
<tr><td class="h">263</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef, undef,</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ Directory =&gt; $TWiki::cfg{TempfileDir} } );</td></tr>
<tr><td class="h">265</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;New IP2SID session&quot;);</td></tr>
<tr><td class="h">266</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_IP2SID( $this-&gt;{_cgisession}-&gt;id() );</td></tr>
<tr><td class="h">267</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">269</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession} = CGI::Session-&gt;new(</td></tr>
<tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef, $query,</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ Directory =&gt; $TWiki::cfg{TempfileDir} } );</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">273</td><td colspan="6"></td></tr><tr><td class="h">274</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L274">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;die CGI::Session-&gt;errstr() unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">275</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Opened session&quot;);</td></tr>
<tr><td class="h">276</td><td colspan="6"></td></tr><tr><td class="h">277</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L277">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $authUser ) {</td></tr>
<tr><td class="h">278</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Webserver says user is $authUser&quot;);</td></tr>
<tr><td class="h">279</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">280</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$authUser = TWiki::Sandbox::untaintUnchecked(</td></tr>
<tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession}-&gt;param( &#39;AUTHUSER&#39; ));</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">283</td><td colspan="6"></td></tr><tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if we couldn&#39;t get the login manager or the http session to tell</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# us who the user is, then let&#39;s use the CGI &quot;remote user&quot;</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# variable (which may have been set manually by a unit test,</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# or it might have come from Apache).</td></tr>
<tr><td class="h">288</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L288">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $authUser ) {</td></tr>
<tr><td class="h">289</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Session says user is $authUser&quot;);</td></tr>
<tr><td class="h">290</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Use remote user provided from &quot;new TWiki&quot; call. This is mainly</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# for testing.</td></tr>
<tr><td class="h">293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$authUser = $defaultUser;</td></tr>
<tr><td class="h">294</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L294">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;TWiki object says user is $authUser&quot;) if $authUser;</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">296</td><td colspan="6"></td></tr><tr><td class="h">297</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L297">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$authUser ||= $defaultUser;</td></tr>
<tr><td class="h">298</td><td colspan="6"></td></tr><tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# is this a logout?</td></tr>
<tr><td class="h">300</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L300">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L300">33</a></div></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $query &amp;&amp; $query-&gt;param( &#39;logout&#39; ) ) {</td></tr>
<tr><td class="h">301</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;User is logging out&quot;);</td></tr>
<tr><td class="h">302</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L302">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $origurl = $ENV{HTTP_REFERER} || $query-&gt;url().$query-&gt;path_info();</td></tr>
<tr><td class="h">303</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;redirectCgiQuery( $query, $origurl );</td></tr>
<tr><td class="h">304</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$authUser = undef;</td></tr>
<tr><td class="h">305</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">306</td><td colspan="6"></td></tr><tr><td class="h">307</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;userLoggedIn( $authUser );</td></tr>
<tr><td class="h">308</td><td colspan="6"></td></tr><tr><td class="h">309</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;{SESSION_TAGS}{SESSIONID} = $this-&gt;{_cgisession}-&gt;id();</td></tr>
<tr><td class="h">310</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;{SESSION_TAGS}{SESSIONVAR} = $CGI::Session::NAME;</td></tr>
<tr><td class="h">311</td><td colspan="6"></td></tr><tr><td class="h">312</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $authUser;</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">314</td><td colspan="6"></td></tr><tr><td class="h">315 - 322</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod checkAccess()

Check if the script being run in this session is authorised for execution.
If not, throw an access control exception.

=cut</pre></td></tr>
<tr><td class="h">323</td><td colspan="6"></td></tr><tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub checkAccess {</td></tr>
<tr><td class="h">325</td><td colspan="6"></td></tr><tr><td class="h">326</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L326">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L326">1</a></div></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless( $TWiki::cfg{UseClientSessions} );</td></tr>
<tr><td class="h">327</td><td colspan="6"></td></tr><tr><td class="h">328</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">329</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = $this-&gt;{twiki};</td></tr>
<tr><td class="h">330</td><td colspan="6"></td></tr><tr><td class="h">331</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L331">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if $twiki-&gt;inContext( &#39;command_line&#39; );</td></tr>
<tr><td class="h">332</td><td colspan="6"></td></tr><tr><td class="h">333</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L333">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L333">33</a></div></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $twiki-&gt;inContext( &#39;authenticated&#39; ) ||</td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{LoginManager} eq &#39;none&#39; ) {</td></tr>
<tr><td class="h">335</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L335">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $script = $ENV{&#39;SCRIPT_NAME&#39;} || $ENV{&#39;SCRIPT_FILENAME&#39;};</td></tr>
<tr><td class="h">336</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L336">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$script =~ s@^.*/([^./]+)@$1@g if $script;</td></tr>
<tr><td class="h">337</td><td colspan="6"></td></tr><tr><td class="h">338</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L338">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L338">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( defined $script &amp;&amp; $this-&gt;{_authScripts}{$script} ) {</td></tr>
<tr><td class="h">339</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $topic = $this-&gt;{twiki}-&gt;{topicName};</td></tr>
<tr><td class="h">340</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $web = $this-&gt;{twiki}-&gt;{webName};</td></tr>
<tr><td class="h">341</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw TWiki::AccessControlException(</td></tr>
<tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$script, $this-&gt;{twiki}-&gt;{user}, $web, $topic,</td></tr>
<tr><td class="h">343</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;authentication required&#39; );</td></tr>
<tr><td class="h">344</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">345</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">346</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">347</td><td colspan="6"></td></tr><tr><td class="h">348 - 355</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod finish

Complete processing after the client&#39;s HTTP request has been responded
to. Flush the user&#39;s session (if any) to disk.

=cut</pre></td></tr>
<tr><td class="h">356</td><td colspan="6"></td></tr><tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub finish {</td></tr>
<tr><td class="h">358</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L358">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">359</td><td colspan="6"></td></tr><tr><td class="h">360</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L360">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{_cgisession} ) {</td></tr>
<tr><td class="h">361</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession}-&gt;flush();</td></tr>
<tr><td class="h">362</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L362">50</a></div></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die $this-&gt;{_cgisession}-&gt;errstr()</td></tr>
<tr><td class="h">363</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $this-&gt;{_cgisession}-&gt;errstr();</td></tr>
<tr><td class="h">364</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Flushed&quot;);</td></tr>
<tr><td class="h">365</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">366</td><td colspan="6"></td></tr><tr><td class="h">367</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L367">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless( $TWiki::cfg{Sessions}{ExpireAfter} &gt; 0 );</td></tr>
<tr><td class="h">368</td><td colspan="6"></td></tr><tr><td class="h">369</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;expireDeadSessions();</td></tr>
<tr><td class="h">370</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">371</td><td colspan="6"></td></tr><tr><td class="h">372 - 382</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod expireDeadSessions()

Delete sessions and passthrough files that are sitting around but are really expired.
This *assumes* that the sessions are stored as files.

This is a static method, but requires TWiki::cfg. It is designed to be
run from a session or from a cron job.

=cut</pre></td></tr>
<tr><td class="h">383</td><td colspan="6"></td></tr><tr><td class="h">384</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub expireDeadSessions {</td></tr>
<tr><td class="h">385</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L385">50</a></div></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L385">1</a></div></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $time = time() || 0;</td></tr>
<tr><td class="h">386</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L386">50</a></div></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $exp = $TWiki::cfg{Sessions}{ExpireAfter} || 36000; # 10 hours</td></tr>
<tr><td class="h">387</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L387">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$exp = -$exp if $exp &lt; 0;</td></tr>
<tr><td class="h">388</td><td colspan="6"></td></tr><tr><td class="h">389</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L389">50</a></div></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;opendir(D, $TWiki::cfg{TempfileDir}) || return;</td></tr>
<tr><td class="h">390</td><td><div class="c3">1</div><div class="c3">4</div></td><td></td><td></td><td></td><td><div>15</div><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $file ( grep { /^(passthru|cgisess)_[0-9a-f]{32}/ } readdir(D) ) {</td></tr>
<tr><td class="h">391</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file = TWiki::Sandbox::untaintUnchecked(</td></tr>
<tr><td class="h">392</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{TempfileDir}.&#39;/&#39;.$file );</td></tr>
<tr><td class="h">393</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>28</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @stat = stat( $file );</td></tr>
<tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# CGI::Session updates the session file each time a browser views a</td></tr>
<tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# topic setting the access and expiry time as values in the file. This </td></tr>
<tr><td class="h">396</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# also sets the mtime (modification time) for the file which is all we need.</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# We know that the expiry time is mtime + $TWiki::cfg{Sessions}{ExpireAfter}</td></tr>
<tr><td class="h">398</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# so we do not need to waste execution time opening and reading the file.</td></tr>
<tr><td class="h">399</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# We just check the mtime. mtime is confirmed set in both Windows and Linux</td></tr>
<tr><td class="h">400</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# As a fallback we also check ctime. Files are deleted when they expire.</td></tr>
<tr><td class="h">401</td><td><div class="c3">2</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L401">33</a></div></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $lat = $stat[9] || $stat[10] || 0;</td></tr>
<tr><td class="h">402</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L402">50</a></div></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink $file if ( $time - $lat &gt;= $exp );</td></tr>
<tr><td class="h">403</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">405</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;closedir D;</td></tr>
<tr><td class="h">406</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">407</td><td colspan="6"></td></tr><tr><td class="h">408 - 418</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod userLoggedIn( $login, $wikiname)

Called when the user logs in. It&#39;s invoked from TWiki::UI::Register::finish
for instance, when the user follows the link in their verification email
message.
   * =$login= - string login name
   * =$wikiname= - string wikiname

=cut</pre></td></tr>
<tr><td class="h">419</td><td colspan="6"></td></tr><tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub userLoggedIn {</td></tr>
<tr><td class="h">421</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L421">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $authUser, $wikiName ) = @_;</td></tr>
<tr><td class="h">422</td><td colspan="6"></td></tr><tr><td class="h">423</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = $this-&gt;{twiki};</td></tr>
<tr><td class="h">424</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L424">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if $twiki-&gt;inContext( &#39;command_line&#39; );</td></tr>
<tr><td class="h">425</td><td colspan="6"></td></tr><tr><td class="h">426</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L426">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseClientSessions} ) {</td></tr>
<tr><td class="h">427</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# create new session if necessary</td></tr>
<tr><td class="h">428</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L428">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{_cgisession} ) {</td></tr>
<tr><td class="h">429</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession} =</td></tr>
<tr><td class="h">430</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CGI::Session-&gt;new(</td></tr>
<tr><td class="h">431</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;undef, $twiki-&gt;{cgiQuery},</td></tr>
<tr><td class="h">432</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ Directory =&gt; $TWiki::cfg{TempfileDir} } );</td></tr>
<tr><td class="h">433</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L433">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die CGI::Session-&gt;errstr() unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">434</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">435</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">436</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L436">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L436">33</a></div></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $authUser &amp;&amp; $authUser ne $TWiki::cfg{DefaultUserLogin} ) {</td></tr>
<tr><td class="h">437</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Session is authenticated&quot;);</td></tr>
<tr><td class="h">438</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L438">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession}-&gt;param( &#39;AUTHUSER&#39;, $authUser )</td></tr>
<tr><td class="h">439</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseClientSessions} );</td></tr>
<tr><td class="h">440</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;enterContext( &#39;authenticated&#39; );</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">442</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Session is NOT authenticated&quot;);</td></tr>
<tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we are not authenticated, expire any existing session</td></tr>
<tr><td class="h">444</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L444">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession}-&gt;clear( [ &#39;AUTHUSER&#39; ] )</td></tr>
<tr><td class="h">445</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseClientSessions} );</td></tr>
<tr><td class="h">446</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;leaveContext( &#39;authenticated&#39; );</td></tr>
<tr><td class="h">447</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">448</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L448">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseClientSessions} ) {</td></tr>
<tr><td class="h">449</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# flush the session, to try to fix Item1820 and Item2234</td></tr>
<tr><td class="h">450</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession}-&gt;flush();</td></tr>
<tr><td class="h">451</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L451">50</a></div></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die $this-&gt;{_cgisession}-&gt;errstr() if $this-&gt;{_cgisession}-&gt;errstr();</td></tr>
<tr><td class="h">452</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Flushed&quot;);</td></tr>
<tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">455</td><td colspan="6"></td></tr><tr><td class="h">456</td><td></td><td></td><td></td><td></td><td></td><td class="s"># get an RE that matches a local script URL</td></tr>
<tr><td class="h">457</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _myScriptURLRE {</td></tr>
<tr><td class="h">458</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L458">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">459</td><td colspan="6"></td></tr><tr><td class="h">460</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $s = $this-&gt;{_MYSCRIPTURL};</td></tr>
<tr><td class="h">461</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L461">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $s ) {</td></tr>
<tr><td class="h">462</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s = quotemeta($this-&gt;{twiki}-&gt;getScriptUrl( 1, $M1, $M2, $M3 ));</td></tr>
<tr><td class="h">463</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s =~ s@\\$M1@[^/]*?@go;</td></tr>
<tr><td class="h">464</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s =~ s@\\$M2@[^/]*?@go;</td></tr>
<tr><td class="h">465</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s =~ s@\\$M3@[^#\?/]*@go;</td></tr>
<tr><td class="h">466</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# now add alternates for the various script-specific overrides</td></tr>
<tr><td class="h">467</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $v ( values %{$TWiki::cfg{ScriptUrlPaths}} ) {</td></tr>
<tr><td class="h">468</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $over = $v;</td></tr>
<tr><td class="h">469</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# escape non-alphabetics</td></tr>
<tr><td class="h">470</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$over =~ s/(\W)/\\$1/g;</td></tr>
<tr><td class="h">471</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$s .= &#39;|&#39;.$over;</td></tr>
<tr><td class="h">472</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">473</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_MYSCRIPTURL} = &quot;($s)&quot;;</td></tr>
<tr><td class="h">474</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">475</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $s;</td></tr>
<tr><td class="h">476</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">477</td><td colspan="6"></td></tr><tr><td class="h">478</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Rewrite a URL inserting the session id</td></tr>
<tr><td class="h">479</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _rewriteURL {</td></tr>
<tr><td class="h">480</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L480">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $url ) = @_;</td></tr>
<tr><td class="h">481</td><td colspan="6"></td></tr><tr><td class="h">482</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L482">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url unless $url;</td></tr>
<tr><td class="h">483</td><td colspan="6"></td></tr><tr><td class="h">484</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sessionId = $this-&gt;{_cgisession}-&gt;id();</td></tr>
<tr><td class="h">485</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L485">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url unless $sessionId;</td></tr>
<tr><td class="h">486</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L486">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url if $url =~ m/\?$CGI::Session::NAME=/;</td></tr>
<tr><td class="h">487</td><td colspan="6"></td></tr><tr><td class="h">488</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $s = $this-&gt;_myScriptURLRE();</td></tr>
<tr><td class="h">489</td><td colspan="6"></td></tr><tr><td class="h">490</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If the URL has no colon in it, or it matches the local script</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# URL, it must be an internal URL and therefore needs the session.</td></tr>
<tr><td class="h">492</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L492">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L492">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url !~ /:/ || $url =~ /^$s/ ) {</td></tr>
<tr><td class="h">493</td><td colspan="6"></td></tr><tr><td class="h">494</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# strip off existing params</td></tr>
<tr><td class="h">495</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $params = &quot;?$CGI::Session::NAME=$sessionId&quot;;</td></tr>
<tr><td class="h">496</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L496">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $url =~ s/\?(.*)$// ) {</td></tr>
<tr><td class="h">497</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$params .= &#39;;&#39;.$1;</td></tr>
<tr><td class="h">498</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">499</td><td colspan="6"></td></tr><tr><td class="h">500</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# strip off the anchor</td></tr>
<tr><td class="h">501</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $anchor = &#39;&#39;;</td></tr>
<tr><td class="h">502</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L502">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $url =~ s/(#.*)// ) {</td></tr>
<tr><td class="h">503</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor = $1;</td></tr>
<tr><td class="h">504</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">505</td><td colspan="6"></td></tr><tr><td class="h">506</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# rebuild the URL</td></tr>
<tr><td class="h">507</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= $anchor.$params;</td></tr>
<tr><td class="h">508</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} # otherwise leave it untouched</td></tr>
<tr><td class="h">509</td><td colspan="6"></td></tr><tr><td class="h">510</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url;</td></tr>
<tr><td class="h">511</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">512</td><td colspan="6"></td></tr><tr><td class="h">513</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Catch all FORMs and add a hidden Session ID variable.</td></tr>
<tr><td class="h">514</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Only do this if the form is pointing to an internal link.</td></tr>
<tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This occurs if there are no colons in its target, if it has</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td class="s"># no target, or if its target matches a getScriptUrl URL.</td></tr>
<tr><td class="h">517</td><td></td><td></td><td></td><td></td><td></td><td class="s"># &#39;$rest&#39; is the bit of the initial form tag up to the closing &gt;</td></tr>
<tr><td class="h">518</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _rewriteFORM {</td></tr>
<tr><td class="h">519</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L519">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $url, $rest ) = @_;</td></tr>
<tr><td class="h">520</td><td colspan="6"></td></tr><tr><td class="h">521</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L521">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url.$rest unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">522</td><td colspan="6"></td></tr><tr><td class="h">523</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $s = $this-&gt;_myScriptURLRE();</td></tr>
<tr><td class="h">524</td><td colspan="6"></td></tr><tr><td class="h">525</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L525">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L525">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url !~ /:/ || $url =~ /^($s)/ ) {</td></tr>
<tr><td class="h">526</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rest .= CGI::hidden( -name =&gt; $CGI::Session::NAME,</td></tr>
<tr><td class="h">527</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-value =&gt; $this-&gt;{_cgisession}-&gt;id());</td></tr>
<tr><td class="h">528</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">529</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $url.$rest;</td></tr>
<tr><td class="h">530</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">531</td><td colspan="6"></td></tr><tr><td class="h">532 - 542</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod endRenderingHandler()

This handler is called by getRenderedVersion just before the plugins
postRenderingHandler. So it is passed all HTML text just before it is
printed.

*DEPRECATED* Use postRenderingHandler instead.

=cut</pre></td></tr>
<tr><td class="h">543</td><td colspan="6"></td></tr><tr><td class="h">544</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub endRenderingHandler {</td></tr>
<tr><td class="h">545</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L545">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L545">3</a></div></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless( $TWiki::cfg{UseClientSessions} );</td></tr>
<tr><td class="h">546</td><td colspan="6"></td></tr><tr><td class="h">547</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">548</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L548">50</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if $this-&gt;{twiki}-&gt;inContext( &#39;command_line&#39; );</td></tr>
<tr><td class="h">549</td><td colspan="6"></td></tr><tr><td class="h">550</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# If cookies are not turned on and transparent CGI session IDs are,</td></tr>
<tr><td class="h">551</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# grab every URL that is an internal link and pass a CGI variable</td></tr>
<tr><td class="h">552</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# with the session ID</td></tr>
<tr><td class="h">553</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L553">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L553">33</a></div></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{_haveCookie} || !$TWiki::cfg{Sessions}{IDsInURLs} ) {</td></tr>
<tr><td class="h">554</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# rewrite internal links to include the transparent session ID</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Doesn&#39;t catch Javascript, because there are just so many ways</td></tr>
<tr><td class="h">556</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# to generate links from JS.</td></tr>
<tr><td class="h">557</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: this would probably be done better using javascript</td></tr>
<tr><td class="h">558</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# that handles navigation away from this page, and uses the</td></tr>
<tr><td class="h">559</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# rules to rewrite any relative URLs at that time.</td></tr>
<tr><td class="h">560</td><td colspan="6"></td></tr><tr><td class="h">561</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# a href= rewriting</td></tr>
<tr><td class="h">562</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_[0] =~ s/(&lt;a[^&gt;]*(?&lt;=\s)href=([&quot;&#39;]))(.*?)(\2)/$1.$this-&gt;_rewriteURL($3).$4/geoi;</td></tr>
<tr><td class="h">563</td><td colspan="6"></td></tr><tr><td class="h">564</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# form action= rewriting</td></tr>
<tr><td class="h">565</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: Forms that have no target are also implicit internal</td></tr>
<tr><td class="h">566</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# links, but are not handled. Does this matter&gt;</td></tr>
<tr><td class="h">567</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_[0] =~ s/(&lt;form[^&gt;]*(?&lt;=\s)(?:action)=([&quot;&#39;]))(.*?)(\2[^&gt;]*&gt;)/$1.$this-&gt;_rewriteFORM($3, $4)/geoi;</td></tr>
<tr><td class="h">568</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">569</td><td colspan="6"></td></tr><tr><td class="h">570</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# And, finally, the logon stuff</td></tr>
<tr><td class="h">571</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>105</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$_[0] =~ s/%SESSIONLOGON%/$this-&gt;_dispLogon()/geo;</td></tr>
<tr><td class="h">572</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>118</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$_[0] =~ s/%SKINSELECT%/$this-&gt;_skinSelect()/geo;</td></tr>
<tr><td class="h">573</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">574</td><td colspan="6"></td></tr><tr><td class="h">575 - 582</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod addCookie($c)

Add a cookie to the list of cookies for this session.
   * =$c= - a CGI::Cookie

=cut</pre></td></tr>
<tr><td class="h">583</td><td colspan="6"></td></tr><tr><td class="h">584</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub addCookie {</td></tr>
<tr><td class="h">585</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L585">0</a></div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L585">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless( $TWiki::cfg{UseClientSessions} );</td></tr>
<tr><td class="h">586</td><td colspan="6"></td></tr><tr><td class="h">587</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $c ) = @_;</td></tr>
<tr><td class="h">588</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L588">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if $this-&gt;{twiki}-&gt;inContext( &#39;command_line&#39; );</td></tr>
<tr><td class="h">589</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($c-&gt;isa(&#39;CGI::Cookie&#39;)) if DEBUG;</td></tr>
<tr><td class="h">590</td><td colspan="6"></td></tr><tr><td class="h">591</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push( @{$this-&gt;{_cookies}}, $c );</td></tr>
<tr><td class="h">592</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">593</td><td colspan="6"></td></tr><tr><td class="h">594 - 601</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod modifyHeader( \%header )

Modify a HTTP header
   * =\%header= - header entries

=cut</pre></td></tr>
<tr><td class="h">602</td><td colspan="6"></td></tr><tr><td class="h">603</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub modifyHeader {</td></tr>
<tr><td class="h">604</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L604">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $hopts ) = @_;</td></tr>
<tr><td class="h">605</td><td colspan="6"></td></tr><tr><td class="h">606</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L606">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">607</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L607">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $TWiki::cfg{Sessions}{MapIP2SID};</td></tr>
<tr><td class="h">608</td><td colspan="6"></td></tr><tr><td class="h">609</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $query = $this-&gt;{twiki}-&gt;{cgiQuery};</td></tr>
<tr><td class="h">610</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $c = CGI::Cookie-&gt;new( -name =&gt; $CGI::Session::NAME,</td></tr>
<tr><td class="h">611</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-value =&gt; $this-&gt;{_cgisession}-&gt;id(),</td></tr>
<tr><td class="h">612</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-path =&gt; &#39;/&#39; );</td></tr>
<tr><td class="h">613</td><td colspan="6"></td></tr><tr><td class="h">614</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push( @{$this-&gt;{_cookies}}, $c );</td></tr>
<tr><td class="h">615</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$hopts-&gt;{cookie} = $this-&gt;{_cookies};</td></tr>
<tr><td class="h">616</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">617</td><td colspan="6"></td></tr><tr><td class="h">618 - 625</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod redirectCgiQuery( $url )

Generate an HTTP redirect on STDOUT, if you can. Return 1 if you did.
   * =$url= - target of the redirection.

=cut</pre></td></tr>
<tr><td class="h">626</td><td colspan="6"></td></tr><tr><td class="h">627</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub redirectCgiQuery {</td></tr>
<tr><td class="h">628</td><td colspan="6"></td></tr><tr><td class="h">629</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L629">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $query, $url ) = @_;</td></tr>
<tr><td class="h">630</td><td colspan="6"></td></tr><tr><td class="h">631</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L631">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{_cgisession} ) {</td></tr>
<tr><td class="h">632</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L632">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L632">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = $this-&gt;_rewriteURL( $url )</td></tr>
<tr><td class="h">633</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( !$TWiki::cfg{Sessions}{IDsInURLs} || $this-&gt;{_haveCookie} );</td></tr>
<tr><td class="h">634</td><td colspan="6"></td></tr><tr><td class="h">635</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# This usually won&#39;t be important, but just in case they haven&#39;t</td></tr>
<tr><td class="h">636</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# yet received the cookie and happen to be redirecting, be sure</td></tr>
<tr><td class="h">637</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# they have the cookie. (this is a lot more important with</td></tr>
<tr><td class="h">638</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# transparent CGI session IDs, because the session DIES when those</td></tr>
<tr><td class="h">639</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# people go across a redirect without a ?CGISESSID= in it... But</td></tr>
<tr><td class="h">640</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# EVEN in that case, they should be redirecting to a URL that</td></tr>
<tr><td class="h">641</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# already *HAS* a sessionID in it... Maybe...)</td></tr>
<tr><td class="h">642</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">643</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# So this is just a big fat precaution, just like the rest of this</td></tr>
<tr><td class="h">644</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# whole handler.</td></tr>
<tr><td class="h">645</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cookie = CGI::Cookie-&gt;new( -name =&gt; $CGI::Session::NAME,</td></tr>
<tr><td class="h">646</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-value =&gt; $this-&gt;{_cgisession}-&gt;id(),</td></tr>
<tr><td class="h">647</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-path =&gt; &#39;/&#39; );</td></tr>
<tr><td class="h">648</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @{$this-&gt;{_cookies}}, $cookie );</td></tr>
<tr><td class="h">649</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">650</td><td colspan="6"></td></tr><tr><td class="h">651</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L651">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{Sessions}{MapIP2SID} ) {</td></tr>
<tr><td class="h">652</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Redirect to $url WITHOUT cookie&quot;);</td></tr>
<tr><td class="h">653</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print $query-&gt;redirect( -url =&gt; $url );</td></tr>
<tr><td class="h">654</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">655</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_trace($this, &quot;Redirect to $url with cookie&quot;);</td></tr>
<tr><td class="h">656</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print $query-&gt;redirect( -url =&gt; $url, -cookie =&gt; $this-&gt;{_cookies} );</td></tr>
<tr><td class="h">657</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">658</td><td colspan="6"></td></tr><tr><td class="h">659</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">660</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">661</td><td colspan="6"></td></tr><tr><td class="h">662 - 668</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getSessionValues() -&gt; \%values

Get a name-&gt;value hash of all the defined session variables

=cut</pre></td></tr>
<tr><td class="h">669</td><td colspan="6"></td></tr><tr><td class="h">670</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getSessionValues {</td></tr>
<tr><td class="h">671</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L671">1</a></div></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">672</td><td colspan="6"></td></tr><tr><td class="h">673</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L673">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">674</td><td colspan="6"></td></tr><tr><td class="h">675</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{_cgisession}-&gt;param_hashref();</td></tr>
<tr><td class="h">676</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">677</td><td colspan="6"></td></tr><tr><td class="h">678 - 684</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getSessionValue( $name ) -&gt; $value

Get the value of a session variable.

=cut</pre></td></tr>
<tr><td class="h">685</td><td colspan="6"></td></tr><tr><td class="h">686</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getSessionValue {</td></tr>
<tr><td class="h">687</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L687">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $key ) = @_;</td></tr>
<tr><td class="h">688</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L688">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">689</td><td colspan="6"></td></tr><tr><td class="h">690</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{_cgisession}-&gt;param( $key );</td></tr>
<tr><td class="h">691</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">692</td><td colspan="6"></td></tr><tr><td class="h">693 - 700</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod setSessionValue( $name, $value )

Set the value of a session variable.
We do not allow setting of AUTHUSER.

=cut</pre></td></tr>
<tr><td class="h">701</td><td colspan="6"></td></tr><tr><td class="h">702</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub setSessionValue {</td></tr>
<tr><td class="h">703</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L703">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $key, $value ) = @_;</td></tr>
<tr><td class="h">704</td><td colspan="6"></td></tr><tr><td class="h">705</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# We do not allow setting of AUTHUSER.</td></tr>
<tr><td class="h">706</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L706">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L706">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{_cgisession} &amp;&amp;</td></tr>
<tr><td class="h">707</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key ne &#39;AUTHUSER&#39; &amp;&amp;</td></tr>
<tr><td class="h">708</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defined( $this-&gt;{_cgisession}-&gt;param( $key, $value ))) {</td></tr>
<tr><td class="h">709</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">710</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">711</td><td colspan="6"></td></tr><tr><td class="h">712</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">713</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">714</td><td colspan="6"></td></tr><tr><td class="h">715 - 722</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod clearSessionValue( $name ) -&gt; $boolean

Clear the value of a session variable.
We do not allow setting of AUTHUSER.

=cut</pre></td></tr>
<tr><td class="h">723</td><td colspan="6"></td></tr><tr><td class="h">724</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub clearSessionValue {</td></tr>
<tr><td class="h">725</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L725">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $key ) = @_;</td></tr>
<tr><td class="h">726</td><td colspan="6"></td></tr><tr><td class="h">727</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# We do not allow clearing of AUTHUSER.</td></tr>
<tr><td class="h">728</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L728">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L728">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{_cgisession} &amp;&amp;</td></tr>
<tr><td class="h">729</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$key ne &#39;AUTHUSER&#39; &amp;&amp;</td></tr>
<tr><td class="h">730</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defined( $this-&gt;{_cgisession}-&gt;param( $key ))) {</td></tr>
<tr><td class="h">731</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{_cgisession}-&gt;clear( [ $_[1] ] );</td></tr>
<tr><td class="h">732</td><td colspan="6"></td></tr><tr><td class="h">733</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">734</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">735</td><td colspan="6"></td></tr><tr><td class="h">736</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">737</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">738</td><td colspan="6"></td></tr><tr><td class="h">739 - 752</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod forceAuthentication() -&gt; boolean

*VIRTUAL METHOD* implemented by subclasses

Triggered by an access control violation, this method tests
to see if the current session is authenticated or not. If not,
it does whatever is needed so that the user can log in, and returns 1.

If the user has an existing authenticated session, the function simply drops
though and returns 0.

=cut</pre></td></tr>
<tr><td class="h">753</td><td colspan="6"></td></tr><tr><td class="h">754</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub forceAuthentication {</td></tr>
<tr><td class="h">755</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L755">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</td></tr>
<tr><td class="h">756</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">757</td><td colspan="6"></td></tr><tr><td class="h">758 - 767</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod loginUrl( ... ) -&gt; $url

*VIRTUAL METHOD* implemented by subclasses

Return a full URL suitable for logging in.
   * =...= - url parameters to be added to the URL, in the format required by TWiki::getScriptUrl()

=cut</pre></td></tr>
<tr><td class="h">768</td><td colspan="6"></td></tr><tr><td class="h">769</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub loginUrl {</td></tr>
<tr><td class="h">770</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L770">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">771</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">772</td><td colspan="6"></td></tr><tr><td class="h">773 - 783</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getUser()

*VIRTUAL METHOD* implemented by subclasses

If there is some other means of getting a username - for example,
Apache has remote_user() - then return it. Otherwise, return undef and
the username stored in the session will be used.

=cut</pre></td></tr>
<tr><td class="h">784</td><td colspan="6"></td></tr><tr><td class="h">785</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getUser {</td></tr>
<tr><td class="h">786</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L786">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">787</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">788</td><td colspan="6"></td></tr><tr><td class="h">789</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _LOGIN {</td></tr>
<tr><td class="h">790</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#my( $twiki, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">791</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L791">2</a></div></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = shift;</td></tr>
<tr><td class="h">792</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">793</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">794</td><td colspan="6"></td></tr><tr><td class="h">795</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L795">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if $twiki-&gt;inContext( &#39;authenticated&#39; );</td></tr>
<tr><td class="h">796</td><td colspan="6"></td></tr><tr><td class="h">797</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = $this-&gt;loginUrl();</td></tr>
<tr><td class="h">798</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L798">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url ) {</td></tr>
<tr><td class="h">799</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $text = $twiki-&gt;{templates}-&gt;expandTemplate(&#39;LOG_IN&#39;);</td></tr>
<tr><td class="h">800</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return CGI::a( { href=&gt;$url }, $text );</td></tr>
<tr><td class="h">801</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">802</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">803</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">804</td><td colspan="6"></td></tr><tr><td class="h">805</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _LOGOUTURL {</td></tr>
<tr><td class="h">806</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L806">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $twiki, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">807</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">808</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">809</td><td colspan="6"></td></tr><tr><td class="h">810</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $twiki-&gt;getScriptUrl(</td></tr>
<tr><td class="h">811</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0, &#39;view&#39;,</td></tr>
<tr><td class="h">812</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;{SESSION_TAGS}{BASEWEB},</td></tr>
<tr><td class="h">813</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$twiki-&gt;{SESSION_TAGS}{BASETOPIC},</td></tr>
<tr><td class="h">814</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;logout&#39; =&gt; 1 );</td></tr>
<tr><td class="h">815</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">816</td><td colspan="6"></td></tr><tr><td class="h">817</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _LOGOUT {</td></tr>
<tr><td class="h">818</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L818">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $twiki, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">819</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">820</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">821</td><td colspan="6"></td></tr><tr><td class="h">822</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L822">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $twiki-&gt;inContext( &#39;authenticated&#39; );</td></tr>
<tr><td class="h">823</td><td colspan="6"></td></tr><tr><td class="h">824</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = _LOGOUTURL( @_ );</td></tr>
<tr><td class="h">825</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L825">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url ) {</td></tr>
<tr><td class="h">826</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $text = $twiki-&gt;{templates}-&gt;expandTemplate(&#39;LOG_OUT&#39;);</td></tr>
<tr><td class="h">827</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return CGI::a( {href=&gt;$url }, $text );</td></tr>
<tr><td class="h">828</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">829</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">830</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">831</td><td colspan="6"></td></tr><tr><td class="h">832</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _AUTHENTICATED {</td></tr>
<tr><td class="h">833</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L833">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $twiki, $params ) = @_;</td></tr>
<tr><td class="h">834</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">835</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">836</td><td colspan="6"></td></tr><tr><td class="h">837</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L837">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $twiki-&gt;inContext( &#39;authenticated&#39; )) {</td></tr>
<tr><td class="h">838</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L838">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{then} || 1;</td></tr>
<tr><td class="h">839</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">840</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L840">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{else} || 0;</td></tr>
<tr><td class="h">841</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">842</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">843</td><td colspan="6"></td></tr><tr><td class="h">844</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _CANLOGIN {</td></tr>
<tr><td class="h">845</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L845">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $twiki, $params ) = @_;</td></tr>
<tr><td class="h">846</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">847</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">848</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L848">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $twiki-&gt;inContext( &#39;can_login&#39; )) {</td></tr>
<tr><td class="h">849</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L849">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{then} || 1;</td></tr>
<tr><td class="h">850</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">851</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L851">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $params-&gt;{else} || 0;</td></tr>
<tr><td class="h">852</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">853</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">854</td><td colspan="6"></td></tr><tr><td class="h">855</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _SESSION_VARIABLE {</td></tr>
<tr><td class="h">856</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L856">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $twiki, $params ) = @_;</td></tr>
<tr><td class="h">857</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">858</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">859</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = $params-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">860</td><td colspan="6"></td></tr><tr><td class="h">861</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L861">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L861">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( defined( $params-&gt;{set} ) ) {</td></tr>
<tr><td class="h">862</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;setSessionValue( $name, $params-&gt;{set} );</td></tr>
<tr><td class="h">863</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">864</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif( defined( $params-&gt;{clear} )) {</td></tr>
<tr><td class="h">865</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;clearSessionValue( $name );</td></tr>
<tr><td class="h">866</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">867</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">868</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L868">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;getSessionValue( $name ) || &#39;&#39;;</td></tr>
<tr><td class="h">869</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">870</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">871</td><td colspan="6"></td></tr><tr><td class="h">872</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _LOGINURL {</td></tr>
<tr><td class="h">873</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L873">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $twiki, $params ) = @_;</td></tr>
<tr><td class="h">874</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = $twiki-&gt;{loginManager};</td></tr>
<tr><td class="h">875</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa(&#39;TWiki::Client&#39;)) if DEBUG;</td></tr>
<tr><td class="h">876</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;loginUrl();</td></tr>
<tr><td class="h">877</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">878</td><td colspan="6"></td></tr><tr><td class="h">879</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _dispLogon {</td></tr>
<tr><td class="h">880</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L880">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">881</td><td colspan="6"></td></tr><tr><td class="h">882</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L882">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $this-&gt;{_cgisession};</td></tr>
<tr><td class="h">883</td><td colspan="6"></td></tr><tr><td class="h">884</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = $this-&gt;{twiki};</td></tr>
<tr><td class="h">885</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = $twiki-&gt;{topicName};</td></tr>
<tr><td class="h">886</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $web = $twiki-&gt;{webName};</td></tr>
<tr><td class="h">887</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sessionId = $this-&gt;{_cgisession}-&gt;id();</td></tr>
<tr><td class="h">888</td><td colspan="6"></td></tr><tr><td class="h">889</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $urlToUse = $this-&gt;loginUrl();</td></tr>
<tr><td class="h">890</td><td colspan="6"></td></tr><tr><td class="h">891</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L891">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--condition.html#L891">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $this-&gt;{_haveCookie} || !$TWiki::cfg{Sessions}{IDsInURLs} ) {</td></tr>
<tr><td class="h">892</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$urlToUse = $this-&gt;_rewriteURL( $urlToUse );</td></tr>
<tr><td class="h">893</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">894</td><td colspan="6"></td></tr><tr><td class="h">895</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = $twiki-&gt;{templates}-&gt;expandTemplate(&#39;LOG_IN&#39;);</td></tr>
<tr><td class="h">896</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return CGI::a({ class =&gt; &#39;twikiAlert&#39;, href =&gt; $urlToUse }, $text );</td></tr>
<tr><td class="h">897</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">898</td><td colspan="6"></td></tr><tr><td class="h">899</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _skinSelect {</td></tr>
<tr><td class="h">900</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Client-pm--subroutine.html#L900">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">901</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $twiki = $this-&gt;{twiki};</td></tr>
<tr><td class="h">902</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $skins = $twiki-&gt;{prefs}-&gt;getPreferencesValue(&#39;SKINS&#39;);</td></tr>
<tr><td class="h">903</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $skin = $twiki-&gt;getSkin();</td></tr>
<tr><td class="h">904</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @skins = split( /,/, $skins );</td></tr>
<tr><td class="h">905</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unshift( @skins, &#39;default&#39; );</td></tr>
<tr><td class="h">906</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $options = &#39;&#39;;</td></tr>
<tr><td class="h">907</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $askin ( @skins ) {</td></tr>
<tr><td class="h">908</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$askin =~ s/\s//go;</td></tr>
<tr><td class="h">909</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Client-pm--branch.html#L909">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $askin eq $skin ) {</td></tr>
<tr><td class="h">910</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options .= CGI::option(</td></tr>
<tr><td class="h">911</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ selected =&gt; &#39;selected&#39;, name =&gt; $askin }, $askin );</td></tr>
<tr><td class="h">912</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">913</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options .= CGI::option( { name =&gt; $askin }, $askin );</td></tr>
<tr><td class="h">914</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">915</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">916</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return CGI::Select( { name =&gt; &#39;stickskin&#39; }, $options );</td></tr>
<tr><td class="h">917</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">918</td><td colspan="6"></td></tr><tr><td class="h">919</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
