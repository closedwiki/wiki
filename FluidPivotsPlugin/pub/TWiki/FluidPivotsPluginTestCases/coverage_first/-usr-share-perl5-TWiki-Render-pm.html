<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Render.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Render.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">40.5%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Module of TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 2001-2007 Peter Thoeny, peter@thoeny.org</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and TWiki Contributors. All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">19</td><td colspan="6"></td></tr><tr><td class="h">20 - 26</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TWiki::Render

This module provides most of the actual HTML rendering code in TWiki.

=cut</pre></td></tr>
<tr><td class="h">27</td><td colspan="6"></td></tr><tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Render;</td></tr>
<tr><td class="h">29</td><td colspan="6"></td></tr><tr><td class="h">30</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L30">1</a></div></td><td><div>5</div><div>3</div><div>4</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">31</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L31">1</a></div></td><td><div>6</div><div>2</div><div>7</div></td><td class="s">use Assert;</td></tr>
<tr><td class="h">32</td><td colspan="6"></td></tr><tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Use -any to force creation of functions for unrecognised tags, like del and ins,</td></tr>
<tr><td class="h">34</td><td></td><td></td><td></td><td></td><td></td><td class="s"># on earlier releases of CGI.pm (pre 2.79)</td></tr>
<tr><td class="h">35</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L35">1</a></div></td><td><div>11</div><div>3</div><div>8</div></td><td class="s">use CGI qw( -any );</td></tr>
<tr><td class="h">36</td><td colspan="6"></td></tr><tr><td class="h">37</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L37">1</a></div></td><td><div>9</div><div>3</div><div>3</div></td><td class="s">use TWiki::Plurals ();</td></tr>
<tr><td class="h">38</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L38">1</a></div></td><td><div>7</div><div>3</div><div>3</div></td><td class="s">use TWiki::Attach ();</td></tr>
<tr><td class="h">39</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L39">1</a></div></td><td><div>6</div><div>3</div><div>3</div></td><td class="s">use TWiki::Attrs ();</td></tr>
<tr><td class="h">40</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L40">1</a></div></td><td><div>6</div><div>3</div><div>3</div></td><td class="s">use TWiki::Time ();</td></tr>
<tr><td class="h">41</td><td colspan="6"></td></tr><tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Used to generate unique placeholders for when we lift blocks out of the</td></tr>
<tr><td class="h">43</td><td></td><td></td><td></td><td></td><td></td><td class="s"># text during rendering. </td></tr>
<tr><td class="h">44</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L44">1</a></div></td><td><div>5</div><div>3</div><div>5</div></td><td class="s">use vars qw( $placeholderMarker );</td></tr>
<tr><td class="h">45</td><td></td><td></td><td></td><td></td><td></td><td class="s">$placeholderMarker = 0;</td></tr>
<tr><td class="h">46</td><td colspan="6"></td></tr><tr><td class="h">47</td><td></td><td></td><td></td><td></td><td></td><td class="s"># defaults for trunctation of summary text</td></tr>
<tr><td class="h">48</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $TMLTRUNC = 162;</td></tr>
<tr><td class="h">49</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $PLAINTRUNC = 70;</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $MINTRUNC = 16;</td></tr>
<tr><td class="h">51</td><td></td><td></td><td></td><td></td><td></td><td class="s"># max number of lines in a summary (best to keep it even)</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $SUMMARYLINES = 6;</td></tr>
<tr><td class="h">53</td><td colspan="6"></td></tr><tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td class="s"># limiting lookbehind and lookahead for wikiwords and emphasis</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td class="s"># use like \b</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td class="s">#SMELL: they really limit the number of places emphasis can happen.</td></tr>
<tr><td class="h">57</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $STARTWW = qr/^|(?&lt;=[\s\(])/m;</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td class="s">my $ENDWW = qr/$|(?=[\s,.;:!?)])/m;</td></tr>
<tr><td class="h">59</td><td colspan="6"></td></tr><tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td class="s">BEGIN {</td></tr>
<tr><td class="h">61</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Do a dynamic &#39;use locale&#39; for this module</td></tr>
<tr><td class="h">62</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L62">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L62">1</a></div></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseLocale} ) {</td></tr>
<tr><td class="h">63</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require locale;</td></tr>
<tr><td class="h">64</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import locale();</td></tr>
<tr><td class="h">65</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">66</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">67</td><td colspan="6"></td></tr><tr><td class="h">68 - 76</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ClassMethod new ($session)

Creates a new renderer with initial state from preference values
(NEWTOPICBGCOLOR, NEWTOPICFONTCOLOR NEWTOPICLINKSYMBOL
 LINKTOOLTIPINFO)

=cut</pre></td></tr>
<tr><td class="h">77</td><td colspan="6"></td></tr><tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">79</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L79">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $session ) = @_;</td></tr>
<tr><td class="h">80</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = bless( {}, $class );</td></tr>
<tr><td class="h">81</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($session-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">82</td><td colspan="6"></td></tr><tr><td class="h">83</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session} = $session;</td></tr>
<tr><td class="h">84</td><td colspan="6"></td></tr><tr><td class="h">85</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L85">50</a></div></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{NEWTOPICBGCOLOR} =</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$session-&gt;{prefs}-&gt;getPreferencesValue(&#39;NEWTOPICBGCOLOR&#39;)</td></tr>
<tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| &#39;#FFFFCE&#39;;</td></tr>
<tr><td class="h">88</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L88">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{NEWTOPICFONTCOLOR} =</td></tr>
<tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$session-&gt;{prefs}-&gt;getPreferencesValue(&#39;NEWTOPICFONTCOLOR&#39;)</td></tr>
<tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| &#39;#0000FF&#39;;</td></tr>
<tr><td class="h">91</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L91">33</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{NEWLINKSYMBOL} =</td></tr>
<tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$session-&gt;{prefs}-&gt;getPreferencesValue(&#39;NEWTOPICLINKSYMBOL&#39;)</td></tr>
<tr><td class="h">93</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| CGI::sup(&#39;?&#39;);</td></tr>
<tr><td class="h">94</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L94">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{NEWLINKFORMAT} =</td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$session-&gt;{prefs}-&gt;getPreferencesValue(&#39;NEWLINKFORMAT&#39;)</td></tr>
<tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| &#39;&lt;span class=&quot;twikiNewLink&quot;&gt;$text&lt;a href=&quot;%SCRIPTURLPATH{&quot;edit&quot;}%/$web/$topic?topicparent=%WEB%.%TOPIC%&quot; &#39;.</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;rel=&quot;nofollow&quot; title=&quot;%MAKETEXT{&quot;Create this topic&quot;}%&quot;&gt;&#39;.</td></tr>
<tr><td class="h">98</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;$linksymbol&lt;/a&gt;&lt;/span&gt;&#39;;</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# tooltip init</td></tr>
<tr><td class="h">100</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L100">50</a></div></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{LINKTOOLTIPINFO} =</td></tr>
<tr><td class="h">101</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$session-&gt;{prefs}-&gt;getPreferencesValue(&#39;LINKTOOLTIPINFO&#39;)</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| &#39;&#39;;</td></tr>
<tr><td class="h">103</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L103">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{LINKTOOLTIPINFO} = &#39;$username - $date - r$rev: $summary&#39;</td></tr>
<tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( TWiki::isTrue( $this-&gt;{LINKTOOLTIPINFO} ));</td></tr>
<tr><td class="h">105</td><td colspan="6"></td></tr><tr><td class="h">106</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this;</td></tr>
<tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">108</td><td colspan="6"></td></tr><tr><td class="h">109 - 115</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod renderParent($web, $topic, $meta, $params) -&gt; $text

Render parent meta-data

=cut</pre></td></tr>
<tr><td class="h">116</td><td colspan="6"></td></tr><tr><td class="h">117</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub renderParent {</td></tr>
<tr><td class="h">118</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L118">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic, $meta, $ah ) = @_;</td></tr>
<tr><td class="h">119</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L119">50</a></div></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dontRecurse = $ah-&gt;{dontrecurse} || 0;</td></tr>
<tr><td class="h">120</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L120">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $noWebHome =   $ah-&gt;{nowebhome} || 0;</td></tr>
<tr><td class="h">121</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L121">50</a></div></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $prefix =      $ah-&gt;{prefix} || &#39;&#39;;</td></tr>
<tr><td class="h">122</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L122">50</a></div></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $suffix =      $ah-&gt;{suffix} || &#39;&#39;;</td></tr>
<tr><td class="h">123</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L123">50</a></div></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $usesep =      $ah-&gt;{separator} || &#39; &amp;gt; &#39;;</td></tr>
<tr><td class="h">124</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L124">50</a></div></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format =      $ah-&gt;{format} || &#39;[[$web.$topic][$topic]]&#39;;</td></tr>
<tr><td class="h">125</td><td colspan="6"></td></tr><tr><td class="h">126</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L126">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L126">33</a></div></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $web &amp;&amp; $topic;</td></tr>
<tr><td class="h">127</td><td colspan="6"></td></tr><tr><td class="h">128</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %visited;</td></tr>
<tr><td class="h">129</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$visited{$web.&#39;.&#39;.$topic} = 1;</td></tr>
<tr><td class="h">130</td><td colspan="6"></td></tr><tr><td class="h">131</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pWeb = $web;</td></tr>
<tr><td class="h">132</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pTopic;</td></tr>
<tr><td class="h">133</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &#39;&#39;;</td></tr>
<tr><td class="h">134</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $parentMeta = $meta-&gt;get( &#39;TOPICPARENT&#39; );</td></tr>
<tr><td class="h">135</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $parent;</td></tr>
<tr><td class="h">136</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">137</td><td colspan="6"></td></tr><tr><td class="h">138</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L138">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$parent = $parentMeta-&gt;{name} if $parentMeta;</td></tr>
<tr><td class="h">139</td><td colspan="6"></td></tr><tr><td class="h">140</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @stack;</td></tr>
<tr><td class="h">141</td><td colspan="6"></td></tr><tr><td class="h">142</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while( $parent ) {</td></tr>
<tr><td class="h">143</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $pWeb, $pTopic ) =</td></tr>
<tr><td class="h">144</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;normalizeWebTopicName( $pWeb, $parent );</td></tr>
<tr><td class="h">145</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = $pWeb.&#39;.&#39;.$pTopic;</td></tr>
<tr><td class="h">146</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L146">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L146">20</a></div></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last if( $noWebHome &amp;&amp;</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $pTopic eq $TWiki::cfg{HomeTopicName} ) ||</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$visited{$parent} );</td></tr>
<tr><td class="h">149</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$visited{$parent} = 1;</td></tr>
<tr><td class="h">150</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $format;</td></tr>
<tr><td class="h">151</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$web/$pWeb/g;</td></tr>
<tr><td class="h">152</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$topic/$pTopic/g;</td></tr>
<tr><td class="h">153</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unshift( @stack, $text );</td></tr>
<tr><td class="h">154</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L154">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last if $dontRecurse;</td></tr>
<tr><td class="h">155</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$parent = $store-&gt;getTopicParent( $pWeb, $pTopic );</td></tr>
<tr><td class="h">156</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">157</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = join( $usesep, @stack );</td></tr>
<tr><td class="h">158</td><td colspan="6"></td></tr><tr><td class="h">159</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L159">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $text) {</td></tr>
<tr><td class="h">160</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L160">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $prefix.$text if ( $prefix );</td></tr>
<tr><td class="h">161</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L161">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text .= $suffix if ( $suffix );</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">163</td><td colspan="6"></td></tr><tr><td class="h">164</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">166</td><td colspan="6"></td></tr><tr><td class="h">167 - 173</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod renderMoved($web, $topic, $meta, $params) -&gt; $text

Render moved meta-data

=cut</pre></td></tr>
<tr><td class="h">174</td><td colspan="6"></td></tr><tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub renderMoved {</td></tr>
<tr><td class="h">176</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L176">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic, $meta, $params ) = @_;</td></tr>
<tr><td class="h">177</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &#39;&#39;;</td></tr>
<tr><td class="h">178</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $moved = $meta-&gt;get( &#39;TOPICMOVED&#39; );</td></tr>
<tr><td class="h">179</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web =~ s#\.#/#go;</td></tr>
<tr><td class="h">180</td><td colspan="6"></td></tr><tr><td class="h">181</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L181">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $moved ) {</td></tr>
<tr><td class="h">182</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $fromWeb, $fromTopic ) =</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;normalizeWebTopicName( $web, $moved-&gt;{from} );</td></tr>
<tr><td class="h">184</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $toWeb, $toTopic ) =</td></tr>
<tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;normalizeWebTopicName( $web, $moved-&gt;{to} );</td></tr>
<tr><td class="h">186</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $by = $moved-&gt;{by};</td></tr>
<tr><td class="h">187</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $u = $this-&gt;{session}-&gt;{users}-&gt;findUser( $by );</td></tr>
<tr><td class="h">188</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L188">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$by = $u-&gt;webDotWikiName() if $u;</td></tr>
<tr><td class="h">189</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $date = TWiki::Time::formatTime( $moved-&gt;{date}, &#39;&#39;, &#39;gmtime&#39; );</td></tr>
<tr><td class="h">190</td><td colspan="6"></td></tr><tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Only allow put back if current web and topic match stored information</td></tr>
<tr><td class="h">192</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $putBack = &#39;&#39;;</td></tr>
<tr><td class="h">193</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L193">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L193">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $web eq $toWeb &amp;&amp; $topic eq $toTopic ) {</td></tr>
<tr><td class="h">194</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$putBack  = &#39; - &#39;.</td></tr>
<tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CGI::a( { title=&gt;($this-&gt;{session}-&gt;{i18n}-&gt;maketext(</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;Click to move topic back to previous location, with option to change references.&#39;)</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;href =&gt; $this-&gt;{session}-&gt;getScriptUrl</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( 0, &#39;rename&#39;, $web, $topic,</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newweb =&gt; $fromWeb,</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newtopic =&gt; $fromTopic,</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;confirm =&gt; &#39;on&#39;,</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nonwikiword =&gt; &#39;checked&#39; ),</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rel =&gt; &#39;nofollow&#39;</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;{i18n}-&gt;maketext(&#39;put it back&#39;) );</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">208</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = CGI::i(</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;{i18n}-&gt;maketext(&quot;[_1] moved from [_2] on [_3] by [_4]&quot;,</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;nop&gt;$toWeb.&lt;nop&gt;$toTopic&quot;,</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;nop&gt;$fromWeb.&lt;nop&gt;$fromTopic&quot;,</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$date,</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$by)) . $putBack;</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">215</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">217</td><td colspan="6"></td></tr><tr><td class="h">218 - 224</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod renderFormField($web, $topic, $meta, $params) -&gt; $text

Render meta-data for a single formfield

=cut</pre></td></tr>
<tr><td class="h">225</td><td colspan="6"></td></tr><tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub renderFormField {</td></tr>
<tr><td class="h">227</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L227">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $meta, $attrs ) = @_;</td></tr>
<tr><td class="h">228</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &#39;&#39;;</td></tr>
<tr><td class="h">229</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = $attrs-&gt;{name};</td></tr>
<tr><td class="h">230</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L230">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = renderFormFieldArg( $meta, $name ) if( $name );</td></tr>
<tr><td class="h">231</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $newline = $attrs-&gt;{newline};</td></tr>
<tr><td class="h">232</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L232">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( defined $newline ) {</td></tr>
<tr><td class="h">233</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newline =~ s/\$n/\n/gos;</td></tr>
<tr><td class="h">234</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">235</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newline = &quot;&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">236</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">237</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L237">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $bar = $attrs-&gt;{bar} || &quot;&amp;#124;&quot;;</td></tr>
<tr><td class="h">238</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# change any new line character sequences to &lt;br /&gt;</td></tr>
<tr><td class="h">239</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\r?\n/$newline/gos;</td></tr>
<tr><td class="h">240</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# escape &quot;|&quot; to HTML entity</td></tr>
<tr><td class="h">241</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\|/$bar/gos;</td></tr>
<tr><td class="h">242</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">243</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">244</td><td colspan="6"></td></tr><tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Add a list item, of the given type and indent depth. The list item may</td></tr>
<tr><td class="h">246</td><td></td><td></td><td></td><td></td><td></td><td class="s"># cause the opening or closing of lists currently being handled.</td></tr>
<tr><td class="h">247</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _addListItem {</td></tr>
<tr><td class="h">248</td><td><div class="c3">869</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L248">869</a></div></td><td><div>3438</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $result, $theType, $theElement, $theIndent, $theOlType ) = @_;</td></tr>
<tr><td class="h">249</td><td colspan="6"></td></tr><tr><td class="h">250</td><td><div class="c3">869</div></td><td></td><td></td><td></td><td><div>2451</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theIndent =~ s/   /\t/g;</td></tr>
<tr><td class="h">251</td><td><div class="c3">869</div></td><td></td><td></td><td></td><td><div>2467</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $depth = length( $theIndent );</td></tr>
<tr><td class="h">252</td><td colspan="6"></td></tr><tr><td class="h">253</td><td><div class="c3">869</div><div class="c3">869</div></td><td></td><td></td><td></td><td><div>2221</div><div>3112</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $size = scalar( @{$this-&gt;{LIST}} );</td></tr>
<tr><td class="h">254</td><td colspan="6"></td></tr><tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The whitespaces either side of the tags are required for the</td></tr>
<tr><td class="h">256</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# emphasis REs to work.</td></tr>
<tr><td class="h">257</td><td><div class="c3">869</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L257">100</a></div></td><td></td><td></td><td><div>3358</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $size &lt; $depth ) {</td></tr>
<tr><td class="h">258</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $firstTime = 1;</td></tr>
<tr><td class="h">259</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>55</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while( $size &lt; $depth ) {</td></tr>
<tr><td class="h">260</td><td><div class="c3">12</div><div class="c3">12</div></td><td></td><td></td><td></td><td><div>32</div><div>68</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @{$this-&gt;{LIST}}, { type=&gt;$theType, element=&gt;$theElement } );</td></tr>
<tr><td class="h">261</td><td><div class="c3">12</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L261">50</a></div></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$result .= &#39; &lt;&#39;.$theElement.&quot;&gt;\n&quot; unless( $firstTime );</td></tr>
<tr><td class="h">262</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$result .= &#39; &lt;&#39;.$theType.&quot;&gt;\n&quot;;</td></tr>
<tr><td class="h">263</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>34</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$firstTime = 0;</td></tr>
<tr><td class="h">264</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$size++;</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">267</td><td><div class="c3">857</div></td><td></td><td></td><td></td><td><div>4034</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while( $size &gt; $depth ) {</td></tr>
<tr><td class="h">268</td><td><div class="c3">12</div><div class="c3">12</div></td><td></td><td></td><td></td><td><div>31</div><div>46</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tags = pop( @{$this-&gt;{LIST}} );</td></tr>
<tr><td class="h">269</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$result .= &quot;\n&lt;/&quot;.$tags-&gt;{element}.&#39;&gt;&lt;/&#39;.$tags-&gt;{type}.&#39;&gt; &#39;;</td></tr>
<tr><td class="h">270</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$size--;</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">272</td><td><div class="c3">857</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L272">100</a></div></td><td></td><td></td><td><div>3055</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $size ) {</td></tr>
<tr><td class="h">273</td><td><div class="c3">49</div></td><td></td><td></td><td></td><td><div>299</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$result .= &quot;\n&lt;/&quot;.$this-&gt;{LIST}-&gt;[$size-1]-&gt;{element}.&#39;&gt; &#39;;</td></tr>
<tr><td class="h">274</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">275</td><td><div class="c3">808</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L275">100</a></div></td><td></td><td></td><td><div>4640</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$result .= &quot;\n&quot; if $$result;</td></tr>
<tr><td class="h">276</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">278</td><td colspan="6"></td></tr><tr><td class="h">279</td><td><div class="c3">869</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L279">100</a></div></td><td></td><td></td><td><div>4042</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $size ) {</td></tr>
<tr><td class="h">280</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>239</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $oldt = $this-&gt;{LIST}-&gt;[$size-1];</td></tr>
<tr><td class="h">281</td><td><div class="c3">61</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L281">50</a></div></td><td></td><td></td><td><div>339</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $oldt-&gt;{type} ne $theType ) {</td></tr>
<tr><td class="h">282</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$result .= &#39; &lt;/&#39;.$oldt-&gt;{type}.&#39;&gt;&lt;&#39;.$theType.&quot;&gt;\n&quot;;</td></tr>
<tr><td class="h">283</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pop( @{$this-&gt;{LIST}} );</td></tr>
<tr><td class="h">284</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @{$this-&gt;{LIST}}, { type=&gt;$theType, element=&gt;$theElement } );</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">288</td><td colspan="6"></td></tr><tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _emitTR {</td></tr>
<tr><td class="h">290</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L290">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $thePre, $theRow, $insideTABLE ) = @_;</td></tr>
<tr><td class="h">291</td><td colspan="6"></td></tr><tr><td class="h">292</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L292">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $insideTABLE ) {</td></tr>
<tr><td class="h">293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$thePre .=</td></tr>
<tr><td class="h">294</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CGI::start_table({ class=&gt;&#39;twikiTable&#39;,</td></tr>
<tr><td class="h">295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border =&gt; 1,</td></tr>
<tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cellspacing =&gt; 0,</td></tr>
<tr><td class="h">297</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cellpadding =&gt; 0 });</td></tr>
<tr><td class="h">298</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">299</td><td colspan="6"></td></tr><tr><td class="h">300</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theRow =~ s/\t/   /g;  # change tabs to space</td></tr>
<tr><td class="h">301</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theRow =~ s/\s*$//;    # remove trailing spaces</td></tr>
<tr><td class="h">302</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theRow =~ s/(\|\|+)/$TWiki::TranslationToken.length($1).&#39;|&#39;/ge;  # calc COLSPAN</td></tr>
<tr><td class="h">303</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cells = &#39;&#39;;</td></tr>
<tr><td class="h">304</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach( split( /\|/, $theRow ) ) {</td></tr>
<tr><td class="h">305</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @attr;</td></tr>
<tr><td class="h">306</td><td colspan="6"></td></tr><tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Avoid matching single columns</td></tr>
<tr><td class="h">308</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L308">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( s/$TWiki::TranslationToken([0-9]+)//o ) {</td></tr>
<tr><td class="h">309</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @attr, colspan =&gt; $1 );</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">311</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s/^\s+$/ &amp;nbsp; /;</td></tr>
<tr><td class="h">312</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $l1, $l2 ) = ( 0, 0 );</td></tr>
<tr><td class="h">313</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L313">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( /^(\s*).*?(\s*)$/ ) {</td></tr>
<tr><td class="h">314</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$l1 = length( $1 );</td></tr>
<tr><td class="h">315</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$l2 = length( $2 );</td></tr>
<tr><td class="h">316</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">317</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L317">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $l1 &gt;= 2 ) {</td></tr>
<tr><td class="h">318</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L318">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $l2 &lt;= 1 ) {</td></tr>
<tr><td class="h">319</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @attr, align =&gt; &#39;right&#39; );</td></tr>
<tr><td class="h">320</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">321</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @attr, align =&gt; &#39;center&#39; );</td></tr>
<tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">324</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L324">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( /^\s*\*(.*)\*\s*$/ ) {</td></tr>
<tr><td class="h">325</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @attr, bgcolor =&gt; &#39;#99CCCC&#39; );</td></tr>
<tr><td class="h">326</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cells .= CGI::th( { @attr }, CGI::strong( &quot; $1 &quot; )).&quot;\n&quot;;</td></tr>
<tr><td class="h">327</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">328</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cells .= CGI::td( { @attr }, &quot; $_ &quot; ).&quot;\n&quot;;</td></tr>
<tr><td class="h">329</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">331</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $thePre.CGI::Tr( $cells );</td></tr>
<tr><td class="h">332</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">333</td><td colspan="6"></td></tr><tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _fixedFontText {</td></tr>
<tr><td class="h">335</td><td><div class="c3">42</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L335">42</a></div></td><td><div>189</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $theText, $theDoBold ) = @_;</td></tr>
<tr><td class="h">336</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# preserve white space, so replace it by &#39;&amp;nbsp; &#39; patterns</td></tr>
<tr><td class="h">337</td><td><div class="c3">42</div></td><td></td><td></td><td></td><td><div>140</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theText =~ s/\t/   /g;</td></tr>
<tr><td class="h">338</td><td><div class="c3">42</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>266</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theText =~ s|((?:[\s]{2})+)([^\s])|&#39;&amp;nbsp; &#39; x (length($1) / 2) . $2|eg;</td></tr>
<tr><td class="h">339</td><td><div class="c3">42</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L339">50</a></div></td><td></td><td></td><td><div>183</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theText = CGI::b( $theText ) if $theDoBold;</td></tr>
<tr><td class="h">340</td><td><div class="c3">42</div></td><td></td><td></td><td></td><td><div>166</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return CGI::code( $theText );</td></tr>
<tr><td class="h">341</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">342</td><td colspan="6"></td></tr><tr><td class="h">343</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Build an HTML &amp;lt;Hn&gt; element with suitable anchor for linking from %&lt;nop&gt;TOC%</td></tr>
<tr><td class="h">344</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _makeAnchorHeading {</td></tr>
<tr><td class="h">345</td><td><div class="c3">60</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L345">60</a></div></td><td><div>265</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $theLevel ) = @_;</td></tr>
<tr><td class="h">346</td><td colspan="6"></td></tr><tr><td class="h">347</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>471</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^\s*(.*?)\s*$/$1/;</td></tr>
<tr><td class="h">348</td><td colspan="6"></td></tr><tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# - Build &#39;&lt;nop&gt;&lt;h1&gt;&lt;a name=&#39;atext&#39;&gt;&lt;/a&gt; heading &lt;/h1&gt;&#39; markup</td></tr>
<tr><td class="h">350</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# - Initial &#39;&lt;nop&gt;&#39; is needed to prevent subsequent matches.</td></tr>
<tr><td class="h">351</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# - filter out $TWiki::regex{headerPatternNoTOC} ( &#39;!!&#39; and &#39;%NOTOC%&#39; )</td></tr>
<tr><td class="h">352</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>226</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $anchorName =       $this-&gt;makeAnchorName( $text, 0 );</td></tr>
<tr><td class="h">353</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>228</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $compatAnchorName = $this-&gt;makeAnchorName( $text, 1 );</td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# filter &#39;!!&#39;, &#39;%NOTOC%&#39;</td></tr>
<tr><td class="h">355</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>305</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$TWiki::regex{headerPatternNoTOC}//o;</td></tr>
<tr><td class="h">356</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>210</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $html = &#39;&lt;nop&gt;&lt;h&#39;.$theLevel.&#39;&gt;&#39;;</td></tr>
<tr><td class="h">357</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>317</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$html .= CGI::a( { name=&gt;$anchorName }, &#39;&#39; );</td></tr>
<tr><td class="h">358</td><td><div class="c3">60</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L358">100</a></div></td><td></td><td></td><td><div>411</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$html .= CGI::a( { name=&gt;$compatAnchorName }, &#39;&#39;)</td></tr>
<tr><td class="h">359</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $compatAnchorName ne $anchorName );</td></tr>
<tr><td class="h">360</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>253</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$html .= &#39; &#39;.$text.&#39; &lt;/h&#39;.$theLevel.&#39;&gt;&#39;;</td></tr>
<tr><td class="h">361</td><td colspan="6"></td></tr><tr><td class="h">362</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>883</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $html;</td></tr>
<tr><td class="h">363</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">364</td><td colspan="6"></td></tr><tr><td class="h">365 - 374</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod makeAnchorName($anchorName, $compatibilityMode) -&gt; $anchorName

   * =$anchorName= -
   * =$compatibilityMode= -

Build a valid HTML anchor name

=cut</pre></td></tr>
<tr><td class="h">375</td><td colspan="6"></td></tr><tr><td class="h">376</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub makeAnchorName {</td></tr>
<tr><td class="h">377</td><td><div class="c3">143</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L377">143</a></div></td><td><div>526</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $anchorName, $compatibilityMode ) = @_;</td></tr>
<tr><td class="h">378</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>319</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">379</td><td colspan="6"></td></tr><tr><td class="h">380</td><td><div class="c3">143</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L380">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L380">67</a></div></td><td></td><td><div>1382</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( !$compatibilityMode &amp;&amp;</td></tr>
<tr><td class="h">381</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ /^$TWiki::regex{anchorRegex}$/ ) {</td></tr>
<tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# accept, already valid -- just remove leading #</td></tr>
<tr><td class="h">383</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return substr($anchorName, 1);</td></tr>
<tr><td class="h">384</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">385</td><td colspan="6"></td></tr><tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# strip out potential links so they don&#39;t get rendered.</td></tr>
<tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remove double bracket link</td></tr>
<tr><td class="h">388</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>386</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/\s*\[\s*\[.*?\]\s*\[(.*?)\]\s*\]/$1/go;</td></tr>
<tr><td class="h">389</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>366</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/\s*\[\s*\[\s*(.*?)\s*\]\s*\]/$1/go;</td></tr>
<tr><td class="h">390</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# add an _ before bare WikiWords</td></tr>
<tr><td class="h">391</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>774</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/($TWiki::regex{wikiWordRegex})/_$1/go;</td></tr>
<tr><td class="h">392</td><td colspan="6"></td></tr><tr><td class="h">393</td><td><div class="c3">143</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L393">100</a></div></td><td></td><td></td><td><div>574</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $compatibilityMode ) {</td></tr>
<tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# remove leading/trailing underscores first, allowing them to be</td></tr>
<tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# reintroduced</td></tr>
<tr><td class="h">396</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>191</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/^[\s\#\_]*//;</td></tr>
<tr><td class="h">397</td><td><div class="c3">60</div></td><td></td><td></td><td></td><td><div>265</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/[\s\_]*$//;</td></tr>
<tr><td class="h">398</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">399</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>400</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/&lt;[\/]?\w[^&gt;]*&gt;//gi;    # remove HTML tags</td></tr>
<tr><td class="h">400</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>381</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/\&amp;\#?[a-zA-Z0-9]*;//g; # remove HTML entities</td></tr>
<tr><td class="h">401</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>380</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/\&amp;//g;                 # remove &amp;</td></tr>
<tr><td class="h">402</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# filter TOC excludes if not at beginning</td></tr>
<tr><td class="h">403</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>967</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/^(.+?)\s*$TWiki::regex{headerPatternNoTOC}.*/$1/o;</td></tr>
<tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# filter &#39;!!&#39;, &#39;%NOTOC%&#39;</td></tr>
<tr><td class="h">405</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>601</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/$TWiki::regex{headerPatternNoTOC}//o;</td></tr>
<tr><td class="h">406</td><td colspan="6"></td></tr><tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# For most common alphabetic-only character encodings (i.e. iso-8859-*),</td></tr>
<tr><td class="h">408</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remove non-alpha characters </td></tr>
<tr><td class="h">409</td><td><div class="c3">143</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L409">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L409">33</a></div></td><td></td><td><div>1713</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( defined($TWiki::cfg{Site}{CharSet}) &amp;&amp;</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{Site}{CharSet} =~ /^iso-?8859-?/i ) {</td></tr>
<tr><td class="h">411</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>879</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/[^$TWiki::regex{mixedAlphaNum}]+/_/g;</td></tr>
<tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">413</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>407</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/__+/_/g;           # remove excessive &#39;_&#39; chars</td></tr>
<tr><td class="h">414</td><td><div class="c3">143</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L414">100</a></div></td><td></td><td></td><td><div>602</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( !$compatibilityMode ) {</td></tr>
<tr><td class="h">415</td><td><div class="c3">83</div></td><td></td><td></td><td></td><td><div>278</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/^[\s\#\_]*//;  # no leading space nor &#39;#&#39;, &#39;_&#39;</td></tr>
<tr><td class="h">416</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">417</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>357</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/^(.{32})(.*)$/$1/; # limit to 32 chars - FIXME: Use Unicode chars before truncate</td></tr>
<tr><td class="h">418</td><td><div class="c3">143</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L418">100</a></div></td><td></td><td></td><td><div>584</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( !$compatibilityMode ) {</td></tr>
<tr><td class="h">419</td><td><div class="c3">83</div></td><td></td><td></td><td></td><td><div>350</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchorName =~ s/[\s\_]*$//;    # no trailing space, nor &#39;_&#39;</td></tr>
<tr><td class="h">420</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">421</td><td colspan="6"></td></tr><tr><td class="h">422</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# No need to encode 8-bit characters in anchor due to UTF-8 URL support</td></tr>
<tr><td class="h">423</td><td colspan="6"></td></tr><tr><td class="h">424</td><td><div class="c3">143</div></td><td></td><td></td><td></td><td><div>574</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $anchorName;</td></tr>
<tr><td class="h">425</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">426</td><td colspan="6"></td></tr><tr><td class="h">427</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns =title=&#39;...&#39;= tooltip info in case LINKTOOLTIPINFO perferences variable is set. </td></tr>
<tr><td class="h">428</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Warning: Slower performance if enabled.</td></tr>
<tr><td class="h">429</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _linkToolTipInfo {</td></tr>
<tr><td class="h">430</td><td><div class="c3">35</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L430">35</a></div></td><td><div>127</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $theWeb, $theTopic ) = @_;</td></tr>
<tr><td class="h">431</td><td><div class="c3">35</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L431">50</a></div></td><td></td><td></td><td><div>163</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless( $this-&gt;{LINKTOOLTIPINFO} );</td></tr>
<tr><td class="h">432</td><td><div class="c3">35</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L432">50</a></div></td><td></td><td></td><td><div>308</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; if( $this-&gt;{LINKTOOLTIPINFO} =~ /^off$/i );</td></tr>
<tr><td class="h">433</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L433">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless( $this-&gt;{session}-&gt;inContext( &#39;view&#39; ));</td></tr>
<tr><td class="h">434</td><td colspan="6"></td></tr><tr><td class="h">435</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: This is slow, it can be improved by caching topic rev info and summary</td></tr>
<tr><td class="h">436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">437</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: we ought not to have to fake this. Topic object model, please!!</td></tr>
<tr><td class="h">438</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = new TWiki::Meta( $this-&gt;{session}, $theWeb, $theTopic );</td></tr>
<tr><td class="h">439</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $date, $user, $rev ) = $meta-&gt;getRevisionInfo();</td></tr>
<tr><td class="h">440</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = $this-&gt;{LINKTOOLTIPINFO};</td></tr>
<tr><td class="h">441</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$web/&lt;nop&gt;$theWeb/g;</td></tr>
<tr><td class="h">442</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$topic/&lt;nop&gt;$theTopic/g;</td></tr>
<tr><td class="h">443</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$rev/1.$rev/g;</td></tr>
<tr><td class="h">444</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$date/TWiki::Time::formatTime( $date )/ge;</td></tr>
<tr><td class="h">445</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$username/$user-&gt;login()/ge;       # &#39;jsmith&#39;</td></tr>
<tr><td class="h">446</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$wikiname/$user-&gt;wikiName()/ge;  # &#39;JohnSmith&#39;</td></tr>
<tr><td class="h">447</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$wikiusername/$user-&gt;webDotWikiName()/ge; # &#39;Main.JohnSmith&#39;</td></tr>
<tr><td class="h">448</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L448">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $text =~ /\$summary/ ) {</td></tr>
<tr><td class="h">449</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $summary = $store-&gt;readTopicRaw</td></tr>
<tr><td class="h">450</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( undef, $theWeb, $theTopic, undef );</td></tr>
<tr><td class="h">451</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$summary = $this-&gt;makeTopicSummary( $summary, $theTopic, $theWeb );</td></tr>
<tr><td class="h">452</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$summary =~ s/[\&quot;\&#39;]//g;       # remove quotes (not allowed in title attribute)</td></tr>
<tr><td class="h">453</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$summary/$summary/g;</td></tr>
<tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">455</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">456</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">457</td><td colspan="6"></td></tr><tr><td class="h">458 - 479</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod internalLink ( $theWeb, $theTopic, $theLinkText, $theAnchor, $doLink, $doKeepWeb ) -&gt; $html

Generate a link. 

Note: Topic names may be spaced out. Spaced out names are converted to &lt;nop&gt;WikWords,
for example, &quot;spaced topic name&quot; points to &quot;SpacedTopicName&quot;.
   * =$theWeb= - the web containing the topic
   * =$theTopic= - the topic to be lunk
   * =$theLinkText= - text to use for the link
   * =$theAnchor= - the link anchor, if any
   * =$doLinkToMissingPages= - boolean: false means suppress link for non-existing pages
   * =$doKeepWeb= - boolean: true to keep web prefix (for non existing Web.TOPIC)

Called by _handleWikiWord and _handleSquareBracketedLink and by Func::internalLink

Calls _renderWikiWord, which in turn will use Plurals.pm to match fold plurals to equivalency with their singular form 

SMELL: why is this available to Func?

=cut</pre></td></tr>
<tr><td class="h">480</td><td colspan="6"></td></tr><tr><td class="h">481</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub internalLink {</td></tr>
<tr><td class="h">482</td><td><div class="c3">37</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L482">37</a></div></td><td><div>175</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $theWeb, $theTopic, $theLinkText, $theAnchor, $doLinkToMissingPages, $doKeepWeb ) = @_;</td></tr>
<tr><td class="h">483</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>90</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL - shouldn&#39;t it be callable by TWiki::Func as well?</td></tr>
<tr><td class="h">485</td><td colspan="6"></td></tr><tr><td class="h">486</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#PN: Webname/Subweb/ -&gt; Webname/Subweb</td></tr>
<tr><td class="h">487</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>107</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theWeb =~ s/\/\Z//o;</td></tr>
<tr><td class="h">488</td><td colspan="6"></td></tr><tr><td class="h">489</td><td><div class="c3">37</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L489">50</a></div></td><td></td><td></td><td><div>163</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if($theLinkText eq $theWeb) {</td></tr>
<tr><td class="h">490</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theLinkText =~ s/\//\./go;</td></tr>
<tr><td class="h">491</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">492</td><td colspan="6"></td></tr><tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#WebHome links to tother webs render as the WebName</td></tr>
<tr><td class="h">494</td><td><div class="c3">37</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L494">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L494">33</a></div></td><td></td><td><div>235</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (($theLinkText eq $TWiki::cfg{HomeTopicName}) &amp;&amp; </td></tr>
<tr><td class="h">495</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($theWeb ne $this-&gt;{session}-&gt;{webName})) {</td></tr>
<tr><td class="h">496</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theLinkText = $theWeb;</td></tr>
<tr><td class="h">497</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">498</td><td colspan="6"></td></tr><tr><td class="h">499</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get rid of leading/trailing spaces in topic name</td></tr>
<tr><td class="h">500</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>132</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theTopic =~ s/^\s*//o;</td></tr>
<tr><td class="h">501</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>175</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theTopic =~ s/\s*$//o;</td></tr>
<tr><td class="h">502</td><td colspan="6"></td></tr><tr><td class="h">503</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Turn spaced-out names into WikiWords - upper case first letter of</td></tr>
<tr><td class="h">504</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# whole link, and first of each word. TODO: Try to turn this off,</td></tr>
<tr><td class="h">505</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# avoiding spaces being stripped elsewhere</td></tr>
<tr><td class="h">506</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>285</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theTopic =~ s/^(.)/\U$1/;</td></tr>
<tr><td class="h">507</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>179</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theTopic =~ s/\s([$TWiki::regex{mixedAlphaNum}])/\U$1/go;</td></tr>
<tr><td class="h">508</td><td colspan="6"></td></tr><tr><td class="h">509</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Add &lt;nop&gt; before WikiWord inside link text to prevent double links</td></tr>
<tr><td class="h">510</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>238</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theLinkText =~ s/(?&lt;=[\s\(])([$TWiki::regex{upperAlpha}])/&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">511</td><td colspan="6"></td></tr><tr><td class="h">512</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>155</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return _renderWikiWord($this, $theWeb, $theTopic, $theLinkText, $theAnchor, $doLinkToMissingPages, $doKeepWeb);</td></tr>
<tr><td class="h">513</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">514</td><td colspan="6"></td></tr><tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td class="s"># TODO: this should be overridable by plugins.</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _renderWikiWord {</td></tr>
<tr><td class="h">517</td><td><div class="c3">37</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L517">37</a></div></td><td><div>212</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $theWeb, $theTopic, $theLinkText, $theAnchor, $doLinkToMissingPages, $doKeepWeb) = @_;</td></tr>
<tr><td class="h">518</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>142</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">519</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>163</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topicExists = $store-&gt;topicExists( $theWeb, $theTopic );</td></tr>
<tr><td class="h">520</td><td colspan="6"></td></tr><tr><td class="h">521</td><td><div class="c3">37</div></td><td></td><td></td><td></td><td><div>109</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $singular = &#39;&#39;;</td></tr>
<tr><td class="h">522</td><td><div class="c3">37</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L522">100</a></div></td><td></td><td></td><td><div>156</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $topicExists ) {</td></tr>
<tr><td class="h">523</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# topic not found - try to singularise</td></tr>
<tr><td class="h">524</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$singular = TWiki::Plurals::singularForm($theWeb, $theTopic);</td></tr>
<tr><td class="h">525</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L525">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $singular ) {</td></tr>
<tr><td class="h">526</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$topicExists = $store-&gt;topicExists( $theWeb, $singular );</td></tr>
<tr><td class="h">527</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L527">50</a></div></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theTopic = $singular if $topicExists;</td></tr>
<tr><td class="h">528</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">529</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">530</td><td colspan="6"></td></tr><tr><td class="h">531</td><td><div class="c3">37</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L531">100</a></div></td><td></td><td></td><td><div>148</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $topicExists) {</td></tr>
<tr><td class="h">532</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>136</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _renderExistingWikiWord($this, $theWeb,</td></tr>
<tr><td class="h">533</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theTopic, $theLinkText, $theAnchor);</td></tr>
<tr><td class="h">534</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">535</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L535">50</a></div></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $doLinkToMissingPages ) {</td></tr>
<tr><td class="h">536</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# CDot: disabled until SuggestSingularNotPlural is resolved</td></tr>
<tr><td class="h">537</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if ($singular &amp;&amp; $singular ne $theTopic) {</td></tr>
<tr><td class="h">538</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#     #unshift( @topics, $singular);</td></tr>
<tr><td class="h">539</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# }</td></tr>
<tr><td class="h">540</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return _renderNonExistingWikiWord($this, $theWeb, $theTopic,</td></tr>
<tr><td class="h">541</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$theLinkText);</td></tr>
<tr><td class="h">542</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">543</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L543">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $doKeepWeb ) {</td></tr>
<tr><td class="h">544</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $theWeb.&#39;.&#39;.$theLinkText;</td></tr>
<tr><td class="h">545</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">546</td><td colspan="6"></td></tr><tr><td class="h">547</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $theLinkText;</td></tr>
<tr><td class="h">548</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">549</td><td colspan="6"></td></tr><tr><td class="h">550</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _renderExistingWikiWord {</td></tr>
<tr><td class="h">551</td><td><div class="c3">35</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L551">35</a></div></td><td><div>140</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $web, $topic, $text, $anchor) = @_;</td></tr>
<tr><td class="h">552</td><td colspan="6"></td></tr><tr><td class="h">553</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $currentWebHome = &#39;&#39;;</td></tr>
<tr><td class="h">554</td><td><div class="c3">35</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L554">100</a></div></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L554">100</a></div></td><td></td><td><div>391</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$currentWebHome = &#39;twikiCurrentWebHomeLink &#39; if (($web eq $this-&gt;{session}-&gt;{webName}) &amp;&amp;</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($topic eq $TWiki::cfg{HomeTopicName} ));</td></tr>
<tr><td class="h">556</td><td colspan="6"></td></tr><tr><td class="h">557</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>91</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $currentTopic = &#39;&#39;;</td></tr>
<tr><td class="h">558</td><td><div class="c3">35</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L558">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L558">67</a></div></td><td></td><td><div>358</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$currentTopic = &#39;twikiCurrentTopicLink &#39; if (($web eq $this-&gt;{session}-&gt;{webName}) &amp;&amp;</td></tr>
<tr><td class="h">559</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($topic eq $this-&gt;{session}-&gt;{topicName}));</td></tr>
<tr><td class="h">560</td><td colspan="6"></td></tr><tr><td class="h">561</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>92</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @attrs;</td></tr>
<tr><td class="h">562</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>188</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $href = $this-&gt;{session}-&gt;getScriptUrl( 0, &#39;view&#39;, $web, $topic );</td></tr>
<tr><td class="h">563</td><td><div class="c3">35</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L563">50</a></div></td><td></td><td></td><td><div>132</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $anchor ) {</td></tr>
<tr><td class="h">564</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor = $this-&gt;makeAnchorName( $anchor );</td></tr>
<tr><td class="h">565</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @attrs, class =&gt; $currentTopic.$currentWebHome.&#39;twikiAnchorLink&#39;, href =&gt; $href.&#39;#&#39;.$anchor );</td></tr>
<tr><td class="h">566</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">567</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>168</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @attrs, class =&gt; $currentTopic.$currentWebHome.&#39;twikiLink&#39;, href =&gt; $href );</td></tr>
<tr><td class="h">568</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">569</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>152</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tooltip = $this-&gt;_linkToolTipInfo( $web, $topic );</td></tr>
<tr><td class="h">570</td><td><div class="c3">35</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L570">50</a></div></td><td></td><td></td><td><div>151</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push( @attrs, title =&gt; $tooltip ) if( $tooltip );</td></tr>
<tr><td class="h">571</td><td colspan="6"></td></tr><tr><td class="h">572</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>206</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $link = CGI::a( { @attrs }, $text );</td></tr>
<tr><td class="h">573</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# When we pass the tooltip text to CGI::a it may contain</td></tr>
<tr><td class="h">574</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &lt;nop&gt;s, and CGI::a will convert the &lt; to &amp;lt;. This is a</td></tr>
<tr><td class="h">575</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# basic problem with &lt;nop&gt;.</td></tr>
<tr><td class="h">576</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>138</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/&amp;lt;nop&amp;gt;/&lt;nop&gt;/g;</td></tr>
<tr><td class="h">577</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td><div>46933</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $link;</td></tr>
<tr><td class="h">578</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">579</td><td colspan="6"></td></tr><tr><td class="h">580</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _renderNonExistingWikiWord {</td></tr>
<tr><td class="h">581</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L581">2</a></div></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($this, $theWeb, $theTopic, $theLinkText) = @_;</td></tr>
<tr><td class="h">582</td><td colspan="6"></td></tr><tr><td class="h">583</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ans = $this-&gt;{NEWLINKFORMAT};</td></tr>
<tr><td class="h">584</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ans =~ s/\$web/$theWeb/g;</td></tr>
<tr><td class="h">585</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ans =~ s/\$topic/$theTopic/g;</td></tr>
<tr><td class="h">586</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ans =~ s/\$text/$theLinkText/g;</td></tr>
<tr><td class="h">587</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ans =~ s/\$linksymbol/$this-&gt;{NEWLINKSYMBOL}/g;</td></tr>
<tr><td class="h">588</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ans = $this-&gt;{session}-&gt;handleCommonTags($ans, </td></tr>
<tr><td class="h">589</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}{webName}, $this-&gt;{session}{topicName});</td></tr>
<tr><td class="h">590</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>159</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ans;</td></tr>
<tr><td class="h">591</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">592</td><td colspan="6"></td></tr><tr><td class="h">593</td><td></td><td></td><td></td><td></td><td></td><td class="s"># _handleWikiWord is called by the TWiki Render routine when it sees a </td></tr>
<tr><td class="h">594</td><td></td><td></td><td></td><td></td><td></td><td class="s"># wiki word that needs linking.</td></tr>
<tr><td class="h">595</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Handle the various link constructions. e.g.:</td></tr>
<tr><td class="h">596</td><td></td><td></td><td></td><td></td><td></td><td class="s"># WikiWord</td></tr>
<tr><td class="h">597</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Web.WikiWord</td></tr>
<tr><td class="h">598</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Web.WikiWord#anchor</td></tr>
<tr><td class="h">599</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">600</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This routine adds missing parameters before passing off to internallink</td></tr>
<tr><td class="h">601</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _handleWikiWord {</td></tr>
<tr><td class="h">602</td><td><div class="c3">19</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L602">19</a></div></td><td><div>112</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $theWeb, $web, $topic, $anchor ) = @_;</td></tr>
<tr><td class="h">603</td><td colspan="6"></td></tr><tr><td class="h">604</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $linkIfAbsent = 1;</td></tr>
<tr><td class="h">605</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $keepWeb = 0;</td></tr>
<tr><td class="h">606</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>50</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text;</td></tr>
<tr><td class="h">607</td><td colspan="6"></td></tr><tr><td class="h">608</td><td><div class="c3">19</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L608">100</a></div></td><td></td><td></td><td><div>91</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$web = $theWeb unless (defined($web));</td></tr>
<tr><td class="h">609</td><td><div class="c3">19</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L609">50</a></div></td><td></td><td></td><td><div>75</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( defined( $anchor )) {</td></tr>
<tr><td class="h">610</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(($anchor =~ m/\#.*/)) if DEBUG; # must include a hash.</td></tr>
<tr><td class="h">611</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">612</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor = &#39;&#39; ;</td></tr>
<tr><td class="h">613</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">614</td><td colspan="6"></td></tr><tr><td class="h">615</td><td><div class="c3">19</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L615">50</a></div></td><td></td><td></td><td><div>70</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( defined( $anchor ) ) {</td></tr>
<tr><td class="h">616</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &#39;Web.TopicName#anchor&#39; or &#39;Web.ABBREV#anchor&#39; link</td></tr>
<tr><td class="h">617</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $topic.$anchor;</td></tr>
<tr><td class="h">618</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">619</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor = &#39;&#39;;</td></tr>
<tr><td class="h">620</td><td colspan="6"></td></tr><tr><td class="h">621</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &#39;Web.TopicName&#39; or &#39;Web.ABBREV&#39; link:</td></tr>
<tr><td class="h">622</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L622">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L622">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $topic eq $TWiki::cfg{HomeTopicName} &amp;&amp;</td></tr>
<tr><td class="h">623</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$web ne $this-&gt;{session}-&gt;{webName} ) {</td></tr>
<tr><td class="h">624</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $web;</td></tr>
<tr><td class="h">625</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">626</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $topic;</td></tr>
<tr><td class="h">627</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">628</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">629</td><td colspan="6"></td></tr><tr><td class="h">630</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Allow spacing out, etc</td></tr>
<tr><td class="h">631</td><td><div class="c3">19</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L631">33</a></div></td><td></td><td><div>125</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{session}-&gt;{plugins}-&gt;renderWikiWordHandler( $text ) || $text;</td></tr>
<tr><td class="h">632</td><td colspan="6"></td></tr><tr><td class="h">633</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# =$doKeepWeb= boolean: true to keep web prefix (for non existing Web.TOPIC)</td></tr>
<tr><td class="h">634</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# (Necessary to leave &quot;web part&quot; of ABR.ABR.ABR intact if topic not found)</td></tr>
<tr><td class="h">635</td><td><div class="c3">19</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L635">33</a></div></td><td></td><td><div>181</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$keepWeb = ( $topic =~ /^$TWiki::regex{abbrevRegex}$/o &amp;&amp; $web ne $this-&gt;{session}-&gt;{webName} );</td></tr>
<tr><td class="h">636</td><td colspan="6"></td></tr><tr><td class="h">637</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# false means suppress link for non-existing pages</td></tr>
<tr><td class="h">638</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>105</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$linkIfAbsent = ( $topic !~ /^$TWiki::regex{abbrevRegex}$/o );</td></tr>
<tr><td class="h">639</td><td colspan="6"></td></tr><tr><td class="h">640</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL - it seems $linkIfAbsent, $keepWeb are always inverses of each</td></tr>
<tr><td class="h">641</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# other</td></tr>
<tr><td class="h">642</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TODO: check the spec of doKeepWeb vs $doLinkToMissingPages</td></tr>
<tr><td class="h">643</td><td colspan="6"></td></tr><tr><td class="h">644</td><td><div class="c3">19</div></td><td></td><td></td><td></td><td><div>83</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;internalLink( $web, $topic, $text, $anchor,</td></tr>
<tr><td class="h">645</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$linkIfAbsent, $keepWeb );</td></tr>
<tr><td class="h">646</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">647</td><td colspan="6"></td></tr><tr><td class="h">648</td><td colspan="6"></td></tr><tr><td class="h">649</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Handle SquareBracketed links mentioned on page $theWeb.$theTopic</td></tr>
<tr><td class="h">650</td><td></td><td></td><td></td><td></td><td></td><td class="s"># format: [[$text]]</td></tr>
<tr><td class="h">651</td><td></td><td></td><td></td><td></td><td></td><td class="s"># format: [[$link][$text]]</td></tr>
<tr><td class="h">652</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _handleSquareBracketedLink {</td></tr>
<tr><td class="h">653</td><td><div class="c3">18</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L653">18</a></div></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic, $link, $text ) = @_;</td></tr>
<tr><td class="h">654</td><td colspan="6"></td></tr><tr><td class="h">655</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Strip leading/trailing spaces</td></tr>
<tr><td class="h">656</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/^\s+//;</td></tr>
<tr><td class="h">657</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>57</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/\s+$//;</td></tr>
<tr><td class="h">658</td><td colspan="6"></td></tr><tr><td class="h">659</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Explicit external [[$link][$text]]-style can be handled directly</td></tr>
<tr><td class="h">660</td><td><div class="c3">18</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L660">50</a></div></td><td></td><td></td><td><div>141</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $link =~ m!^($TWiki::regex{linkProtocolPattern}\:|/)! ) {</td></tr>
<tr><td class="h">661</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L661">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (defined $text) {</td></tr>
<tr><td class="h">662</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# [[][]] style - protect text:</td></tr>
<tr><td class="h">663</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prevent automatic WikiWord or CAPWORD linking in explicit links</td></tr>
<tr><td class="h">664</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(?&lt;=[\s\(])($TWiki::regex{wikiWordRegex}|[$TWiki::regex{upperAlpha}])/&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">665</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">666</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">667</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# [[]] style - take care for legacy:</td></tr>
<tr><td class="h">668</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Prepare special case of &#39;[[URL#anchor display text]]&#39; link</td></tr>
<tr><td class="h">669</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L669">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $link =~ /^(\S+)\s+(.*)$/ ) {</td></tr>
<tr><td class="h">670</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &#39;[[URL#anchor display text]]&#39; link:</td></tr>
<tr><td class="h">671</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$link = $1;</td></tr>
<tr><td class="h">672</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $2;</td></tr>
<tr><td class="h">673</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(?&lt;=[\s\(])($TWiki::regex{wikiWordRegex}|[$TWiki::regex{upperAlpha}])/&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">674</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">675</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">676</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_externalLink( $link, $text );</td></tr>
<tr><td class="h">677</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">678</td><td colspan="6"></td></tr><tr><td class="h">679</td><td><div class="c3">18</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L679">50</a></div></td><td></td><td><div>71</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text ||= $link;</td></tr>
<tr><td class="h">680</td><td colspan="6"></td></tr><tr><td class="h">681</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Extract &#39;#anchor&#39;</td></tr>
<tr><td class="h">682</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# $link =~ s/(\#[a-zA-Z_0-9\-]*$)//;</td></tr>
<tr><td class="h">683</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $anchor = &#39;&#39;;</td></tr>
<tr><td class="h">684</td><td><div class="c3">18</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L684">50</a></div></td><td></td><td></td><td><div>126</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $link =~ s/($TWiki::regex{anchorRegex}$)// ) {</td></tr>
<tr><td class="h">685</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$anchor = $1;</td></tr>
<tr><td class="h">686</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">687</td><td colspan="6"></td></tr><tr><td class="h">688</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# filter out &amp;any; entities (legacy)</td></tr>
<tr><td class="h">689</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>54</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/\&amp;[a-z]+\;//gi;</td></tr>
<tr><td class="h">690</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# filter out &amp;#123; entities (legacy)</td></tr>
<tr><td class="h">691</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>52</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/\&amp;\#[0-9]+\;//g;</td></tr>
<tr><td class="h">692</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Filter junk</td></tr>
<tr><td class="h">693</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>87</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/$TWiki::cfg{NameFilter}+/ /g;</td></tr>
<tr><td class="h">694</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Capitalise first word</td></tr>
<tr><td class="h">695</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>110</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/^(.)/\U$1/;</td></tr>
<tr><td class="h">696</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Collapse spaces and capitalise following letter</td></tr>
<tr><td class="h">697</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>88</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/\s([$TWiki::regex{mixedAlphaNum}])/\U$1/go;</td></tr>
<tr><td class="h">698</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Get rid of remaining spaces, i.e. spaces in front of -&#39;s and (&#39;s</td></tr>
<tr><td class="h">699</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$link =~ s/\s//go;</td></tr>
<tr><td class="h">700</td><td colspan="6"></td></tr><tr><td class="h">701</td><td><div class="c3">18</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L701">50</a></div></td><td></td><td></td><td><div>80</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$topic = $link if( $link );</td></tr>
<tr><td class="h">702</td><td colspan="6"></td></tr><tr><td class="h">703</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Topic defaults to the current topic</td></tr>
<tr><td class="h">704</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>94</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;($web, $topic) = $this-&gt;{session}-&gt;normalizeWebTopicName( $web, $topic );</td></tr>
<tr><td class="h">705</td><td colspan="6"></td></tr><tr><td class="h">706</td><td><div class="c3">18</div></td><td></td><td></td><td></td><td><div>86</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;internalLink( $web, $topic, $text, $anchor, 1, undef );</td></tr>
<tr><td class="h">707</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">708</td><td colspan="6"></td></tr><tr><td class="h">709</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Handle an external link typed directly into text. If it&#39;s an image</td></tr>
<tr><td class="h">710</td><td></td><td></td><td></td><td></td><td></td><td class="s"># (as indicated by the file type), and no text is specified, then use</td></tr>
<tr><td class="h">711</td><td></td><td></td><td></td><td></td><td></td><td class="s"># an img tag, otherwise generate a link.</td></tr>
<tr><td class="h">712</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _externalLink {</td></tr>
<tr><td class="h">713</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L713">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $url, $text ) = @_;</td></tr>
<tr><td class="h">714</td><td colspan="6"></td></tr><tr><td class="h">715</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L715">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L715">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url =~ /\.(gif|jpg|jpeg|png)$/i &amp;&amp; !$text) {</td></tr>
<tr><td class="h">716</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filename = $url;</td></tr>
<tr><td class="h">717</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filename =~ s@.*/([^/]*)@$1@go;</td></tr>
<tr><td class="h">718</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return CGI::img( { src =&gt; $url, alt =&gt; $filename } );</td></tr>
<tr><td class="h">719</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">720</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $opt = &#39;&#39;;</td></tr>
<tr><td class="h">721</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L721">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $url =~ /^mailto:/i ) {</td></tr>
<tr><td class="h">722</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L722">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{AntiSpam}{EmailPadding} ) {</td></tr>
<tr><td class="h">723</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url =~  s/(\@[\w\_\-\+]+)(\.)/$1$TWiki::cfg{AntiSpam}{EmailPadding}$2/;</td></tr>
<tr><td class="h">724</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L724">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($text) {</td></tr>
<tr><td class="h">725</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(\@[\w\_\-\+]+)(\.)/$1$TWiki::cfg{AntiSpam}{EmailPadding}$2/;</td></tr>
<tr><td class="h">726</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">727</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">728</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L728">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{AntiSpam}{HideUserDetails} ) {</td></tr>
<tr><td class="h">729</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Much harder obfuscation scheme. For link text we only encode &#39;@&#39;</td></tr>
<tr><td class="h">730</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# See also Item2928 and Item3430 before touching this</td></tr>
<tr><td class="h">731</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url =~ s/(\W)/&#39;&amp;#&#39;.ord($1).&#39;;&#39;/ge;</td></tr>
<tr><td class="h">732</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L732">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($text) {</td></tr>
<tr><td class="h">733</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\@/&#39;&amp;#&#39;.ord(&#39;@&#39;).&#39;;&#39;/ge;</td></tr>
<tr><td class="h">734</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">735</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">736</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">737</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opt = &#39; target=&quot;_top&quot;&#39;;</td></tr>
<tr><td class="h">738</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">739</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L739">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text ||= $url;</td></tr>
<tr><td class="h">740</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: Can&#39;t use CGI::a here, because it encodes ampersands in</td></tr>
<tr><td class="h">741</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# the link, and those have already been encoded once in the</td></tr>
<tr><td class="h">742</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# rendering loop (they are identified as &quot;stand-alone&quot;). One</td></tr>
<tr><td class="h">743</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# encoding works; two is too many. None would be better for everyone!</td></tr>
<tr><td class="h">744</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;a href=&quot;&#39;.$url.&#39;&quot;&#39;.$opt.&#39;&gt;&#39;.$text.&#39;&lt;/a&gt;&#39;;</td></tr>
<tr><td class="h">745</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">746</td><td colspan="6"></td></tr><tr><td class="h">747</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Generate a &quot;mailTo&quot; link</td></tr>
<tr><td class="h">748</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _mailLink {</td></tr>
<tr><td class="h">749</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L749">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text ) = @_;</td></tr>
<tr><td class="h">750</td><td colspan="6"></td></tr><tr><td class="h">751</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = $text;</td></tr>
<tr><td class="h">752</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L752">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$url = &#39;mailto:&#39;.$url unless $url =~ /^mailto:/i;</td></tr>
<tr><td class="h">753</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;_externalLink( $url, $text );</td></tr>
<tr><td class="h">754</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">755</td><td colspan="6"></td></tr><tr><td class="h">756 - 762</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod renderFORMFIELD ( %params, $topic, $web ) -&gt; $html

Returns the fully rendered expansion of a %FORMFIELD{}% tag.

=cut</pre></td></tr>
<tr><td class="h">763</td><td colspan="6"></td></tr><tr><td class="h">764</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub renderFORMFIELD {</td></tr>
<tr><td class="h">765</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L765">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $params, $topic, $web ) = @_;</td></tr>
<tr><td class="h">766</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">767</td><td colspan="6"></td></tr><tr><td class="h">768</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $formField = $params-&gt;{_DEFAULT};</td></tr>
<tr><td class="h">769</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $formTopic = $params-&gt;{topic};</td></tr>
<tr><td class="h">770</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $altText   = $params-&gt;{alttext};</td></tr>
<tr><td class="h">771</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $default   = $params-&gt;{default};</td></tr>
<tr><td class="h">772</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rev       = $params-&gt;{rev};</td></tr>
<tr><td class="h">773</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format    = $params-&gt;{&#39;format&#39;};</td></tr>
<tr><td class="h">774</td><td colspan="6"></td></tr><tr><td class="h">775</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L775">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ( $format ) {</td></tr>
<tr><td class="h">776</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if null format explicitly set, return empty</td></tr>
<tr><td class="h">777</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: it&#39;s not clear what this does; the implication</td></tr>
<tr><td class="h">778</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is that it does something that violates TWiki tag syntax,</td></tr>
<tr><td class="h">779</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# so I&#39;ve had to comment it out....</td></tr>
<tr><td class="h">780</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# return &#39;&#39; if ( $args =~ m/format\s*=/o);</td></tr>
<tr><td class="h">781</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Otherwise default to value</td></tr>
<tr><td class="h">782</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$format = &#39;$value&#39;;</td></tr>
<tr><td class="h">783</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">784</td><td colspan="6"></td></tr><tr><td class="h">785</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $formWeb;</td></tr>
<tr><td class="h">786</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L786">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $formTopic ) {</td></tr>
<tr><td class="h">787</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L787">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($topic =~ /^([^.]+)\.([^.]+)/o) {</td></tr>
<tr><td class="h">788</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $formWeb, $topic ) = ( $1, $2 );</td></tr>
<tr><td class="h">789</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">790</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: Undocumented feature, &#39;web&#39; parameter</td></tr>
<tr><td class="h">791</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formWeb = $params-&gt;{web};</td></tr>
<tr><td class="h">792</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">793</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L793">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formWeb = $web unless $formWeb;</td></tr>
<tr><td class="h">794</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">795</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formWeb = $web;</td></tr>
<tr><td class="h">796</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$formTopic = $topic;</td></tr>
<tr><td class="h">797</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">798</td><td colspan="6"></td></tr><tr><td class="h">799</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $meta = $this-&gt;{ffCache}{$formWeb.&#39;.&#39;.$formTopic};</td></tr>
<tr><td class="h">800</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">801</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L801">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ( $meta ) {</td></tr>
<tr><td class="h">802</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $dummyText;</td></tr>
<tr><td class="h">803</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $meta, $dummyText ) =</td></tr>
<tr><td class="h">804</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$store-&gt;readTopic( $this-&gt;{session}-&gt;{user}, $formWeb, $formTopic, $rev );</td></tr>
<tr><td class="h">805</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{ffCache}{$formWeb.&#39;.&#39;.$formTopic} = $meta;</td></tr>
<tr><td class="h">806</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">807</td><td colspan="6"></td></tr><tr><td class="h">808</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $text = &#39;&#39;;</td></tr>
<tr><td class="h">809</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $found = 0;</td></tr>
<tr><td class="h">810</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $title = &#39;&#39;;</td></tr>
<tr><td class="h">811</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L811">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $meta ) {</td></tr>
<tr><td class="h">812</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @fields = $meta-&gt;find( &#39;FIELD&#39; );</td></tr>
<tr><td class="h">813</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $field ( @fields ) {</td></tr>
<tr><td class="h">814</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $name = $field-&gt;{name};</td></tr>
<tr><td class="h">815</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L815">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$title = $field-&gt;{title} || $name;</td></tr>
<tr><td class="h">816</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L816">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L816">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $title eq $formField || $name eq $formField ) {</td></tr>
<tr><td class="h">817</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$found = 1;</td></tr>
<tr><td class="h">818</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $value = $field-&gt;{value};</td></tr>
<tr><td class="h">819</td><td colspan="6"></td></tr><tr><td class="h">820</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L820">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L820">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (length $value) {</td></tr>
<tr><td class="h">821</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $format;   </td></tr>
<tr><td class="h">822</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$value/$value/go;</td></tr>
<tr><td class="h">823</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( defined $default ) {</td></tr>
<tr><td class="h">824</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $default;</td></tr>
<tr><td class="h">825</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">826</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last; #one hit suffices</td></tr>
<tr><td class="h">827</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">828</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">829</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">830</td><td colspan="6"></td></tr><tr><td class="h">831</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L831">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ( $found ) {</td></tr>
<tr><td class="h">832</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L832">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $altText || &#39;&#39;;</td></tr>
<tr><td class="h">833</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">834</td><td colspan="6"></td></tr><tr><td class="h">835</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\$title/$title/go;</td></tr>
<tr><td class="h">836</td><td colspan="6"></td></tr><tr><td class="h">837</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">838</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">839</td><td colspan="6"></td></tr><tr><td class="h">840 - 846</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod getRenderedVersion ( $text, $theWeb, $theTopic ) -&gt; $html

The main rendering function.

=cut</pre></td></tr>
<tr><td class="h">847</td><td colspan="6"></td></tr><tr><td class="h">848</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getRenderedVersion {</td></tr>
<tr><td class="h">849</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L849">3</a></div></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $theWeb, $theTopic ) = @_;</td></tr>
<tr><td class="h">850</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">851</td><td colspan="6"></td></tr><tr><td class="h">852</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L852">50</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless $text;  # nothing to do</td></tr>
<tr><td class="h">853</td><td colspan="6"></td></tr><tr><td class="h">854</td><td><div class="c3">3</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L854">50</a></div></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theTopic ||= $this-&gt;{session}-&gt;{topicName};</td></tr>
<tr><td class="h">855</td><td><div class="c3">3</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L855">50</a></div></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theWeb ||= $this-&gt;{session}-&gt;{webName};</td></tr>
<tr><td class="h">856</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $session = $this-&gt;{session};</td></tr>
<tr><td class="h">857</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $plugins = $session-&gt;{plugins};</td></tr>
<tr><td class="h">858</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $prefs = $session-&gt;{prefs};</td></tr>
<tr><td class="h">859</td><td colspan="6"></td></tr><tr><td class="h">860</td><td><div class="c3">3</div><div class="c3">3</div></td><td></td><td></td><td></td><td><div>10</div><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@{$this-&gt;{LIST}} = ();</td></tr>
<tr><td class="h">861</td><td colspan="6"></td></tr><tr><td class="h">862</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Initial cleanup</td></tr>
<tr><td class="h">863</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>54</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\r//g;</td></tr>
<tr><td class="h">864</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# whitespace before &lt;! tag (if it is the first thing) is illegal</td></tr>
<tr><td class="h">865</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^\s+(&lt;![a-z])/$1/i;</td></tr>
<tr><td class="h">866</td><td colspan="6"></td></tr><tr><td class="h">867</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# clutch to enforce correct rendering at end of doc</td></tr>
<tr><td class="h">868</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>38</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\n?$/\n&lt;nop&gt;\n/s;</td></tr>
<tr><td class="h">869</td><td colspan="6"></td></tr><tr><td class="h">870</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Maps of placeholders to tag parameters and text</td></tr>
<tr><td class="h">871</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $removed = {};</td></tr>
<tr><td class="h">872</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $removedComments = {};</td></tr>
<tr><td class="h">873</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $removedScript = {};</td></tr>
<tr><td class="h">874</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $removedHead = {};</td></tr>
<tr><td class="h">875</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $removedVerbatim = {};</td></tr>
<tr><td class="h">876</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $removedLiterals = {};</td></tr>
<tr><td class="h">877</td><td colspan="6"></td></tr><tr><td class="h">878</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# verbatim before literal - see Item3431</td></tr>
<tr><td class="h">879</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutBlocks( $text, &#39;verbatim&#39;, $removedVerbatim );</td></tr>
<tr><td class="h">880</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutBlocks( $text, &#39;literal&#39;, $removedLiterals );</td></tr>
<tr><td class="h">881</td><td colspan="6"></td></tr><tr><td class="h">882</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>40</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutProtected( $text, qr/&lt;\?([^?]*)\?&gt;/s,</td></tr>
<tr><td class="h">883</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removedComments );</td></tr>
<tr><td class="h">884</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>27</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutProtected( $text, qr/&lt;!DOCTYPE([^&lt;&gt;]*)&gt;?/mi,</td></tr>
<tr><td class="h">885</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removedComments );</td></tr>
<tr><td class="h">886</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutProtected( $text, qr/&lt;head.*?&lt;\/head&gt;/si,</td></tr>
<tr><td class="h">887</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removedHead );</td></tr>
<tr><td class="h">888</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutProtected( $text, qr/&lt;script\b.*?&lt;\/script&gt;/si,</td></tr>
<tr><td class="h">889</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removedScript );</td></tr>
<tr><td class="h">890</td><td colspan="6"></td></tr><tr><td class="h">891</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# DEPRECATED startRenderingHandler before PRE removed</td></tr>
<tr><td class="h">892</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: could parse more efficiently if this wasn&#39;t</td></tr>
<tr><td class="h">893</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# here.</td></tr>
<tr><td class="h">894</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$plugins-&gt;startRenderingHandler( $text, $theWeb, $theTopic );</td></tr>
<tr><td class="h">895</td><td colspan="6"></td></tr><tr><td class="h">896</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutBlocks( $text, &#39;pre&#39;, $removed );</td></tr>
<tr><td class="h">897</td><td colspan="6"></td></tr><tr><td class="h">898</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Join lines ending in &#39;\&#39; (don&#39;t need \r?, it was removed already)</td></tr>
<tr><td class="h">899</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\\\n//gs;</td></tr>
<tr><td class="h">900</td><td colspan="6"></td></tr><tr><td class="h">901</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$plugins-&gt;preRenderingHandler( $text, $removed );</td></tr>
<tr><td class="h">902</td><td colspan="6"></td></tr><tr><td class="h">903</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L903">50</a></div></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $plugins-&gt;haveHandlerFor( &#39;insidePREHandler&#39; )) {</td></tr>
<tr><td class="h">904</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $region ( sort keys %$removed ) {</td></tr>
<tr><td class="h">905</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L905">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless ( $region =~ /^pre\d+$/i );</td></tr>
<tr><td class="h">906</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @lines = split( /\r?\n/, $removed-&gt;{$region}{text} );</td></tr>
<tr><td class="h">907</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rt = &#39;&#39;;</td></tr>
<tr><td class="h">908</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ( scalar( @lines )) {</td></tr>
<tr><td class="h">909</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $line = shift( @lines );</td></tr>
<tr><td class="h">910</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$plugins-&gt;insidePREHandler( $line );</td></tr>
<tr><td class="h">911</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L911">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ /\n/ ) {</td></tr>
<tr><td class="h">912</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unshift( @lines, split( /\r?\n/, $line ));</td></tr>
<tr><td class="h">913</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">914</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">915</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rt .= $line.&quot;\n&quot;;</td></tr>
<tr><td class="h">916</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">917</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$removed-&gt;{$region}{text} = $rt;</td></tr>
<tr><td class="h">918</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">919</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">920</td><td colspan="6"></td></tr><tr><td class="h">921</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L921">50</a></div></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $plugins-&gt;haveHandlerFor( &#39;outsidePREHandler&#39; )) {</td></tr>
<tr><td class="h">922</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# DEPRECATED - this is the one call preventing</td></tr>
<tr><td class="h">923</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# effective optimisation of the TWiki ML processing loop,</td></tr>
<tr><td class="h">924</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# as it exposes the concept of a &#39;line loop&#39; to plugins,</td></tr>
<tr><td class="h">925</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# but HTML is not a line-oriented language (though TML is).</td></tr>
<tr><td class="h">926</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# But without it, a lot of processing could be moved</td></tr>
<tr><td class="h">927</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# outside the line loop.</td></tr>
<tr><td class="h">928</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @lines = split( /\r?\n/, $text );</td></tr>
<tr><td class="h">929</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rt = &#39;&#39;;</td></tr>
<tr><td class="h">930</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ( scalar( @lines ) ) {</td></tr>
<tr><td class="h">931</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $line = shift( @lines );</td></tr>
<tr><td class="h">932</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$plugins-&gt;outsidePREHandler( $line );</td></tr>
<tr><td class="h">933</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L933">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ /\n/ ) {</td></tr>
<tr><td class="h">934</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unshift( @lines, split( /\r?\n/, $line ));</td></tr>
<tr><td class="h">935</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">936</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">937</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rt .= $line . &quot;\n&quot;;</td></tr>
<tr><td class="h">938</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">939</td><td colspan="6"></td></tr><tr><td class="h">940</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $rt;</td></tr>
<tr><td class="h">941</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">942</td><td colspan="6"></td></tr><tr><td class="h">943</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Escape rendering: Change &#39; !AnyWord&#39; to &#39; &lt;nop&gt;AnyWord&#39;,</td></tr>
<tr><td class="h">944</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# for final &#39; AnyWord&#39; output</td></tr>
<tr><td class="h">945</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>33794</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$STARTWW\!(?=[\w\*\=])/&lt;nop&gt;/gm;</td></tr>
<tr><td class="h">946</td><td colspan="6"></td></tr><tr><td class="h">947</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Blockquoted email (indented with &#39;&gt; &#39;)</td></tr>
<tr><td class="h">948</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Could be used to provide different colours for different numbers of &#39;&gt;&#39;</td></tr>
<tr><td class="h">949</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>587</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^&gt;(.*?)$/&#39;&amp;gt;&#39;.CGI::cite( $1 ).CGI::br()/gem;</td></tr>
<tr><td class="h">950</td><td colspan="6"></td></tr><tr><td class="h">951</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# locate isolated &lt; and &gt; and translate to entities</td></tr>
<tr><td class="h">952</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Protect isolated &lt;!-- and --&gt;</td></tr>
<tr><td class="h">953</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>814</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;!--/{$TWiki::TranslationToken!--/g;</td></tr>
<tr><td class="h">954</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>847</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/--&gt;/--}$TWiki::TranslationToken/g;</td></tr>
<tr><td class="h">955</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: this next fragment does not handle the case where HTML tags</td></tr>
<tr><td class="h">956</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# are embedded in the values provided to other tags. The only way to</td></tr>
<tr><td class="h">957</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do this correctly is to parse the HTML (bleagh!). So we just assume</td></tr>
<tr><td class="h">958</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# they have been escaped.</td></tr>
<tr><td class="h">959</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>15044</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;(\/?\w+(:\w+)?)&gt;/{$TWiki::TranslationToken$1}$TWiki::TranslationToken/g;</td></tr>
<tr><td class="h">960</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>31395</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;(\w+(:\w+)?(\s+.*?|\/)?)&gt;/{$TWiki::TranslationToken$1}$TWiki::TranslationToken/g;</td></tr>
<tr><td class="h">961</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# XML processing instruction only valid at start of text</td></tr>
<tr><td class="h">962</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>254</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^&lt;(\?\w.*?\?)&gt;/{$TWiki::TranslationToken$1}$TWiki::TranslationToken/g;</td></tr>
<tr><td class="h">963</td><td colspan="6"></td></tr><tr><td class="h">964</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# entitify lone &lt; and &gt;, praying that we haven&#39;t screwed up :-(</td></tr>
<tr><td class="h">965</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>285</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;/&amp;lt\;/g;</td></tr>
<tr><td class="h">966</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>288</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&gt;/&amp;gt\;/g;</td></tr>
<tr><td class="h">967</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>3668</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/{$TWiki::TranslationToken/&lt;/go;</td></tr>
<tr><td class="h">968</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>3396</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/}$TWiki::TranslationToken/&gt;/go;</td></tr>
<tr><td class="h">969</td><td colspan="6"></td></tr><tr><td class="h">970</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# standard URI</td></tr>
<tr><td class="h">971</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>3169</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(^|[-*\s(|])($TWiki::regex{linkProtocolPattern}:([^\s&lt;&gt;&quot;]+[^\s*.,!?;:)&lt;|]))/$1.$this-&gt;_externalLink($2)/geo;</td></tr>
<tr><td class="h">972</td><td colspan="6"></td></tr><tr><td class="h">973</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# other entities</td></tr>
<tr><td class="h">974</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>851</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&amp;(\w+);/$TWiki::TranslationToken$1;/g;      # &quot;&amp;abc;&quot;</td></tr>
<tr><td class="h">975</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>279</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&amp;(#[0-9]+);/$TWiki::TranslationToken$1;/g;  # &quot;&amp;#123;&quot;</td></tr>
<tr><td class="h">976</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>284</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&amp;/&amp;amp;/g;                         # escape standalone &quot;&amp;&quot;</td></tr>
<tr><td class="h">977</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>293</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$TWiki::TranslationToken(#[0-9]+;)/&amp;$1/go;</td></tr>
<tr><td class="h">978</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>849</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$TWiki::TranslationToken(\w+;)/&amp;$1/go;</td></tr>
<tr><td class="h">979</td><td colspan="6"></td></tr><tr><td class="h">980</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Headings</td></tr>
<tr><td class="h">981</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;&lt;h6&gt;...&lt;/h6&gt;&#39; HTML rule</td></tr>
<tr><td class="h">982</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>478</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$TWiki::regex{headerPatternHt}/$this-&gt;_makeAnchorHeading($2,$1)/geo;</td></tr>
<tr><td class="h">983</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;----+++++++&#39; rule</td></tr>
<tr><td class="h">984</td><td><div class="c3">3</div><div class="c3">60</div></td><td></td><td></td><td></td><td><div>73</div><div>304</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$TWiki::regex{headerPatternDa}/$this-&gt;_makeAnchorHeading($2,(length($1)))/geo;</td></tr>
<tr><td class="h">985</td><td colspan="6"></td></tr><tr><td class="h">986</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Horizontal rule</td></tr>
<tr><td class="h">987</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $hr = CGI::hr();</td></tr>
<tr><td class="h">988</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>449</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^---+/$hr/gm;</td></tr>
<tr><td class="h">989</td><td colspan="6"></td></tr><tr><td class="h">990</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Now we really _do_ need a line loop, to process TML</td></tr>
<tr><td class="h">991</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# line-oriented stuff.</td></tr>
<tr><td class="h">992</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $isList = 0;        # True when within a list</td></tr>
<tr><td class="h">993</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $insideTABLE = 0;</td></tr>
<tr><td class="h">994</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $result = &#39;&#39;;</td></tr>
<tr><td class="h">995</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $isFirst = 1;</td></tr>
<tr><td class="h">996</td><td colspan="6"></td></tr><tr><td class="h">997</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>890</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $line ( split( /\r?\n/, $text )) {</td></tr>
<tr><td class="h">998</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Table: | cell | cell |</td></tr>
<tr><td class="h">999</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# allow trailing white space after the last |</td></tr>
<tr><td class="h">1000</td><td><div class="c3">866</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1000">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1000">50</a></div></td><td></td><td></td><td><div>5272</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $line =~ m/^(\s*)\|.*\|\s*$/ ) {</td></tr>
<tr><td class="h">1001</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/^(\s*)\|(.*)/$this-&gt;_emitTR($1,$2,$insideTABLE)/e;</td></tr>
<tr><td class="h">1002</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$insideTABLE = 1;</td></tr>
<tr><td class="h">1003</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $insideTABLE ) {</td></tr>
<tr><td class="h">1004</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= &#39;&lt;/table&gt;&#39;;</td></tr>
<tr><td class="h">1005</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$insideTABLE = 0;</td></tr>
<tr><td class="h">1006</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1007</td><td colspan="6"></td></tr><tr><td class="h">1008</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Lists and paragraphs</td></tr>
<tr><td class="h">1009</td><td><div class="c3">866</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1009">100</a></div><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1009">100</a></div><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1009">100</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1009">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1009">33</a></div></td><td></td><td><div>7816</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ m/^\s*$/ ) {</td></tr>
<tr><td class="h">1010</td><td><div class="c3">46</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1010">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1010">33</a></div></td><td></td><td><div>433</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $insideTABLE || $isFirst ) {</td></tr>
<tr><td class="h">1011</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td><div>143</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = &#39;&lt;p /&gt;&#39;;</td></tr>
<tr><td class="h">1012</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1013</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td><div>123</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 0;</td></tr>
<tr><td class="h">1014</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1015</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $line =~ m/^(\S+?)/ ) {</td></tr>
<tr><td class="h">1016</td><td><div class="c3">226</div></td><td></td><td></td><td></td><td><div>640</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 0;</td></tr>
<tr><td class="h">1017</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1018</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $line =~ m/^(\t|   )+\S/ ) {</td></tr>
<tr><td class="h">1019</td><td><div class="c3">61</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1019">50</a></div><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1019">50</a></div><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1019">50</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1019">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1019">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1019">0</a></div></td><td></td><td><div>563</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $line =~ s/^((\t|   )+)\$\s(([^:]+|:[^\s]+)+?):\s/&lt;dt&gt; $3 &lt;\/dt&gt;&lt;dd&gt; / ) {</td></tr>
<tr><td class="h">1020</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Definition list</td></tr>
<tr><td class="h">1021</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_addListItem( \$result, &#39;dl&#39;, &#39;dd&#39;, $1, &#39;&#39; );</td></tr>
<tr><td class="h">1022</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 1;</td></tr>
<tr><td class="h">1023</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1024</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $line =~ s/^((\t|   )+)(\S+?):\s/&lt;dt&gt; $3&lt;\/dt&gt;&lt;dd&gt; /o ) {</td></tr>
<tr><td class="h">1025</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Definition list</td></tr>
<tr><td class="h">1026</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_addListItem( \$result, &#39;dl&#39;, &#39;dd&#39;, $1, &#39;&#39; );</td></tr>
<tr><td class="h">1027</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 1;</td></tr>
<tr><td class="h">1028</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1029</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $line =~ s/^((\t|   )+)\* /&lt;li&gt; /o ) {</td></tr>
<tr><td class="h">1030</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Unnumbered list</td></tr>
<tr><td class="h">1031</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>262</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_addListItem( \$result, &#39;ul&#39;, &#39;li&#39;, $1, &#39;&#39; );</td></tr>
<tr><td class="h">1032</td><td><div class="c3">61</div></td><td></td><td></td><td></td><td><div>184</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 1;</td></tr>
<tr><td class="h">1033</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1034</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ( $line =~ m/^((\t|   )+)([1AaIi]\.|\d+\.?) ?/ ) {</td></tr>
<tr><td class="h">1035</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Numbered list</td></tr>
<tr><td class="h">1036</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ot = $3;</td></tr>
<tr><td class="h">1037</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ot =~ s/^(.).*/$1/;</td></tr>
<tr><td class="h">1038</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1038">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $ot !~ /^\d$/ ) {</td></tr>
<tr><td class="h">1039</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ot = &#39; type=&quot;&#39;.$ot.&#39;&quot;&#39;;</td></tr>
<tr><td class="h">1040</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1041</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ot = &#39;&#39;;</td></tr>
<tr><td class="h">1042</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1043</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ s/^((\t|   )+)([1AaIi]\.|\d+\.?) ?/&lt;li$ot&gt; /;</td></tr>
<tr><td class="h">1044</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_addListItem( \$result, &#39;ol&#39;, &#39;li&#39;, $1, $ot );</td></tr>
<tr><td class="h">1045</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 1;</td></tr>
<tr><td class="h">1046</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1047</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif( $isList &amp;&amp; $line =~ /^(\t|   )+\s*\S/ ) {</td></tr>
<tr><td class="h">1048</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# indented line extending prior list item</td></tr>
<tr><td class="h">1049</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= $line;</td></tr>
<tr><td class="h">1050</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1051</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1052</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</td></tr>
<tr><td class="h">1053</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 0;</td></tr>
<tr><td class="h">1054</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1055</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif( $isList &amp;&amp; $line =~ /^(\t|   )+\s*\S/ ) {</td></tr>
<tr><td class="h">1056</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# indented line extending prior list item; case where indent</td></tr>
<tr><td class="h">1057</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# starts with is at least 3 spaces or a tab, but may not be a</td></tr>
<tr><td class="h">1058</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# multiple of 3.</td></tr>
<tr><td class="h">1059</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= $line;</td></tr>
<tr><td class="h">1060</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1061</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1062</td><td colspan="6"></td></tr><tr><td class="h">1063</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Finish the list</td></tr>
<tr><td class="h">1064</td><td><div class="c3">866</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1064">100</a></div></td><td></td><td></td><td><div>3747</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $isList ) {</td></tr>
<tr><td class="h">1065</td><td><div class="c3">805</div></td><td></td><td></td><td></td><td><div>3445</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_addListItem( \$result, &#39;&#39;, &#39;&#39;, &#39;&#39; );</td></tr>
<tr><td class="h">1066</td><td><div class="c3">805</div></td><td></td><td></td><td></td><td><div>2478</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isList = 0;</td></tr>
<tr><td class="h">1067</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1068</td><td colspan="6"></td></tr><tr><td class="h">1069</td><td><div class="c3">866</div></td><td></td><td></td><td></td><td><div>3188</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= $line;</td></tr>
<tr><td class="h">1070</td><td><div class="c3">866</div></td><td></td><td></td><td></td><td><div>2998</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$isFirst = 0;</td></tr>
<tr><td class="h">1071</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1072</td><td colspan="6"></td></tr><tr><td class="h">1073</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1073">50</a></div></td><td></td><td></td><td><div>166</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $insideTABLE ) {</td></tr>
<tr><td class="h">1074</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result .= &#39;&lt;/table&gt;&#39;;</td></tr>
<tr><td class="h">1075</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1076</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;_addListItem( \$result, &#39;&#39;, &#39;&#39;, &#39;&#39; );</td></tr>
<tr><td class="h">1077</td><td colspan="6"></td></tr><tr><td class="h">1078</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>280</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text = $result;</td></tr>
<tr><td class="h">1079</td><td colspan="6"></td></tr><tr><td class="h">1080</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# &#39;#WikiName&#39; anchors</td></tr>
<tr><td class="h">1081</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>509</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^(\#)($TWiki::regex{wikiWordRegex})/CGI::a( { name=&gt;$this-&gt;makeAnchorName( $2 )}, &#39;&#39;)/geom;</td></tr>
<tr><td class="h">1082</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>35604</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/${STARTWW}==(\S+?|\S[^\n]*?\S)==$ENDWW/_fixedFontText($1,1)/gem;</td></tr>
<tr><td class="h">1083</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>35192</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/${STARTWW}__(\S+?|\S[^\n]*?\S)__$ENDWW/&lt;strong&gt;&lt;em&gt;$1&lt;\/em&gt;&lt;\/strong&gt;/gm;</td></tr>
<tr><td class="h">1084</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>38738</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/${STARTWW}\*(\S+?|\S[^\n]*?\S)\*$ENDWW/&lt;strong&gt;$1&lt;\/strong&gt;/gm;</td></tr>
<tr><td class="h">1085</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>34207</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/${STARTWW}\_(\S+?|\S[^\n]*?\S)\_$ENDWW/&lt;em&gt;$1&lt;\/em&gt;/gm;</td></tr>
<tr><td class="h">1086</td><td><div class="c3">3</div><div class="c3">42</div></td><td></td><td></td><td></td><td><div>3335</div><div>159</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/${STARTWW}\=(\S+?|\S[^\n]*?\S)\=$ENDWW/_fixedFontText($1,0)/gem;</td></tr>
<tr><td class="h">1087</td><td colspan="6"></td></tr><tr><td class="h">1088</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Mailto</td></tr>
<tr><td class="h">1089</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Email addresses must always be 7-bit, even within I18N sites</td></tr>
<tr><td class="h">1090</td><td colspan="6"></td></tr><tr><td class="h">1091</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Normal mailto:foo@example.com (&#39;mailto:&#39; part optional)</td></tr>
<tr><td class="h">1092</td><td><div class="c3">3</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>40021</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$STARTWW((mailto\:)?[a-zA-Z0-9-_.+]+@[a-zA-Z0-9-_.]+\.[a-zA-Z0-9-_]+)$ENDWW/$this-&gt;_mailLink( $1 )/gem;</td></tr>
<tr><td class="h">1093</td><td colspan="6"></td></tr><tr><td class="h">1094</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Handle [[][] and [[]] links</td></tr>
<tr><td class="h">1095</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Escape rendering: Change &#39; ![[...&#39; to &#39; [&lt;nop&gt;[...&#39;, for final unrendered &#39; [[...&#39; output</td></tr>
<tr><td class="h">1096</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>390</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(^|\s)\!\[\[/$1\[&lt;nop&gt;\[/gm;</td></tr>
<tr><td class="h">1097</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Spaced-out Wiki words with alternative link text</td></tr>
<tr><td class="h">1098</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# i.e. [[$1][$3]]</td></tr>
<tr><td class="h">1099</td><td><div class="c3">3</div><div class="c3">18</div></td><td></td><td></td><td></td><td><div>222</div><div>81</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[([^\]\[\n]+)\](\[([^\]\n]+)\])?\]/$this-&gt;_handleSquareBracketedLink($theWeb,$theTopic,$1,$3)/ge;</td></tr>
<tr><td class="h">1100</td><td colspan="6"></td></tr><tr><td class="h">1101</td><td><div class="c3">3</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1101">50</a></div></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( TWiki::isTrue( $prefs-&gt;getPreferencesValue(&#39;NOAUTOLINK&#39;)) ) {</td></tr>
<tr><td class="h">1102</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Handle WikiWords</td></tr>
<tr><td class="h">1103</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;takeOutBlocks( $text, &#39;noautolink&#39;, $removed );</td></tr>
<tr><td class="h">1104</td><td><div class="c3">3</div><div class="c3">19</div></td><td></td><td></td><td></td><td><div>1361</div><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$STARTWW(?:($TWiki::regex{webNameRegex})\.)?($TWiki::regex{wikiWordRegex}|$TWiki::regex{abbrevRegex})($TWiki::regex{anchorRegex})?/$this-&gt;_handleWikiWord($theWeb,$1,$2,$3)/geom;</td></tr>
<tr><td class="h">1105</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>20</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackBlocks( \$text, $removed, &#39;noautolink&#39; );</td></tr>
<tr><td class="h">1106</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1107</td><td colspan="6"></td></tr><tr><td class="h">1108</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackBlocks( \$text, $removed, &#39;pre&#39; );</td></tr>
<tr><td class="h">1109</td><td colspan="6"></td></tr><tr><td class="h">1110</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# DEPRECATED plugins hook after PRE re-inserted</td></tr>
<tr><td class="h">1111</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$plugins-&gt;endRenderingHandler( $text );</td></tr>
<tr><td class="h">1112</td><td colspan="6"></td></tr><tr><td class="h">1113</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# replace verbatim with pre in the final output</td></tr>
<tr><td class="h">1114</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackBlocks( \$text, $removedVerbatim,</td></tr>
<tr><td class="h">1115</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;verbatim&#39;, &#39;pre&#39;, \&amp;verbatimCallBack );</td></tr>
<tr><td class="h">1116</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>225</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s|\n?&lt;nop&gt;\n$||o; # clean up clutch</td></tr>
<tr><td class="h">1117</td><td colspan="6"></td></tr><tr><td class="h">1118</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackProtected( \$text, $removedScript, \&amp;_filterScript );</td></tr>
<tr><td class="h">1119</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackBlocks( \$text, $removedLiterals,</td></tr>
<tr><td class="h">1120</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;literal&#39;, &#39;&#39;, \&amp;_filterLiteral );</td></tr>
<tr><td class="h">1121</td><td colspan="6"></td></tr><tr><td class="h">1122</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackProtected( \$text, $removedHead );</td></tr>
<tr><td class="h">1123</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;putBackProtected( \$text, $removedComments );</td></tr>
<tr><td class="h">1124</td><td colspan="6"></td></tr><tr><td class="h">1125</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session}-&gt;{loginManager}-&gt;endRenderingHandler( $text );</td></tr>
<tr><td class="h">1126</td><td colspan="6"></td></tr><tr><td class="h">1127</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$plugins-&gt;postRenderingHandler( $text );</td></tr>
<tr><td class="h">1128</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>422</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1129</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1130</td><td colspan="6"></td></tr><tr><td class="h">1131 - 1138</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod verbatimCallBack

Callback for use with putBackBlocks that replaces &amp;lt; and &gt;
by their HTML entities &amp;amp;lt; and &amp;amp;gt;

=cut</pre></td></tr>
<tr><td class="h">1139</td><td colspan="6"></td></tr><tr><td class="h">1140</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub verbatimCallBack {</td></tr>
<tr><td class="h">1141</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1141">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $val = shift;</td></tr>
<tr><td class="h">1142</td><td colspan="6"></td></tr><tr><td class="h">1143</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# SMELL: A shame to do this, but been in TWiki.org have converted</td></tr>
<tr><td class="h">1144</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 3 spaces to tabs since day 1</td></tr>
<tr><td class="h">1145</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$val =~ s/\t/   /g;</td></tr>
<tr><td class="h">1146</td><td colspan="6"></td></tr><tr><td class="h">1147</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return TWiki::entityEncode( $val );</td></tr>
<tr><td class="h">1148</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1149</td><td colspan="6"></td></tr><tr><td class="h">1150</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Only put script and literal sections back if they are allowed by options</td></tr>
<tr><td class="h">1151</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _filterLiteral {</td></tr>
<tr><td class="h">1152</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1152">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $val = shift;</td></tr>
<tr><td class="h">1153</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1153">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $val if( $TWiki::cfg{AllowInlineScript} );</td></tr>
<tr><td class="h">1154</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return CGI::span({class =&gt; &#39;twikiAlert&#39;},</td></tr>
<tr><td class="h">1155</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&amp;lt;literal&amp;gt; is not allowed on this site&#39;);</td></tr>
<tr><td class="h">1156</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1157</td><td colspan="6"></td></tr><tr><td class="h">1158</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _filterScript {</td></tr>
<tr><td class="h">1159</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1159">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $val = shift;</td></tr>
<tr><td class="h">1160</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1160">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $val if( $TWiki::cfg{AllowInlineScript} );</td></tr>
<tr><td class="h">1161</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return CGI::span({class =&gt; &#39;twikiAlert&#39;},</td></tr>
<tr><td class="h">1162</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&amp;lt;script&amp;gt; is not allowed on this site&#39;);</td></tr>
<tr><td class="h">1163</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1164</td><td colspan="6"></td></tr><tr><td class="h">1165 - 1182</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod TML2PlainText( $text, $web, $topic, $opts ) -&gt; $plainText

Clean up TWiki text for display as plain text without pushing it
through the full rendering pipeline. Intended for generation of
topic and change summaries. Adds nop tags to prevent TWiki 
subsequent rendering; nops get removed at the very end.

Defuses TML.

$opts:
   * showvar - shows !%VAR% names if not expanded
   * expandvar - expands !%VARS%
   * nohead - strips ---+ headings at the top of the text
   * showmeta - does not filter meta-data

=cut</pre></td></tr>
<tr><td class="h">1183</td><td colspan="6"></td></tr><tr><td class="h">1184</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub TML2PlainText {</td></tr>
<tr><td class="h">1185</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1185">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $web, $topic, $opts ) = @_;</td></tr>
<tr><td class="h">1186</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1187</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1187">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$opts ||= &#39;&#39;;</td></tr>
<tr><td class="h">1188</td><td colspan="6"></td></tr><tr><td class="h">1189</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\r//g;  # SMELL, what about OS10?</td></tr>
<tr><td class="h">1190</td><td colspan="6"></td></tr><tr><td class="h">1191</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1191">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $opts =~ /showmeta/ ) {</td></tr>
<tr><td class="h">1192</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%META:/%&lt;nop&gt;META:/g;</td></tr>
<tr><td class="h">1193</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1194</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%META:[A-Z].*?}%//g;</td></tr>
<tr><td class="h">1195</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1196</td><td colspan="6"></td></tr><tr><td class="h">1197</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1197">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $opts =~ /expandvar/ ) {</td></tr>
<tr><td class="h">1198</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(\%)(SEARCH){/$1&lt;nop&gt;$2/g; # prevent recursion</td></tr>
<tr><td class="h">1199</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = $this-&gt;{session}-&gt;handleCommonTags( $text, $web, $topic );</td></tr>
<tr><td class="h">1200</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1201</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%WEB%/$web/g;</td></tr>
<tr><td class="h">1202</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%TOPIC%/$topic/g;</td></tr>
<tr><td class="h">1203</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1203">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $wtn = $this-&gt;{session}-&gt;{prefs}-&gt;getPreferencesValue(</td></tr>
<tr><td class="h">1204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;WIKITOOLNAME&#39; ) || &#39;&#39;;</td></tr>
<tr><td class="h">1205</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%WIKITOOLNAME%/$wtn/g;</td></tr>
<tr><td class="h">1206</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1206">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $opts =~ /showvar/ ) {</td></tr>
<tr><td class="h">1207</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%(\w+({.*?}))%/$1/g; # defuse</td></tr>
<tr><td class="h">1208</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1209</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/%$TWiki::regex{tagNameRegex}({.*?})?%//g;  # remove</td></tr>
<tr><td class="h">1210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1211</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1212</td><td colspan="6"></td></tr><tr><td class="h">1213</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Format e-mail to add spam padding (HTML tags removed later)</td></tr>
<tr><td class="h">1214</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$STARTWW((mailto\:)?[a-zA-Z0-9-_.+]+@[a-zA-Z0-9-_.]+\.[a-zA-Z0-9-_]+)$ENDWW/$this-&gt;_mailLink( $1 )/gem;</td></tr>
<tr><td class="h">1215</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;!--.*?--&gt;//gs;          # remove all HTML comments</td></tr>
<tr><td class="h">1216</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;(?!nop)[^&gt;]*&gt;//g;       # remove all HTML tags except &lt;nop&gt;</td></tr>
<tr><td class="h">1217</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\&amp;[a-z]+;/ /g;           # remove entities</td></tr>
<tr><td class="h">1218</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1218">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $opts =~ /nohead/ ) {</td></tr>
<tr><td class="h">1219</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# skip headings on top</td></tr>
<tr><td class="h">1220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while( $text =~ s/^\s*\-\-\-+\+[^\n\r]*// ) {}; # remove heading</td></tr>
<tr><td class="h">1221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1222</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# keep only link text of [[prot://uri.tld/ link text]] or [[][]]</td></tr>
<tr><td class="h">1223</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[$TWiki::regex{linkProtocolPattern}\:([^\s&lt;&gt;&quot;]+[^\s*.,!?;:)&lt;|])\s+(.*?)\]\]/$3/g;</td></tr>
<tr><td class="h">1224</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[([^\]]*\]\[)(.*?)\]\]/$2/g;</td></tr>
<tr><td class="h">1225</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remove &quot;Web.&quot; prefix from &quot;Web.TopicName&quot; link</td></tr>
<tr><td class="h">1226</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$STARTWW(($TWiki::regex{webNameRegex})\.($TWiki::regex{wikiWordRegex}|$TWiki::regex{abbrevRegex}))/$3/g;</td></tr>
<tr><td class="h">1227</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/&lt;[^&gt;]*&gt;//g;              # remove all HTML tags</td></tr>
<tr><td class="h">1228</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/[\[\]\*\|=_\&amp;\&lt;\&gt;]/ /g;  # remove Wiki formatting chars</td></tr>
<tr><td class="h">1229</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^\-\-\-+\+*\s*\!*/ /gm;  # remove heading formatting and hbar</td></tr>
<tr><td class="h">1230</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/[\+\-]+/ /g;             # remove special chars</td></tr>
<tr><td class="h">1231</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/^\s+//;                  # remove leading whitespace</td></tr>
<tr><td class="h">1232</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\s+$//;                  # remove trailing whitespace</td></tr>
<tr><td class="h">1233</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/[\r\n]+/\n/s;</td></tr>
<tr><td class="h">1234</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/[ \t]+/ /s;</td></tr>
<tr><td class="h">1235</td><td colspan="6"></td></tr><tr><td class="h">1236</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1237</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1238</td><td colspan="6"></td></tr><tr><td class="h">1239 - 1247</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod protectPlainText($text) -&gt; $tml

Protect plain text from expansions that would normally be done
duing rendering, such as wikiwords. Topic summaries, for example,
have to be protected this way.

=cut</pre></td></tr>
<tr><td class="h">1248</td><td colspan="6"></td></tr><tr><td class="h">1249</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub protectPlainText {</td></tr>
<tr><td class="h">1250</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1250">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text ) = @_;</td></tr>
<tr><td class="h">1251</td><td colspan="6"></td></tr><tr><td class="h">1252</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# prevent text from getting rendered in inline search and link tool</td></tr>
<tr><td class="h">1253</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# tip text by escaping links (external, internal, Interwiki)</td></tr>
<tr><td class="h">1254</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    $text =~ s/(?&lt;=[\s\(])((($TWiki::regex{webNameRegex})\.)?($TWiki::regex{wikiWordRegex}|$TWiki::regex{abbrevRegex}))/&lt;nop&gt;$1/g;</td></tr>
<tr><td class="h">1255</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    $text =~ s/(^|(&lt;=\W))((($TWiki::regex{webNameRegex})\.)?($TWiki::regex{wikiWordRegex}|$TWiki::regex{abbrevRegex}))/&lt;nop&gt;$1/g;</td></tr>
<tr><td class="h">1256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/((($TWiki::regex{webNameRegex})\.)?($TWiki::regex{wikiWordRegex}|$TWiki::regex{abbrevRegex}))/&lt;nop&gt;$1/g;</td></tr>
<tr><td class="h">1257</td><td colspan="6"></td></tr><tr><td class="h">1258</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    $text =~ s/(?&lt;=[\s\(])($TWiki::regex{linkProtocolPattern}\:)/&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">1259</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    $text =~ s/(^|(&lt;=\W))($TWiki::regex{linkProtocolPattern}\:)/&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">1260</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/($TWiki::regex{linkProtocolPattern}\:)/&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">1261</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/([@%])/&lt;nop&gt;$1&lt;nop&gt;/g;    # email address, variable</td></tr>
<tr><td class="h">1262</td><td colspan="6"></td></tr><tr><td class="h">1263</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Encode special chars into XML &amp;#nnn; entities for use in RSS feeds</td></tr>
<tr><td class="h">1264</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# - no encoding for HTML pages, to avoid breaking international </td></tr>
<tr><td class="h">1265</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# characters. Only works for ISO-8859-1 sites, since the Unicode</td></tr>
<tr><td class="h">1266</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# encoding (&amp;#nnn;) is identical for first 256 characters. </td></tr>
<tr><td class="h">1267</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# I18N TODO: Convert to Unicode from any site character set.</td></tr>
<tr><td class="h">1268</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1268">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1268">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $this-&gt;{session}-&gt;inContext( &#39;rss&#39; ) &amp;&amp;</td></tr>
<tr><td class="h">1269</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defined( $TWiki::cfg{Site}{CharSet} ) &amp;&amp;</td></tr>
<tr><td class="h">1270</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{Site}{CharSet} =~ /^iso-?8859-?1$/i ) {</td></tr>
<tr><td class="h">1271</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/([\x7f-\xff])/&quot;\&amp;\#&quot; . unpack( &#39;C&#39;, $1 ) .&#39;;&#39;/ge;</td></tr>
<tr><td class="h">1272</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1273</td><td colspan="6"></td></tr><tr><td class="h">1274</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1275</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1276</td><td colspan="6"></td></tr><tr><td class="h">1277 - 1285</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod makeTopicSummary (  $theText, $theTopic, $theWeb, $theFlags ) -&gt; $tml

Makes a plain text summary of the given topic by simply trimming a bit
off the top. Truncates to $TMTRUNC chars or, if a number is specified in $theFlags,
to that length.

=cut</pre></td></tr>
<tr><td class="h">1286</td><td colspan="6"></td></tr><tr><td class="h">1287</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub makeTopicSummary {</td></tr>
<tr><td class="h">1288</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1288">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $theText, $theTopic, $theWeb, $theFlags ) = @_;</td></tr>
<tr><td class="h">1289</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1290</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1290">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$theFlags ||= &#39;&#39;;</td></tr>
<tr><td class="h">1291</td><td colspan="6"></td></tr><tr><td class="h">1292</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $htext = $this-&gt;TML2PlainText( $theText, $theWeb, $theTopic, $theFlags);</td></tr>
<tr><td class="h">1293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$htext =~ s/\n+/ /g;</td></tr>
<tr><td class="h">1294</td><td colspan="6"></td></tr><tr><td class="h">1295</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME I18N: Avoid splitting within multi-byte characters (e.g. EUC-JP</td></tr>
<tr><td class="h">1296</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# encoding) by encoding bytes as Perl UTF-8 characters in Perl 5.8+. </td></tr>
<tr><td class="h">1297</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# This avoids splitting within a Unicode codepoint (or a UTF-16</td></tr>
<tr><td class="h">1298</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# surrogate pair, which is encoded as a single Perl UTF-8 character),</td></tr>
<tr><td class="h">1299</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# but we ideally need to avoid splitting closely related Unicode codepoints.</td></tr>
<tr><td class="h">1300</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Specifically, this means Unicode combining character sequences (e.g.</td></tr>
<tr><td class="h">1301</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# letters and accents) - might be better to split on word boundary if</td></tr>
<tr><td class="h">1302</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# possible.</td></tr>
<tr><td class="h">1303</td><td colspan="6"></td></tr><tr><td class="h">1304</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# limit to n chars</td></tr>
<tr><td class="h">1305</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $nchar = $theFlags;</td></tr>
<tr><td class="h">1306</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1306">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $nchar =~ s/^.*?([0-9]+).*$/$1/ ) {</td></tr>
<tr><td class="h">1307</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nchar = $TMLTRUNC;</td></tr>
<tr><td class="h">1308</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1309</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1309">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$nchar = $MINTRUNC if( $nchar &lt; $MINTRUNC );</td></tr>
<tr><td class="h">1310</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$htext =~ s/^(.{$nchar}.*?)($TWiki::regex{mixedAlphaNumRegex}).*$/$1$2 \.\.\./s;</td></tr>
<tr><td class="h">1311</td><td colspan="6"></td></tr><tr><td class="h">1312</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# We do not want the summary to contain any $variable that formatted</td></tr>
<tr><td class="h">1313</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# searches can interpret to anything (Item3489).</td></tr>
<tr><td class="h">1314</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Especially new lines (Item2496)</td></tr>
<tr><td class="h">1315</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# To not waste performance we simply replace $ by $&lt;nop&gt;</td></tr>
<tr><td class="h">1316</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$htext =~ s/\$/\$&lt;nop&gt;/g;</td></tr>
<tr><td class="h">1317</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$htext =~ s/\s+/ /g;</td></tr>
<tr><td class="h">1318</td><td colspan="6"></td></tr><tr><td class="h">1319</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;protectPlainText( $htext );</td></tr>
<tr><td class="h">1320</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1321</td><td colspan="6"></td></tr><tr><td class="h">1322 - 1337</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod takeOutProtected( \$text, $re, \%map ) -&gt; $text

   * =$text= - Text to process
   * =$re= - Regular expression that matches tag expressions to remove
   * =\%map= - Reference to a hash to contain the removed blocks

Return value: $text with blocks removed

used to extract from $text comment type tags like &amp;lt;!DOCTYPE blah&gt;

WARNING: if you want to take out &amp;lt;!-- comments --&gt; you _will_ need to re-write all the takeOuts
	to use a different placeholder

=cut</pre></td></tr>
<tr><td class="h">1338</td><td colspan="6"></td></tr><tr><td class="h">1339</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub takeOutProtected {</td></tr>
<tr><td class="h">1340</td><td><div class="c3">12</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1340">12</a></div></td><td><div>79</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $intext, $re, $map ) = @_;</td></tr>
<tr><td class="h">1341</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1342</td><td colspan="6"></td></tr><tr><td class="h">1343</td><td><div class="c3">12</div><div class="c3">2</div></td><td></td><td></td><td></td><td><div>338</div><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$intext =~ s/($re)/_replaceBlock($1, $map)/ge;</td></tr>
<tr><td class="h">1344</td><td colspan="6"></td></tr><tr><td class="h">1345</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td><div>104</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $intext;</td></tr>
<tr><td class="h">1346</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1347</td><td colspan="6"></td></tr><tr><td class="h">1348</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _replaceBlock {</td></tr>
<tr><td class="h">1349</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1349">2</a></div></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $scoop, $map ) = @_;</td></tr>
<tr><td class="h">1350</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $placeholder = $placeholderMarker;</td></tr>
<tr><td class="h">1351</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$placeholderMarker++;</td></tr>
<tr><td class="h">1352</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$map-&gt;{$placeholder}{text} = $scoop;</td></tr>
<tr><td class="h">1353</td><td colspan="6"></td></tr><tr><td class="h">1354</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>33</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&lt;!--&#39;.$TWiki::TranslationToken.$placeholder.</td></tr>
<tr><td class="h">1355</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::TranslationToken.&#39;--&gt;&#39;;</td></tr>
<tr><td class="h">1356</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1357</td><td colspan="6"></td></tr><tr><td class="h">1358 - 1369</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod putBackProtected( \$text, \%map, $callback ) -&gt; $text

Return value: $text with blocks added back
   * =\$text= - reference to text to process
   * =\%map= - map placeholders to blocks removed by takeOutBlocks
   * =$callback= - Reference to function to call on each block being inserted (optional)

Reverses the actions of takeOutProtected.

=cut</pre></td></tr>
<tr><td class="h">1370</td><td colspan="6"></td></tr><tr><td class="h">1371</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub putBackProtected {</td></tr>
<tr><td class="h">1372</td><td><div class="c3">9</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1372">9</a></div></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $map, $callback ) = @_;</td></tr>
<tr><td class="h">1373</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td><div>21</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1374</td><td colspan="6"></td></tr><tr><td class="h">1375</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td><div>43</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $placeholder ( keys %$map ) {</td></tr>
<tr><td class="h">1376</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $val = $map-&gt;{$placeholder}{text};</td></tr>
<tr><td class="h">1377</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1377">50</a></div></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$val = &amp;$callback( $val ) if( defined( $callback ));</td></tr>
<tr><td class="h">1378</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>42</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$text =~ s/&lt;!--$TWiki::TranslationToken$placeholder$TWiki::TranslationToken--&gt;/$val/;</td></tr>
<tr><td class="h">1379</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete( $map-&gt;{$placeholder} );</td></tr>
<tr><td class="h">1380</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1381</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1382</td><td colspan="6"></td></tr><tr><td class="h">1383 - 1404</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod takeOutBlocks( \$text, $tag, \%map ) -&gt; $text

   * =$text= - Text to process
   * =$tag= - XHTML-style tag.
   * =\%map= - Reference to a hash to contain the removed blocks

Return value: $text with blocks removed

Searches through $text and extracts blocks delimited by a tag, appending each
onto the end of the @buffer and replacing with a token
string which is not affected by TWiki rendering.  The text after these
substitutions is returned.

Parameters to the open tag are recorded.

This is _different_ to takeOutProtected, because it requires tags
to be on their own line. it also supports a callback for post-
processing the data before re-insertion.

=cut</pre></td></tr>
<tr><td class="h">1405</td><td colspan="6"></td></tr><tr><td class="h">1406</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub takeOutBlocks {</td></tr>
<tr><td class="h">1407</td><td><div class="c3">418</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1407">418</a></div></td><td><div>2045</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $intext, $tag, $map ) = @_;</td></tr>
<tr><td class="h">1408</td><td><div class="c3">418</div></td><td></td><td></td><td></td><td><div>980</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1409</td><td colspan="6"></td></tr><tr><td class="h">1410</td><td><div class="c3">418</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1410">100</a></div></td><td></td><td></td><td><div>4715</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $intext unless( $intext =~ m/&lt;$tag\b/i );</td></tr>
<tr><td class="h">1411</td><td colspan="6"></td></tr><tr><td class="h">1412</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $out = &#39;&#39;;</td></tr>
<tr><td class="h">1413</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $depth = 0;</td></tr>
<tr><td class="h">1414</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $scoop;</td></tr>
<tr><td class="h">1415</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tagParams;</td></tr>
<tr><td class="h">1416</td><td colspan="6"></td></tr><tr><td class="h">1417</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>68</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $token ( split/(&lt;\/?$tag[^&gt;]*&gt;)/i, $intext ) {</td></tr>
<tr><td class="h">1418</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1418">100</a></div><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1418">100</a></div></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($token =~ /&lt;$tag\b([^&gt;]*)?&gt;/i) {</td></tr>
<tr><td class="h">1419</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$depth++;</td></tr>
<tr><td class="h">1420</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1420">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($depth eq 1) {</td></tr>
<tr><td class="h">1421</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tagParams = $1;</td></tr>
<tr><td class="h">1422</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1423</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1424</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($token =~ /&lt;\/$tag&gt;/i) {</td></tr>
<tr><td class="h">1425</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1425">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($depth &gt; 0) {</td></tr>
<tr><td class="h">1426</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$depth--;</td></tr>
<tr><td class="h">1427</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1427">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($depth eq 0) {</td></tr>
<tr><td class="h">1428</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $placeholder = $tag.$placeholderMarker;</td></tr>
<tr><td class="h">1429</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$placeholderMarker++;</td></tr>
<tr><td class="h">1430</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$map-&gt;{$placeholder}{text} = $scoop;</td></tr>
<tr><td class="h">1431</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$map-&gt;{$placeholder}{params} = $tagParams;</td></tr>
<tr><td class="h">1432</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &#39;&lt;!--&#39;.$TWiki::TranslationToken.$placeholder.</td></tr>
<tr><td class="h">1433</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::TranslationToken.&#39;--&gt;&#39;;</td></tr>
<tr><td class="h">1434</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scoop = &#39;&#39;;</td></tr>
<tr><td class="h">1435</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1436</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1437</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1438</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1439</td><td><div class="c3">3</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1439">100</a></div></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($depth &gt; 0) {</td></tr>
<tr><td class="h">1440</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scoop .= $token;</td></tr>
<tr><td class="h">1441</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1442</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= $token;</td></tr>
<tr><td class="h">1443</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1444</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1445</td><td colspan="6"></td></tr><tr><td class="h">1446</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# unmatched tags</td></tr>
<tr><td class="h">1447</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1447">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1447">33</a></div></td><td></td><td><div>15</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (defined($scoop) &amp;&amp; ($scoop ne &#39;&#39;)) {</td></tr>
<tr><td class="h">1448</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $placeholder = $tag.$placeholderMarker;</td></tr>
<tr><td class="h">1449</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$placeholderMarker++;</td></tr>
<tr><td class="h">1450</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$map-&gt;{$placeholder}{text} = $scoop;</td></tr>
<tr><td class="h">1451</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$map-&gt;{$placeholder}{params} = $tagParams;</td></tr>
<tr><td class="h">1452</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &#39;&lt;!--&#39;.$TWiki::TranslationToken.$placeholder.</td></tr>
<tr><td class="h">1453</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::TranslationToken.&#39;--&gt;&#39;;</td></tr>
<tr><td class="h">1454</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1455</td><td colspan="6"></td></tr><tr><td class="h">1456</td><td colspan="6"></td></tr><tr><td class="h">1457</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $out;</td></tr>
<tr><td class="h">1458</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1459</td><td colspan="6"></td></tr><tr><td class="h">1460 - 1488</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod putBackBlocks( \$text, \%map, $tag, $newtag, $callBack ) -&gt; $text

Return value: $text with blocks added back
   * =\$text= - reference to text to process
   * =\%map= - map placeholders to blocks removed by takeOutBlocks
   * =$tag= - Tag name processed by takeOutBlocks
   * =$newtag= - Tag name to use in output, in place of $tag. If undefined, uses $tag.
   * =$callback= - Reference to function to call on each block being inserted (optional)

Reverses the actions of takeOutBlocks.

Each replaced block is processed by the callback (if there is one) before
re-insertion.

Parameters to the outermost cut block are replaced into the open tag,
even if that tag is changed. This allows things like
&amp;lt;verbatim class=&#39;&#39;&gt;
to be mapped to
&amp;lt;pre class=&#39;&#39;&gt;

Cool, eh what? Jolly good show.

And if you set $newtag to &#39;&#39;, we replace the taken out block with the valuse itself
   * which i&#39;m using to stop the rendering process, but then at the end put in the html directly
   (for &lt;literal&gt; tag.

=cut</pre></td></tr>
<tr><td class="h">1489</td><td colspan="6"></td></tr><tr><td class="h">1490</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub putBackBlocks {</td></tr>
<tr><td class="h">1491</td><td><div class="c3">400</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1491">400</a></div></td><td><div>1563</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $map, $tag, $newtag, $callback ) = @_;</td></tr>
<tr><td class="h">1492</td><td><div class="c3">400</div></td><td></td><td></td><td></td><td><div>902</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1493</td><td colspan="6"></td></tr><tr><td class="h">1494</td><td><div class="c3">400</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1494">100</a></div></td><td></td><td></td><td><div>1857</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$newtag = $tag if (!defined($newtag));</td></tr>
<tr><td class="h">1495</td><td colspan="6"></td></tr><tr><td class="h">1496</td><td><div class="c3">400</div></td><td></td><td></td><td></td><td><div>2111</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $placeholder ( keys %$map ) {</td></tr>
<tr><td class="h">1497</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1497">50</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $placeholder =~ /^$tag\d+$/ ) {</td></tr>
<tr><td class="h">1498</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1498">50</a></div></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $params = $map-&gt;{$placeholder}{params} || &#39;&#39;;</td></tr>
<tr><td class="h">1499</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $val = $map-&gt;{$placeholder}{text};</td></tr>
<tr><td class="h">1500</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1500">50</a></div></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$val = &amp;$callback( $val ) if ( defined( $callback ));</td></tr>
<tr><td class="h">1501</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1501">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($newtag eq &#39;&#39;) {</td></tr>
<tr><td class="h">1502</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$text =~ s(&lt;!--$TWiki::TranslationToken$placeholder$TWiki::TranslationToken--&gt;)($val);</td></tr>
<tr><td class="h">1503</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1504</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>31</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$text =~ s(&lt;!--$TWiki::TranslationToken$placeholder$TWiki::TranslationToken--&gt;)</td></tr>
<tr><td class="h">1505</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&lt;$newtag$params&gt;$val&lt;/$newtag&gt;);</td></tr>
<tr><td class="h">1506</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1507</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete( $map-&gt;{$placeholder} );</td></tr>
<tr><td class="h">1508</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1509</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1510</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# This was added by Sven in 7219, but without any clear explanation</td></tr>
<tr><td class="h">1511</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# or tests. It removes perfectly valid content from inside verbatim</td></tr>
<tr><td class="h">1512</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# tags, and causes the unit tests for &lt;literal&gt; to fail.</td></tr>
<tr><td class="h">1513</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#	if ($newtag eq &#39;&#39;) {</td></tr>
<tr><td class="h">1514</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#		$$text =~ s/&amp;#60;\/?$tag&amp;#62;//g;</td></tr>
<tr><td class="h">1515</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#	}</td></tr>
<tr><td class="h">1516</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1517</td><td colspan="6"></td></tr><tr><td class="h">1518 - 1540</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod renderRevisionInfo($web, $topic, $meta, $rev, $format) -&gt; $string

Obtain and render revision info for a topic.
   * =$web= - the web of the topic
   * =$topic= - the topic
   * =$meta= if specified, get rev info from here. If not specified, or meta contains rev info for a different version than the one requested, will reload the topic
   * =$rev= - the rev number, defaults to latest rev
   * =$format= - the render format, defaults to =$rev - $time - $wikiusername=
=$format= can contain the following keys for expansion:
   | =$web= | the web name |
   | =$topic= | the topic name |
   | =$rev= | the rev number |
   | =$comment= | the comment |
   | =$username= | the login of the saving user |
   | =$wikiname= | the wikiname of the saving user |
   | =$wikiusername= | the web.wikiname of the saving user |
   | =$date= | the date of the rev (no time) |
   | =$time= | the time of the rev |
   | =$min=, =$sec=, etc. | Same date format qualifiers as GMTIME |

=cut</pre></td></tr>
<tr><td class="h">1541</td><td colspan="6"></td></tr><tr><td class="h">1542</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub renderRevisionInfo {</td></tr>
<tr><td class="h">1543</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1543">1</a></div></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $web, $topic, $meta, $rrev, $format ) = @_;</td></tr>
<tr><td class="h">1544</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1545</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">1546</td><td colspan="6"></td></tr><tr><td class="h">1547</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1547">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $rrev ) {</td></tr>
<tr><td class="h">1548</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$rrev = $store-&gt;cleanUpRevID( $rrev );</td></tr>
<tr><td class="h">1549</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1550</td><td colspan="6"></td></tr><tr><td class="h">1551</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1551">50</a></div></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $meta ) {</td></tr>
<tr><td class="h">1552</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $text;</td></tr>
<tr><td class="h">1553</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( $meta, $text ) = $store-&gt;readTopic( undef, $web, $topic, $rrev );</td></tr>
<tr><td class="h">1554</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1555</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $date, $user, $rev, $comment ) = $meta-&gt;getRevisionInfo( $rrev );</td></tr>
<tr><td class="h">1556</td><td colspan="6"></td></tr><tr><td class="h">1557</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $wun = &#39;&#39;;</td></tr>
<tr><td class="h">1558</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $wn = &#39;&#39;;</td></tr>
<tr><td class="h">1559</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $un = &#39;&#39;;</td></tr>
<tr><td class="h">1560</td><td><div class="c3">1</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1560">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $user ) {</td></tr>
<tr><td class="h">1561</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wun = $user-&gt;webDotWikiName();</td></tr>
<tr><td class="h">1562</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wn = $user-&gt;wikiName();</td></tr>
<tr><td class="h">1563</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$un = $user-&gt;login();</td></tr>
<tr><td class="h">1564</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1565</td><td colspan="6"></td></tr><tr><td class="h">1566</td><td><div class="c3">1</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1566">50</a></div></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $value = $format || &#39;r$rev - $date - $time - $wikiusername&#39;;</td></tr>
<tr><td class="h">1567</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$web/$web/gi;</td></tr>
<tr><td class="h">1568</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$topic/$topic/gi;</td></tr>
<tr><td class="h">1569</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$rev/$rev/gi;</td></tr>
<tr><td class="h">1570</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$time/TWiki::Time::formatTime($date, &#39;$hour:$min:$sec&#39;)/gei;</td></tr>
<tr><td class="h">1571</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$date/TWiki::Time::formatTime($date, &#39;$day $mon $year&#39;)/gei;</td></tr>
<tr><td class="h">1572</td><td><div class="c3">1</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>4</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/(\$(rcs|http|email|iso))/TWiki::Time::formatTime($date, $1 )/gei;</td></tr>
<tr><td class="h">1573</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1573">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $value =~ /\$(sec|min|hou|day|wday|dow|week|mo|ye|epoch|tz)/ ) {</td></tr>
<tr><td class="h">1574</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = TWiki::Time::formatTime( $date, $value );</td></tr>
<tr><td class="h">1575</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1576</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$comment/$comment/gi;</td></tr>
<tr><td class="h">1577</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$username/$un/gi;</td></tr>
<tr><td class="h">1578</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$wikiname/$wn/gi;</td></tr>
<tr><td class="h">1579</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$wikiusername/$wun/gi;</td></tr>
<tr><td class="h">1580</td><td colspan="6"></td></tr><tr><td class="h">1581</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $value;</td></tr>
<tr><td class="h">1582</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1583</td><td colspan="6"></td></tr><tr><td class="h">1584 - 1602</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod summariseChanges($user, $web, $topic, $orev, $nrev, $tml) -&gt; $text

   * =$user= - user (null to ignore permissions)
   * =$web= - web
   * =$topic= - topic
   * =$orev= - older rev
   * =$nrev= - later rev
   * =$tml= - if true will generate renderable TML (i.e. HTML with NOPs. if false will generate a summary suitable for use in plain text (mail, for example)
Generate a (max 3 line) summary of the differences between the revs.

If there is only one rev, a topic summary will be returned.

If =$tml= is not set, all HTML will be removed.

In non-tml, lines are truncated to 70 characters. Differences are shown using + and - to indicate added and removed text.

=cut</pre></td></tr>
<tr><td class="h">1603</td><td colspan="6"></td></tr><tr><td class="h">1604</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub summariseChanges {</td></tr>
<tr><td class="h">1605</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1605">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $user, $web, $topic, $orev, $nrev, $tml ) = @_;</td></tr>
<tr><td class="h">1606</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1607</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#ASSERT($user-&gt;isa( &#39;TWiki::User&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1608</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $summary = &#39;&#39;;</td></tr>
<tr><td class="h">1609</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $store = $this-&gt;{session}-&gt;{store};</td></tr>
<tr><td class="h">1610</td><td colspan="6"></td></tr><tr><td class="h">1611</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1611">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1611">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$orev = $nrev - 1 unless (defined($orev) || !defined($nrev));</td></tr>
<tr><td class="h">1612</td><td colspan="6"></td></tr><tr><td class="h">1613</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $nmeta, $ntext ) = $store-&gt;readTopic( $user, $web, $topic, $nrev );</td></tr>
<tr><td class="h">1614</td><td colspan="6"></td></tr><tr><td class="h">1615</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1615">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1615">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $nrev &amp;&amp; $nrev &gt; 1 &amp;&amp; $orev ne $nrev ) {</td></tr>
<tr><td class="h">1616</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $metaPick = qr/^[A-Z](?!OPICINFO)/; # all except TOPICINFO</td></tr>
<tr><td class="h">1617</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# there was a prior version. Diff it.</td></tr>
<tr><td class="h">1618</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ntext = $this-&gt;TML2PlainText(</td></tr>
<tr><td class="h">1619</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ntext, $web, $topic, &#39;nonop&#39; ).&quot;\n&quot;.</td></tr>
<tr><td class="h">1620</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nmeta-&gt;stringify( $metaPick );</td></tr>
<tr><td class="h">1621</td><td colspan="6"></td></tr><tr><td class="h">1622</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my( $ometa, $otext ) = $store-&gt;readTopic( $user, $web, $topic, $orev );</td></tr>
<tr><td class="h">1623</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$otext = $this-&gt;TML2PlainText(</td></tr>
<tr><td class="h">1624</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$otext, $web, $topic, &#39;nonop&#39; ).&quot;\n&quot;.</td></tr>
<tr><td class="h">1625</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ometa-&gt;stringify( $metaPick );</td></tr>
<tr><td class="h">1626</td><td colspan="6"></td></tr><tr><td class="h">1627</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $blocks = TWiki::Merge::simpleMerge( $otext, $ntext, qr/[\r\n]+/ );</td></tr>
<tr><td class="h">1628</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# sort through, keeping one line of context either side of a change</td></tr>
<tr><td class="h">1629</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @revised;</td></tr>
<tr><td class="h">1630</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $getnext = 0;</td></tr>
<tr><td class="h">1631</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $prev = &#39;&#39;;</td></tr>
<tr><td class="h">1632</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1632">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ellipsis = $tml ? &#39;&amp;hellip;&#39; : &#39;...&#39;;</td></tr>
<tr><td class="h">1633</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1633">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $trunc = $tml ? $TMLTRUNC : $PLAINTRUNC;</td></tr>
<tr><td class="h">1634</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1634">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ( scalar @$blocks &amp;&amp; scalar( @revised ) &lt; $SUMMARYLINES ) {</td></tr>
<tr><td class="h">1635</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $block = shift( @$blocks );</td></tr>
<tr><td class="h">1636</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1636">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $block =~ /\S/;</td></tr>
<tr><td class="h">1637</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $trim = length($block) &gt; $trunc;</td></tr>
<tr><td class="h">1638</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1638">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block =~ s/^(.{$trunc}).*$/$1/ if( $trim );</td></tr>
<tr><td class="h">1639</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1639">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $block =~ m/^[-+]/ ) {</td></tr>
<tr><td class="h">1640</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1640">0</a></div><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1640">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $tml ) {</td></tr>
<tr><td class="h">1641</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block =~ s/^-(.*)$/CGI::del( $1 )/se;</td></tr>
<tr><td class="h">1642</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block =~ s/^\+(.*)$/CGI::ins( $1 )/se;</td></tr>
<tr><td class="h">1643</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $this-&gt;{session}-&gt;inContext(&#39;rss&#39;)) {</td></tr>
<tr><td class="h">1644</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block =~ s/^-/REMOVED: /;</td></tr>
<tr><td class="h">1645</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block =~ s/^\+/INSERTED: /;</td></tr>
<tr><td class="h">1646</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1647</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1647">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @revised, $prev ) if $prev;</td></tr>
<tr><td class="h">1648</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1648">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block .= $ellipsis if $trim;</td></tr>
<tr><td class="h">1649</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @revised, $block );</td></tr>
<tr><td class="h">1650</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$getnext = 1;</td></tr>
<tr><td class="h">1651</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$prev = &#39;&#39;;</td></tr>
<tr><td class="h">1652</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1653</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1653">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $getnext ) {</td></tr>
<tr><td class="h">1654</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1654">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$block .= $ellipsis if $trim;</td></tr>
<tr><td class="h">1655</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push( @revised, $block );</td></tr>
<tr><td class="h">1656</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$getnext = 0;</td></tr>
<tr><td class="h">1657</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$prev = &#39;&#39;;</td></tr>
<tr><td class="h">1658</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1659</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$prev = $block;</td></tr>
<tr><td class="h">1660</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1661</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1662</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1663</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1663">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $tml ) {</td></tr>
<tr><td class="h">1664</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$summary = join(CGI::br(), @revised );</td></tr>
<tr><td class="h">1665</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1666</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$summary = join(&quot;\n&quot;, @revised );</td></tr>
<tr><td class="h">1667</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1668</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1669</td><td colspan="6"></td></tr><tr><td class="h">1670</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1670">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $summary ) {</td></tr>
<tr><td class="h">1671</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$summary = $this-&gt;makeTopicSummary( $ntext, $topic, $web );</td></tr>
<tr><td class="h">1672</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1673</td><td colspan="6"></td></tr><tr><td class="h">1674</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1674">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( ! $tml ) {</td></tr>
<tr><td class="h">1675</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$summary = $this-&gt;protectPlainText( $summary );</td></tr>
<tr><td class="h">1676</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1677</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $summary;</td></tr>
<tr><td class="h">1678</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1679</td><td colspan="6"></td></tr><tr><td class="h">1680 - 1693</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod forEachLine( $text, \&amp;fn, \%options ) -&gt; $newText

Iterate over each line, calling =\&amp;fn= on each.
\%options may contain:
   * =pre= =&gt; true, will call fn for each line in pre blocks
   * =verbatim= =&gt; true, will call fn for each line in verbatim blocks
   * =noautolink= =&gt; true, will call fn for each line in =noautolink= blocks
The spec of \&amp;fn is sub fn( \$line, \%options ) -&gt; $newLine; the %options hash passed into this function is passed down to the sub, and the keys =in_pre=, =in_verbatim= and =in_noautolink= are set boolean TRUE if the line is from one (or more) of those block types.

The return result replaces $line in $newText.

=cut</pre></td></tr>
<tr><td class="h">1694</td><td colspan="6"></td></tr><tr><td class="h">1695</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub forEachLine {</td></tr>
<tr><td class="h">1696</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1696">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $fn, $options ) = @_;</td></tr>
<tr><td class="h">1697</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1698</td><td colspan="6"></td></tr><tr><td class="h">1699</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_pre} = 0;</td></tr>
<tr><td class="h">1700</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_pre} = 0;</td></tr>
<tr><td class="h">1701</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_verbatim} = 0;</td></tr>
<tr><td class="h">1702</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_literal} = 0;</td></tr>
<tr><td class="h">1703</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_noautolink} = 0;</td></tr>
<tr><td class="h">1704</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $newText = &#39;&#39;;</td></tr>
<tr><td class="h">1705</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $line ( split( /([\r\n]+)/, $text ) ) {</td></tr>
<tr><td class="h">1706</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1706">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $line =~ /[\r\n]/ ) {</td></tr>
<tr><td class="h">1707</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newText .= $line;</td></tr>
<tr><td class="h">1708</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">1709</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1710</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1710">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_verbatim}++ if( $line =~ m|^\s*&lt;verbatim\b[^&gt;]*&gt;\s*$|i );</td></tr>
<tr><td class="h">1711</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1711">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_verbatim}-- if( $line =~ m|^\s*&lt;/verbatim&gt;\s*$|i );</td></tr>
<tr><td class="h">1712</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1712">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_literal}++ if( $line =~ m|^\s*&lt;literal\b[^&gt;]*&gt;\s*$|i );</td></tr>
<tr><td class="h">1713</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1713">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_literal}-- if( $line =~ m|^\s*&lt;/literal&gt;\s*$|i );</td></tr>
<tr><td class="h">1714</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1714">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1714">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (( $options-&gt;{in_verbatim} &gt; 0 ) || (( $options-&gt;{in_literal} &gt; 0 ))){</td></tr>
<tr><td class="h">1715</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1715">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_pre}++ if( $line =~ m|&lt;pre\b|i );</td></tr>
<tr><td class="h">1716</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1716">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_pre}-- if( $line =~ m|&lt;/pre&gt;|i );</td></tr>
<tr><td class="h">1717</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1717">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_noautolink}++ if( $line =~ m|^\s*&lt;noautolink\b[^&gt;]*&gt;\s*$|i );</td></tr>
<tr><td class="h">1718</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1718">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_noautolink}-- if( $line =~ m|^\s*&lt;/noautolink&gt;\s*|i );</td></tr>
<tr><td class="h">1719</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1720</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1720">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1720">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless( $options-&gt;{in_pre} &gt; 0 &amp;&amp; !$options-&gt;{pre} ||</td></tr>
<tr><td class="h">1721</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_verbatim} &gt; 0 &amp;&amp; !$options-&gt;{verbatim} ||</td></tr>
<tr><td class="h">1722</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_literal} &gt; 0 &amp;&amp; !$options-&gt;{literal} ||</td></tr>
<tr><td class="h">1723</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$options-&gt;{in_noautolink} &gt; 0 &amp;&amp; !$options-&gt;{noautolink} ) {</td></tr>
<tr><td class="h">1724</td><td colspan="6"></td></tr><tr><td class="h">1725</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line = &amp;$fn( $line, $options );</td></tr>
<tr><td class="h">1726</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1727</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newText .= $line;</td></tr>
<tr><td class="h">1728</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1729</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $newText;</td></tr>
<tr><td class="h">1730</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1731</td><td colspan="6"></td></tr><tr><td class="h">1732 - 1747</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod replaceTopicReferences( $text, \%options ) -&gt; $text

Callback designed for use with forEachLine, to replace topic references.
\%options contains:
   * =oldWeb= =&gt; Web of reference to replace
   * =oldTopic= =&gt; Topic of reference to replace
   * =spacedTopic= =&gt; RE matching spaced out oldTopic
   * =newWeb= =&gt; Web of new reference
   * =newTopic= =&gt; Topic of new reference
   * =inWeb= =&gt; the web which the text we are presently processing resides in
   * =fullPaths= =&gt; optional, if set forces all links to full web.topic form
For a usage example see TWiki::UI::Manage.pm

=cut</pre></td></tr>
<tr><td class="h">1748</td><td colspan="6"></td></tr><tr><td class="h">1749</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub replaceTopicReferences {</td></tr>
<tr><td class="h">1750</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1750">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $text, $args ) = @_;</td></tr>
<tr><td class="h">1751</td><td colspan="6"></td></tr><tr><td class="h">1752</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{oldWeb}) if DEBUG;</td></tr>
<tr><td class="h">1753</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{oldTopic}) if DEBUG;</td></tr>
<tr><td class="h">1754</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{spacedTopic}) if DEBUG;</td></tr>
<tr><td class="h">1755</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{newWeb}) if DEBUG;</td></tr>
<tr><td class="h">1756</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{newTopic}) if DEBUG;</td></tr>
<tr><td class="h">1757</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{inWeb}) if DEBUG;</td></tr>
<tr><td class="h">1758</td><td colspan="6"></td></tr><tr><td class="h">1759</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $repl = $args-&gt;{newTopic};</td></tr>
<tr><td class="h">1760</td><td colspan="6"></td></tr><tr><td class="h">1761</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{inWeb} =~ s/\//./go;</td></tr>
<tr><td class="h">1762</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{newWeb} =~ s/\//./go;</td></tr>
<tr><td class="h">1763</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{oldWeb} =~ s/\//./go;</td></tr>
<tr><td class="h">1764</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldWebRegex = $args-&gt;{oldWeb};</td></tr>
<tr><td class="h">1765</td><td colspan="6"></td></tr><tr><td class="h">1766</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$oldWebRegex =~ s#\.#[.\\/]#go;</td></tr>
<tr><td class="h">1767</td><td colspan="6"></td></tr><tr><td class="h">1768</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1768">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1768">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $args-&gt;{inWeb} ne $args-&gt;{newWeb} || $args-&gt;{fullPaths} ) {</td></tr>
<tr><td class="h">1769</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$repl = $args-&gt;{newWeb}.&#39;.&#39;.$repl;</td></tr>
<tr><td class="h">1770</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1771</td><td colspan="6"></td></tr><tr><td class="h">1772</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\b$oldWebRegex\.$args-&gt;{oldTopic}\b/$repl/g;</td></tr>
<tr><td class="h">1773</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[$oldWebRegex\.$args-&gt;{spacedTopic}(\](\[[^\]]+\])?\])/[[$repl$1/g;</td></tr>
<tr><td class="h">1774</td><td colspan="6"></td></tr><tr><td class="h">1775</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1775">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text unless( $args-&gt;{inWeb} eq $args-&gt;{oldWeb} );</td></tr>
<tr><td class="h">1776</td><td colspan="6"></td></tr><tr><td class="h">1777</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/([^\.]|^)$args-&gt;{oldTopic}\b/$1$repl/g;</td></tr>
<tr><td class="h">1778</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\[\[($args-&gt;{spacedTopic})(\](\[[^\]]+\])?\])/[[$repl$2/g;</td></tr>
<tr><td class="h">1779</td><td colspan="6"></td></tr><tr><td class="h">1780</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1781</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1782</td><td colspan="6"></td></tr><tr><td class="h">1783 - 1793</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod replaceWebReferences( $text, \%options ) -&gt; $text

Callback designed for use with forEachLine, to replace web references.
\%options contains:
   * =oldWeb= =&gt; Web of reference to replace
   * =newWeb= =&gt; Web of new reference
For a usage example see TWiki::UI::Manage.pm

=cut</pre></td></tr>
<tr><td class="h">1794</td><td colspan="6"></td></tr><tr><td class="h">1795</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub replaceWebReferences {</td></tr>
<tr><td class="h">1796</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1796">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $text, $args ) = @_;</td></tr>
<tr><td class="h">1797</td><td colspan="6"></td></tr><tr><td class="h">1798</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{oldWeb}) if DEBUG;</td></tr>
<tr><td class="h">1799</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT(defined $args-&gt;{newWeb}) if DEBUG;</td></tr>
<tr><td class="h">1800</td><td colspan="6"></td></tr><tr><td class="h">1801</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $repl = $args-&gt;{newWeb};</td></tr>
<tr><td class="h">1802</td><td colspan="6"></td></tr><tr><td class="h">1803</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{newWeb}=~s/\//./go;</td></tr>
<tr><td class="h">1804</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{oldWeb}=~s/\//./go;</td></tr>
<tr><td class="h">1805</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $oldWebRegex=$args-&gt;{oldWeb};</td></tr>
<tr><td class="h">1806</td><td colspan="6"></td></tr><tr><td class="h">1807</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$oldWebRegex=~s#\.#[.\\/]#go;</td></tr>
<tr><td class="h">1808</td><td colspan="6"></td></tr><tr><td class="h">1809</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/\b$oldWebRegex\b/$repl/g;</td></tr>
<tr><td class="h">1810</td><td colspan="6"></td></tr><tr><td class="h">1811</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1812</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1813</td><td colspan="6"></td></tr><tr><td class="h">1814 - 1823</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod replaceWebInternalReferences( \$text, \%meta, $oldWeb, $oldTopic )

Change within-web wikiwords in $$text and $meta to full web.topic syntax.

\%options must include topics =&gt; list of topics that must have references
to them changed to include the web specifier.

=cut</pre></td></tr>
<tr><td class="h">1824</td><td colspan="6"></td></tr><tr><td class="h">1825</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub replaceWebInternalReferences {</td></tr>
<tr><td class="h">1826</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1826">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $text, $meta, $oldWeb, $oldTopic, $newWeb, $newTopic ) = @_;</td></tr>
<tr><td class="h">1827</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Render&#39;)) if DEBUG;</td></tr>
<tr><td class="h">1828</td><td colspan="6"></td></tr><tr><td class="h">1829</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @topics = $this-&gt;{session}-&gt;{store}-&gt;getTopicNames( $oldWeb );</td></tr>
<tr><td class="h">1830</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $options =</td></tr>
<tr><td class="h">1831</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1832</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# exclude this topic from the list</td></tr>
<tr><td class="h">1833</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;topics =&gt; [ grep { !/^$oldTopic$/ } @topics ],</td></tr>
<tr><td class="h">1834</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inWeb =&gt; $oldWeb,</td></tr>
<tr><td class="h">1835</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inTopic =&gt; $oldTopic,</td></tr>
<tr><td class="h">1836</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldWeb =&gt; $oldWeb,</td></tr>
<tr><td class="h">1837</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newWeb =&gt; $oldWeb,</td></tr>
<tr><td class="h">1838</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1839</td><td colspan="6"></td></tr><tr><td class="h">1840</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$text = $this-&gt;forEachLine( $$text, \&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1841</td><td colspan="6"></td></tr><tr><td class="h">1842</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;forEachSelectedValue( qw/^(FIELD|TOPICPARENT)$/, undef,</td></tr>
<tr><td class="h">1843</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1844</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;forEachSelectedValue( qw/^TOPICMOVED$/, qw/^by$/,</td></tr>
<tr><td class="h">1845</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1846</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;forEachSelectedValue( qw/^FILEATTACHMENT$/, qw/^user$/,</td></tr>
<tr><td class="h">1847</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1848</td><td colspan="6"></td></tr><tr><td class="h">1849</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;## Ok, let&#39;s do it again, but look for links to topics in the new web and remove their full paths</td></tr>
<tr><td class="h">1850</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@topics = $this-&gt;{session}-&gt;{store}-&gt;getTopicNames( $newWeb );</td></tr>
<tr><td class="h">1851</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$options =</td></tr>
<tr><td class="h">1852</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1853</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# exclude this topic from the list</td></tr>
<tr><td class="h">1854</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;topics =&gt; [ @topics ],</td></tr>
<tr><td class="h">1855</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullPaths =&gt; 0,</td></tr>
<tr><td class="h">1856</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inWeb =&gt; $newWeb,</td></tr>
<tr><td class="h">1857</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inTopic =&gt; $oldTopic,</td></tr>
<tr><td class="h">1858</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldWeb =&gt; $newWeb,</td></tr>
<tr><td class="h">1859</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newWeb =&gt; $newWeb,</td></tr>
<tr><td class="h">1860</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1861</td><td colspan="6"></td></tr><tr><td class="h">1862</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$$text = $this-&gt;forEachLine( $$text, \&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1863</td><td colspan="6"></td></tr><tr><td class="h">1864</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;forEachSelectedValue( qw/^(FIELD|TOPICPARENT)$/, undef,</td></tr>
<tr><td class="h">1865</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1866</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;forEachSelectedValue( qw/^TOPICMOVED$/, qw/^by$/,</td></tr>
<tr><td class="h">1867</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1868</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$meta-&gt;forEachSelectedValue( qw/^FILEATTACHMENT$/, qw/^user$/,</td></tr>
<tr><td class="h">1869</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&amp;_replaceInternalRefs, $options );</td></tr>
<tr><td class="h">1870</td><td colspan="6"></td></tr><tr><td class="h">1871</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1872</td><td colspan="6"></td></tr><tr><td class="h">1873</td><td></td><td></td><td></td><td></td><td></td><td class="s"># callback used by replaceWebInternalReferences</td></tr>
<tr><td class="h">1874</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub _replaceInternalRefs {</td></tr>
<tr><td class="h">1875</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1875">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $text, $args ) = @_;</td></tr>
<tr><td class="h">1876</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $topic ( @{$args-&gt;{topics}} ) {</td></tr>
<tr><td class="h">1877</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1877">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{fullPaths} =  ( $topic ne $args-&gt;{inTopic} ) if (!defined($args-&gt;{fullPaths}));</td></tr>
<tr><td class="h">1878</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{oldTopic} = $topic;</td></tr>
<tr><td class="h">1879</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{newTopic} = $topic;</td></tr>
<tr><td class="h">1880</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{spacedTopic} = TWiki::spaceOutWikiWord( $topic );</td></tr>
<tr><td class="h">1881</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$args-&gt;{spacedTopic} =~ s/ / */g;</td></tr>
<tr><td class="h">1882</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text = replaceTopicReferences( $text, $args );</td></tr>
<tr><td class="h">1883</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1884</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1885</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1886</td><td colspan="6"></td></tr><tr><td class="h">1887 - 1901</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod renderFormFieldArg( $meta, $args ) -&gt; $text

Parse the arguments to a $formfield specification and extract
the relevant formfield from the given meta data.

   * =args= string containing name of form field
   
In addition to the name of a field =args= can be appended with a commas
followed by a string format (\d+)([,\s*]\.\.\.)?). This supports the formatted
search function $formfield and is used to shorten the returned string or a 
hyphenated string.        

=cut</pre></td></tr>
<tr><td class="h">1902</td><td colspan="6"></td></tr><tr><td class="h">1903</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub renderFormFieldArg {</td></tr>
<tr><td class="h">1904</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1904">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $meta, $args ) = @_;</td></tr>
<tr><td class="h">1905</td><td colspan="6"></td></tr><tr><td class="h">1906</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = $args;</td></tr>
<tr><td class="h">1907</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $breakArgs = &#39;&#39;;</td></tr>
<tr><td class="h">1908</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @params = split( /\,\s*/, $args, 2 );</td></tr>
<tr><td class="h">1909</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1909">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( @params &gt; 1 ) {</td></tr>
<tr><td class="h">1910</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1910">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $params[0] || &#39;&#39;;</td></tr>
<tr><td class="h">1911</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1911">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$breakArgs = $params[1] || 1;</td></tr>
<tr><td class="h">1912</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1913</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $value = &#39;&#39;;</td></tr>
<tr><td class="h">1914</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @fields = $meta-&gt;find( &#39;FIELD&#39; );</td></tr>
<tr><td class="h">1915</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $field ( @fields ) {</td></tr>
<tr><td class="h">1916</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1916">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $title = $field-&gt;{title} || $field-&gt;{name};</td></tr>
<tr><td class="h">1917</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1917">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $name =~ /^($field-&gt;{name}|$title)$/ ) {</td></tr>
<tr><td class="h">1918</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = $field-&gt;{value};</td></tr>
<tr><td class="h">1919</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1919">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = &#39;&#39; unless defined( $value );</td></tr>
<tr><td class="h">1920</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1920">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $breakArgs ) {</td></tr>
<tr><td class="h">1921</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/^\s*(.*?)\s*$/$1/go;</td></tr>
<tr><td class="h">1922</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value = breakName( $value, $breakArgs );</td></tr>
<tr><td class="h">1923</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1924</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Item3489, Item2837. Prevent $vars in formfields from</td></tr>
<tr><td class="h">1925</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# being expanded in formatted searches.</td></tr>
<tr><td class="h">1926</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$value =~ s/\$(n|nop|quot|percnt|dollar)/\$&lt;nop&gt;$1/go;</td></tr>
<tr><td class="h">1927</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $value;</td></tr>
<tr><td class="h">1928</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1929</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1930</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39;;</td></tr>
<tr><td class="h">1931</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1932</td><td colspan="6"></td></tr><tr><td class="h">1933 - 1946</td><td colspan="5"></td><td class="s"><pre>=pod

---++ StaticMethod breakName( $text, $args) -&gt; $text

   * =$text= - text to &quot;break&quot;
   * =$args= - string of format (\d+)([,\s*]\.\.\.)?)
Hyphenates $text every $1 characters, or if $2 is &quot;...&quot; then shortens to
$1 characters and appends &quot;...&quot; (making the final string $1+3 characters
long)

_Moved from Search.pm because it was obviously unhappy there,
as it is a rendering function_

=cut</pre></td></tr>
<tr><td class="h">1947</td><td colspan="6"></td></tr><tr><td class="h">1948</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub breakName {</td></tr>
<tr><td class="h">1949</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--subroutine.html#L1949">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $text, $args ) = @_;</td></tr>
<tr><td class="h">1950</td><td colspan="6"></td></tr><tr><td class="h">1951</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @params = split( /[\,\s]+/, $args, 2 );</td></tr>
<tr><td class="h">1952</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1952">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( @params ) {</td></tr>
<tr><td class="h">1953</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Render-pm--condition.html#L1953">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $len = $params[0] || 1;</td></tr>
<tr><td class="h">1954</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1954">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$len = 1 if( $len &lt; 1 );</td></tr>
<tr><td class="h">1955</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sep = &#39;- &#39;;</td></tr>
<tr><td class="h">1956</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1956">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sep = $params[1] if( @params &gt; 1 );</td></tr>
<tr><td class="h">1957</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Render-pm--branch.html#L1957">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $sep =~ /^\.\.\./i ) {</td></tr>
<tr><td class="h">1958</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# make name shorter like &#39;ThisIsALongTop...&#39;</td></tr>
<tr><td class="h">1959</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(.{$len})(.+)/$1.../s;</td></tr>
<tr><td class="h">1960</td><td colspan="6"></td></tr><tr><td class="h">1961</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1962</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# split and hyphenate the topic like &#39;ThisIsALo- ngTopic&#39;</td></tr>
<tr><td class="h">1963</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/(.{$len})/$1$sep/gs;</td></tr>
<tr><td class="h">1964</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$text =~ s/$sep$//;</td></tr>
<tr><td class="h">1965</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1966</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1967</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">1968</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1969</td><td colspan="6"></td></tr><tr><td class="h">1970</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
