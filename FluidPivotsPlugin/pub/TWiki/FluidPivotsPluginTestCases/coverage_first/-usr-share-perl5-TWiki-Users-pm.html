<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: /usr/share/perl5/TWiki/Users.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">/usr/share/perl5/TWiki/Users.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">60.6%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Module of TWiki Enterprise Collaboration Platform, http://TWiki.org/</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Copyright (C) 1999-2007 Peter Thoeny, peter@thoeny.org</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td class="s"># and TWiki Contributors. All Rights Reserved. TWiki Contributors</td></tr>
<tr><td class="h">5</td><td></td><td></td><td></td><td></td><td></td><td class="s"># are listed in the AUTHORS file in the root of this distribution.</td></tr>
<tr><td class="h">6</td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE: Please extend that file, not this notice.</td></tr>
<tr><td class="h">7</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is free software; you can redistribute it and/or</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td class="s"># modify it under the terms of the GNU General Public License</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td class="s"># as published by the Free Software Foundation; either version 2</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td class="s"># of the License, or (at your option) any later version. For</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td class="s"># more details read LICENSE in the root of this distribution.</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td class="s"># This program is distributed in the hope that it will be useful,</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td class="s"># but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td class="s"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td class="s"># As per the GPL, removal of this notice is prohibited.</td></tr>
<tr><td class="h">19</td><td colspan="6"></td></tr><tr><td class="h">20 - 27</td><td colspan="5"></td><td class="s"><pre>=pod

---+ package TWiki::Users

Singleton object that handles mapping of users to wikinames and
vice versa, and user authentication checking.

=cut</pre></td></tr>
<tr><td class="h">28</td><td colspan="6"></td></tr><tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td class="s">package TWiki::Users;</td></tr>
<tr><td class="h">30</td><td colspan="6"></td></tr><tr><td class="h">31</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L31">1</a></div></td><td><div>5</div><div>3</div><div>5</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">32</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L32">1</a></div></td><td><div>7</div><div>3</div><div>4</div></td><td class="s">use Assert;</td></tr>
<tr><td class="h">33</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L33">1</a></div></td><td><div>6</div><div>2</div><div>6</div></td><td class="s">use TWiki::User;</td></tr>
<tr><td class="h">34</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L34">1</a></div></td><td><div>6</div><div>5</div><div>5</div></td><td class="s">use TWiki::Time;</td></tr>
<tr><td class="h">35</td><td colspan="6"></td></tr><tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td class="s">BEGIN {</td></tr>
<tr><td class="h">37</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Do a dynamic &#39;use locale&#39; for this module</td></tr>
<tr><td class="h">38</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L38">50</a></div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L38">1</a></div></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $TWiki::cfg{UseLocale} ) {</td></tr>
<tr><td class="h">39</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;require locale;</td></tr>
<tr><td class="h">40</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import locale();</td></tr>
<tr><td class="h">41</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">43</td><td colspan="6"></td></tr><tr><td class="h">44 - 50</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ClassMethod new ($session, $impl)

Construct the user management object

=cut</pre></td></tr>
<tr><td class="h">51</td><td colspan="6"></td></tr><tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">53</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L53">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $class, $session ) = @_;</td></tr>
<tr><td class="h">54</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>2</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($session-&gt;isa( &#39;TWiki&#39;)) if DEBUG;</td></tr>
<tr><td class="h">55</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = bless( {}, $class );</td></tr>
<tr><td class="h">56</td><td colspan="6"></td></tr><tr><td class="h">57</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{session} = $session;</td></tr>
<tr><td class="h">58</td><td colspan="6"></td></tr><tr><td class="h">59</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $implPasswordManager = $TWiki::cfg{PasswordManager};</td></tr>
<tr><td class="h">60</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L60">50</a></div></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$implPasswordManager = &#39;TWiki::Users::Password&#39; if( $implPasswordManager eq &#39;none&#39; );</td></tr>
<tr><td class="h">61</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L61">1</a></div></td><td><div>14</div><div>4</div><div>9</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;eval &quot;use $implPasswordManager&quot;;</td></tr>
<tr><td class="h">62</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L62">50</a></div></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Password Manager: $@&quot; if $@;</td></tr>
<tr><td class="h">63</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{passwords} = $implPasswordManager-&gt;new( $session );</td></tr>
<tr><td class="h">64</td><td colspan="6"></td></tr><tr><td class="h">65</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $implUserMappingManager = $TWiki::cfg{UserMappingManager};</td></tr>
<tr><td class="h">66</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L66">50</a></div></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$implUserMappingManager = &#39;TWiki::Users::TWikiUserMapping&#39; if( $implUserMappingManager eq &#39;none&#39; );</td></tr>
<tr><td class="h">67</td><td><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L67">1</a></div></td><td><div>10</div><div>3</div><div>9</div><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;eval &quot;use $implUserMappingManager&quot;;</td></tr>
<tr><td class="h">68</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L68">50</a></div></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;die &quot;User Mapping Manager: $@&quot; if $@;</td></tr>
<tr><td class="h">69</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{usermappingmanager} = $implUserMappingManager-&gt;new( $session );</td></tr>
<tr><td class="h">70</td><td colspan="6"></td></tr><tr><td class="h">71</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>3</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{login} = {};</td></tr>
<tr><td class="h">72</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{wikiname} = {};</td></tr>
<tr><td class="h">73</td><td colspan="6"></td></tr><tr><td class="h">74</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>4</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{CACHED} = 0;</td></tr>
<tr><td class="h">75</td><td colspan="6"></td></tr><tr><td class="h">76</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# create the guest user</td></tr>
<tr><td class="h">77</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;createUser( $TWiki::cfg{DefaultUserLogin},</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$TWiki::cfg{DefaultUserWikiName} );</td></tr>
<tr><td class="h">79</td><td colspan="6"></td></tr><tr><td class="h">80</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this;</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">82</td><td colspan="6"></td></tr><tr><td class="h">83 - 92</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod finish

Complete processing after the client&#39;s HTTP request has been responded
to.
   1 breaking circular references to allow garbage collection in persistent
     environments

=cut</pre></td></tr>
<tr><td class="h">93</td><td colspan="6"></td></tr><tr><td class="h">94</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub finish {</td></tr>
<tr><td class="h">95</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L95">1</a></div></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">96</td><td colspan="6"></td></tr><tr><td class="h">97</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{passwords}-&gt;finish();</td></tr>
<tr><td class="h">98</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{usermappingmanager}-&gt;finish();</td></tr>
<tr><td class="h">99</td><td colspan="6"></td></tr><tr><td class="h">100</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $wikinames = $this-&gt;{wikiname};</td></tr>
<tr><td class="h">101</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while (my ($wikiname,$user) = each %$wikinames) {</td></tr>
<tr><td class="h">102</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$user-&gt;{groups} = ();</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">104</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>5</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{wikiname}  =  {};</td></tr>
<tr><td class="h">105</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{login}     =  {};</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">107</td><td colspan="6"></td></tr><tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td class="s">#returns a ref to an array of all group objects found.</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getAllGroups() {</td></tr>
<tr><td class="h">110</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L110">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">111</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users&#39;)) if DEBUG;</td></tr>
<tr><td class="h">112</td><td colspan="6"></td></tr><tr><td class="h">113</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L113">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (defined($this-&gt;{grouplist})) {</td></tr>
<tr><td class="h">114</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Always add $cfg{SuperAdminGroup}</td></tr>
<tr><td class="h">115</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sawAdmin = 0;</td></tr>
<tr><td class="h">116</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L116">0</a></div></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@{$this-&gt;{grouplist}} =</td></tr>
<tr><td class="h">117</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { $sawAdmin ||= ($_-&gt;wikiName() eq $TWiki::cfg{SuperAdminGroup}); $_ }</td></tr>
<tr><td class="h">118</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{usermappingmanager}-&gt;getListOfGroups();</td></tr>
<tr><td class="h">119</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L119">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$sawAdmin) {</td></tr>
<tr><td class="h">120</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@{$this-&gt;{grouplist}}, $this-&gt;findUser($TWiki::cfg{SuperAdminGroup}));</td></tr>
<tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">123</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return \@{$this-&gt;{grouplist}};</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">125</td><td colspan="6"></td></tr><tr><td class="h">126</td><td colspan="6"></td></tr><tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Get a list of user objects from a text string containing a</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td class="s"># list of user names. Used by User.pm</td></tr>
<tr><td class="h">129</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub expandUserList {</td></tr>
<tr><td class="h">130</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L130">3</a></div></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $names, $expand ) = @_;</td></tr>
<tr><td class="h">131</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>8</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users&#39;)) if DEBUG;</td></tr>
<tr><td class="h">132</td><td colspan="6"></td></tr><tr><td class="h">133</td><td><div class="c3">3</div></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L133">100</a></div></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$names ||= &#39;&#39;;</td></tr>
<tr><td class="h">134</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# comma delimited list of users or groups</td></tr>
<tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# i.e.: &quot;%MAINWEB%.UserA, UserB, Main.UserC  # something else&quot;</td></tr>
<tr><td class="h">136</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>10</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$names =~ s/(&lt;[^&gt;]*&gt;)//go;     # Remove HTML tags</td></tr>
<tr><td class="h">137</td><td colspan="6"></td></tr><tr><td class="h">138</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>47</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$names =~ s/\s*([$TWiki::regex{mixedAlphaNum}_\.\,\s\%]*)\s*(.*)/$1/go;</td></tr>
<tr><td class="h">139</td><td colspan="6"></td></tr><tr><td class="h">140</td><td><div class="c3">3</div><div class="c3">1</div></td><td></td><td></td><td></td><td><div>14</div><div>7</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @l = map { $this-&gt;findUser( $_ ) } split( /[\,\s]+/, $names );</td></tr>
<tr><td class="h">141</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return \@l;</td></tr>
<tr><td class="h">142</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">143</td><td colspan="6"></td></tr><tr><td class="h">144 - 169</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod findUser( $name [, $wikiname] [, $nocreate ] ) -&gt; $userObject

   * =$name= - login name or wiki name
   * =$wikiname= - optional, wikiname for created user
   * =$nocreate= - optional, disable creation of user object for user not found

Find the user object corresponding to =$name=, which may be either a
login name or a wiki name. If =$name= is found (either in the list
of login names or the list of wiki names) the corresponding
user object is returned. In this case =$wikiname= is ignored.

If they are not found, and =$nocreate= is true, then return undef.

If =$nocreate= is false, then a user object is returned even if
the user is not known.

If =$nocreate= is false, and no =$wikiname= is given, then the
=$name= is used for both login name and wiki name.

If nocreate is off, then a default user will be created with their wikiname
set the same as their login name. This user/wiki name pair can be overridden
by a later createUser call when the correct wikiname is known, if necessary.

=cut</pre></td></tr>
<tr><td class="h">170</td><td colspan="6"></td></tr><tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub findUser {</td></tr>
<tr><td class="h">172</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L172">5</a></div></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $name, $wikiname, $dontCreate ) = @_;</td></tr>
<tr><td class="h">173</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users&#39;)) if DEBUG;</td></tr>
<tr><td class="h">174</td><td><div class="c3">5</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L174">50</a></div></td><td></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$name ||= $TWiki::cfg{DefaultUserLogin};</td></tr>
<tr><td class="h">175</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $object;</td></tr>
<tr><td class="h">176</td><td colspan="6"></td></tr><tr><td class="h">177</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#$this-&gt;{session}-&gt;writeDebug(&quot;Looking for $name / $wikiname / $dontCreate&quot;);</td></tr>
<tr><td class="h">178</td><td colspan="6"></td></tr><tr><td class="h">179</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# is it a cached login name?</td></tr>
<tr><td class="h">180</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$object = $this-&gt;{login}{$name};</td></tr>
<tr><td class="h">181</td><td><div class="c3">5</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L181">100</a></div></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $object if $object;</td></tr>
<tr><td class="h">182</td><td colspan="6"></td></tr><tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remove pointless tag; we&#39;ll be looking there anyway</td></tr>
<tr><td class="h">184</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>13</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$name =~ s/^%MAINWEB%.//;</td></tr>
<tr><td class="h">185</td><td colspan="6"></td></tr><tr><td class="h">186</td><td><div class="c3">4</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L186">50</a></div></td><td></td><td></td><td><div>73</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $name =~ m/^$TWiki::regex{webNameRegex}\.$TWiki::regex{wikiWordRegex}$/o ) {</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# may be web.wikiname; try the cache</td></tr>
<tr><td class="h">188</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$object = $this-&gt;{wikiname}{$name};</td></tr>
<tr><td class="h">189</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L189">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $object if $object;</td></tr>
<tr><td class="h">190</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">191</td><td colspan="6"></td></tr><tr><td class="h">192</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# prepend the mainweb and try again in the cache</td></tr>
<tr><td class="h">193</td><td><div class="c3">4</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L193">50</a></div></td><td></td><td></td><td><div>49</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( $name =~ /^$TWiki::regex{wikiWordRegex}$/ ) {</td></tr>
<tr><td class="h">194</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$object = $this-&gt;{wikiname}{&quot;$TWiki::cfg{UsersWebName}.$name&quot;};</td></tr>
<tr><td class="h">195</td><td><div class="c3">4</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L195">50</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $object if $object;</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">197</td><td colspan="6"></td></tr><tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# not cached</td></tr>
<tr><td class="h">199</td><td colspan="6"></td></tr><tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if no wikiname is given, try and recover it from</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TWikiUsers</td></tr>
<tr><td class="h">202</td><td><div class="c3">4</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L202">50</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $wikiname ) {</td></tr>
<tr><td class="h">203</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>17</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wikiname = $this-&gt;lookupLoginName( $name );</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">205</td><td colspan="6"></td></tr><tr><td class="h">206</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L206">100</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L206">67</a></div></td><td></td><td><div>109</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if( !$wikiname &amp;&amp;</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name =~ m/^($TWiki::regex{webNameRegex}\.)?$TWiki::regex{wikiWordRegex}$/o ) {</td></tr>
<tr><td class="h">208</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $t = $name;</td></tr>
<tr><td class="h">209</td><td><div class="c3">3</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L209">50</a></div></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$t = &quot;$TWiki::cfg{UsersWebName}.$t&quot; unless $1;</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# not in TWiki users as a login name; see if it is</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# a WikiName</td></tr>
<tr><td class="h">212</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $lUser = $this-&gt;lookupWikiName( $t );</td></tr>
<tr><td class="h">213</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L213">50</a></div></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $lUser ) {</td></tr>
<tr><td class="h">214</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# it&#39;s a wikiname</td></tr>
<tr><td class="h">215</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$name = $lUser;</td></tr>
<tr><td class="h">216</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wikiname = $t;</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">219</td><td colspan="6"></td></tr><tr><td class="h">220</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if we haven&#39;t matched a wikiname yet and we&#39;ve been told</td></tr>
<tr><td class="h">221</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# not to create, then abandon ship</td></tr>
<tr><td class="h">222</td><td><div class="c3">4</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L222">50</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L222">67</a></div></td><td></td><td><div>35</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if ( !$wikiname &amp;&amp; $dontCreate );</td></tr>
<tr><td class="h">223</td><td colspan="6"></td></tr><tr><td class="h">224</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L224">100</a></div></td><td></td><td></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless( $wikiname ) {</td></tr>
<tr><td class="h">225</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# default to wikiname being the same as name.</td></tr>
<tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Commented out because this warning is too common, and tends to</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# flood the logs.</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# $this-&gt;{session}-&gt;writeWarning(&quot;$name does not exist in TWikiUsers - is this a bogus user?&quot;) unless( $name =~ /Group$/ );</td></tr>
<tr><td class="h">229</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>9</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wikiname = $name;</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">231</td><td colspan="6"></td></tr><tr><td class="h">232</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>19</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;createUser( $name, $wikiname );</td></tr>
<tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">234</td><td colspan="6"></td></tr><tr><td class="h">235 - 242</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod findUserByEmail( $email ) -&gt; \@users
   * =$email= - email address to look up
Return a list of user objects for the users that have this email registered
with the password manager.

=cut</pre></td></tr>
<tr><td class="h">243</td><td colspan="6"></td></tr><tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub findUserByEmail {</td></tr>
<tr><td class="h">245</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L245">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">246</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;ASSERT($this-&gt;isa( &#39;TWiki::Users&#39;)) if DEBUG;</td></tr>
<tr><td class="h">247</td><td colspan="6"></td></tr><tr><td class="h">248</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = $this-&gt;{passwords}-&gt;findUserByEmail(@_);</td></tr>
<tr><td class="h">249</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $user;</td></tr>
<tr><td class="h">250</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">251</td><td colspan="6"></td></tr><tr><td class="h">252 - 260</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod createUser( $login, $wikiname ) -&gt; $userobject

Create a user, and insert them in the maps (overwriting any current entry).
Use this instead of findUser when you want to be sure you are not going to
pick up any default user created by findUser. All parameters are required.

=cut</pre></td></tr>
<tr><td class="h">261</td><td colspan="6"></td></tr><tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub createUser {</td></tr>
<tr><td class="h">263</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L263">5</a></div></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $name, $wikiname ) = @_;</td></tr>
<tr><td class="h">264</td><td colspan="6"></td></tr><tr><td class="h">265</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $object = new TWiki::User( $this-&gt;{session}, $name, $wikiname );</td></tr>
<tr><td class="h">266</td><td><div class="c3">5</div></td><td><div class="c0" title="T/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L266">50</a></div></td><td></td><td></td><td><div>24</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( defined ($object) ) {</td></tr>
<tr><td class="h">267</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{login}{$object-&gt;login()} = $object;</td></tr>
<tr><td class="h">268</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;{wikiname}{$object-&gt;webDotWikiName()} = $object;</td></tr>
<tr><td class="h">269</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">270</td><td colspan="6"></td></tr><tr><td class="h">271</td><td><div class="c3">5</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $object;</td></tr>
<tr><td class="h">272</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">273</td><td colspan="6"></td></tr><tr><td class="h">274 - 281</td><td colspan="5"></td><td class="s"><pre>=pod

---++ ObjectMethod addUserToMapping( $user ) -&gt; $topicName

Add a user to the persistant mapping that maps from usernames to wikinames
and vice-versa.

=cut</pre></td></tr>
<tr><td class="h">282</td><td colspan="6"></td></tr><tr><td class="h">283</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub addUserToMapping {</td></tr>
<tr><td class="h">284</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L284">0</a></div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $this, $user, $me ) = @_;</td></tr>
<tr><td class="h">285</td><td colspan="6"></td></tr><tr><td class="h">286</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{usermappingmanager}-&gt;addUserToMapping($user, $me);</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">288</td><td colspan="6"></td></tr><tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Translates username (e.g. jsmith) to Web.WikiName</td></tr>
<tr><td class="h">290</td><td></td><td></td><td></td><td></td><td></td><td class="s"># (e.g. Main.JaneSmith)</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub lookupLoginName {</td></tr>
<tr><td class="h">292</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L292">4</a></div></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $loginUser ) = @_;</td></tr>
<tr><td class="h">293</td><td colspan="6"></td></tr><tr><td class="h">294</td><td><div class="c3">4</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L294">50</a></div></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $loginUser;</td></tr>
<tr><td class="h">295</td><td colspan="6"></td></tr><tr><td class="h">296</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>26</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$loginUser =~ s/$TWiki::cfg{NameFilter}//go;</td></tr>
<tr><td class="h">297</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td><div>25</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{usermappingmanager}-&gt;lookupLoginName($loginUser);</td></tr>
<tr><td class="h">298</td><td colspan="6"></td></tr><tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">300</td><td colspan="6"></td></tr><tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td class="s"># Translates Web.WikiName (e.g. Main.JaneSmith) to</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td class="s"># username (e.g. jsmith)</td></tr>
<tr><td class="h">303</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub lookupWikiName {</td></tr>
<tr><td class="h">304</td><td><div class="c3">3</div></td><td></td><td></td><td><div class="c3"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L304">3</a></div></td><td><div>12</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this, $wikiName ) = @_;</td></tr>
<tr><td class="h">305</td><td colspan="6"></td></tr><tr><td class="h">306</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L306">50</a></div></td><td></td><td></td><td><div>14</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $wikiName;</td></tr>
<tr><td class="h">307</td><td colspan="6"></td></tr><tr><td class="h">308</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$wikiName =~ s/$TWiki::cfg{NameFilter}//go;</td></tr>
<tr><td class="h">309</td><td><div class="c3">3</div></td><td><div class="c0" title="-/F"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L309">50</a></div></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$wikiName = &quot;$TWiki::cfg{UsersWebName}.$wikiName&quot;</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $wikiName =~ /\./;</td></tr>
<tr><td class="h">311</td><td colspan="6"></td></tr><tr><td class="h">312</td><td><div class="c3">3</div></td><td></td><td></td><td></td><td><div>16</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $this-&gt;{usermappingmanager}-&gt;lookupWikiName($wikiName);</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">314</td><td colspan="6"></td></tr><tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td class="s">#TODO: I was under the impression that this list would not contain every user, </td></tr>
<tr><td class="h">316</td><td></td><td></td><td></td><td></td><td></td><td class="s">#but i can&#39;t prove it..</td></tr>
<tr><td class="h">317</td><td></td><td></td><td></td><td></td><td></td><td class="s">#using TWikiUserMapping, this hash will contain users listed in a group, that don&#39;t exist</td></tr>
<tr><td class="h">318</td><td></td><td></td><td></td><td></td><td></td><td class="s">#Also, this list will contain a user that is in the current session file, even after it was removed from the system ( we don&#39;t check the validity of the user specified in the session - and thus a person can log in, then have their account removed, and until the session expires, they can still edit.)</td></tr>
<tr><td class="h">319</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getAllLoadedUsers {</td></tr>
<tr><td class="h">320</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L320">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $this = shift;</td></tr>
<tr><td class="h">321</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L321">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $includeGroups = shift || 0;</td></tr>
<tr><td class="h">322</td><td colspan="6"></td></tr><tr><td class="h">323</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list = ();</td></tr>
<tr><td class="h">324</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $key (sort keys(%{$this-&gt;{wikiname}})) {</td></tr>
<tr><td class="h">325</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $u = $this-&gt;{wikiname}{$key};</td></tr>
<tr><td class="h">326</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L326">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($u-&gt;isa( &#39;TWiki::User&#39;)) {</td></tr>
<tr><td class="h">327</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L327">0</a></div></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--condition.html#L327">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@list, $u) unless (($includeGroups == 0) &amp;&amp; ($u-&gt;isGroup()));</td></tr>
<tr><td class="h">328</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">329</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die $u;</td></tr>
<tr><td class="h">330</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">331</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">332</td><td colspan="6"></td></tr><tr><td class="h">333</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return \@list;</td></tr>
<tr><td class="h">334</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">335</td><td colspan="6"></td></tr><tr><td class="h">336</td><td></td><td></td><td></td><td></td><td></td><td class="s">#TODO: we need to re-write and bring together the different UserCaches</td></tr>
<tr><td class="h">337</td><td></td><td></td><td></td><td></td><td></td><td class="s">#this seems to be a safer list than getAllLoadedUsers()</td></tr>
<tr><td class="h">338</td><td></td><td></td><td></td><td></td><td></td><td class="s">#however, if there is a non-existant user in the TWikiUsers topic, it will be here.</td></tr>
<tr><td class="h">339</td><td></td><td></td><td></td><td></td><td></td><td class="s">sub getAllUsers {</td></tr>
<tr><td class="h">340</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="-usr-share-perl5-TWiki-Users-pm--subroutine.html#L340">0</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my( $this ) = @_;</td></tr>
<tr><td class="h">341</td><td colspan="6"></td></tr><tr><td class="h">342</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list = $this-&gt;{usermappingmanager}-&gt;getListOfAllWikiNames();</td></tr>
<tr><td class="h">343</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@list = sort(@list);</td></tr>
<tr><td class="h">344</td><td></td><td></td><td></td><td></td><td></td><td class="s">#    die join(&#39;, &#39;, @list);</td></tr>
<tr><td class="h">345</td><td colspan="6"></td></tr><tr><td class="h">346</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @userlist= ();</td></tr>
<tr><td class="h">347</td><td colspan="6"></td></tr><tr><td class="h">348</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $u (@list) {</td></tr>
<tr><td class="h">349</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $user = $this-&gt;findUser($u);</td></tr>
<tr><td class="h">350</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="-usr-share-perl5-TWiki-Users-pm--branch.html#L350">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@userlist, $user) if ($user-&gt;isa( &#39;TWiki::User&#39;));</td></tr>
<tr><td class="h">351</td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">352</td><td colspan="6"></td></tr><tr><td class="h">353</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return \@userlist;</td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">355</td><td colspan="6"></td></tr><tr><td class="h">356</td><td colspan="6"></td></tr><tr><td class="h">357</td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
