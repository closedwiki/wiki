#!/usr/bin/perl
#
# DatabasePluginEdit module.  Creates the HTML for the frames in the DB
# popup window that allows users to edit their DB.
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details, published at 
# http://www.gnu.org/copyleft/gpl.html

use CGI;
use lib ( '.' );
use lib ( '..' );
use lib ( '../lib' );
use lib ( '../../lib' );
use TWiki;
use DatabasePluginConfig;

use strict;

my $query= new CGI;

my $database = $query->param( 'database' );
my $table = $query->param( 'table' );
my $html;
my $http = $DatabasePluginConfig::db_edit_prefix;
my $user = $DatabasePluginConfig::db_username;
my $pw = $DatabasePluginConfig::db_password;
my $path = $DatabasePluginConfig::db_edit_url;

# If the 'database' argument has been specified, then return the main frame
# page for the DB edit page.  If not specified, return the top frame for
# the same main page.
if ($database ne "") {
    $html = "<html>\n"
    . "<head>\n"
    . "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\n"
    . "</head>\n"
    . "<frameset rows=\"4%,96%\" frameborder=\"yes\" border=\"0\" framespacing=\"0\"> \n"
    . "  <frame name=\"top\" scrolling=\"NO\" noresize src=\"$TWiki::scriptUrlPath/sec/DatabasePluginEdit\" >\n"
    . "  <frame name=\"bottom\" scrolling=\"yes\" noresize src=\"${http}://${user}:${pw}\@$path/sql.php3?lang=en&server=1&db=${database}&table=${table}&goto=tbl_properties.php3&sql_query=SELECT+%2A+FROM+%60${table}%60&pos=0\">\n"
    . "</frameset>\n"
    . "<noframes>\n"
    . "<body bgcolor=\"#FFFFFF\" marginwidth=\"0\" marginheight=\"0\" topmargin=\"0\" leftmargin=\"0\">\n"
    . "This site requires a browser that supports frames.\n"
    . "</body></noframes>\n"
    . "</html>\n";
} else {
    # If there are no arguments, then assume that this script is being
    # called to generate the code for the top 'close me' frame.
    $html = "<html>\n"
    . "<head>\n"
    . "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\n"
    . "</head>\n"
    . "<body bgcolor=\"#FFFFFF\" marginwidth=\"0\" marginheight=\"0\" topmargin=\"0\" leftmargin=\"0\">\n"
    . "<center>\n"
    . "<a href='javascript:parent.window.close();'>Close this window</a>\n"
    . "<hr>\n"
    . "</center>\n"
    . "</body>\n"
    . "</html>\n";
}
print "Content-type: text/html\n\n";
print $html;

# EOF
