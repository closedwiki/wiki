%META:TOPICINFO{author="StephaneLenclud" date="1173308327" format="1.1" version="1.11"}%
---+ Tree Browser Plugin

Renders a bulleted or numbered list as a collapsable/expandable tree of nodes.

---++ Acknowledgement

This plugin leverages the [[http://www.destroydrop.com/javascripts/tree/][dTree]] !JavaScript tree menu by [[mailto:drop@destroydrop.com][Geir Landrö]] as well as code borrowed from TWiki:Plugins.RenderListPlugin.

---++ Syntax Rules

Place the tag =%<nop>TREEBROWSER{= _parameters_ =}%= immediately before a bulleted or numbered list. The lists can be handcrafted, generated by another Plugin, a =%<nop>TOC%=, or the result of a %TWIKIWEB%.FormattedSearch. The list will be rendered in a tree-like fashion (similar to the explorer folder list). Whenever a new indentation level is started, the subsequent nodes at this or a lower indentation level are shown as descendents of the preceding node. The following parameters can be used to configure the appearance of the tree:
| *Parameter* | *Description* | *Default* |
| ="name"= or%BR% =theme="name"= | Select a rendering theme | none |
| =title= | Required. This text serves as the root of the tree | none |
| =openAll= | If =on=, the tree is shown fully expanded. | =off= |
| =openTo= | Must be an integer. If present, the tree is expanded to the given node, as numbered from the root. | =0= |
| =shared= | Must be a string. If present, the state of the tree is shared across all trees using this string. For example, if the tree is used in the WebLeftBar, the state will hold at all topics with this WebLeftBar. It's basically the name of the JavaScript object representing your tree. | none |
| =uselines= | Set to =false= if you don't want to show lines linking nodes and leafs in the tree | =true= |
| =useplusminus= | Set to =false= if you don't want to show '-' and '+' signs. One can use something like =onclick='javascript: tree.o($index);'= in the tree item to trigger opening/closing of a node. | =true= |
| =noindent= | Set to =true= to show children at the level their parent. It suppresses children indentation. | =false= |
| =nocss= | Set to =true= to prevent inclusion of =dtree.css=. | =false= |
| =closesamelevel= | If =true= only one node within a parent can be expanded at the same time. openAll() and closeAll() functions do not work when this is enabled. | =false= |
| =noroot= | Prevents rendering of the title line. Useful if you don't want to show any title. | =false= |
| =warn= | Text to be displayed if no tree was found. | none |

Rendering themes can be defined by =&lt;name&gt;_THEME= Plugin settings
   * Each theme is defined by a comma separated list containing the render type and parameters required by that render type
   * There are different render types; currently this Plugin supports *tree* and *icon* render types
   * Format of the *tree* render type:
      * =Set &lt; _name_ &gt;_THEME = tree=
   * Format of the *icon* render type:
      * =Set &lt; _name_ &gt;_THEME = icon, [&lt; _root icon image_ &gt;], [&lt; _icon image_ &gt;], [&lt; _folder icon image_ &gt;], [&lt; _open folder icon image_ &gt;]=
      * The _root icon image_ is shown at the root of the tree, the _icon image_ is shown at every leaf node, the _folder icon image_ is shown at every collapsed internal node, and the _open folder icon image_ is shown at every expanded internal node. The icon images point to files attached to TWiki topics and are referenced in the standard manner. If no path is given, the images are taken from TWiki.TWikiDocGraphics.
      * If an icon image is omitted, the following defaults are chosen: %ATTACHURL%/empty.gif, %ATTACHURL%/page.gif, %ATTACHURL%/folder.gif, %ATTACHURL%/folderopen.gif

If !JavaScript is not enabled, the list is rendered as usual, and the =%<nop>TREEBROWSER% tag is omitted.

---+++ Bullets

   * Use regular ==*== bullets
   * Start with level one
      * Increase indentation only one level at a time
         * =Like this=
   * Decreasing indentation many levels at a time is fine
   * Keep labels short as text does not wrap.
   * You can specify an icon for a bullet of render type *tree* or *icon*:
      * Attach the icon to a topic, e.g. =myicon.gif=, or
      * Use one of the existing icons: %ATTACHURL%/globe.gif =%<nop>ATTACHURL%/globe.gif=, %ATTACHURL%/home.gif =%<nop>ATTACHURL%/home.gif=, %ATTACHURL%/virtualhome.gif =%<nop>ATTACHURL%/virtualhome.gif=, %ATTACHURL%/group.gif =%<nop>ATTACHURL%/group.gif=, %ATTACHURL%/persons.gif =%<nop>ATTACHURL%/persons.gif=, %ATTACHURL%/virtualpersons.gif =virtualpersons.gif=, %ATTACHURL%/person.gif =%<nop>ATTACHURL%/person.gif=, %ATTACHURL%/virtualperson.gif =%<nop>ATTACHURL%/virtualperson.gif=, %ATTACHURL%/email.gif =%<nop>ATTACHURL%/email.gif=, %ATTACHURL%/trend.gif =%<nop>ATTACHURL%/trend.gif=, %ATTACHURL%/folder.gif =%<nop>ATTACHURL%/folder.gif=, %ATTACHURL%/file.gif =%<nop>ATTACHURL%/file.gif=, %ATTACHURL%/doc.gif =%<nop>ATTACHURL%/doc.gif=, %ATTACHURL%/image.gif =%<nop>ATTACHURL%/image.gif=, %ATTACHURL%/pdf.gif =%<nop>ATTACHURL%/pdf.gif=, %ATTACHURL%/ppt.gif =%<nop>ATTACHURL%/ppt.gif=, %ATTACHURL%/sound.gif =%<nop>ATTACHURL%/sound.gif=, %ATTACHURL%/xls.gif =%<nop>ATTACHURL%/xls.gif=, %ATTACHURL%/zip.gif =%<nop>ATTACHURL%/zip.gif=, %ATTACHURL%/see.gif =%<nop>ATTACHURL%/see.gif=
      * Refer to an attached icon at the beginning of the bullet with:
         * =icon:myicon.gif Followed by normal bullet text=

---++ Example

<verbatim>
%TREEBROWSER{"file" title="[[%HOMETOPIC%][%INCLUDINGWEB% Web Home]]" shared="left"}%
   * [[WebChanges][Changes]] 
   * [[WebIndex][Index]]
   * [[WebSearch][Search]]
   * this is a very very very long text
   * *Webs*
%WEBLIST{"      * [[$name.%HOMETOPIC%][$name]]"}%
</verbatim>
generates
<table borders="0">
<tr><th align="left">If installed</th><th align="left">Simulated</th></tr>
<tr><td>
%TREEBROWSER{"file" title="[[%HOMETOPIC%][%INCLUDINGWEB% Web Home]]" shared="left"}%
   * [[WebChanges][Changes]] 
   * [[WebIndex][Index]]
   * [[WebSearch][Search]]
   * this is a very very very long text
   * Folder
      * Leaf1
      * Subfolder
         * Leaf3
      * Leaf2
   * *Webs*
%WEBLIST{"      * [[$name.%HOMETOPIC%][$name]]"}%

<a href="javascript: left.openAll();">open all</a> | <a href="javascript: left.closeAll();">close all</a>

</td><td><image src="%ATTACHURL%/tree.jpg"></td></tr></table>

This tree could be used in the TWiki.WebLeftBar, for example. Clicking on the plus icon next to =Webs= will expand the subtree below that node.

To add _"collapse/expand all nodes"_ functionalities do something like:
<verbatim><a href="javascript: tree.openAll();">open all</a> | <a href="javascript: tree.closeAll();">close all</a>
%TREEBROWSER{"file" title="[[%HOMETOPIC%][%INCLUDINGWEB% Web Home]]" shared="tree"}%
...</verbatim>


---++ Plugin Settings

Plugin settings are stored as preferences variables. To reference
a plugin setting write ==%<nop>&lt;plugin&gt;_&lt;setting&gt;%==, i.e. ==%<nop>TREEBROWSERPLUGIN_SHORTDESCRIPTION%==

   * One line description, is shown in the %TWIKIWEB%.TextFormattingRules topic:
      * Set SHORTDESCRIPTION = Renders a list as a collapsable/expandable tree.

   * Debug plugin: (See output in =data/debug.txt=)
      * Set DEBUG = 0

   * Themes are named =&lt;SOMETHING&gt;_THEME= and contain a comma delimited list of render type with parameters:
      * Set THREAD_THEME = tree
      * Set HOME_THEME = icon, %ATTACHURL%/home.gif
      * Set ORG_THEME = icon, %ATTACHURL%/base.gif, %ATTACHURL%/home.gif, %ATTACHURL%/person.gif, %ATTACHURL%/persons.gif
      * Set GROUP_THEME = icon, tip.gif, %ATTACHURL%/page.gif, %ATTACHURL%/person.gif, %ATTACHURL%/group.gif
      * Set EMAIL_THEME = icon, %ATTACHURL%/email.gif
      * Set TREND_THEME = icon, %ATTACHURL%/trend.gif
      * Set FILE_THEME = icon, %ATTACHURL%/empty.gif
      * Set DIR_THEME = icon, %ATTACHURL%/empty.gif,%ATTACHURL%/empty.gif
      * Set FORUM_THEME = icon, group.gif, index.gif, indexlist.gif, indexlist.gif

---++ Plugin Installation Instructions

   0 Download the zip file.
   0 Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
     | *File:* | *Description:* |
     | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
     | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
     | ==pub/TWiki/%TOPIC%/dtree.css== | part of dtree |
     | ==pub/TWiki/%TOPIC%/dtree.js== | part of dtree |
     | ==pub/TWiki/%TOPIC%/base.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/cd.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/empty.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/folder.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/folderopen.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/globe.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/imgfolder.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/join.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/joinbottom.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/line.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/minus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/minusbottom.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/musicfolder.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/nolines_minus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/nolines_plus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/page.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/plus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/plusbottom.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/question.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/trash.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/doc.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/email.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/file.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/group.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/home.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/image.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/pdf.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/person.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/persons.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/ppt.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/see.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/sound.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/trend.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/virtualhome.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/virtualperson.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/virtualpersons.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/xls.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/zip.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |

---++ Planned Enhancements

   * Support configurable icons for each node (similar to TWiki:Plugins.RenderListPlugin). _SL: Sounds fun!_
   * Support configurable default icons. _SL: I think this was done sometimes ago._
   * Support wrapping of long node text. _SL: Not sure how to do that? Looks like it's not such a big problem with Firfox._
   * Support tree browser in other than view mode also. _SL: Not sure what's that?_
   * Cleanup and comment !JavaScript code.
   
---++ Plugin Info

|  Plugin Author: | TWiki:Main.ThomasWeigert |
|  Plugin Version: | v0.8 |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  07 Mar 2007: | (v0.8) - Adding =noroot= and =warn= parameters. Now using =preRenderingHandler= instead of the deprecated =startRenderingHandler= . =%<nop>TREEBROWSER%= are hidden if there is no tree to render. By [[TWiki:Main.StephaneLenclud][Stéphane Lenclud]]. |
|  01 Oct 2006: | (v0.7) - Adding =useplusminus= , =noindent= and =nocss= parameters. By [[TWiki:Main.StephaneLenclud][Stéphane Lenclud]]. |
|  17 Sep 2006: | (v0.6) - Adding =closesamelevel= and =uselines= functionalities, fix rendering issues with Firefox and pattern skin, fix warnings in apache error logs. By [[TWiki:Main.StephaneLenclud][Stéphane Lenclud]] |
|  12 Apr 2006: | (v0.5) - Minor update for TWiki:Codev.TWikiRelease04x00  |
|  16 Sep 2005: | (v0.4) - Fix bug in =openAll= and =openTo= functions  |
|  06 Sep 2005: | (v0.3) - Adopt the rendering themes from TWiki:Plugins.RenderListPlugin |
|  05 Sep 2005: | (v0.2) - Support sharing of tree state across topics. If !JavaScript is not enabled, render the list in standard fashion. Correct user input error containig a line that is too deeply indented. |
|  04 Sep 2005: | (v0.1) - Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.024 |
|  CPAN Dependencies: | none |
|  Other Dependencies: | none |
|  Perl Version: | 5.005, 5.8.7 |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  TWiki:Plugins/Benchmark: | %TWIKIWEB%.GoodStyle n%, %TWIKIWEB%.FormattedSearch n%, %TOPIC% n% |
|  Plugin Home: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC% |
|  Feedback: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Dev |
|  Appraisal: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Appraisal |

__Related Topics:__ TWiki:Plugins.RenderListPlugin

-- TWiki:Main.ThomasWeigert - 16 Sep 2005


%META:FILEATTACHMENT{name="empty.gif" attr="" autoattached="1" comment="" date="1151849905" path="empty.gif" size="62" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="email.gif" attr="" autoattached="1" comment="" date="1151849905" path="email.gif" size="183" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="dtree.js~" attr="" autoattached="1" comment="" date="1159656757" path="dtree.js~" size="12407" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="xls.gif" attr="" autoattached="1" comment="" date="1151849905" path="xls.gif" size="918" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="joinbottom.gif" attr="" autoattached="1" comment="" date="1151849905" path="joinbottom.gif" size="66" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="question.gif" attr="" autoattached="1" comment="" date="1151849905" path="question.gif" size="1044" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="file.gif" attr="" autoattached="1" comment="" date="1151849905" path="file.gif" size="151" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="musicfolder.gif" attr="" autoattached="1" comment="" date="1151849905" path="musicfolder.gif" size="633" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="person.gif" attr="" autoattached="1" comment="" date="1151849905" path="person.gif" size="153" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="doc.gif" attr="" autoattached="1" comment="" date="1151849905" path="doc.gif" size="922" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="virtualpersons.gif" attr="" autoattached="1" comment="" date="1151849905" path="virtualpersons.gif" size="160" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="imgfolder.gif" attr="" autoattached="1" comment="" date="1151849905" path="imgfolder.gif" size="622" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="folderopen.gif" attr="" autoattached="1" comment="" date="1151849905" path="folderopen.gif" size="376" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="cd.gif" attr="" autoattached="1" comment="" date="1151849905" path="cd.gif" size="239" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="virtualperson.gif" attr="" autoattached="1" comment="" date="1151849905" path="virtualperson.gif" size="149" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="group.gif" attr="" autoattached="1" comment="" date="1151849905" path="group.gif" size="162" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="dtree.css" attr="" autoattached="1" comment="" date="1159656429" path="dtree.css" size="817" user="Main.StephaneLenclud" version="1"}%
%META:FILEATTACHMENT{name="minus.gif" attr="" autoattached="1" comment="" date="1151849905" path="minus.gif" size="86" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="ppt.gif" attr="" autoattached="1" comment="" date="1151849905" path="ppt.gif" size="921" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="join.gif" attr="" autoattached="1" comment="" date="1151849905" path="join.gif" size="69" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="page.gif" attr="" autoattached="1" comment="" date="1151849905" path="page.gif" size="582" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="nolines_minus.gif" attr="" autoattached="1" comment="" date="1151849905" path="nolines_minus.gif" size="861" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="plusbottom.gif" attr="" autoattached="1" comment="" date="1151849905" path="plusbottom.gif" size="88" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="pdf.gif" attr="" autoattached="1" comment="" date="1151849905" path="pdf.gif" size="938" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="minusbottom.gif" attr="" autoattached="1" comment="" date="1151849905" path="minusbottom.gif" size="85" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="nolines_plus.gif" attr="" autoattached="1" comment="" date="1151849905" path="nolines_plus.gif" size="870" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="persons.gif" attr="" autoattached="1" comment="" date="1151849905" path="persons.gif" size="164" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="dtree.js" attr="" autoattached="1" comment="" date="1159656769" path="dtree.js" size="12407" user="Main.StephaneLenclud" version="8"}%
%META:FILEATTACHMENT{name="sound.gif" attr="" autoattached="1" comment="" date="1151849905" path="sound.gif" size="166" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="home.gif" attr="" autoattached="1" comment="" date="1151849905" path="home.gif" size="172" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="folder.gif" attr="" autoattached="1" comment="" date="1151849905" path="folder.gif" size="372" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="tree.jpg" attr="" autoattached="1" comment="" date="1151849905" path="tree.jpg" size="8115" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="zip.gif" attr="" autoattached="1" comment="" date="1151849905" path="zip.gif" size="940" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="image.gif" attr="" autoattached="1" comment="" date="1151849905" path="image.gif" size="943" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="base.gif" attr="" autoattached="1" comment="" date="1151849905" path="base.gif" size="1040" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="see.gif" attr="" autoattached="1" comment="" date="1151849905" path="see.gif" size="81" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="trend.gif" attr="" autoattached="1" comment="" date="1151849905" path="trend.gif" size="149" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="trash.gif" attr="" autoattached="1" comment="" date="1151849905" path="trash.gif" size="1051" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="line.gif" attr="" autoattached="1" comment="" date="1151849905" path="line.gif" size="66" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="dtree.css~" attr="" autoattached="1" comment="" date="1159398861" path="dtree.css~" size="821" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="virtualhome.gif" attr="" autoattached="1" comment="" date="1151849905" path="virtualhome.gif" size="162" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="plus.gif" attr="" autoattached="1" comment="" date="1151849905" path="plus.gif" size="89" user="UnknownUser" version=""}%
%META:FILEATTACHMENT{name="globe.gif" attr="" autoattached="1" comment="" date="1151849905" path="globe.gif" size="1095" user="UnknownUser" version=""}%
