---+!! !NativeSearchContrib
<!--
One line description, required for extensions repository catalog.
   * Set SHORTDESCRIPTION = Native code search for use with CGI accelerators
-->
<img style="float:right" src="%ATTACHURLPATH%/logo.gif" />
%SHORTDESCRIPTION%

By default TWiki searches its database by forking the standard GNU =grep= program in a subprocess to search through the text files in the database cache. This is usually pretty fast, but unfortunately in some environments (specifically with =mod_perl=) forking a sub-process is very expensive, and another approach is needed.

!NativeSearch is a c-code module that can be plugged into TWiki to replace the default searching algorithm. It publishes an XS interface that allows it to be called from Perl, without having to spawn a subprocess. It has comparable performance to the standard forked search in most environments, but is often significantly faster than forked search when TWiki is run under a CGI accelerator. The effect is most pronounced with =mod_perl=, but is also there for !SpeedyCGI.

Refer to TWiki:Codev.NativeSearch for a list of systems where the module has been successfully compiled and installed (and please update it if you find a new one).

---++ Installation Instructions

Before you start, there are some prerequisites. 
   1 you must have a C compiler (=gcc= has been tested). Most Unix/Linux systems will have this already. On Win32 you !MinGW is recommended.
   2 you will need =make= (a standard development tool). Unix/Linux users will have this already; others may have to search. Use =nmake= on Win32. 
   3 Finally you will need the development versions of the [[http://www.pcre.org/][pcre]] library (required for perl compatible regular expressions). This is a standard Linux library and will be available in an RPM or Debian package or whatever for your system. It is available for !GnuWin32 for Windows.

%$INSTALL_INSTRUCTIONS%

---+++ Building the c-code

=cd= to the root directory in your TWiki installation. Now:
<verbatim>
$ cd tools/native_search
$ perl Makefile.PL
$ make install
$ perl test.pl -i -l NativeTWikiSearch test.pl Makefile.PL NativeTWikiSearch.xs
</verbatim>
(on Win32 you make have to use =nmake=)

Make sure that the =perl test.pl= returns something sane, and _NOT_ a =Segmentation fault= (in which case you'll need to debug it and fix it before going further).
(=test.pl= is simply a stub interface to the native search, so it behaves like =grep=. The test above simply greps for the string "NativeSearch" in the files Makefile.PL and NativeTWikiSearch.xs)

Easy, huh? Unless, maybe you aren't root, and couldn't install? If so, you can use =perl Makefile.PL INSTALL_BASE=/your/dir= to install to a different directory.

Now, in =configure=, click "Yes, I have read all the documention". Under "Store Settings" you can now select the search algorithm ='TWiki::Store::SearchAlgorithms::Native'=. Watch the web server error log to see if there are any issues.

Because performance can differ widely between two similar webserver configurations, you are recommended to do your own benchmarking and select the search algorithm that performs best for you.

---++ Contrib Info

Another great TWiki extension from the <a style="text-decoration:none" href="http://wikiring.com"><img src="%ATTACHURLPATH%/wikiringlogo20x20.png" alt="" /> *WikiRing* </a> - working together to improve your wiki experience!

Many thanks to the following sponsors for supporting this work:
   * Wind River Systems http://windriver.com

|  Contrib Author(s): | Crawford Currie http://c-dot.co.uk |
|  Copyright: | &copy; !WikiRing 2007 |
|  License: | [[http://www.gnu.org/licenses/gpl.html][GPL (Gnu General Public License)]] |
|  Contrib Version: | %$VERSION% |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  Dependencies: | %$DEPENDENCIES% |
|  Contrib Home: | http://twiki.org/cgi-bin/view/Plugins/NativeSearchContrib |
|  Feedback: | http://twiki.org/cgi-bin/view/Plugins/NativeSearchContribDev |
|  Appraisal: | http://twiki.org/cgi-bin/view/Plugins/NativeSearchContribAppraisal |

__Related Topics:__ %SYSTEMWEB%.TWikiContribs, %SYSTEMWEB%.DeveloperDocumentationCategory, %SYSTEMWEB%.AdminDocumentationCategory, %SYSTEMWEB%.TWikiPreferences

<!-- Do _not_ attempt to edit this topic; it is auto-generated. Please add comments/questions/remarks to the feedback topic on twiki.org instead. -->

%META:FILEATTACHMENT{name="wikiringlogo20x20.png" attr="h" comment="" version="1"}%
%META:FILEATTACHMENT{name="logo.gif" attr="h" comment="" version="1"}%
