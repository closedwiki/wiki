%META:TOPICINFO{author="TWikiContributor" date="1131431859" format="1.1" version="$Rev$"}%
%META:TOPICPARENT{name="WebHome"}%
---+ %MAKETEXT{"Create New Topic in [_1] Web" args="<nop>%BASEWEB%"}%
%STARTSECTION{"formstart"}%<script type="text/javascript">
//<![CDATA[
function canSubmit(inForm, inShouldConvertInput) {
	var inputForTopicName = inForm.topic.value;

	// Topic names of zero length are not allowed
	if (inputForTopicName.length == 0) {
		disableSubmit(inForm.submit);
		return false;
	}
	
	var userAllowsNonWikiWord = inForm.nonwikiword.checked;

	// check if current input is a valid WikiWord
	var noSpaceName = removeSpacesAndPunctiation(inputForTopicName);
	var isAWikiWord = isWikiWord(noSpaceName);

	// if necessary, create a WikiWord from the input
	var wikiWordName = noSpaceName;
	if (!userAllowsNonWikiWord) {
		wikiWordName = removeSpacesAndPunctiation(capitalize(inputForTopicName));
		// check again with new WikiWord value
		isAWikiWord = isWikiWord(wikiWordName);
	}	
	
	if (inShouldConvertInput) {
		if (userAllowsNonWikiWord) inForm.topic.value = noSpaceName;
		if (!userAllowsNonWikiWord) inForm.topic.value = wikiWordName;
	}
	
	var returnValue = false;
	if (isAWikiWord || userAllowsNonWikiWord) {
		enableSubmit(inForm.submit);
		returnValue = true;
	} else {
		disableSubmit(inForm.submit);
		returnValue= false;
	}

	// update feedback field
	inForm.feedback.value = wikiWordName;

	// Update hidden field value
	// Use the negative value of the checkbox. This is the ugly way but must be used until edit script parameter =allowsnonwikiword= is implemented.
	inForm.onlywikiname.value = (userAllowsNonWikiWord == true) ? "off" : "on";

	return returnValue;
}
function setCheckBoxState (inCheckBox, inState) {
	inCheckBox.checked = inState;
}
function enableSubmit(inButton) {
	removeClass(inButton, "twikiSubmitDisabled");
	inButton.disabled = false;
}
function disableSubmit(inButton) {
	addClass(inButton, "twikiSubmitDisabled");
	inButton.disabled = true;
}
//]]>
</script>
<form name="newtopic" id="newtopic" action="%SCRIPTURLPATH{edit}%/%BASEWEB%/" onsubmit="return canSubmit(this,true);">%ENDSECTION{"formstart"}%
<div class="twikiFormSteps">
<div class="twikiFormStep">
---+++ %MAKETEXT{"Topic name:"}%
<p>%STARTSECTION{"topicname"}%<input type="text" class="twikiInputField" name="topic" id="topic" size="40" tabindex="10" %IF{"'%PREFILLTOPIC%'='1'" then="value=\"%BASETOPIC%\"" else="value=\"\""}% onkeyup="canSubmit(this.form,false);" onblur="canSubmit(this.form,true);" /> <input type="text" class="twikiInputFieldDisabled" style="background-color:transparent" readonly="readonly" disabled="disabled" name="feedback" id="feedback" size="40" />%ENDSECTION{"topicname"}%</p>
<p>%STARTSECTION{"allownonwikiword"}%<input type="checkbox" class="twikiCheckbox" id="nonwikiword" name="nonwikiword" tabindex="11" onchange="canSubmit(this.form,false);" /><label for="nonwikiword">%MAKETEXT{"Allow non <nop>WikiWord for the new topic name"}%</label><br />
<span class="twikiGrayText">%MAKETEXT{"It's usually best to choose a <a target='WikiWord' onclick=\"return launchWindow('[_1]','WikiWord')\" href='[_1]' rel='nofollow'>WikiWord</a> for the new topic name, otherwise automatic linking may not work. Characters not allowed in topic names, such as spaces will automatically be removed." args="%TWIKIWEB%,%SCRIPTURLPATH{"view"}%/%TWIKIWEB%/WikiWord"}%</span>%ENDSECTION{"allownonwikiword"}%</p>
</div><!--/twikiFormStep-->
<div class="twikiFormStep">
---+++ %MAKETEXT{"Topic parent:"}%
<p>%STARTSECTION{"topicparent"}%<select name="topicparent" size="10" tabindex="12">
%TOPICLIST{"<option $marker value='$name'>$name</option>" separator=" " selection="%URLPARAM{ "parent" default="%MAKETEXT{"(no parent, orphaned topic)"}%" }%"}%
<option value="">%MAKETEXT{"(no parent, orphaned topic)"}%</option>
</select>%ENDSECTION{"topicparent"}%</p>
</div><!--/twikiFormStep-->
<div class="twikiFormStep twikiLast">
<p>%STARTSECTION{"submit"}%<input id="submit" type="submit" class="twikiSubmit" tabindex="13" value='%MAKETEXT{"Create this topic"}%' />%ENDSECTION{"submit"}%</p>
</div><!--/twikiFormStep-->
</div><!--/twikiFormSteps-->
%STARTSECTION{"formend"}%<input type="hidden" name="onlywikiname" />
<input type="hidden" name="onlynewtopic" value="on" />
</form>
<script type="text/javascript">
//<![CDATA[
// Read url param 'allowsnonwikiword'
// This calls for a variable 'ALLOWSNONWIKIWORD'
var allowsNonWikiWord = %URLPARAM{"allowsnonwikiword" default=0}%;
setCheckBoxState(document.forms.newtopic.nonwikiword, (eval(allowsNonWikiWord)) ? "checked" : "off");
// start with a check
canSubmit(document.forms.newtopic,false);
//]]>
</script>%ENDSECTION{"formend"}%
%BR%
<div class="twikiHelp">
%ICON{info}% %MAKETEXT{"Once you have created the topic, consider adding links in related topics to the new topic so that there are more ways people can discover it."}%
</div>
