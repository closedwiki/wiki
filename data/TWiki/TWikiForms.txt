%META:TOPICINFO{author="JohnTalintyre" date="999597196" format="1.0" version="1.6"}%
%META:TOPICPARENT{name="WebHome"}%
%TOC%
%STARTINCLUDE%
---## Form Templates

Topics allow for flexible free format data, sometimes you want to ensure strucutre to some of the topic information, this can be done with Forms e.g. saying what type of topic it is (e.g. Bug, Feature, FAQ entry etc) and then filling in fields using dropdowns, radio buttons etc.

---+++ Overview

If forms are enabled for a Web and a topic has a form you will see it as a table when viewing the page.  When you edit you will see the various edit controls below the normal text area.  There will be a button at the top of the form marked _Change_ which allows you to change to a different form, or remove the form.  If you edit a topic without a form, there will be a button _Add Form_, that let's you associate a form with the topic; note that changes you have made to the topic are not lost when you select this option.

You can search for topics with specific form data using the %<nop>SEARCH% variable - see [[TWikiDocumentation#TWikiVariables][TWikiVariables]].

---+++ <nop>TWikiCategoryTables Are History

Form Templates more powerful, flexible replacement for the original <nop>TWikiCategoryTable. 

---++++ Changes from the Category Table System

Main changes from <nop>TWikiCategoryTable: The templates for category view/edit have been dropped, and the forma renders to HTML on viewing.

| *Form Templates* | *Category Tables* |
| defined by topics | defined in a template file |
| multiple forms per web | one category per web |
| data saved in Meta variables | data saved as HTML |
| [Change] form and [Add Form] contol buttons | <nop>UseCategory radio button |

---++++ Migrating Existing Category Table Data

The new Form Template system should work with old Category Table data with no special conversion. Old data should be transparently upgraded to the new Meta format when a page imported from the old TWiki is edited and saved in the new system for the first time.

On upgrading, the administrator must produce a form template topic for each web that uses the old Category Tables. =twikicatitems.tmpl= defines the categories and is used in the conversion. The form template must be set as the first item in the WebPreferences variable ==WEBFORM=. If it's not present, =view= works, but =edit= results in an _oops_ dialog result. If things aren't working correctly, there may be entries in =data/warning.txt=.

---+++ Form Template Elements

	* *Form Template:* A set of fields defining a form. (_Class_ in OO speak; used to be called _category table definition_)
		* A web may contain more then zero or more form template.
	* *Form:* A topic containing additional meta-data (besides the free form TEXTAREA) which categorizes the content. (_Object_ in OO speak; used to be called _category table_)
		* A topic has zero or one of the defined forms. So there are topics with a form or without.
	* *Form Field:* A named item in a form. (Used to be called _category item name_)
	* *Field Type:* The type of a field when editing a form. The type defines the HTML INPUT tag widgets when editing a topic:
		* *select:* Drop down box or selector
		* *checkbox:* One or more check boxes
		* *checkbox+buttons:* One or more check boxes, plus [Set] and [][Clear] buttons to set/clear all checkboxes
		* *radio:* One or more radio buttons
		* *text:* A one-line text field
		* *textarea:* A general text area - size is <i>rows</i>x<i>cols</i> 40x10
	* *Field Value:* Value of a form field. Can be one or more values from a fixed set (select, checkbox, radio type) or free form (text type). (Used to be called _category item value_)

---++++ Defining a Form Template

A Form Template is simply a page containing your form, defined in a table where each row is one form field.

	1. Create a new topic with your Form name: <nop>MyForm, <nop>ExpenseReport, <nop>InfoCategory, <nop>RecordReview, whatever you need.
	1. Create a TWiki table, with each column representing one element of an entry field: Name, Type, Size, Values, and Tooltip msessage (see sample below).
	1. For each field, fill in a new line; for the type of field, select from the list.
	1. Save the topic.

<blockquote style="background-color:#f0f0f0">
<span style="color:#0000ff"><b>Example:</b> Form Template  </span>
<verbatim>
| *Name:* | *Type:* | *Size:* | *Values:* | *Tooltip message:* |
| TopClass | select | 1 | Select one..., Private, Public | must fill |
| Target	| checkbox+buttons | 3 | 1, No.2, No.3 | Select OS |
| Version | text | 16 | | OS version |
</verbatim>
</blockquote>

---++++ Defining a Form in One Topic

Example: <nop>WebFormTemplate of the TWiki.Know web:

| *Name:* | *Type:* | *Size:* | *Values:* | *Tooltip message:* |
| Know.TopicClassification | select | 1 | Know.NoDisclosure, Know.PublicSupported, Know.PublicFAQ | blah blah... |
| Know.OperatingSystem | checkbox | 3 | Know.OsHPUX, Know.OsLinux, Know.OsSolaris, Know.OsWin | blah blah... |
| Know.OsVersion | text | 16 | | blah blah... |

---++++ Defining a Form in Multiple Topics

The form template can also be defined in an alternative way by using more then one topic:

	* A *form template topic* defines the form
	* Values of fields that have more then one value, e.g. of type radio, select and checkbox can be defined by *field value template topics*

</blockquote><blockquote style="background-color:#f0f0f0">
<span style="color:#0000ff"><b>Code from:</b>  </span>

	* <nop>WebFormTemplate of the TWiki.Know web:
	  | *Name:* | *Type:* | *Size:* | *Values:*  | *Tooltip message:* |
	  | Know.TopicClassification | select | 1 | | blah blah... |
	  | Know.OperatingSystem | checkbox | 3 | | blah blah... |
	  | Know.OsVersion | text | 16 | | blah blah... |

	* <nop>TopicClassification topic:
	  | *Name:* | *Type:* | *Tooltip message:* |
	  | Know.NoDisclosure | option | blah blah... |
	  | Know.PublicSupported | option | blah blah... |
	  | Know.PublicFAQ | option | blah blah... |
</blockquote>

---++++ Various Implementation Notes

	* This format allows you to define field items with / without TWiki.WikiNames, depending on your needs.
	* The topic can be protected in the usual manner so that not everybody can change the form template - see TWikiAccessControl
	* =[[...]]= can be used for force a link, at present =[[...][...]]= format is not supported
	* The "Tooltip message:" column is used as a tool tip for the field name (only if field name is a TWiki.WikiName) - you only see the tooltip on edit
	* The first item in the list is the default item.  Alternative initial values can be given in a topic template such as ==WebTopicEditTemplate== or using field=value or for checkboxes field<checkbox name>=1
	* The topic definition is not read when a topic is viewed

---+++ Enabling Forms by Web

Forms are enabled on a per web basis. The ==WEBFORMS== variable in WebPreferences is optional and defines a list of possible form templates e.g.
	* <nop>Set WEBFORMS = <nop>BugForm, <nop>FeatureForm, <nop>BookLoanForm

With ==WEBFORMS== enabled, an extra button is added to the edit view. If the topic doesn't have a form an [Add Form] button appears at the end of the topic. If a form is present, a [Change] button appears in the top row of the form. The buttons lead to a screen that enables _no form_ to be selected or one of those specified by =WEBFORMS=.

A default form template (i.e. new topics get this default form) can be provided by creating the ==WebTopicEditTemplate== topic in a Web and adding a form to it.  Initial form values can be set here.  

Addtionaly a new topic can be given a form using the =formtemplate= parameter in the URL.  Initial values can then be provided in the URLs or as form values.  Names being:
	* Not checkboxes - name e.g. ?BugPriority=1
	* Checkbox - namevalue=1 e.g. ?ColourRed=1.  Note that all boxes with a tick must be specified.

---+++ Creating New Topics with Forms

When you create a new topic in a web that has the WEBFORMS Preferences variable set, an [Add Form] button appears at the bottom of the page. If the WebTopicEditTemplate topic has a form added, the form will appear with values set; press [Change] to remove the template or to switch to a different one.

A form embedded in a topic also appears in a new topic. This is done by specifying the =formtemplate= parameter in the URL.

---+++ Setting Up Multiple Form Options

	* The optional ==WEBFORMS== variable defines alternative Form Templates that can be selected after pressing [Change] on the Edit page
	* A template topic can use any form template 
	* New topics with a form get instantiated by simple HTML forms asking for a topic name. If there is a <nop>SubmitExpenseReport topic were you can create new expense reports, a <nop>SubmitVacationRequest topic and so on. These can specify the required template topic and hence form. __HUH?__


---+++ Form Template Data Storage

The Form Template topic name, fields and values are stored in the topic [[TWikiDocumentation#TWikiMetaData][Meta Data]]. The order of field/value pairs in the Meta Data is the same as in the Template. The Form name is required for [Edit] and [Save].
-- JohnTalintyre - 16 Aug 2001 <br>
