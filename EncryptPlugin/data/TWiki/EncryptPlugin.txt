%META:TOPICINFO{author="TWikiContributor" date="1284795163" format="1.1" version="$Rev$"}%
---+!! Encrypt Plugin
<!--
   Contributions to this plugin are appreciated. Please update the plugin page at
   http://twiki.org/cgi-bin/view/Plugins/EncryptPlugin or provide feedback at
   http://twiki.org/cgi-bin/view/Plugins/EncryptPluginDev.
   If you are a TWiki contributor please update the plugin in the SVN repository.

   * Set SHORTDESCRIPTION = Securely encrypt text in TWiki topics to be accessible by selected users only
-->
<sticky>
<div style="float:right; background-color:#EBEEF0; margin:0 0 20px 20px; padding: 0 10px 0 10px;">
%TOC{title="Page contents"}%
</div>
</sticky>
%SHORTDESCRIPTION%

---++ Introduction

This plugin can be used to securely hide some text in a TWiki topic, such as passwords that should be accessible by an individual or a small group only. [[http://en.wikipedia.org/wiki/RC4][RSA RC4]] is used to encrypt text, which is the same technology used in Secure Sockets Layer (SSL) to protect Internet traffic and WEP to secure wireless networks.

---++ Syntax Rules

Add =%<nop>ENCRYPT{"any text"}%= anywhere in a TWiki page.

| *Write this:* | *Renders as: (for author)* | *Renders as: (for others)* |
| =%<nop>ENCRYPT{"Password: Abracadabra"}%= | =Password: Abracadabra= | =<nop>*****<nop>= |

Supported parameters:
   * ="any text"=: Text to encrypt
   * =allow="..."=: TWiki group or list of users allowed to view/edit encrypted text (comma space delimited list of !WikiWords)
   * =_dont_change="..."=: Identifier, added automatically after saving the page for the first time. Do not change.

Users who are allowed to view the encrypted text see:
   * the plain text in view mode
   * the plain text inside the =%<nop>ENCRYPT{...}%= variable when in edit mode

Users who are _not_ allowed to view the encrypted text see:
   * =<nop>*****<nop>= asterisks in view mode
   * a hash string inside the =%<nop>ENCRYPT{...}%= variable when in edit mode

Note that search cannot find encrypted text. This can be an advantage or a disadvantage depending how you look at it.

---++ Examples

*1. Encrypt text for my own use only*

=%<nop>ENCRYPT{"Jimmy Neutron"}%= encrypts text ="Jimmy Neutron"= to be viewable/editable only by the user who added the ENCRYPT variable.

*2. Encrypt text for my group*

=%<nop>ENCRYPT{"Helpdesk password: h3lp-Cu$t" allow="SupportGroup"}%= encrypts text to be viewable/editable by !SupportGroup members only.

After saving, the ENCRYPT variable is changed to =%<nop>ENCRYPT{_dont_change="PPq2ez7j"}%=. A member of the group sees =Helpdesk password: h3lp-Cu$t= when looking at the topic, and  =%<nop>ENCRYPT{"Helpdesk password: h3lp-Cu$t" allow="SupportGroup" _dont_change="PPq2ez7j"}%= when editing the topic. That is, members can change the encrypted text and the access restriction.

Other people see =<nop>*****<nop>= when looking at the page, and =%<nop>ENCRYPT{_dont_change="PPq2ez7j"}%= when editing the page. A non-member could change the ENCRYPT parameter the wiki way, which would invalidate the encrypted text. If this happens, anyone can view and restore the original text from a previous topic version, thus it is possible restore the encrypted text.

---++ Installation Instructions

__Note:__ You do not need to install anything on the browser to use this plugin. The following instructions are for the administrator who installs the plugin on the TWiki server. 

   * Download the ZIP file from the Plugin Home (see below)
   * Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
     | *File:* | *Description:* |
     | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
     | ==data/TWiki/VarENCRYPT.txt== | Variable documentation |
     | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
   * Create your asymetric key with openssl (currently only RSA key is supported): %BR%
     =openssl genrsa -out /var/www/twiki/lib/cryptkey.priv 2048=
   * Install the CPAN Dependencies listed in the Plugin Info section below
   * Configure the Plugin:
      * The TWiki =lib= directory is the default location of the private key file =cryptkey.priv=. If you store it in a different place add this setting to =twiki/lib/LocalSite.cfg=: %BR%
        =$TWiki::cfg{Plugins}{EncryptPlugin}{PrivateKey} = '/path/to/cryptkey.priv';=
      * Run the [[%SCRIPTURL{configure}%][configure]] script to enable the Plugin
   * Test if the installation was successful:
      * Add =%<nop>ENCRYPT{"any text"}%= to a topic in the Sandbox.WebHome web and verify that the text is viewable by you, and hidden by others.

---++ Plugin Info

|  Plugin Author: | TWiki:Main.PeterThoeny |
|  Copyright: | &copy; 2010, TWiki:Main.PeterThoeny %BR% &copy; 2010, TWiki:TWiki.TWikiContributor |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Plugin Version: | %$VERSION% |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  2010-09-18: | TWikibug:Item6617: Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.1 |
|  CPAN Dependencies: | CPAN:Mime::Base64, CPAN:Crypt::CBC, CPAN:Crypt::Rijndael_PP, CPAN:Crypt::RC4, CPAN:Crypt::OpenSSL::RSA |
|  Other Dependencies: | openssl to generate the asymetric key |
|  Perl Version: | 5.008 |
|  [[TWiki:Plugins/Benchmark][Benchmarks]]: | %SYSTEMWEB%.GoodStyle nn%, %SYSTEMWEB%.FormattedSearch nn%, %TOPIC% nn% |
|  Plugin Home: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC% |
|  Feedback: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Dev |
|  Appraisal: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Appraisal |

__Related Topics:__ VarENCRYPT, %SYSTEMWEB%.TWikiPlugins, %SYSTEMWEB%.DeveloperDocumentationCategory, %SYSTEMWEB%.AdminDocumentationCategory, %SYSTEMWEB%.TWikiPreferences
