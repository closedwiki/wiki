<!-- template:editjavascript.natedit.tmpl -->
%TMPL:DEF{"templatescript"}%%TMPL:P{"templatejavascript"}%%TMPL:END%
%TMPL:DEF{"script:skintemplate:edit"}%%TMPL:P{"templatejavascript"}%%TMPL:END%
%TMPL:DEF{"editjavascript"}%<!-- editjavascript -->
<script type="text/javascript">
function submitEditForm(script, action) {
  if (typeof(beforeSubmitHandler) != 'undefined') {
    beforeSubmitHandler(script, action);
  }
  if (action == 'add form') {
    document.main.elements['submitChangeForm'].value = action;
  }
  document.main.elements['action_preview'].value = '';
  document.main.elements['action_save'].value = '';
  document.main.elements['action_checkpoint'].value = '';
  document.main.elements['action_addform'].value = '';
  document.main.elements['action_replaceform'].value = '';
  document.main.elements['action_cancel'].value = '';
  document.main.elements['action_' + action].value = 'foobar';
  document.main.submit();
}
</script>
<!-- //editjavascript -->%TMPL:END%
%TMPL:DEF{"templatejavascript"}%<!-- templatejavascript -->
<script type="text/javascript" src="%PUBURLPATH%/%TWIKIWEB%/NatEditContrib/jquery.natedit.js"></script>
<script type="text/javascript">

$(function() {
  $("#topic").natedit({
    autoHideToolbar:false,
    autoMaxExpand:true,
    signatureMarkup: ['-- ', '%WIKIUSERNAME%', ' - %DATE%'],
    gotImagePlugin: %IF{"context ImagePluginEnabled" then="true" else="false"}%,
    gotMathModePlugin: %IF{"context MathModePluginEnabled" then="true" else="false"}%
  });
  window.setTimeout(fixHeightOfPane, 1);
});

var paneTop = -1;
var bottomBarHeight = -1;
function fixHeightOfPane() {

  var $tab = $(".jqTab:first .jqTabContents");

  if (paneTop < 0) {
    var paneOffset = $tab.offset({
      scroll:false,
      border:true,
      padding:true,
      margin:true
    });
    paneTop = paneOffset.top;
  }
  if (bottomBarHeight < 0) {
    bottomBarHeight = $(".natEditBottomBar").height();
  }

  var windowHeight = $(window).height();
  var height = windowHeight-paneTop-bottomBarHeight-70;

  // add new height to those containers, that don't have an natEditAutoMaxExpand element
  $(".jqTab:visible .jqTabContents").filter(function(index) { 
    return $(".natEditAutoMaxExpand", this).length == 0; 
  }).each(function() {
    $(this).height(height);
  });

  // add a slight timeout not to DoS IE 
  // before enabling handler again
  setTimeout(function() { 
    $(window).one("resize", fixHeightOfPane);
  }, 20);

}

</script>
%TMPL:P{"editjavascript"}%
<!-- //templatejavascript -->%TMPL:END%

