%META:TOPICINFO{author="PeterThoeny" date="1106382775" format="1.0" version="1.5"}%
---+ Black List Plugin

This is a simple utility to keep black sheep away from a public TWiki site. The site can be protected against excessive page access (e.g. by bad robots) and suspicious activities of users, such as multiple registrations or rapid topic updates indicating Wiki:WikiSpam.

The Plugin monitors activities by IP address and uses three IP address lists to protect the TWiki site:
	* WHITELIST: Manually maintained list of users who should never get on the BANLIST
	* BLACKLIST: Manually maintained list of malicious users
	* BANLIST: Automatically updated list of users with suspicious activities

Users on the BLACKLIST and BANLIST will have every page access delayed by one minute and will get an error message.

To fight Wiki-spam, the Plugin can also add a =rel="nofollow"= parameter to external URLs. Search engines will not follow links that have this parameter, taking away the incentive to add spam to TWiki.

---++ Plugin Settings

Plugin settings are stored as preferences variables. To reference a plugin setting write ==%<nop>&lt;plugin&gt;_&lt;setting&gt;%==, i.e. ==%<nop>INTERWIKIPLUGIN_SHORTDESCRIPTION%==

	* One line description, is shown in the %TWIKIWEB%.TextFormattingRules topic:
		* Set SHORTDESCRIPTION = Utility to keep malicious users away from a public TWiki site

	* Debug plugin: (See output in =data/debug.txt=)
		* Set DEBUG = 0

	* WHITELIST: Comma delimited list of IP addresses; possible to use partial addresses ending in a dot
		* Set WHITELIST = 127.0.0.1

	* BLACKLIST: Comma delimited list of IP addresses; possible to use partial addresses ending in a dot
		* Set BLACKLIST = 203.88.152., 203.88.155., 219.65.75.

<form name="banlist" action="%SCRIPTURL%/viewauth%SCRIPTSUFFIX%/%WEB%/%TOPIC%" method="get">
	* BANLIST: Automatically updated list of IP addresses based on BANLIST configuration
		* <select name="action"> <option></option> <option value="ban_add">Add</option> <option value="ban_remove">Remove</option> </select> IP address <input type="text" name="ip" size="16" value="" /> <input type="submit" value="Submit" /> %BLACKLIST{ action="%URLPARAM{action}%" value="%URLPARAM{ip}%" }%
		* Current list: %BLACKLIST{ action="ban_show" }%
</form>

	* BANLIST configuration, comma delimited list of: Points for registration, points for each save and upload, points for view raw, points for other actions like view, threshold to add to BANLIST, measured over time (in seconds)
		* Set BANLISTCONFIG = 20, 5, 1, 20, 120, 300
		* Your current score: %BLACKLIST{ action="user_score" }% for IP address %REMOTE_ADDR%

	* Message for users on BLACKLIST and BANLIST:
		* Set BLACKLISTMESSAGE = You are black listed at the %WIKITOOLNAME% web site due to excessive access or suspicious activities. Please contact site administrator %WIKIWEBMASTER% if you got on the list by mistake. Black listed IP addresses will be submitted to major blacklist databases.

	* Add a =rel="nofollow"= parameter to external URLs. Use this is to fight Wiki-spam. Search engines will not follow the link if a URL has a nofollow parameter, such as =&lt;a href="http://spammer.com/" rel="nofollow"&gt;=. Specify topic age in hours for which the nofollow parameter should appear (set it to a value that gives you enough time to remove spam); set it to -1 to add the nofollow parameter unconditionally to external URLs; or 0 to disable: (-1, 0, 1...N)
		* Set NOFOLLOWAGE = -1

	* Log access of users on BLACKLIST and BANLIST: (1 or 0)
		* Set LOGACCESS = 1

	* Access restriction
		* Set ALLOWTOPICCHANGE = %MAINWEB%.TWikiAdminGroup

---++ Plugin Installation Instructions

__Note:__ You do not need to install anything on the browser to use this plugin. The following instructions are for the administrator who installs the plugin on the server where TWiki is running. 

	* Download the ZIP file from the Plugin web (see below)
	* Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
	  | *File:* | *Description:* |
	  | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
	  | ==data/TWiki/%TOPIC%.txt,v== | Plugin topic repository |
	  | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
	* Test if the installation was successful:
		1 Using above form, add the IP address of one of your workstations to the BANLIST
		1 Access TWiki from that workstation
			* if you look at a TWiki topic (with the view script) you should see the BLACKLISTMESSAGE (defined above) after a one minute timeout
			* else, you should get an 500 Internal Server Error for other scripts
		1 On a different workstation, remove the IP address of the test workstation from the BANLIST


---++ Known Issues

	* The BANLIST does not work until you add and remove an IP address using above form

---++ Plugin Info

|  Plugin Author: | TWiki:Main/PeterThoeny |
|  Plugin Version: | 22 Jan 2005 (V1.004) |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  22 Jan 2005: | Added NOFOLLOWAGE handling |
|  19 Jan 2005: | Added score for "view raw" to address e-mail harvester issue |
|  05 Apr 2004: | Fixed bug in event log (requiring update of earlier Plugin versions); doc updates |
|  04 Apr 2004: | Added WHITELIST and BANLIST |
|  21 Mar 2004: | Initial version |
|  CPAN Dependencies: | none |
|  Other Dependencies: | none |
|  Perl Version: | 5.005 |
|  TWiki:Plugins/Benchmark: | %TWIKIWEB%.GoodStyle 99%, %TWIKIWEB%.FormattedSearch 99%, %TOPIC% 97% |
|  Plugin Home: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC% |
|  Feedback: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Dev |

__Related Topics:__ %TWIKIWEB%.TWikiPreferences, %TWIKIWEB%.TWikiPlugins, [[http://directory.google.com/Top/Computers/Internet/Abuse/Spam/Blacklists/][Google blacklist directory]]

-- TWiki:Main/PeterThoeny - 22 Jan 2005

