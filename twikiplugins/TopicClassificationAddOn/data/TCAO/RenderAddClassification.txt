%META:TOPICINFO{author="LynnwoodBrown" date="1171687697" format="1.1" version="1.24"}%
%META:TOPICPARENT{name="TopicFunction"}%
---+!! Function: %TOPIC%
%FORMFIELD{"Summary"}%

%TOC{depth="3"}%

---++ Further Development
   * Reduce decision steps:
      * Make the "predefined" radio a drop down for selecting type and add name field after radio for "new".
   * Disable create button unless a valid name is entered. Can take code from TWiki.WebTopicCreator.
   * For new classification, pull in Facets from template topic.

---++ Documentation
%STARTSECTION{name="documentation" type="section"}%
%TOPIC% is INCLUDED in TopicClassification and provides interface for adding new classifications to a web where TopicClassificationApplication is used.

Restrict view to %MAINWEB%.ModeratorGroup. This makes this form invisible for anyone not authorized to add TopicClassifications.
   * Set ALLOWTOPICVIEW = %MAINWEB%.ModeratorGroup

---+++++ Parameters
   * TYPE = %RED% Required %ENDCOLOR% - type of Classification form is form

---+++++ Css
   * None
%ENDSECTION{name="documentation" type="section"}%

---++ Implementation
<verbatim>
%STARTINCLUDE%
<script type="text/javascript" language="JavaScript"><!--
// The following section create a list of Classification Summary fields from the templates.
<noautolink>
%DBQUERY{ "Classification='%TYPE%'" web="%TCAOWEB%/Installs" format="var $topic$nop_summary = \"$formfield(Summary)\";" }%
</noautolink>

// This variable just a placeholder until select_predefined is filled.
var null_summary;
null_summary = " ";

// These variables are for holding the Summary value when switching back and forth between predefined and new.
var predefinedSummary, newSummary;
predefinedSummary = " ";
newSummary = " ";

function choosePredefined() {
   document.addType.topic.value=document.addType.select_predefined.value;
   document.addType.templatetopic.value=('%TCAOWEB%/Installs.' + document.addType.select_predefined.value);
  // Save any new Summary that may have been entered.
   newSummary=document.addType.Summary.value; 
   document.addType.Summary.value=eval(document.addType.select_predefined.value + '_summary');
   document.getElementById("addNew").style.display = "none";
   document.getElementById("addPredefined").style.display = "block";
}

function chooseNew() {
   document.addType.topic.value=document.addType.new_type.value;
%IFDEFINEDTHEN{"%TEMPLATE%" glue="off"}%
   document.addType.templatetopic.value="%TEMPLATE%";
%ELSEDEFINED%
   document.addType.templatetopic.value="%TCAOWEB%/Installs.%TYPE%Template";
%FIDEFINED%
   predefinedSummary=document.addType.Summary.value;
   document.addType.Summary.value=newSummary;
   document.getElementById("addPredefined").style.display = "none";
   document.getElementById("addNew").style.display = "block";
}

function selectPredefined() {
   document.addType.topic.value=document.addType.select_predefined.value;
   document.addType.templatetopic.value=('%TCAOWEB%/Installs.' + document.addType.select_predefined.value);
   document.addType.Summary.value=eval(document.addType.select_predefined.value + '_summary');
}

function nameNew() {
   document.addType.topic.value=removeSpacesAndPunctiation(capitalize(document.addType.new_type.value));
   document.addType.new_type.value=document.addType.topic.value;
   insertHtml((document.addType.topic.value + "Template"), "newTemplateFeedback");
}

function checkName() {
   if (document.addType.topic.value == 0) {
      alert("Please enter a new for your new <nop>%BASETOPIC%");
      return false;
   } else {
      return true;
   }
}

//--></script>

---+++ Add A New <nop>%TYPE% to the <nop>%BASEWEB% Web

<div class="twikiFormSteps">
<div class="twikiFormStep">
<p><form name="addType" action="%SCRIPTURLPATH%/save%SCRIPTSUFFIX%/%BASEWEB%/" onsubmit="return checkName()" >
Add <input type="radio" name="defined_or_new" checked="on" onClick="choosePredefined()"> *predefined* or <input type="radio" name="defined_or_new" onClick="chooseNew()"> *new* <nop>%TYPE%:
</p>
</div><!--/twikiFormStep--><div class="twikiFormStep">
<div id="addPredefined" style="display:block;"  >
*Select predefined <nop>%TYPE% to add:* <select name="select_predefined" size="1"  onchange="selectPredefined()" > <option value="null"> Select... </option>%SEARCH{ "[C]lassification.*value\=.*%TYPE%" web="%TCAOWEB%/Installs" excludetopic="%DBQUERY{ "Classification='%TYPE%'" web="%BASEWEB%" order="topic" format="$topic" separator=", "}%" order="topic" type="regex"  nonoise="on" format="<option>$topic</option>" separator="" }% </select> %BR%
</div>
<div id="addNew" style="display:none;"  >
*Create a new <nop>%TYPE% called:* <input type="text" name="new_type"  size="40" onblur="nameNew();" > %BR%
%IFDEFINEDTHEN{"%NEWEXTRA%" glue="off"}%
%INCLUDE{"%TOPIC%" section="%NEWEXTRA%" TYPE="%TYPE%"}% 
%FIDEFINED%
</div>
<p />
*Summary for this <nop>%TYPE%:* <input type="text" name="Summary" size="40" value=' ' /> 
<p />
*Optional: Specify Facets for this <nop>%TYPE%:* <input type="text" name="Facets" size="40" /> 
<p />
%IFDEFINEDTHEN{"%ALLEXTRA%" glue="off"}%
%INCLUDE{"%TOPIC%" section="%ALLEXTRA%" TYPE="%TYPE%"}% 
%FIDEFINED%
<input type="hidden" name="new_headline" value="Enter summary for your new <nop>%TYPE%..." />
<input type="hidden" name="topic" size="20" value=" " />
<input type="hidden" name="templatetopic" size="40" value="Template" />
<input type="hidden" name="formtemplate" value="TopicClassForm" />
<input type="hidden" name="Classification" value="%TYPE%" />
<p /><input type="submit" id="submit" value=" Create New <nop>%TYPE%  " />
</form>
</div><!--/twikiFormStep-->
</div><!--/twikiFormSteps-->
%STOPINCLUDE%
</verbatim>

---+++ noParent ALLEXTRA section
Use this section for assigning no parent as is the default for !TopicTypes
<verbatim>
%STARTSECTION{name="noParent" type="section"}%
<input type="hidden" name="topicparent" value="" />
%ENDSECTION{"noParent"}%
</verbatim>

---+++ defaultTemplate NEWEXTRA section
Use this section to create a new template topic based on the name of the new classification. Requires an accompanying CREATETOPIC tag in the template for the new class.
<verbatim>
%STARTSECTION{name="defaultTemplate" type="section"}%
%I% A new template topic called <span id="newTemplateFeedback" class="twikiInputFieldDisabled">...<!--generated name will be put here--></span> will automatically be created. %BR%
%ENDSECTION{"defaultTemplate"}%
</verbatim>

---+++ selectClassParent ALLEXTRA section
Use this section to add a select element for assigning parent topic that list topics _of the same class_ as the one being created.
<verbatim>
%STARTSECTION{name="selectClassParent" type="section"}%
<p />
*Optional: Assign another <nop>%BASETOPIC% as parent:* <select name="topicparent"> <option>%BASETOPIC%</option> %DBQUERY{"Classification='%BASETOPIC%'" web="%BASEWEB%" format="<option>$topic</option>" separator=" "}%</select>
%ENDSECTION{"selectClassParent"}%
</verbatim>


---++ Test
<div class="alt">
%DBCALL{"%TOPIC%" TYPE="SubjectArea" }%
</div>


%DBCALL{"%APPLIB%.RenderFunctionCallers"}%

---++ Copyright
<div style="text-align:justify;margin:1em;">
(C) 2006 LynnwoodBrown@Skyloom.com

%DBCALL{"%APPLIB%.GnuGeneralPublicLicense" section="notice"}%
</div>



%META:FORM{name="TopicForm"}%
%META:FIELD{name="TopicType" attributes="" title="TopicType" value="TopicFunction"}%
%META:FIELD{name="Summary" attributes="" title="Summary" value="Provides interface to adding new Classifications."}%
%META:TOPICMOVED{by="LynnwoodBrown" date="1159827949" from="TCAO2.RenderClassificationSetUp" to="TCAO2.RenderAddClassification"}%
%META:REVCOMMENT{comment_1=" " minor_1="1" ncomments="1" rev_1="22" t_1="1167774973"}%
