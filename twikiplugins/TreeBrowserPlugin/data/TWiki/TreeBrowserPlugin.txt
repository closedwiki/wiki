%META:TOPICINFO{author="TWikiContributor" date="1144877608" format="1.1" version="1.1"}%
---+ Tree Browser Plugin

Renders a bulleted or numbered list as a collapsable/expandable tree of nodes.

---++ Acknowledgement

This plugin leverages the [[http://www.destroydrop.com/javascripts/tree/][dTree]] !JavaScript tree menu by [[mailto:drop@destroydrop.com][Geir Landrö]] as well as code borrowed from TWiki:Plugins.RenderListPlugin.

---++ Syntax Rules

Place the tag =%<nop>TREEBROWSER{= _parameters_ =}%= immediately before a bulleted or numbered list. The lists can be handcrafted, generated by another Plugin, a =%<nop>TOC%=, or the result of a %TWIKIWEB%.FormattedSearch. The list will be rendered in a tree-like fashion (similar to the explorer folder list). Whenever a new indentation level is started, the subsequent nodes at this or a lower indentation level are shown as descendents of the preceding node. The following parameters can be used to configure the appearance of the tree:
| *Parameter* | *Description* | *Default* |
| ="name"= or%BR% =theme="name"= | Select a rendering theme | none |
| =title= | Required. This text serves as the root of the tree (rendered in bold face | none |
| =openAll= | If =on=, the tree is shown fully expanded. | =off= |
| =openTo= | Must be an integer. If present, the tree is expanded to the given node, as numbered from the root. | =0= |
| =shared= | Must be a string. If present, the state of the tree is shared across all trees using this string. For example, if the tree is used in the WebLeftBar, the state will hold at all topics with this WebLeftBar. | none |

Rendering themes can be defined by =&lt;name&gt;_THEME= Plugin settings
   * Each theme is defined by a comma separated list containing the render type and parameters required by that render type
   * There are different render types; currently this Plugin supports *tree* and *icon* render types
   * Format of the *tree* render type:
      * =Set &lt; _name_ &gt;_THEME = tree=
   * Format of the *icon* render type:
      * =Set &lt; _name_ &gt;_THEME = icon, [&lt; _root icon image_ &gt;], [&lt; _icon image_ &gt;], [&lt; _folder icon image_ &gt;], [&lt; _open folder icon image_ &gt;]=
      * The _root icon image_ is shown at the root of the tree, the _icon image_ is shown at every leaf node, the _folder icon image_ is shown at every collapsed internal node, and the _open folder icon image_ is shown at every expanded internal node. The icon images point to files attached to TWiki topics and are referenced in the standard manner. If no path is given, the images are taken from TWiki.TWikiDocGraphics.
      * If an icon image is omitted, the following defaults are chosen: %ATTACHURL%/empty.gif, %ATTACHURL%/page.gif, %ATTACHURL%/folder.gif, %ATTACHURL%/folderOpen.gif

If !JavaScript is not enabled, the list is rendered as usual, and the =%<nop>TREEBROWSER% tag is omitted.

---+++ Bullets

   * Use regular ==*== bullets
   * Start with level one
      * Increase indentation only one level at a time
         * =Like this=
   * Decreasing indentation many levels at a time is fine
   * Keep labels short as text does not wrap.
   * You can specify an icon for a bullet of render type *tree* or *icon*:
      * Attach the icon to a topic, e.g. =myicon.gif=, or
      * Use one of the existing icons: %ATTACHURL%/globe.gif =%<nop>ATTACHURL%/globe.gif=, %ATTACHURL%/home.gif =%<nop>ATTACHURL%/home.gif=, %ATTACHURL%/virtualhome.gif =%<nop>ATTACHURL%/virtualhome.gif=, %ATTACHURL%/group.gif =%<nop>ATTACHURL%/group.gif=, %ATTACHURL%/persons.gif =%<nop>ATTACHURL%/persons.gif=, %ATTACHURL%/virtualpersons.gif =virtualpersons.gif=, %ATTACHURL%/person.gif =%<nop>ATTACHURL%/person.gif=, %ATTACHURL%/virtualperson.gif =%<nop>ATTACHURL%/virtualperson.gif=, %ATTACHURL%/email.gif =%<nop>ATTACHURL%/email.gif=, %ATTACHURL%/trend.gif =%<nop>ATTACHURL%/trend.gif=, %ATTACHURL%/folder.gif =%<nop>ATTACHURL%/folder.gif=, %ATTACHURL%/file.gif =%<nop>ATTACHURL%/file.gif=, %ATTACHURL%/doc.gif =%<nop>ATTACHURL%/doc.gif=, %ATTACHURL%/image.gif =%<nop>ATTACHURL%/image.gif=, %ATTACHURL%/pdf.gif =%<nop>ATTACHURL%/pdf.gif=, %ATTACHURL%/ppt.gif =%<nop>ATTACHURL%/ppt.gif=, %ATTACHURL%/sound.gif =%<nop>ATTACHURL%/sound.gif=, %ATTACHURL%/xls.gif =%<nop>ATTACHURL%/xls.gif=, %ATTACHURL%/zip.gif =%<nop>ATTACHURL%/zip.gif=, %ATTACHURL%/see.gif =%<nop>ATTACHURL%/see.gif=
      * Refer to an attached icon at the beginning of the bullet with:
         * =icon:myicon.gif Followed by normal bullet text=

---++ Example

<verbatim>
%TREEBROWSER{"file" title="[[%HOMETOPIC%][%INCLUDINGWEB% Web Home]]" shared="left"}%
   * [[WebChanges][Changes]] 
   * [[WebIndex][Index]]
   * [[WebSearch][Search]]
   * this is a very very very long text
   * *Webs*
%WEBLIST{"      * [[$name.%HOMETOPIC%][$name]]"}%
</verbatim>
generates
<table borders="0">
<tr><th align="left">If installed</th><th align="left">Simulated</th></tr>
<tr><td>
%TREEBROWSER{"file" title="[[%HOMETOPIC%][%INCLUDINGWEB% Web Home]]" shared="left"}%
   * [[WebChanges][Changes]] 
   * [[WebIndex][Index]]
   * [[WebSearch][Search]]
   * this is a very very very long text
   * *Webs*
%WEBLIST{"      * [[$name.%HOMETOPIC%][$name]]"}%
</td><td><image src="%ATTACHURL%/tree.jpg"></td></tr></table>

This tree could be used in the TWiki.WebLeftBar, for example. Clicking on the plus icon next to =Webs= will expand the subtree below that node.

---++ Plugin Settings

Plugin settings are stored as preferences variables. To reference
a plugin setting write ==%<nop>&lt;plugin&gt;_&lt;setting&gt;%==, i.e. ==%<nop>TREEBROWSERPLUGIN_SHORTDESCRIPTION%==

   * One line description, is shown in the %TWIKIWEB%.TextFormattingRules topic:
      * Set SHORTDESCRIPTION = Renders a list as a collapsable/expandable tree.

   * Debug plugin: (See output in =data/debug.txt=)
      * Set DEBUG = 0

   * Themes are named =&lt;SOMETHING&gt;_THEME= and contain a comma delimited list of render type with parameters:
      * Set THREAD_THEME = tree
      * Set HOME_THEME = icon, %ATTACHURL%/home.gif
      * Set ORG_THEME = icon, %ATTACHURL%/base.gif, %ATTACHURL%/home.gif, %ATTACHURL%/person.gif, %ATTACHURL%/persons.gif
      * Set GROUP_THEME = icon, tip.gif, %ATTACHURL%/page.gif, %ATTACHURL%/person.gif, %ATTACHURL%/group.gif
      * Set EMAIL_THEME = icon, %ATTACHURL%/email.gif
      * Set TREND_THEME = icon, %ATTACHURL%/trend.gif
      * Set FILE_THEME = icon, %ATTACHURL%/empty.gif


---++ Plugin Installation Instructions

   0 Download the zip file.
   0 Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
     | *File:* | *Description:* |
     | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
     | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
     | ==View.pm.patch== | Patch to =lib/TWiki/UI/View.pm= |
     | ==pub/TWiki/%TOPIC%/dtree.css== | part of dtree |
     | ==pub/TWiki/%TOPIC%/dtree.js== | part of dtree |
     | ==pub/TWiki/%TOPIC%/base.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/cd.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/empty.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/folder.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/folderopen.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/globe.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/imgfolder.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/join.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/joinbottom.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/line.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/minus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/minusbottom.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/musicfolder.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/nolines_minus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/nolines_plus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/page.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/plus.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/plusbottom.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/question.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/trash.gif== | part of dtree |
     | ==pub/TWiki/%TOPIC%/doc.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/email.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/file.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/group.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/home.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/image.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/pdf.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/person.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/persons.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/ppt.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/see.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/sound.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/trend.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/virtualhome.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/virtualperson.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/virtualpersons.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/xls.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |
     | ==pub/TWiki/%TOPIC%/zip.gif== | icons from [[TWiki:Plugins.RenderListPlugin][RenderListPlugin]] |

   0 Patch =lib/TWiki/UI/View.pm= using =View.pm.patch=. This patch inserts code into =lib/TWiki/UI/View.pm= which lifts some !JavaScript up into the head section of the document.
   0 See if the above example renders correctly.

---++ Planned Enhancements

   * Support configurable icons for each node (similar to TWiki:Plugins.RenderListPlugin).
   * Support configurable default icons.
   * Support wrapping of long node text.
   * Allow for tree status to be shared across topics (e.g., leave the status of nodes unchanged for a tree used in the WebLeftBar).
   * Support tree browser in other than view mode also.

---++ Plugin Info

|  Plugin Author: | TWiki:Main.ThomasWeigert |
|  Plugin Version: | 16 Sep 2005 |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  12 Apr 2006: | Minor update for TWiki:Codev.TWikiRelease04x00  |
|  16 Sep 2005: | Fix bug in =openAll= and =openTo= functions  |
|  06 Sep 2005: | Adopt the rendering themes from TWiki:Plugins.RenderListPlugin |
|  05 Sep 2005: | Support sharing of tree state across topics. If !JavaScript is not enabled, render the list in standard fashion. Correct user input error containig a line that is too deeply indented. |
|  04 Sep 2005: | Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.024 |
|  CPAN Dependencies: | none |
|  Other Dependencies: | none |
|  Perl Version: | 5.005 |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  TWiki:Plugins/Benchmark: | %TWIKIWEB%.GoodStyle n%, %TWIKIWEB%.FormattedSearch n%, %TOPIC% n% |
|  Plugin Home: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC% |
|  Feedback: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Dev |
|  Appraisal: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Appraisal |

__Related Topics:__ TWiki:Plugins.RenderListPlugin

-- TWiki:Main.ThomasWeigert - 16 Sep 2005

