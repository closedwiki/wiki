%META:TOPICINFO{author="TWikiContributor" date="1154450646" format="1.0" version="$Rev$"}%
---+!! <nop>%TOPIC%
The <nop>%TOPIC% handles the tag =%<nop>TIMETABLE%= and creates a weekly timetable. 
The timetable is rendered with HTML tables and should work with all modern web browsers.

It also handles the tag =%<nop>TTCM%= (<nop>TimeTable Compatibilty Mode). The compatibility mode allows the usage of all TWiki:Plugins.CalendarPlugin event types. The =%<nop>TTCM%= tag should be placed into the description field of an event and must contain a time range and
optional colors in a comma seperated list (=&lt;time range&gt;[<nop>[','&lt;forground color&gt;][','&lt;background color&gt;]]=), 
e.g: 
<br/> you type:
<verbatim>
	* 22 May 2006 - %TTCM{"7:00-1:00pm,white,black"}% Meeting
	* 23 May 2006 - 24 May 2006 - %TTCM{"7am-4pm,yellow"}% Conference
</verbatim>
you get:
	* 22 May 2006 - <span style="color:white;background-color:black">07:00am-01:00pm</span> Meeting
	* 23 May 2006 - 24 May 2006 - <span style="background-color:yellow">07:00am-04:00pm</span> Conference

The =%<nop>TTTOPICSETUP%= tag allows you to define foreground/background colors and a timezone for all events on a topic.


*Example: (png image):*

<img src="%ATTACHURLPATH%/example.png" alt="timetable example" />


%TOC%

---++ Syntax Rules

Events are defined with bullets. Following event types are supported to define entries for the timetable:

| *Event Type* | *Syntax* | *Example(s)* |
| <b>Single</b>	| ==&nbsp;* DDD - HH:MM - HH:MM - description== | ==&nbsp;* Mon - 09:00 - 11:00 - Meeting== |
|^| ==&nbsp;* DDD - HH:MM - HH:MM - description - background color== | ==&nbsp;* Mon - 09:00 - 11:00 - Meeting - green== |
|^| ==&nbsp;* DDD - HH:MM - HH:MM - description - foreground color, background color== | ==&nbsp;* Mon - 09:00 - 11:00 - Meeting - white,black== |
| <b>List</b> | ==&nbsp;* DDD, DDD,... - HH:MM - HH:MM - description== | ==&nbsp;* Mon,Tue - 08:00 - 8:15 - Breakfast== | 
|^| ==&nbsp;* DDD, DDD,... - HH:MM - HH:MM - description - background color== | ==&nbsp;* Mon,Tue - 08:00 - 8:15 - Breakfast - yellow== | 
|^| ==&nbsp;* DDD, DDD,... - HH:MM - HH:MM - description - forground color, background color== | ==&nbsp;* Mon,Tue - 08:00 - 8:15 - Breakfast - white,black== |
| <b>Interval</b> | ==&nbsp;* DDD - DDD - HH:MM - HH:MM - description== | ==&nbsp;* Mon - Fri - 12:15 - 13:00 - Lunch== |
|^| ==&nbsp;* DDD - DDD - HH:MM - HH:MM - description - background color== | ==&nbsp;* Mon - Fri - 12:15 - 13:00 - Lunch - green== |
|^| ==&nbsp;* DDD - DDD - HH:MM - HH:MM - description - foreground color, background color== | ==&nbsp;* Mon - Fri - 12:15 - 13:00 - Lunch - white,black== |

If you enable the compatibility mode (see Attributes or Plugins Settings sections) you can also use all TWiki:Plugins.CalendarPlugin event types.
Examples:
<verbatim>
%TIMETABLE{compatmode="1" startdate="12 Jun 2006"}%
	* 12 Jun - %TTCM{"10am-5pm,yellow"}% Every 12th of June between 10am and 5pm
	* E Wed - Every Wednesday (whole-time)
	* 12 Jun 2006 - 19 Jun 2006 - %TTCM{"12:15pm-1pm,white,black"}% Lunch with Mary
	* 13 Jun 2006 - 10:00-12:00 Meeting 
	* 14 Jun 2006 - Meeting - 01pm-03pm,green
</verbatim>
*Notes:*
	* The parameter of the %<nop>TTCM% tag *must not contain any whitespaces*.
	* Time ranges in a description field *must not contain any whitespaces*.
	* If no %<nop>TTCM% tag or no time range was specified in a description of a TWiki:Plugins.CalendarPlugin event the event gets a full-time event (12:01am-11:59pm o'clock, 0-24h).
 
---++ Attributes
Usage: %<nop>TIMETABLE{attribute1="value1" attribute2="value2" ...}% 

Example: %<nop>TIMETABLE{lang="Deutsch" timeinterval="15" }%

| *Attribute* | *Comment* | *Default/Example* |
|  *Behavior:*  |||
| compatmode | if set to "1" all TWiki:Plugins.CalendarPlugin event types are supported (related: compatibility mode attributes); %X% the description field can contain a time range (without any whitespaces, e.g. 1pm-2pm) or a %<nop>TTCM%-Tag (e.g. ==%<nop>TTCM{"7:00-1:00pm,white,black"}%== ) with a time range and optional foreground and background color and *without* any *whitespaces* | compatmode="0" |
| days	 | days to show | days="7" |
| endtime | a end time, e.g. 18:00, 6:00pm, ...  | endtime="8:00pm" |
| lang | Language used for weekdays in the table header and for event entries (e.g: English, Deutsch, Français, Español, Nederlands, Dansk, suomi, ...) | lang="English" |
| showweekend | show weekend if set to '1' | showweekend="1" |
| starttime | a start time, e.g. 7:00, 8a.m., 9:15a.m. ... | starttime="7:00am" |
| timeformat | time format; allowed values: 12, 12am, 12p.m., 12a.m, 12p.m. and 24 | timeformat="24" |
| timeinterval | interval steps in minutes for the timeline | timeinterval="30" |
| timezone | an hour offset (allowed values: -12 ... 0 ... +12) for time correction %X% It is *not* a real time zone like CET, CEST but you can use it in =%<nop>TIMETABLE%= and =%<nop>TTTOPICSETUP%= to simulate time zones.| timezone="0" |
| topic  | a comma separated list of source topics | topic="%<nop>TOPIC%" |
| wholetimerow | enables/disables a whole-time event row (related attributes: wholetimerowtext, wholetimerowtitle) | wholetimerow="0" |
| workingendtime | working hours end time | workingendtime="5:00pm" |
| workingstarttime | working hours start time | workingstarttime="9:00am" |
|  *Compatibility Mode:*  |||
| cmheaderformat | table header format of a day; a subset of strftime conversion specifiers is supported (only date not time specificiers; see manual page or TWiki:Codev.ConvergeDateTimeFormattingModels) | cmheaderformat="&lt;font&nbsp;title=\"%A - %d %b %Y\" size=\"-2\">%b&lt;br/&gt;%a&lt;br/&gt;%e&lt;/font&gt;" |
| daynames | costum daynames (a list separated by a '¦' and starting on Monday; overwrites lang attribute) | daynames="M¦T¦W¦T¦F¦S¦S" |
| forcestartdate | if set to 1 the timetable starts with the given startdate ('0' means: the timetable view starts with Monday') | forcestartdate="0" |
| month | set a month (e.g. Jan, Feb ... or 01, 02, ... 12 ) or a month offset (e.g. +0, +1, -2,...) | month="+1" |
| monthnames | custom month names (a list separated by '¦' and starting on January; overwrites lang attribute) | monthnames="J¦F¦M¦A¦M¦J¦J¦A¦S¦O¦N¦D" |
| navnext | navigation button to the next n days | navnext="&amp;gt;&amp;gt;" |
| navnexttitle | title text (tooltip text) for the navigation button to the next n days | navnexttitle="Next %n day(s)" |
| navprev | navigation button to the previous n days | navprev="&amp;lt;&amp;lt;" |
| navprevtitle | title text (tooltip text) for the navigation button to the previous n days | navprevtitle="Previous %n day(s)" |
| startdate | a start date (e.g. '1 Oct 2005') or a day offset (e.g. '10', '+30' or '-30') | startdate="+0" |
| year | set a year (e.g. 2005, 2006 ...) or a year offset (e.g. +0, +1, -1, ...) | year="+0" |
|  *Table formatting:*  |||
| descrlimit | per line character limit for the description | descrlimit="10" | 
| displaytime | display time in the event description of the timetable | displaytime="0" |
| eventbgcolor | default background color of an event cell (you can overwrite this with an event entry) | eventbgcolor = "#AAAAAA" |
| eventfgcolor | default text color of an event cell (you can overwrite this with an event entry) | eventfgcolor = "black" |
| headerformat | table header format of a day; a subset of strftime conversion specifiers is supported (only date not time specificiers; see manual page or TWiki:Codev.ConvergeDateTimeFormattingModels) | headerformat="&lt;font&nbsp;title=\"%A - %d %b %Y\" size=\"-2\">%a&lt;/font&gt;" |
| name | header content of the first column | name = "&amp;nbsp;" |
| nowbgcolor | highlight current time in the timeline with a background color | nowbgcolor="black" | 
| nowfgcolor | highlight current time in the timeline with a forgeround color | nowfgcolor="white" |
| showtimeline | show timeline =left=, =right=, or on =both= sides | showtimeline="both" |
| tablebgcolor | table background color | tablebgcolor="white" |
| tablecaption | table caption shown above the timetable | tablecaption="Timetable" |
| tableheadercolor | color of the table header | tableheadercolor="%<nop>WEBBGCOLOR%" |
| todaybgcolor | highlight today column with a background color | todaybgcolor="black" |
| todayfgcolor | highlight today column with a foreground color | todayfgcolor="white" | 
| weekendbgcolor | highlight weekends with a column background color | weekendbgcolor="%<nop>WEBBGCOLOR%" |
| weekendfgcolor | highlight weekends with a column foreground color | weekendfgcolor="black" |
| wholetimerowpos | whole-time event row position (default: top), allowed values: top, bottom, both | wholetimerowpos="top" |
| wholetimerowtext | text in the time line of the whole-time event row | wholetimerowtext="24h"|
| wholetimerowtitle | alternate text for the wholetimerowtext | wholetimerowtitle="whole-time events" |
| workingbgcolor | highlight working hours in the timeline with a background color | workingbgcolor="white" |
| workingfgcolor | highlight working hours in the timeline with a foreground color | workingfgcolor="black" |

*Hints:*
	* You can use TextFormattingRules for some attribute values: tablecaption, name, navnext, navprev, wholetimerowtext
	* Every attribute of %<nop>TIMETABLE% can also be used as plugin setting. You only have to use capital letters.


---++ Examples
%TIMETABLE{descrlimit="9"}%
	* Mon,Tue - 9 - 14 - MONTEST1 - green
	* Mon - 9 - 11 - MONTEST2 - yellow
	* Mon - 10 - 13 - MONTEST3 - white,black
	* Mon - 12 - 15 - MONTEST4


	* Tue - 9 - 9:30 - TUETEST1
	* Tue - 9 - 10:00 - TUETEST2
	* Tue - 10:00 - 11:00 - TUETESTFO
	* Tue - 9 - 11:30 - TUETEST3
	* Tue - 12 - 15 - TUETEST4
	
	* Wed - 7 - 9 - WEDTEST1
	* Wed - 9 - 11 - WEDTEST2
	* Wed - 11 - 13 - WEDTEST3
	* Wed - 13 - 17 - WEDTEST4

	* Thu - 7 - 20:30 - THUTEST1
  
	* Fri - 7 - 10 - FRITEST1
	* Fri - 12 - 15 - FRITEST2

	* Sat - 5 - 10 - SATTEST1 - white,blue
	* Sat - 6 - 21 - SATTEST2 - yellow
	* Sat - 11 - 22 - SATTEST3 - green 

	* Sun - 9:18 - 17:35 - SUNTEST1 - red
	* Sun - 18:00 - 18:15 - SUNTEST2 - yellow
---++ Plugin Settings

Plugin settings are stored as preferences variables. To reference a plugin setting write ==%<nop>&lt;plugin&gt;_&lt;setting&gt;%==, i.e. ==%<nop>NEWPLUGIN_SHORTDESCRIPTION%==

	* One line description, is shown in the %TWIKIWEB%.TextFormattingRules topic:
		* Set SHORTDESCRIPTION = Render a weekly timetable

	* Debug plugin: (See output in =data/debug.txt=)
		* Set DEBUG = 0

	* Time format (default: 24, allowed: 12, 12pm, 12am, 12a.m.,12p.m., 12PM, 12AM, or 24):
		* # Set TIMEFORMAT = 12

	* Timetable start time (default: 7:00am):
		* # Set STARTTIME = 7am

	* Timetable end time (default: 8:00pm):
		* # Set ENDTIME = 8pm

	* Enable/Disable whole-time event row (default: disabled):
		* # Set WHOLETIMEROW = 1
		* # Set WHOLETIMEROWPOS = top
		* # Set WHOLETIMEROWTEXT = 24h
		* # Set WHOLETIMEROWTITLE = whole-time events

	* Character limitation of a description in a table cell line (default: 10):
		* # Set DESCRLIMIT = 15

	* Show timeline on the =left=, =right= or =both= sides (default: both):
		* # Set SHOWTIMELINE = left

	* Language (default: English - see manual page of Date::Calc perl module, e.g: English, Deutsch, Français, Español, Nederlands, Dansk, suomi, ...): 
		* # Set LANG = Deutsch

	* Enable/Disable compatibility mode (default: off) to (dis)allow TWiki:Plugins.CalendarPlugin event types:
		* # Set COMPATMODE = 1

	* Set unknown parameter message (default: =%<nop>RED% Sorry, some parameters are unknown: %<nop>UNKNOWNPARAMSLIST% %<nop>ENDCOLOR% &lt;br/&gt; Allowed parameters are (see !TWiki.TimeTablePlugin topic for more details): %<nop>KNOWNPARAMSLIST%=)
		* # Set UNKNOWNPARAMSMSG = %RED% Following parameter(s) is/are unknown: %UNKNOWNPARAMSLIST% %ENDCOLOR%


*Note:* Every attribute of %<nop>TIMETABLE% can also be used as plugin setting. You only have to use capital letters.

---++ Plugin Installation Instructions

__Note:__ You do not need to install anything on the browser to use this plugin. The following instructions are for the administrator who installs the plugin on the TWiki server. 

	* Download the ZIP file from the Plugin web (see below)
	* Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
	  | *File:* | *Description:* |
	  | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
	  | ==data/TWiki/%TOPIC%.txt,v== | Plugin topic repository |
	  | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
	  | ==lib/TWiki/Plugins/%TOPIC%/TimeTable.pm== | Plugin Perl library |
	  | ==pub/TWiki/%TOPIC%/example.png== | example image |
	* Configure the Plugin:
		* TWiki 4.0 and up: Run the [[%SCRIPTURL%/configure%SCRIPTSUFFIX%][configure]] script to enable the Plugin
		* Change the Plugin settings as needed
	* Test if the installation was successful:
		* see Examples section

---++ Plugin Info

|  Plugin Author: | TWiki:Main.DanielRohde |
|  Copyright: | &copy; 2006, TWiki:Main.DanielRohde |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Plugin Version: | V1.008 (BETA) |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  V1.008 (BETA) | added timezone feature requested by TWiki:Main.BenWatts; fixed major midday/midnight (12pm/12am) bug reported by TWiki:Main.BenWatts; fixed overlapping day bug; fixed periodic event bug; fixed minor bugs (stylesheet bug: annyoing <nop>JavaScript errors; empty event row) |
|  V1.007 (23 Jun 2006) | TWiki:Main.DanielRohde: fixed major bug (wholetimerow: empty column) |
|  V1.006 (23 Jun 2006) | TWiki:Main.DanielRohde: fixed major mod_perl bug (paging in compatmode); added whole-time row feature; fixed minor bugs (empty column color; cutted text) |
|  V1.005 (8 Jun 2006) | TWiki:Main.DanielRohde: fixed typos (documentation); added new features (compatmode only): inline time range feature and navigation; minor improvements (table header, ...) |
|  V1.004 (31 May 2006) | TWiki:Main.DanielRohde: fixed typos (documentation, timeformat); added new attributes (days, forcestartdate, nowfgcolor, nowbgcolor); fixed minor bug (periodic repeater); added new event type (list) |
|  V1.003 (24 May 2006) | TWiki:Main.DanielRohde: added compatibility mode (TWiki:Plugins.CalendarPlugin event types); added documentation and new attributes; fixed bugs (bgcolor bug; conflict rendering; documentation; error logs; warnings);|
|  V1.002 (22 May 2006): | TWiki:Main.DanielRohde: fixed major bugs (conflict handling, preferences); added documentation; |
|  V1.001 (19 May 2006): | TWiki:Main.DanielRohde: fixed some major bugs (conflict entries, parameter handling, long descriptions); added documentation; |
|  V1.000 (16 May 2006): | TWiki:Main.DanielRohde: Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.021 |
|  CPAN Dependencies: | CPAN:Date::Calc |
|  Other Dependencies: | none |
|  Perl Version: | 5.005 |
|  [[TWiki:Plugins/Benchmark][Benchmarks]]: | %TWIKIWEB%.GoodStyle nn%, %TWIKIWEB%.FormattedSearch nn%, %TOPIC% nn% |
|  Plugin Home: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC% |
|  Feedback: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Dev |
|  Appraisal: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Appraisal |

__Related Topics:__ %TWIKIWEB%.TWikiPlugins, %TWIKIWEB%.DeveloperDocumentationCategory, %TWIKIWEB%.AdminDocumentationCategory, %TWIKIWEB%.TWikiPreferences

-- TWiki:Main.DanielRohde - 16 May 2006
 

%META:FILEATTACHMENT{name="example.png" attr="h" comment="" date="1148998422" path="example.png" size="34071" user="rohdedan" version="1.6"}%
