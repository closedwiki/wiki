%META:TOPICINFO{author="TWikiContributor" date="1127834520" format="1.0" version="1.1"}%
---+!! The Natural Skin Plugin

This is the supplemental plugin for the NatSkin. This plugin is inspired
by the TWiki:Plugins/GnuSkin by TWiki:Main/JoachimNilsson and the TWiki:Plugins/PhotonSkin by TWiki:Main/EstebanManchado (<nop>PhotonSearch) renamed to =natsearch= . This plugin tries
to be maximal compatible with all past, current and upcomming TWiki releases, namely beijing,
cairo and dakar. Therefore some mechanisms have been internalized that are only available on
the newest dakar engine, sandbox security and html login dialogues comparable  to TWiki:Plugins/AuthPagePlugin. In addition the plugin tries to be interface-compatible to all
engines using the =Func.pm= API. In those cases where this is _not_ possible, because needed
functions are not part of the =Func.pm= API, access functions have been added to 
address the different implementations and incompatibilities (e.g. access to topic meta data).

%TOC%

---++ Current Features
	* Sandbox security: backport of the dakar sandbox
	* Login page: independent implementation of a login page (see ) for
	  maximal compatibility with old TWiki releases
	* WebSideBar: a configurable navigation bar on the 
	  left hand side, with topic content on the right;
	* MySideBar: every user can extend the sidebar with a personalized navigation
	* <nop>NatSearch: a search+go box that combines advanced search with the GO feature of twiki
	* Skin state: an internal representation of different ways to render the NatSkin concerning
		* the style variant,
		* the sidebar location,
		* the page border decoration and
		* the web buttons in the topbar 
	* Conditional content: 
		* USERACTIONS, NATLOGON: display topic actions depending on the user being logged in or not
		* IFSKINSTATE: render skin differently depending on the current skin state
		* IFACCESS: render different content or include topics depending on access rights
		* IFDEFINED: render content based on twiki variables being defined or not (compare to the
		  <nop>IfStatement of the upcomming dakar release)
	* GROUPSUMMARY: render %MAINWEB%.TWikiGroups nicely
	* Group based subsription: generate an automated email notification if a new TWiki
	  user want's to join a TWiki Group
	* email address obfuscation: all email addresses in topic texts are obfuscated by the use
	  of dynamic html; so mailto links are still clickable while the pure html text does not
	  allow to extract the addresses by respective web crawlers.
	* marking external links: add a nice icon to offsite links
	* skin style control: add infrastructure to get, set and display the skin style that
	  is currently active using the NatSkinStyleBrowser
	* FORMATLIST: render list items according a format parameter (will be externalized into
	  a separate plugin asap).

---++ Syntax Rules
| *Tag* | *Desciption* |
| =%<nop>WEBSIDEBAR%= \
| displays the left navigation menu using the WebSideBar topic |
| =%<nop>MYSIDEBAR%= \
| display a personalized WebSideBar for the user currently logged in |
| =%<nop>WEBLINK{web="..." name="..."}%= \
| display a link to a WebHome with the given name and add the SITEMAPUSEDTO description to \
  to the hover balloon |
| =%<nop>NATLOGON%= \
| displays =Logon&#124;Register= for <nop>TWikiGuest, and \
  =%WIKINAME%&#124;Logout= otherewise |
| =%<nop>USERACTIONS%= \
| display =Edit&#124;Attach&#124;Move&#124;Raw&#124;Diffs&#124;More= when \
  logged in and an empty string for <nop>TWikiGuest |
| =%<nop>GROUPSUMMARY%= \
| display list of group members in a %MAINWEB%.TWikiGroups nicely \
  by extracting the =GROUP= and =ALLOWTOPICCHANGE= variables of \
  a group topic and adds links "Contact all members" and "Contact all maintainters"; \
  by definition maintainers of a group are those listed in the =ALLOWTOPICCHANGE= \
  variable of the group topic |
| =%<nop>ALLUSERS%= \
| display a list of all registered users generated from the %MAINWEB%.TWikiUsers topic; \
  this is usefull for specific access configurations on beijing and cairo engines \
  (obsolete on dakar) |
| =%<nop>KNOWNSKINSTYLES%= \
| render a list of all known skin styles being attachted to the NatSkin topic |
| =%<nop>GETSKINSTYLE%= \
| get the current skin style; the priority is \
  (1) urlparam =style=&lt;name>=, \
  (2) value of the session variable =NATSKIN_STYLE= and \
  (3) preference value =SKINSTYLE= set in \
		(a) the user preferences \
		(b) the WebPreferences or \
		(c) %TWIKIWEB%.TWikiPreferences |
| =%<nop>IFSKINSTATE{&lt;tests> then="..." else="..."}%= \
| conditionally returns content depending on the current skin state; \
  &lt;tests> can be \
  <ul> \
	 <li> =style="&lt;name>"=: test if the current style is &lt;name> </li> \
	 <li> =border="on,off,thin"=: test if the current border is on, off or "thin" </li> \
	 <li> =buttons="on,off"=: test if the web buttons are currently on or off </li> \
	 <li> =sidebar="left,right,off"=: \
			test if the sidebar is currently on the right, left or off </li> \
	 <li> =release="beijing,cairo,dakar"=: test if the twiki release this plugin is installed on\
			is beijing, cairo or dakar </li>\
	 <li> =action="view,edit,preview,..."=: test the current topic action </li> \
  </ul> \
  The tag will render the "then" content if all tests evaluate to true and \
  the "else" content otherwise. Tested strings can be regular expressions. |
| =%<nop>IFSKINSTATETHEN{&lt;tests>}% <br/>\
  &lt;then content> <br/> \
[%<nop>ELSIFSKINSTATE{&lt;tests>}% <br/>\
  &lt;elsif content>]* <br/> \
[%<nop>ELSESKINSTATE% <br/>\
  &lt;else content>]? <br/> \
%<nop>FISKINSTATE%= \
| This is the multi-line version if %<nop>IFSKINSTATE{}%\
  that uses the same tests as above but takes the content from between the sections; thus, \
  arbitrary <nop>TWikiML might be rendered conditionaly. Note, that IFSKINSTATETHENs can be \
  nested safely |
| =%<nop>IFDEFINED{"&lt;<nop>TWikiML>" \
  [action="view,edit,preview,..."]? \
  then="..." else="..."}%= \
| returns "then" or "else" depeinding on the &lt;<nop>TWikiML> expression expanding to the \
  emtpy string or not and \
  the current topic action matching the given one; this tag works similar to the <nop>IfStatement\
  in dakar but is backwards compatible to beijing and cairo and omits the overhead of an expression\
  parser |
| =%<nop>IFDEFINEDTHEN{"&lt;<nop>TWikiML>" [action="view,edit,preview,..."]?}% <br/> \
  &lt;then content> <br/> \
[%<nop>ELSIFDEFINED{...}% <br/> \
  &lt;elsif content>]* <br/> \
[%<nop>ELSEDEFINED% <br/> \
  &lt;else content>]? <br/> \
%<nop>FIDEFINED%= \
| This is the multi-line version if %<nop>IFSDEFINED{}%; \
  IFDEFINEDTHENs can be nested safely |
| =%<nop>WIKIRELEASENAME%= \
| returns "beijing", "cairo" or "dakar" depending on the TWiki engine this plugin is installed on |
| =%<nop>IFACCESS{"&lt;topic>" action="" then="..." else="..." mode="" [then_]args="..." else_args="..."}%= \
| display content in =then= or =else= argument depending on the access rights of the current user\
  to the topic =&lt;topic>; \
  =action= can be =view=, =change= or =rename= \
  specifying the requested access mode;\
  =mode= can be =text= or =include= where =text= conditionally renders the text in  \
  the =then= and =else= arguments and =text= includes the topic in =then= or =else=; \
  if =then= is not specified in =include= mode then =&lt;topic>= is included if access \
  is granted; example: %<nop>IFACCESS{"<nop>AdminSideBar" mode="include"}% includes the \
  <nop>AdminSideBar if the current user has view access to this topic |
| =%<nop>NATREVISIONS%= | substitute for the =%<nop>REVISIONS%= tag which only works on \
  the TWiki:Plugins/PatternSkin (todo: fix REVISIONS) |
| =%<nop>NATMAXREV%= | substitute for =%<nop>MAXREV%= which differes on beijing, cairo and dakar |
| =%<nop>PREVREV%= | returns the previous topic revision taking =NumberOfRevisions= into account |
| =%<nop>CURREV%= | returns the current topic revision (compatible among all TWiki engines) |


---++ About <nop>NatSearch

This is a cgi-script that is heavily based on the <nop>PhotonSearch of the TWiki:Plugins/PhotonSkin.
So =natsearch= is basically a fork of that including fixes to similar security flaws that 
hit the WebSearch those days also. Here's the list of differences:

	* replaced the =a= flag with =g= to indicate global search
	* obey the =NOSEARCHALL= flag for global search
	* remember the original search string and insert it back into the input field
	* added perl's =use strict= and fixed all warnings
	* fixed several mod-perl issues
	* add friendly message when nothing's been found
	* use =noSpamPadding= to obfuscate email addresses
	* light weighted google-like hit colorization

Please see the TWiki:Plugins/PhotonSkin for an explanation of the possible search parameters
(TODO: maby move that stuff in here).

---++ About the WebSideBar

The WebSideBar is used to generate a navigation appearing next to 
the main topic area. Each web in your <nop>%WIKITOOLNAME% might optionaly have a 
separate WebSideBar. The default [[%TWIKIWEB%.WebSideBar]] can be used to add a default 
section common to all WebSideBars.
If the WebSideBar isn't defined the default [[%TWIKIWEB%.WebSideBar]] 
is used. Each user might define a personalized WebSideBar called =%<nop>WIKINAME%SideBar= that is
appended to the WebSideBar. The TWiki:Plugins/RedDotPlugin is used to make customizing the WebSideBar
easier appended to the different parts that make up the complete sidebar. These are hidden if
you don't have write access to the respective topic fragments.

---++ About Logon &amp; Logout

=LOGONTOPIC=

---++ Plugin Settings
Below are the settings which affect the behavior of the NatSkin.

	* Set SHORTDESCRIPTION = Supplements the bare bones NatSkin theme for TWiki

---+++ Skin state configuration
The skin state is controlled by a set of variables that are configured on the user's home topic,
the WebPreferences or the [[%TWIKIWEB%.TWikiPreferences]] and are then loaded into the current
session of the user. So every setting can be changed by an url parameter to take effect for the
duration of the user session. The default values are given below 

	* switch to the given style,
	  Base, Clean, <nop>GeorgiaBlue, Gettysburg, Independence, Kubrick, <nop>PlainJane, Rusty,
		<nop>SeaGreen, Squash or Stormy, url param =style=
		* Set SKINSTYLE = Clean
	* change the border decoration on, off or to thin (enabling a thin blog-like page layout),
	  url param is =styleborder=
		* Set STYLEBORDER = off
	* switch on/of the web buttons in the top bar of the page
		* Set STYLEBUTTONS = off
	* switch the sidebar to be displayed on the right or left side or off, url param is =stylesidebar=
		* Set STYLESIDEBAR = left

In addition there's a url parameter =togglesidebar= that disables the sidebar for this request
only. 

To emulate the Kubrick style on the old
[[http://binarybonsai.com][BinaryBonsai]] (not the new K2 style) then copy-paste this
	* Set SKINSTYLE = Kubrick
	* Set STYLEBORDER = thin
	* Set STYLEBUTTONS = on
	* Set STYLESIDEBAR = right
to your [[%TWIKIWEB%.TWikiPreferences]]. Try out other settings using the NatSkinStyleBrowser,
or even INCLUDE it in your [[%MAINWEB%.%WIKINAME%SideBar]].

There are some constraints build into the NatSkin templates that try guarantee a pleasant appearance
when combining the different skin states:
	* If the styleborder is "thin" the sidebar will be disabled for the edit, manage, rdiff,
	  natsearch, changes and search topic actions. 
	* The web buttons will alternate with the sidebar so that they will not be displayed
	  on the same side. 
	* If the web buttons are enabled the default WebSideBar will disable the redundant 
	  navigation to other webs.

---+++ Style support for the TablePlugin 
These attributes will be loaded into your session and thereby overwriting any 
default settings on the TablePlugin topic. Depending on the skin style you are currently
using these settings will be changed accordingly.


	* Set BASETABLEATTRIBUTES = databg="white" headercolor="black" headerbg="white" tableborder="0" cellpadding="0" cellspacing="0" 
	* Set CLEANTABLEATTRIBUTES = headercolor="#444444"
	* Set GEORGIABLUETABLEATTRIBUTES = headercolor="#999966"
	* Set GETTYSBURGTABLEATTRIBUTES = headercolor="#03366"
	* Set INDEPENDENCETABLEATTRIBUTES = databg="white, #f0f0f0" headercolor="white"
	* Set KUBRICKTABLEATTRIBUTES = databg="#f4f4f4, white" headercolor="#0055aa"
	* Set PLAINJANETABLEATTRIBUTES = headercolor="#666666"
	* Set RUSTYTABLEATTRIBUTES = headercolor="white"
	* Set SEAGREENTABLEATTRIBUTES = databg="white, #f0f0f0" headercolor="white"
	* Set SQUASHTABLEATTRIBUTES = databg="white, #f0f0f0" headercolor="white"
	* Set STORMYTABLEATTRIBUTES = databg="#333333, #444444" headercolor="#cccccc" headerbackground="black", headerbg="black"

---++ Plugin Installation Instructions

	* Install the plugins this one depends on (see below) of not done so already.
	* Download the ZIP file from the Plugin web (see below)
	* Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:

	  | *File:* | *Description:* |
	  | ==bin/natlogon== | logon cgi script |
	  | ==bin/natsearch== | search cgi script |
	  | ==data/TWiki/%TOPIC%.txt== | plugin topic |
	  | ==data/TWiki/MySideBar.txt== | plugin to customize a personalized sidebar |
	  | ==data/TWiki/MySideBarTemplate.txt== | topic template for MySideBar |
	  | ==lib/TWiki/Plugins/NatSkinPlugin.pm== | main module |
	  | ==lib/TWiki/Plugins/NatSkinPlugin/Sandbox.pm== | security module |
	  | ==lib/TWiki/Plugins/NatSkinPlugin/Search.pm== | <nop>NatSearch module |
	  | ==lib/TWiki/Plugins/NatSkinPlugin/Auth.pm== | authentication module |
    * (Dakar) Visit =configure= in your TWiki installation, and enable the plugin in the {Plugins} section.
	* on [[%TWIKIWEB%.TWikiPreferences]] change the SKIN variable to "nat";
	  customize the default style adding the variables SKINSTYLE, STYLEBORDER,
	  STYLEBUTTONS and STYLESIDEBAR (see NatSkin)


---++ Plugin Info

|  Plugin Author: | TWiki:Main/MichaelDaum |
|  Plugin Version: | v2.50 (2005-09-27) |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  27 Sep 2005: | added IFSKINSTATE and IFDEFINED features; \
						added web button support |
|  30 Aug 2005: | added external link detection; fixed IFSKINSTYLE; \
						added style support for the TWiki:Plugins.TablePlugin |
|  26 Aug 2005: | new NatSkin-2.0 release |
|  28 Apr 2005: | pre-release to fix installation on TWiki/Cairo |
|  16 Mar 2005: | Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.024 |
|  CPAN Dependencies: | none |
|  Other Dependencies: | SpreadSheetPlugin, SessionPlugin, RedDotPlugin |
|  Perl Version: | >=5.6 |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  TWiki:Plugins/Benchmark: | TWiki:TWiki/GoodStyle nn%, TWiki:TWiki/FormattedSearch nn%, %TOPIC% nn% |
|  Plugin Home: | TWiki:Plugins.NatSkinPlugin |
|  Feedback: | TWiki:Plugins.NatSkinPluginDev  |
|  Appraisal: | TWiki:Plugins.%TOPIC%Appraisal |

__Related Topics:__ TWiki:Plugins/NatSkinPlugin, TWiki:Plugins/NatSkin

-- TWiki:Main.MichaelDaum - 27 Sep 2005 

