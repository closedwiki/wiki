%META:TOPICINFO{author="TWikiUserMapping_micha" date="1180543279" format="1.1" version="1.3"}%
<!--

   PLEASE DO NOT EDIT THIS TOPIC

   It is automatically generated from the subversion repository, and any changes
   you make will simply be overwritten the next time a release is generated.

   Instead, you could check your fix in, raise a bug in the Bugs web, or mail the author.
-->
---+!! <nop>%TOPIC%
This plugin can be used to establish an online-voting system. Votes are
collected in a separate file. There are two types of voting:
   * *select mode*: vote on a given choice
   * *star mode*: collect ratings on a given set of options
You can only vote once; the last vote overrides the former. A voter can vote anonymously
on "open" votes. Anonymous votes are distinguished based on the remote address and time of
the voter. To vote on a "closed" poll (=open="0"=), you will have to login first. Your
username is then used to keep you from voting multiple times on the same question.

Every poll has got an identification which distinguishes it from several on the same page
or - when you've defined it to be global (=global="1"=) - collect votes on the same
poll from all over the site.

The result of a poll is displayed alongside with the vote form (todo: decouple that).


---++ Example
%VOTE{id="FavouriteMeal" select1="Drink" options1="Beer,Wine,Milk,Water" select2="Food" options2="Steak,Bread,Pasta,Pizza"}%

%VOTE{id="Jazzers" stars1="Herbie Mann" stars2="Horace Silver" stars3="Thelonious Monk"}%

---++ Syntax Rules

The %<nop>VOTE{ ... }% macro defines a poll using the following options:
| *name* | *description* | *example* |
| =id= | \
The identifier of a poll. This must be unique within the topic. \
You can have multiple independent votes in the same \
topic. | <nop>FavouriteMeal |
| =style= | \
Specifies the style of the poll result. Possible values are a \
combination of =bar=, =perc=, =total=, =stars= and =sum= to specify the \
display style of the poll results (the default is =bar,perc,total=). | =bar= |
| =select<i>&lt;n&gt;</i>= | \
As you can see in the example above, multiple \
decisions can be made within the same poll. \
You can have as many selects per %VOTE as you want. | =Drinks= |
| =options<i>&lt;n&gt;</i>= | \
Each select&lt;n&gt; must have a corresponding set of options that \
the voter will select from. | =Beer,Wine,Milk= |
| =global= | If set to ="on"=, this makes the =id= global in your TWiki. \
Votes with global id's accumulate; the same id in two topics are \
effectively both the same vote. | |
| =open= | Normally votes are recorded anonymously i.e. the database does *not* record who voted. If this option is set to ="on"=, then the database will record who voted. | |

=select= and =option= can use the pseudo variables =$percnt=, =$dollar=, 
=$quote= and =$doublequote= to render the respective characters in the vote
output.

The %<nop>VOTE{ ... }% will generate the selection box(es) and the poll
results.

The plugin will count only your latest vote. You may only vote once a day.

You can weight the vote results by setting the !TWikiPreference
=%<nop>VOTEPLUGIN_WEIGHTINGS%= to the name of a topic that is used
to weight the votes of certain members of the community in the final result.
For example,
<verbatim>
| *Name* | *Weight* |
| AlbertCamus | 100 |
| SunTszu | 50 |
| NiccoloMachiavelli | 1000 |
</verbatim>
The numbers are percentages. A user who isn't otherwise weighted has a weighting of 100. A weighting lower that 100 reduces their influence on the vote, and a weighting higher than 100 increases it. In the example above,
   * !AlbertCamus has a weight of 100, as does !AdamSmith (who gets the default)
   * !SunTszu's votes only count for half as much as !AlbertCamus'
   * !NiccolaMachiavelli has ten times as much influence as !AlbertCamus and !AdamSmith, and twenty times as much as !SunTszu.
The weighting topic applies to all votes in the scope of the =%<nop>VOTEPLUGIN_WEIGHTINGS%= setting.

---++ Plugin Installation Instructions
%$INSTALL_INSTRUCTIONS%

---++ Plugin Info
<!-- provided for compatibility only
   * Set SHORTDESCRIPTION = Simple way to count votes
-->
|  Plugin Author: | TWiki:Main/MichaelDaum |
|  Copyright &copy;: | 2005-2007, Michael Daum http://wikiring.de |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Plugin Version: | v1.32 |
|  Change History: | &nbsp; | 
|               | Added =global= and =VOTEPLUGIN_WEIGHTINGS= - TWiki:Main/CrawfordCurrie |
|  31 Aug 2006: | added NO_PREFS_IN_TOPIC |
|  15 Aug 2006: | added "use strict" and fixed revealing errors |
|  27 Apr 2006: | added lazy compilation |
|   7 Dec 2005: | added gif bar; removed debug flag |
|   9 Oct 2005: | fixed invocation of normalizeFileName |
|   8 Oct 2005: | added added a little more style flexibility |
|   7 Oct 2005: | storing votes into =_Vote*.txt= now (was =Vote*.txt= before) ;\
                fixed error messaging on empty argument lists |
|  14 Sep 2005: | fixes for dakar |
|  14 Apr 2005: | incorporated =getLocaldate()= function |
|  16 Mar 2005: | use Cache API only if its there; delayed =use &lt;package&gt;= | 
|   7 Mar 2005: | Initial version |
|  TWiki Dependency: | $TWiki::Plugins::VERSION 1.024 |
|  CPAN Dependencies: | none |
|  Other Dependencies: | none |
|  Perl Version: | >=5.6.1 |
|  TWiki:Plugins/Benchmark: | TWiki:TWiki/GoodStyle nn%, TWiki:TWiki/FormattedSearch nn%, %TOPIC% nn% |
|  Plugin Home: | TWiki:Plugins/%TOPIC% |
|  Feedback: | TWiki:Plugins/%TOPIC%Dev |
|  Appraisal: | TWiki:Plugins/%TOPIC%Appraisal |

-- TWiki:Main.MichaelDaum - 31 Aug 2006
