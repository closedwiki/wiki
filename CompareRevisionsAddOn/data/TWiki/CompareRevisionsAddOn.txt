%META:TOPICINFO{author="jcf" date="1141040906" format="1.0" version="1.9"}%
---+ Compare Revisions Add-On

This add-on compares the renderd HTML output of two revisions and shows the differences broken down to the word-by-word level if necessary. The output can be formatted by templates and skins.

%TOC%

---++ Description

The CompareRevisionsAddOn compares two revisions of a document, like _rdiff_ does.
But in contrast to normal _rdiff_, the comparison is done with the rendered HTML output of the revisions 
instead of the TWiki source text files. (This feature was proposed by many of our users, who found
the normal _rdiff_ output too technical - even with the _sidebyside_ option - and wanted to see
differences in the content of the page).

Furthermore, the differences between the revisions are shown as close as possible. If necessary, this means
that different words are marked instead of whole lines or even paragraphs.

The differences may be shown in two formats, either side-by-side or as an interwoven output of the old and
new revision (like it is done in  Word or !StarOffice/!OpenOffice):

	* [[%ATTACHURL%/interweave.png][Screenshot of interwoven output]]
	* [[%ATTACHURL%/sidebyside.png][Screenshot of side-by-side output]]

The appearance can be affected by templates and skins. Default templates for the classic and pattern skins are 
included in the distribution.

---++ Usage

Call ==http:<nop>//your/twiki/bin/compare/Web/Topic?parameters== from your browser

---+++ Parameters

==rev1=<i>rev</i>== and ==rev2=<i>rev</i>== %BR%
Revision numbers of the two revisions which should be compared. 
Defaults to the last two revisions. (More exact:
_rev2_ defaults to the latest edition, _rev1_ defaults to _rev2_ - 1)

==render=interweave== or ==render=sidebyside== %BR%
Chooses the output format. May also be given in the preference variable COMPARERENDERSTYLE

==context=<i>n</i>== %BR%
The number _n_ of unchanged sections which should be shown around changed sections. 
A section means a top-level section like a paragraph, table, etc.
If _n=-1_ (the default), all unchanged sections are shown.
May also be given in the preference variable COMPARECONTEXT

==skin=<i>someskin</i>== %BR%
Chooses _someskin_ for the output. See section [[#Templates][Templates]] below

---+++ Templates

The output of the script is rendered by templates. Two templates are needed,
==compare.tmpl== (or ==compare.skin.tmpl==) for the side-by-side format,
and ==interweave.tmpl== (or ==interweave.skin.tmpl==) for the interwoven
format.

The templates itself are broken into 7 parts

<verbatim>
template for start of page
%REPEAT%
template for unchanged section 
which is not printed according to context
%REPEAT%
template for unchanged section 
which is printed
%REPEAT%
template for changed section
%REPEAT%
template for added section
%REPEAT%
template for deleted section
%REPEAT%
template for end of page
</verbatim>

All empty templates for a section default to their predecessor. (E.g. if you 
do not specify a template for a deleted section, it defaults to the template
for an added section, which in turn may default to the template for a changed section).

In the templates for a section, ==%<nop>TEXT1%== is replaced by the text of the old revision
and ==%<nop>TEXT2%== is replaced by the text of the new revision.
In interwoven output, only ==%<nop>TEXT1%== is used.

Examples for templates can be found in the default template files from
the distribution (==compare.tmpl==, ==compare.pattern.tmpl==, ==interweave.tmpl==,
==interweave.pattern.tmpl== ).

---+++ CSS Styles

The differences in the two revisions are marked with the help of
CSS style classes, whose appearance should be defined in the templates.

The following classes are used:

==twikiCompareAdd== %BR%
Class for added items (i.e. items which are in the newer revision, 
but not yet in the older one)

==twikiCompareDelete== %BR%
Class for deleted items (i.e. items which are in the older revision,
but no more in the newer one)

==twikiCompareChange1== %BR%
Class for the items from the older revision which have been changed.

==twikiCompareChange2== %BR%
Class for the items from the newer revision which have been changed.

In the default templates files from the distribution, the classes 
==twikiCompareAdd== and ==twikiCompareChange1== are defined with
a light red background and stroken out text, and ==twikiCompareDelete== 
and ==twikiCompareChange2== are defined with a light green background.


---++ Add-On Installation Instructions

__Note:__ You do not need to install anything on the browser to use this add-on. The following instructions are for the administrator who installs the add-on on the server where TWiki is running. 

	* This script needs some additional Perl modules.
	  If necessary, download and install the required perl modules from [[http://www.cpan.org][CPAN]]. 
	  If you do not want to install these modules in your standard perl location,
	  install them in /your/twiki/lib.
	  (See e.g.
	  [[http://www.perldoc.com/perl5.6.1/pod/perlmodinstall.html][perldoc perlmodinstall]] on how to 
	  install perl modules).%BR%
	  These modules are required:
		* [[http://cpan.uwinnipeg.ca/module/HTML::Tree][HTML::Tree]] (with HTML::TreeBuilder and HTML::Element). These modules in turn need
			* [[http://cpan.uwinnipeg.ca/module/HTML::Parser][HTML::Parser]]
			* [[http://cpan.uwinnipeg.ca/module/HTML::Tagset][HTML::Tagset]]
		* Algorithm::Diff (which is included in the standard TWiki installation
	* Download the [[%ATTACHURL%/CompareRevisionsAddOn.zip][ZIP file]] from the Add-on Home (see below)
	* Unzip ==%TOPIC%.zip== in your twiki installation directory. Content:
	  | *File:*							 | *Description:*	|
	  | ==data/TWiki/%TOPIC%.txt==	| Add-on topic	  |
	  | ==data/TWiki/%TOPIC%.txt,v== | Add-on topic repository  |
	  | ==bin/compare==				  | Add-on script  |
	  | ==lib/TWiki/UI/Compare.pm==  | Perl package used by the script |
	  | ==templates/compare.tmpl==	| Template for side-by-side output |
	  | ==templates/compare.pattern.tmpl== | Same for pattern skin |
	  | ==templates/interweave.tmpl==	| Template for interwoven output |
	  | ==templates/interweave.pattern.tmpl== | Same for pattern skin |
	  | _The following files are only in the distribution for the Dakar (4.0.x) release_ ||
	  | ==lib/TWiki/Plugins/CompareRevisionsAddonPlugin.pm== | Helper plugin (Dakar only) |
	  | ==data/TWiki/CompareRevisionsAddonPlugin.txt== | Plugin topic (Dakar only) |
	  | ==data/TWiki/CompareRevisionsAddonPlugin.txt,v== | Plugin topic repository (Dakar only) |
	  | ==templates/view_cra.tmpl== | Replacement for view.tmpl (Dakar only) |
	  | ==templates/view_cra.pattern.tmpl== | Replacement for view.pattern.tmpl (Dakar only) |
	* Test if the installation was successful:%BR%
	  Call ==%<nop>SCRIPTURL%/compare/Web/Topic== with
	  some existing topic.
	* Add links to the _compare_ script in your templates for viewing a topic 
	  (or replace the links to _rdiff_ with links to _compare_)
	  (but see below for Dakar release) 

The following instructions apply only for the Dakar (4.0.x) release of TWiki:

	* Enable the helper plugin CompareRevisionsAddonPlugin with the configure script
	* If you want to replace the links to _rdiff_  by links to _compare_, either replace
	  the view.tmpl by the provided view_cra.tmpl, and view.pattern.tmpl by view_cra.pattern.tmpl,
	  or include a line <br>
	  ==SET VIEW_TEMPLATE = view_cra==
	  in TWiki.TWikiPreferences
	  (These templates will also support the HistoryPlugin, if it is enabled)


---++ Add-On Info

|  Add-on Author: | TWiki:Main/JChristophFuchs |
|  Add-on Version: | 03 Mar 2005 (Twiki Sep 2004 release) / 26 Feb 2006 (Twiki 4.0.x release) |
|  Change History: | <!-- versions below in reverse order -->&nbsp; |
|  26 Feb 2006: | Updated for Dakar |
|  02 Mar 2005: | Corrected bug concerning uninitialized elements |
|  03 Feb 2005: | Removed blank paragraphs before comparing |
|  20 Jan 2005: | Initial version |
|  CPAN Dependencies: | [[http://cpan.uwinnipeg.ca/module/HTML::Parser][HTML::Parser]], [[http://cpan.uwinnipeg.ca/module/HTML::Tagset][HTML::Tagset]], [[http://cpan.uwinnipeg.ca/module/HTML::Tree][HTML::Tree]] |
|  Other Dependencies: | none |
|  Perl Version: | 5.005 |
|  License: | GPL |
|  Add-on Home: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC% |
|  Feedback: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Dev |
|  Appraisal: | http://TWiki.org/cgi-bin/view/Plugins/%TOPIC%Appraisal |

__Related Topic:__ %TWIKIWEB%.TWikiAddOns

-- TWiki:Main/JChristophFuchs - 20 Jan 2005


%META:FILEATTACHMENT{name="CompareRevisionsAddOn.zip" attr="" comment="zip file containing all files of the distribution (Sep 2004 release)" date="1109775619" path="CompareRevisionsAddOn.zip" size="17278" user="jcf" version="1.2"}%
%META:FILEATTACHMENT{name="interweave.png" attr="" comment="Screenshot of interwoven output" date="1106231658" path="interweave.png" size="4375" user="jcf" version="1.1"}%
%META:FILEATTACHMENT{name="sidebyside.png" attr="" comment="Screenshot of side-by-side output" date="1106231695" path="sidebyside.png" size="6359" user="jcf" version="1.1"}%
%META:FILEATTACHMENT{name="CompareRevisionsAddOn.Dakar.zip" attr="" comment="Addon for Dakar (4.0.x) release" date="1141041191" path="CompareRevisionsAddOn.Dakar.zip" size="27843" user="jcf" version="1.1"}%
%META:REVCOMMENT{comment_1="Attached file !CompareRevisionsAddOn.Dakar.zip" comment_2="Changed properties for attachment !CompareRevisionsAddOn.zip" comment_3="Changed properties for attachment !CompareRevisionsAddOn.Dakar.zip" minor_1="0" minor_2="0" minor_3="0" ncomments="3" rev_1="9" rev_2="9" rev_3="9" t_1="Upload1141041192" t_2="PropChanged1141041306" t_3="PropChanged1141041333"}%
