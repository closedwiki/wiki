%META:TOPICINFO{author="TWikiContributor" date="1023947640" format="1.0" version="1.1"}%
<!--

   PLEASE DO NOT EDIT THIS TOPIC

   It is automatically generated from the subversion repository, and any changes
   you make will simply be overwritten the next time a release is generated.

   Instead, you could check your fix in, raise a bug in the Bugs web, or mail the author(s).
-->
---+!! <nop>%TOPIC%

%TOC%

---++ Description
This plugin adds a couple of tags that allow to render content conditionally.
There are two different ways to do that: either by using the inline 
=%<nop>IFDEFINED{"string" then="..." else="..."}%= tag that returns the 
=then= or =else= argument depending on the =string= being defined, that is non-empty.
There are no other ways to decide the condition but rendering the =test= string 
being a <nop>TWikiML expression, for example by embedding a =%<nop>CALC{}%= expression. This simplifies
this plugin alot and allows a rather flexible way to generate the condition.

The other way is to use blocks of content surrounded by expressions like this:
<verbatim>
%IFDEFINEDTHEN{"test"}%
...
%ELSIFDEFINED{"test"}%
...
%ELSEDEFINED%
...
%FIDEFINED%
</verbatim>
This way the conditioned content is not limited to fit into a the argument
position of a =%<nop>IFDEFINED{...}%= expression.  Blocks can be nested and are
evaluated starting from the outside, contrary to standard <nop>TWikiML being
evaluated left-to-right-inside-out.

---++ Related work
Similar extensions have been done before but are either only available as an integral part of TWiki-4.0 
(see TWiki:TWiki04/IfStatements) or unmaintained (see TWiki:Plugins/ConditionalPlugin).
Especially these two alternatives are rather similar as they defined the same tag (%IF).
The main differences between those and this plugin here is that they have a more elaborated
conditon parser that allows to evaluate more complex boolean expressions. Some of the
expressions in %IF of TWiki-4.0 are specific to that platform and make only sense there
(context). The other difference is that the IFDEFINED tag family allows nested blocks of
conditional content and %IF is an inline tag only.

The advantage of this plugin is that you get a simpler mechanism for checking the condition
which is however more flexible as the string can be generated arbitrarily using <nop>TWikiML.
Furthermore, and possibly more important, this plugin is backwards compatible and may be used
on a TWiki/Beijing, TWiki/Cairo and TWiki/Dakar engine.

This plugin has been externalized from the TWiki:Plugins/NatSkinPlugin.


---++ Syntax Rules
---+++ IFDEFINED
*Syntax*: 
<verbatim>
%IFDEFINED{"test" 
  [action="view,edit,preview,..."]? 
  [as="..."]
  then="..." 
  else="..." 
  glue="on,off"}%
</verbatim>

returns the "then or "else" content depending on the "test"
expression expanding to the emtpy string or to the string given in "as".
Optionally the current topic action is checked to match the one given in "action".  
Normally, all surrounding whitespaces are removed, that is the resulting content
is glued together in a way. You may switch that off by setting "glue" to "off"
thus preventing all whitespace as it is.

The "then" and "else" strings may contain the following pseudo-variables:
   * =$n=: substituted with a newline character (\n)
   * =$percnt=: substituted with a percent character (%)
   * =$dollar=: substituted with a dollar character ($)
   * =$test= or =$variable=: substituted with the "test" string
   * =$value=: substituted with the "as" string


---+++ IFDEFINEDTHEN, ELSIFDEFINED, ELSEDEFINED, FIDEFINED
*Syntax*:
<verbatim>
%IFDEFINEDTHEN{"test" [action="view,edit,preview,..."]?}% 
  <then content> 
[%ELSIFDEFINED{...}% 
  <elsif content>]* 
[%ELSEDEFINED%
  <else content>]?
%FIDEFINED%
</verbatim>

This is the multi-line version of [[#IFSDEFINED][IFSDEFINED]].
IFDEFINEDTHEN expressions can be nested safely.  Within a single IFDEFINEDTHEN
the ELSIFDEFINED parts can be repeated arbitrarily.  Before rendering the
=&lt;then|elsif|else condition>= any =$nop= string will be removed first.
Thereby nested <nop>TWikiML expressions can be prevented from being expanded in
advance.

---++ Demo
	* Set FOO = foo
	* FOO is %IFDEFINED{"%FOO%" then=" " else="not" glue="off"}% defined.
	* FOO is %IFDEFINED{"%FOO%" as="bar" then=" " else="not" glue="off"}% defined as "bar".
	* BAR is %IFDEFINED{"%BAR%" then=" " else="not" glue="off"}% defined.
   


---++ Plugin Installation Instructions

	* [[http://twiki.org/p/pub/Plugins/%TOPIC%/%TOPIC%.zip][Download]] the ZIP file
	* Unzip it in your twiki installation directory. Content: 
	  | *File:* | *Description:* |
	  | ==data/TWiki/%TOPIC%.txt== | Plugin topic |
	  | ==lib/TWiki/Plugins/%TOPIC%.pm== | Plugin Perl module |
	* (Dakar) Visit =configure= in your TWiki installation, and enable the plugin in the {Plugins} section.

---++ Plugin Info
<!-- provided for compatibility only
	* Set SHORTDESCRIPTION = Render content conditionally
-->
|  Plugin Author: | TWiki:Main.MichaelDaum |
|  Copyright &copy;: | 2006, MichaelDaum@WikiRing.com |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Plugin Version: | v0.95 |
|  Change History: | <!-- specify latest version first -->&nbsp; |
|  18 Sep 2006: | allow multinline values to be checked |
|  31 Aug 2006: | added NO_PREFS_IN_TOPIC |
|  15 Aug 2006: | added =$test= and =$value= |
|  07 Aug 2006: | be smarter to detect the cgi action wrt to different apache setups |
|  10 Mar 2006: | added =as= parameter; \
                  added escape parameters and recursive variable expansion to the condition argument \
		  which helps to circumvent problems due to different plugin orders |
|  21 Feb 2006: | Initial version |
|  CPAN Dependencies: | none |
|  Other Dependencies: | none |
|  Perl Version: | 5.8 |
|  TWiki:Plugins/Benchmark: | %TWIKIWEB%.GoodStyle nn%, %TWIKIWEB%.FormattedSearch nn%, %TOPIC% nn% |
|  Plugin Home: | TWiki:Plugins/%TOPIC% |
|  Feedback: | TWiki:Plugins/%TOPIC%Dev |


-- TWiki:Main.MichaelDaum - 18 Sep 2006
